<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-400ZH-Designing-and-Implementing-Microsoft-DevOps-solutions
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-400ZH-Designing-and-Implementing-Microsoft-DevOps-solutions
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-400ZH-Designing-and-Implementing-Microsoft-DevOps-solutions" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#准备工作">准备工作</a></li><li class="nav-item"><a class="nav-link" href="#练习-0配置实验室先决条件">练习 0：配置实验室先决条件</a></li><li class="nav-item"><a class="nav-link" href="#练习-1创作和部署-azure-资源管理器模板">练习 1：创作和部署 Azure 资源管理器模板</a></li><li class="nav-item"><a class="nav-link" href="#练习-2删除-azure-实验室资源">练习 2：删除 Azure 实验室资源</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="实验室-13使用资源管理器模板进行-azure-部署">实验室 13：使用资源管理器模板进行 Azure 部署</h1>
<h1 id="学生实验室手册">学生实验室手册</h1>

<h2 id="实验室概述">实验室概述</h2>

<p>在本实验室中，你将创建一个 Azure 资源管理器 (ARM) 模板，并使用链接模板概念将其模块化。然后，你将修改主部署模板以调用链接的模板和更新的依赖关系，最后将模板部署到 Azure。</p>

<h2 id="目标">目标</h2>

<p>完成本实验室后，你将能够：</p>

<ul>
  <li>创建资源管理器模板</li>
  <li>创建用于存储资源的链接模板</li>
  <li>将链接模板上传到 Azure Blob 存储并生成 SAS 令牌</li>
  <li>修改主模板以调用链接模板</li>
  <li>修改主模板以更新依赖关系</li>
  <li>使用链接模板将资源部署到 Azure</li>
</ul>

<h2 id="实验室持续时间">实验室持续时间</h2>

<ul>
  <li>预计用时：<strong>60 分钟</strong></li>
</ul>

<h2 id="说明">说明</h2>

<h3 id="准备工作">准备工作</h3>

<h4 id="登录到实验室虚拟机">登录到实验室虚拟机</h4>

<p>请确保已使用以下凭据登录到 Windows 10 虚拟机：</p>

<ul>
  <li>用户名：<strong>Student</strong></li>
  <li>密码：<strong>Pa55w.rd</strong></li>
</ul>

<h4 id="查看本实验室所需的应用程序">查看本实验室所需的应用程序</h4>

<p>确定你将在本实验室中使用的应用程序：</p>

<ul>
  <li>Microsoft Edge</li>
  <li><a href="https://code.visualstudio.com/">Visual Studio Code</a>。此应用程序将作为本实验室先决条件安装。</li>
</ul>

<h4 id="准备-azure-订阅">准备 Azure 订阅</h4>

<ul>
  <li>标识现有的 Azure 订阅或创建一个新的 Azure 订阅。</li>
  <li>验证你拥有 Microsoft 帐户或 Azure AD 帐户，该帐户在 Azure 订阅中具有所有者角色并且在与 Azure 订阅关联的 Azure AD 租户中具有全局管理员角色。</li>
</ul>

<h3 id="练习-0配置实验室先决条件">练习 0：配置实验室先决条件</h3>

<p>在本练习中，你将设置实验室先决条件，其中包括 Visual Studio Code。</p>

<h4 id="任务-1安装并配置-git-和-visual-studio-code">任务 1：安装并配置 Git 和 Visual Studio Code</h4>

<p>在此任务中，你将安装 Visual Studio Code。如果你已经实现了此先决条件，则可以直接进行下一个任务。</p>

<ol>
  <li>如果尚未安装 Visual Studio Code，请从实验室计算机启动 Web 浏览器，导航到 <a href="https://code.visualstudio.com/">Visual Studio Code 下载页面</a>以进行下载和安装。</li>
</ol>

<h3 id="练习-1创作和部署-azure-资源管理器模板">练习 1：创作和部署 Azure 资源管理器模板</h3>

<p>在本实验室中，你将创建 Azure 资源管理器模板，并使用链接的模板将其模块化。然后，你将修改主部署模板以调用链接的模板和更新的依赖关系，最后将模板部署到 Azure。</p>

<h4 id="任务-1创建资源管理器模板">任务 1：创建资源管理器模板</h4>

<p>在此任务中，你将使用 Visual Studio Code 创建资源管理器模板</p>

<ol>
  <li>从实验室计算机中启动 Visual Studio Code，在 Visual Studio Code 中，单击“<strong>文件</strong>”顶层菜单，在下拉菜单中，选择“<strong>首选项</strong>”，在级联菜单中选择“<strong>扩展</strong>”，在“<strong>搜索扩展</strong>”文本框中，键入“<strong>Azure 资源管理器 (ARM) 工具</strong>”，选择相应的搜索结果，然后单击“<strong>安装</strong>”以安装 Azure 资源管理器工具</li>
  <li>
    <p>在 Web 浏览器中，连接到 <strong>https://github.com/Azure/azure-quickstart-templates/blob/master/101-vm-simple-windows/azuredeploy.json</strong> 复制代码窗口中的内容，然后将其粘贴到 Visual Studio Code 编辑器。</p>

    <blockquote>
      <p><strong>备注</strong>： 我们将使用某个名为“部署简单 Windows 模板 VM”的 <a href="https://azure.microsoft.com/zh-cn/resources/templates/">Azure 快速启动模板</a>，<strong>而不是从头开始创建模板</strong>。模板可从 GitHub - <a href="https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-simple-windows">101-vm-simple-windows</a> 下载。</p>
    </blockquote>
  </li>
  <li>
    <p>在实验室计算机上，打开文件资源管理器并创建以下用于存储模板的本地文件夹：</p>

    <ul>
      <li><strong>C:\templates</strong></li>
      <li><strong>C:\templates\storage</strong></li>
    </ul>
  </li>
  <li>使用 azuredeploy.json 模板切换回 Visual Studio Code 窗口，单击“<strong>文件</strong>”顶层菜单，在下拉菜单中，单击“<strong>另存为</strong>”，然后在新创建的本地文件夹“<strong>C:\templates</strong>”中将模板另存为“<strong>azuredeploy.json</strong>”。</li>
  <li>
    <p>查看模板以更好地了解其结构。模板中包含五种资源类型：</p>

    <ul>
      <li>Microsoft.Storage/storageAccounts</li>
      <li>Microsoft.Network/publicIPAddresses</li>
      <li>Microsoft.Network/virtualNetworks</li>
      <li>Microsoft.Network/networkInterfaces</li>
      <li>Microsoft.Compute/virtualMachines</li>
    </ul>
  </li>
  <li>
    <p>在 Visual Studio Code 中，再次保存文件，但是这次选择 <strong>C:\templates\storage</strong> 作为目标位置，并选择 <strong>storage.json</strong> 作为文件名。</p>

    <blockquote>
      <p><strong>备注</strong>： 现在，我们有两个相同的 JSON 文件： <strong>C:\templates\azuredeploy.json</strong> 和 <strong>C:\templates\storage\storage.json</strong>。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2创建用于存储资源的链接模板">任务 2：创建用于存储资源的链接模板</h4>

<p>在此任务中，你将修改在上一任务中保存的模板，使链接存储模板 <strong>storage.json</strong> 仅创建一个存储帐户，而其执行将由第一个模板调用。链接存储模板需要将值传递回主模板 <strong>azuredeploy.json</strong>，并且此值将在链接存储模板的输出元素中定义。</p>

<ol>
  <li>
    <p>在 Visual Studio Code 窗口中显示的 <strong>storage.json</strong> 文件中的<strong>资源部分</strong>下，删除除 <strong>storageAccounts</strong> 资源以外的所有资源元素。此操作将导致资源部分如下所示：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="language-json hljs"><span class="hljs-string"><span class="hljs-string">"resources"</span></span>: [
  {
    <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Microsoft.Storage/storageAccounts"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"[variables('storageAccountName')]"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"location"</span></span>: <span class="hljs-string"><span class="hljs-string">"[parameters('location')]"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"apiVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"2021-04-01"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"sku"</span></span>: {
       <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Standard_LRS"</span></span>
    },
    <span class="hljs-attr"><span class="hljs-attr">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"Storage"</span></span>
  }
],
</code></pre>
  </li>
  <li>
    <p>将 storageAccount 的名称元素从变量重命名为参数</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="language-json hljs"><span class="hljs-string"><span class="hljs-string">"resources"</span></span>: [
  {
    <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Microsoft.Storage/storageAccounts"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"[parameters('storageAccountName')]"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"location"</span></span>: <span class="hljs-string"><span class="hljs-string">"[parameters('location')]"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"apiVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"2021-04-01"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"sku"</span></span>: {
       <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Standard_LRS"</span></span>
    },
    <span class="hljs-attr"><span class="hljs-attr">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"Storage"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: {}
  }
],
</code></pre>
  </li>
  <li>
    <p>接下来，删除整个变量部分和所有变量定义：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="language-json hljs"><span class="hljs-string"><span class="hljs-string">"variables"</span></span>: {
  <span class="hljs-attr"><span class="hljs-attr">"storageAccountName"</span></span>: <span class="hljs-string"><span class="hljs-string">"[concat('bootdiags', uniquestring(resourceGroup().id))]"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"nicName"</span></span>: <span class="hljs-string"><span class="hljs-string">"myVMNic"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"addressPrefix"</span></span>: <span class="hljs-string"><span class="hljs-string">"10.0.0.0/16"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"subnetName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Subnet"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"subnetPrefix"</span></span>: <span class="hljs-string"><span class="hljs-string">"10.0.0.0/24"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"virtualNetworkName"</span></span>: <span class="hljs-string"><span class="hljs-string">"MyVNET"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"networkSecurityGroupName"</span></span>: <span class="hljs-string"><span class="hljs-string">"default-NSG"</span></span>
},
</code></pre>
  </li>
  <li>
    <p>接下来，删除除位置以外的所有参数值，并添加以下参数代码，从而生成以下结果：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="language-json hljs"><span class="hljs-string"><span class="hljs-string">"parameters"</span></span>: {
  <span class="hljs-attr"><span class="hljs-attr">"location"</span></span>: {
    <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"defaultValue"</span></span>: <span class="hljs-string"><span class="hljs-string">"[resourceGroup().location]"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"metadata"</span></span>: {
      <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Location for all resources."</span></span>
    }
  },
    <span class="hljs-attr"><span class="hljs-attr">"storageAccountName"</span></span>:{
    <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"metadata"</span></span>: {
      <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Azure Storage account name."</span></span>
    }
  }
},
</code></pre>
  </li>
  <li>
    <p>接下来，更新输出部分以定义 storageURI 输出值。storageUri 值是主模板中的虚拟机资源定义所需的。请将该值作为输出值传递回主模板。修改输出，使其如下所示。</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="language-json hljs"><span class="hljs-string"><span class="hljs-string">"outputs"</span></span>: {
  <span class="hljs-attr"><span class="hljs-attr">"storageUri"</span></span>: {
    <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"[reference(parameters('storageAccountName')).primaryEndpoints.blob]"</span></span>
  }
}
</code></pre>
  </li>
  <li>
    <p>最后，确保架构版本为 2019-04-01（如果在 VS Code 中显示，则忽略警告/错误）：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="language-json hljs">     {
       <span class="hljs-attr"><span class="hljs-attr">"$schema"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"contentVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0.0"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"parameters"</span></span>: {
         <span class="hljs-attr"><span class="hljs-attr">"storageAccountName"</span></span>:{
           <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>,
           <span class="hljs-attr"><span class="hljs-attr">"metadata"</span></span>: {
             <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Azure Storage account name."</span></span>
           }
</code></pre>
  </li>
  <li>
    <p>保存 storage.json 模板。链接存储模板现在应如下所示：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="language-json hljs"> {
   <span class="hljs-attr"><span class="hljs-attr">"$schema"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"</span></span>,
   <span class="hljs-attr"><span class="hljs-attr">"contentVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0.0"</span></span>,
   <span class="hljs-attr"><span class="hljs-attr">"metadata"</span></span>: {
     <span class="hljs-attr"><span class="hljs-attr">"_generator"</span></span>: {
       <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"bicep"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.4.1.14562"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"templateHash"</span></span>: <span class="hljs-string"><span class="hljs-string">"8381960602397537918"</span></span>
     }
   },
   <span class="hljs-attr"><span class="hljs-attr">"parameters"</span></span>: {
     <span class="hljs-attr"><span class="hljs-attr">"location"</span></span>: {
       <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"defaultValue"</span></span>: <span class="hljs-string"><span class="hljs-string">"[resourceGroup().location]"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"metadata"</span></span>: {
         <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Location for all resources."</span></span>
       }
     },
     <span class="hljs-attr"><span class="hljs-attr">"storageAccountName"</span></span>: {
       <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"metadata"</span></span>: {
         <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Azure Storage account name."</span></span>
       }
     }
    
   },
   <span class="hljs-attr"><span class="hljs-attr">"functions"</span></span>: [],
   <span class="hljs-attr"><span class="hljs-attr">"variables"</span></span>: {
   },
   <span class="hljs-attr"><span class="hljs-attr">"resources"</span></span>: [
     {
       <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Microsoft.Storage/storageAccounts"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"apiVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"2021-04-01"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"[parameters('storageAccountName')]"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"location"</span></span>: <span class="hljs-string"><span class="hljs-string">"[parameters('location')]"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"sku"</span></span>: {
         <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Standard_LRS"</span></span>
       },
       <span class="hljs-attr"><span class="hljs-attr">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"Storage"</span></span>
     }
   ],
   <span class="hljs-attr"><span class="hljs-attr">"outputs"</span></span>: {
     <span class="hljs-attr"><span class="hljs-attr">"storageUri"</span></span>: {
       <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>,
       <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"[reference(parameters('storageAccountName')).primaryEndpoints.blob]"</span></span>
     }
   }
 }
</code></pre>
  </li>
</ol>

<h4 id="任务-3将链接模板上传到-azure-blob-存储并生成-sas-令牌">任务 3：将链接模板上传到 Azure Blob 存储并生成 SAS 令牌</h4>

<p>在此任务中，你需要将在上一任务中创建的链接模板上传到 Azure Blob 存储并生成 SAS 令牌，以便在后续部署期间提供对该模板的访问权限。</p>

<blockquote>
  <p><strong>备注</strong>： 链接到某个模板时，Azure 资源管理器服务必须能够通过 http 或 https 访问该模板。为此，请将链接存储模板 <strong>storage.json</strong> 上传到 Azure 中的 blob 存储。然后，你将生成一个数字签名 URL，该 URL 提供对该相应 blob 的有限访问权限。你将使用 Azure Cloud Shell 中的 Azure CLI 执行这些步骤。或者，可以通过 Azure 门户手动创建 blob 容器，上传文件并生成 URL，或使用实验室计算机上安装的 Azure CLI 或 Azure PowerShell 模块。</p>
</blockquote>

<ol>
  <li>
    <p>在实验室计算机上，启动 Web 浏览器，导航到 <a href="https://portal.azure.com"><strong>Azure 门户</strong></a>，然后使用至少具有将在本实验室中所使用的 Azure 订阅中的参与者角色的用户帐户登录。</p>
  </li>
  <li>
    <p>在 Azure 门户的工具栏中，单击搜索文本框右侧的“<strong>Cloud Shell</strong>”图标。</p>

    <blockquote>
      <p><strong>备注</strong>： 或者，可以直接导航到 <a href="http://shell.azure.com">Azure Cloud Shell</a>。</p>
    </blockquote>
  </li>
  <li>
    <p>提示选择 <strong>Bash</strong> 或 <strong>PowerShell</strong> 时，选择 <strong>PowerShell</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>：如果这是第一次启动 <strong>Cloud Shell</strong>，并显示消息 <strong>“未装载任何存储”</strong>，请选择你将在本实验室中使用的订阅，然后选择 <strong>“创建存储”</strong>。</p>
    </blockquote>
  </li>
  <li>在 Cloud Shell 窗格的 <strong>PowerShell</strong> 会话中，运行以下命令以创建 blob 存储容器，上传你在上一个任务中创建的模板文件，并生成一个 SAS 令牌，你将在主模板中引用该令牌以访问链接模板。</li>
  <li>
    <p>首先，复制并粘贴以下代码行以设置要部署到的 Azure 区域的值。命令将等待你的输入，如提示符中所示。</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="language-powershell"># Provide the name of the closest Azure region in which you can provision Azure VMs
$location = Read-Host -Prompt 'Enter the name of Azure region (i.e. centralus)'
</code></pre>
  </li>
  <li>
    <p>其次，将以下代码复制并粘贴到同一个 Cloud Shell 会话中以创建 blob 存储容器：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock8" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock8" class="mt-0"><code class="language-powershell"> # This is a random string used to assign the name to the Azure storage account
 $suffix = Get-Random
 $resourceGroupName = 'az400m13l01-RG'
 $storageAccountName = 'az400m13blob' + $suffix

 # The name of the Blob container to be created
 $containerName = 'linktempblobcntr' 

 # A file name used for downloading and uploading the linked template
 $fileName = 'storage.json' 
    
 # Create a resource group
 New-AzResourceGroup -Name $resourceGroupName -Location $location 
    
 # Create a storage account
 $storageAccount = New-AzStorageAccount `
   -ResourceGroupName $resourceGroupName `
   -Name $storageAccountName `
   -Location $location `
   -SkuName 'Standard_LRS'
    
 $context = $storageAccount.Context
    
 # Create a container
 New-AzureStorageContainer -Name $containerName -Context $context
</code></pre>
  </li>
  <li>
    <p>在 Cloud Shell 窗格中，单击“<strong>上传/下载文件</strong>”图标，然后在下拉菜单中单击“<strong>上传</strong>”。在“<strong>打开</strong>”对话框中，导航到 C:\templates\storage\storage.json 并选择该文件，然后单击“<strong>打开</strong>”。</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock9" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock9" class="mt-0"><code class="language-powershell"> # Upload the linked template
 Set-AzureStorageBlobContent `
   -Container $containerName `
   -File "$home/$fileName" `
   -Blob $fileName `
   -Context $context

 # Generate a SAS token. We set an expiry time of 24 hours, but you could have shorter values for increased security.
 $templateURI = New-AzureStorageBlobSASToken `
   -Context $context `
   -Container $containerName `
   -Blob $fileName `
   -Permission r `
   -ExpiryTime (Get-Date).AddHours(24.0) `
   -FullUri

 "Resource Group Name: $resourceGroupName"
 "Linked template URI with SAS token: $templateURI"
</code></pre>
  </li>
</ol>

<blockquote>
  <p><strong>备注</strong>：确保记录脚本生成的最终输出。稍后将在本实验室中用到它。</p>
</blockquote>

<blockquote>
  <p><strong>备注</strong>： 输出值应如下所示：</p>
</blockquote>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock10" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock10" class="mt-0"><code class="hljs apache">      <span class="hljs-attribute"><span class="hljs-attribute">Resource</span></span> Group Name: az400m13l01-RG
      <span class="hljs-attribute"><span class="hljs-attribute">Linked</span></span> template URI with SAS token: https://az400m13blob1677205310.blob.core.windows.net/linktempblobcntr/storage.json?sv=2018-03-28&amp;sr=b&amp;sig=B4hDLt9rFaWHZXToJlMwMjejAQGT7x0INdDR9bHBQnI<span class="hljs-number"><span class="hljs-number">%3</span></span>D&amp;se=2020-11-23T21<span class="hljs-number"><span class="hljs-number">%3</span></span>A54<span class="hljs-number"><span class="hljs-number">%3</span></span>A53Z&amp;sp=r
</code></pre>

<blockquote>
  <p><strong>备注</strong>： 对于需要更高安全级别的场景，你可以在主模板部署过程中动态生成 SAS 令牌，并为 SAS 令牌指定更短的有效期。</p>
</blockquote>

<ol>
  <li>关闭 Cloud Shell 窗格。</li>
</ol>

<h4 id="任务-4修改主模板以调用链接模板">任务 4：修改主模板以调用链接模板</h4>

<p>在此任务中，你将修改主模板，以引用在上一个任务中上传到 Azure Blob 存储的链接模板。</p>

<blockquote>
  <p><strong>备注</strong>： 为了负责处理通过模块化所有存储元素对模板结构所做的更改，我们现在需要修改主模板以调用新的存储资源定义。</p>
</blockquote>

<ol>
  <li>在 Visual Studio Code 中，单击“<strong>文件</strong>”顶层菜单，在下拉菜单中选择“<strong>打开文件</strong>”，在“打开文件”对话框中，导航到 <strong>C:\templates\azuredeploy.json</strong> 并选择该文件，然后单击“<strong>打开</strong>”。</li>
  <li>
    <p>在 <strong>azuredeploy.json</strong> 文件的资源部分，删除存储资源元素</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock11" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock11" class="mt-0"><code class="language-json hljs">{
  <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Microsoft.Storage/storageAccounts"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"[variables('storageAccountName')]"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"location"</span></span>: <span class="hljs-string"><span class="hljs-string">"[parameters('location')]"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"apiVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"2021-04-01"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"sku"</span></span>: {
    <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Standard_LRS"</span></span>
  },
  <span class="hljs-attr"><span class="hljs-attr">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"Storage"</span></span>
},
</code></pre>
  </li>
  <li>
    <p>接下来，将以下代码直接添加到新删除的存储资源元素所在的位置：</p>

    <blockquote>
      <p><strong>备注</strong>： 确保将 <code>&lt;linked_template_URI_with_SAS_token&gt;</code> 占位符替换为你在上一个任务结束时记录的实际值。</p>
    </blockquote>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock12" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock12" class="mt-0"><code class="language-json hljs">{
  <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"linkedTemplate"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Microsoft.Resources/deployments"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"apiVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-05-01"</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: {
      <span class="hljs-attr"><span class="hljs-attr">"mode"</span></span>: <span class="hljs-string"><span class="hljs-string">"Incremental"</span></span>,
      <span class="hljs-attr"><span class="hljs-attr">"templateLink"</span></span>: {
          <span class="hljs-attr"><span class="hljs-attr">"uri"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt;linked_template_URI_with_SAS_token&gt;"</span></span>
      },
      <span class="hljs-attr"><span class="hljs-attr">"parameters"</span></span>: {
          <span class="hljs-attr"><span class="hljs-attr">"storageAccountName"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"[variables('storageAccountName')]"</span></span>},
          <span class="hljs-attr"><span class="hljs-attr">"location"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"[parameters('location')]"</span></span>}
      }
   }
},
</code></pre>
  </li>
  <li>
    <p>查看主模板中的以下详细信息：</p>

    <ul>
      <li>主模板中的 Microsoft.Resources/deployments 资源用于链接到另一个模板。</li>
      <li>部署资源的名称为 linkedTemplate。此名称用于配置依赖关系。</li>
      <li>调用链接模板时，只能使用增量部署模式。</li>
      <li>templateLink/uri 包含链接模板的 URI。</li>
      <li>请使用参数将值从主模板传递给链接模板。</li>
    </ul>
  </li>
  <li>保存模板。</li>
</ol>

<h4 id="任务-5修改主模板以更新依赖关系">任务 5：修改主模板以更新依赖关系</h4>

<p>在此任务中，你将修改主模板以处理需要更新的剩余依赖关系。</p>

<blockquote>
  <p><strong>备注</strong>：由于存储帐户是在链接存储模板中定义的，因此需要更新 <strong>Microsoft.Compute/virtualMachines</strong> 资源定义。</p>
</blockquote>

<ol>
  <li>
    <p>在虚拟机元素的资源部分，通过替换以下内容来更新 <strong>dependsOn</strong> 元素：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock13" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock13" class="mt-0"><code class="language-json hljs"><span class="hljs-string"><span class="hljs-string">"dependsOn"</span></span>: [
  <span class="hljs-string"><span class="hljs-string">"[resourceId('Microsoft.Network/networkInterfaces/', variables('nicName'))]"</span></span>,
  <span class="hljs-string"><span class="hljs-string">"[resourceId('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]"</span></span>
]
</code></pre>

    <p>with</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock14" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock14" class="mt-0"><code class="language-json hljs"><span class="hljs-string"><span class="hljs-string">"dependsOn"</span></span>: [
      
  <span class="hljs-string"><span class="hljs-string">"[resourceId('Microsoft.Network/networkInterfaces/', variables('nicName'))]"</span></span>,
  <span class="hljs-string"><span class="hljs-string">"linkedTemplate"</span></span>
]
</code></pre>
  </li>
  <li>
    <p>在 <strong>Microsoft.Compute/virtualMachines</strong> 元素下的资源部分中，通过替换以下内容，重新配置 <strong>properties/diagnosticsProfile/bootDiagnostics/storageUri</strong> 元素，以反映在链接存储模板中定义的输出值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock15" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock15" class="mt-0"><code class="language-json hljs"><span class="hljs-string"><span class="hljs-string">"diagnosticsProfile"</span></span>: {
  <span class="hljs-attr"><span class="hljs-attr">"bootDiagnostics"</span></span>: {
    <span class="hljs-attr"><span class="hljs-attr">"enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"storageUri"</span></span>: <span class="hljs-string"><span class="hljs-string">"[reference(resourceId('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))).primaryEndpoints.blob]"</span></span>
  }
</code></pre>

    <p>with</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock16" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock16" class="mt-0"><code class="language-json hljs"><span class="hljs-string"><span class="hljs-string">"diagnosticsProfile"</span></span>: {
  <span class="hljs-attr"><span class="hljs-attr">"bootDiagnostics"</span></span>: {
    <span class="hljs-attr"><span class="hljs-attr">"enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,
    <span class="hljs-attr"><span class="hljs-attr">"storageUri"</span></span>: <span class="hljs-string"><span class="hljs-string">"[reference('linkedtemplate').outputs.storageUri.value]"</span></span>
  }
</code></pre>
  </li>
  <li>
    <p>保存更新后的主部署模板。</p>
  </li>
</ol>

<h4 id="任务-6通过使用链接模板将资源部署到-azure">任务 6：通过使用链接模板将资源部署到 Azure</h4>

<blockquote>
  <p><strong>备注</strong>： 可以通过多种方式来部署模板，例如，直接从 Azure 门户进行部署、使用本地安装的 Azure CLI 或 PowerShell 进行部署或者通过 Azure Cloud Shell 进行部署。在本实验室中，你将使用 Azure Cloud Shell 中的 Azure CLI。</p>
</blockquote>

<blockquote>
  <p><strong>备注</strong>： 若要使用 Azure Cloud Shell，需将主部署模板 azuredeploy.json 上传到 Cloud Shell 的主目录中，另外，也可以将其上传到 Azure Blob 存储，就像上传链接模板一样，并使用其 URI（而不是本地文件系统路径）来引用它。</p>
</blockquote>

<ol>
  <li>在实验室计算机上，在显示 Azure 门户的 Web 浏览器中，单击“Cloud Shell”图标以打开 <strong>Cloud Shell</strong>。
    <blockquote>
      <p><strong>备注</strong>：如果本练习前面部分的 PowerShell 会话仍处于活动状态，则可以使用该会话，而无需切换到 Bash（下一步）。以下步骤在 Cloud Shell 的 PowerShell 和 Bash 会话中均可运行。如果要打开新的 Cloud Shell 会话，请按照说明进行操作。</p>
    </blockquote>
  </li>
  <li>在“Cloud Shell”窗格中，单击“<strong>PowerShell</strong>”，在下拉菜单中，单击“<strong>Bash</strong>”，然后在出现提示时，单击“<strong>确认</strong>”。</li>
  <li>在 Cloud Shell 窗格中，单击“<strong>上传/下载文件</strong>”图标，然后在下拉菜单中单击“<strong>上传</strong>”。</li>
  <li>在“<strong>打开</strong>”对话框中，导航到 <strong>C:\templates\azuredeploy.json</strong> 并选择该文件，然后单击“<strong>打开</strong>”。</li>
  <li>
    <p>在 Cloud Shell 窗格的 <strong>Bash</strong> 会话中，运行以下命令以使用新上传的模板进行部署：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock17" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock17" class="mt-0"><code class="language-bash hljs">az deployment group create --name az400m13l01deployment --resource-group az400m13l01-RG --template-file azuredeploy.json
</code></pre>
  </li>
  <li>当系统提示为“adminUsername”输入值时，键入“<strong>Student</strong>”并按 <strong>Enter</strong> 键。</li>
  <li>
    <p>当系统提示为“adminPassword”输入值时，键入“<strong>Pa55w.rd1234</strong>”并按 <strong>Enter</strong> 键。（不会显示键入密码）</p>
  </li>
  <li>
    <p>如果在运行上述命令部署模板时收到错误，请尝试以下操作：</p>

    <ul>
      <li>如果有多个 Azure 订阅，请确保已将订阅上下文设置为部署资源组的正确上下文。</li>
      <li>确保可以通过指定的 URI 访问链接模板。</li>
    </ul>
  </li>
</ol>

<blockquote>
  <p><strong>备注</strong>： 下一步，现在可以对主部署模板中的剩余资源定义（例如网络和虚拟机资源定义）进行模块化。</p>
</blockquote>

<blockquote>
  <p><strong>备注</strong>： 如果不打算使用部署的资源，应删除这些资源来避免产生相关费用。只需删除资源组 <strong>az400m13l01-RG</strong> 即可完成此操作。</p>
</blockquote>

<h3 id="练习-2删除-azure-实验室资源">练习 2：删除 Azure 实验室资源</h3>

<p>在本练习中，你将删除在本实验室中预配的 Azure 资源，避免产生意外费用。</p>

<blockquote>
  <p><strong>备注</strong>： 请记得删除不再使用的所有新创建的 Azure 资源。删除未使用的资源，确保不产生意外费用。</p>
</blockquote>

<h4 id="任务-1删除-azure-实验室资源">任务 1：删除 Azure 实验室资源</h4>

<p>在此任务中，你将使用 Azure Cloud Shell 删除在本实验室中预配的 Azure 资源，避免产生不必要的费用。</p>

<ol>
  <li>在 Azure 门户中，在 <strong>Cloud Shell</strong> 窗格中打开 <strong>Bash</strong> Shell 会话。</li>
  <li>
    <p>运行以下命令，列出在本模块各实验室中创建的所有资源组：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock18" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock18" class="mt-0"><code class="language-bash hljs">az group list --query <span class="hljs-string"><span class="hljs-string">"[?starts_with(name,'az400m13l01-RG')].name"</span></span> --output tsv
</code></pre>
  </li>
  <li>
    <p>运行以下命令，删除在本模块各个实验室中创建的所有资源组：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock19" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock19" class="mt-0"><code class="language-bash hljs">az group list --query <span class="hljs-string"><span class="hljs-string">"[?starts_with(name,'az400m13l01-RG')].[name]"</span></span> --output tsv | xargs -L1 bash -c <span class="hljs-string"><span class="hljs-string">'az group delete --name $0 --no-wait --yes'</span></span>
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 该命令以异步方式执行（由 –nowait 参数决定），因此，虽然你随后可在同一 Bash 会话中立即运行另一个 Azure CLI 命令，但实际上要花几分钟才能删除资源组。</p>
    </blockquote>
  </li>
</ol>

<h2 id="回顾">回顾</h2>

<p>在本实验室中，你学习了如何创建 Azure 资源管理器模板，使用链接模板对其进行模块化，修改主部署模板以调用链接模板和更新后的依赖关系，以及最终将模板部署到 Azure。</p>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-400ZH-Designing-and-Implementing-Microsoft-DevOps-solutions" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-400ZH-Designing-and-Implementing-Microsoft-DevOps-solutions
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D.js"></script>



</body></html>