<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-400ZH-Designing-and-Implementing-Microsoft-DevOps-solutions
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-400ZH-Designing-and-Implementing-Microsoft-DevOps-solutions
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-400ZH-Designing-and-Implementing-Microsoft-DevOps-solutions" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#准备工作">准备工作</a></li><li class="nav-item"><a class="nav-link" href="#练习-1创建-devops-starter-项目">练习 1：创建 DevOps Starter 项目</a></li><li class="nav-item"><a class="nav-link" href="#练习-2删除-azure-实验室资源">练习 2：删除 Azure 实验室资源</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="实验室-08-使用-devops-starter-实现-github-actions">实验室 08： 使用 DevOps Starter 实现 GitHub Actions</h1>
<h1 id="学生实验室手册">学生实验室手册</h1>

<h2 id="实验室概述">实验室概述</h2>

<p>在此实验室中，你将学习如何使用 DevOps Starter 实现部署 Azure Web 应用的 GitHub Action 工作流。</p>

<h2 id="目标">目标</h2>

<p>完成本实验室后，你将能够：</p>

<ul>
  <li>使用 DevOps Starter 实现 GitHub Actions 工作流</li>
  <li>解释 GitHub Action 工作流的基本特征</li>
</ul>

<h2 id="实验室持续时间">实验室持续时间</h2>

<ul>
  <li>预计用时：<strong>30 分钟</strong></li>
</ul>

<h2 id="说明">说明</h2>

<h3 id="准备工作">准备工作</h3>

<h4 id="登录到实验室虚拟机">登录到实验室虚拟机</h4>

<p>请确保已使用以下凭据登录到 Windows 10 虚拟机：</p>

<ul>
  <li>用户名：<strong>Student</strong></li>
  <li>密码： <strong>Pa55w.rd</strong></li>
</ul>

<h4 id="查看本实验室所需的应用程序">查看本实验室所需的应用程序</h4>

<p>确定你将在本实验室中使用的应用程序：</p>

<ul>
  <li>Microsoft Edge</li>
</ul>

<h4 id="准备-azure-订阅">准备 Azure 订阅</h4>

<ul>
  <li>标识现有的 Azure 订阅或创建一个新的 Azure 订阅。</li>
  <li>验证你是否拥有 Microsoft 帐户或具有 Azure 订阅中参与者或所有者角色的 Azure AD 帐户。有关详细信息，请参阅<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/role-assignments-list-portal">使用 Azure 门户列出 Azure 角色分配</a>和<a href="https://docs.microsoft.com/zh-cn/azure/active-directory/roles/manage-roles-portal#view-my-roles">在 Azure Active Directory 中查看和分配管理员角色</a>。</li>
</ul>

<h4 id="准备-github-帐户">准备 GitHub 帐户</h4>

<p>如果还没有可用于此实验的 GitHub 帐户，请按照<a href="https://github.com/join">注册新的 GitHub 帐户</a>中的说明创建一个帐户。</p>

<h3 id="练习-1创建-devops-starter-项目">练习 1：创建 DevOps Starter 项目</h3>

<p>在本练习中，你将使用 DevOps Starter 来更好地配置许多资源，包括：</p>

<ul>
  <li>
    <p>GitHub 存储库托管：</p>

    <ul>
      <li>示例 .NET Core 网站的代码。</li>
      <li>Azure 资源管理器模板，用于部署托管网站代码的 Azure Web 应用。</li>
      <li>构建、部署和测试网站的工作流。</li>
    </ul>
  </li>
  <li>
    <p>一个 Azure Web 应用，通过使用 GitHub 工作流自动部署。</p>
  </li>
</ul>

<h4 id="任务-1创建-devops-starter-项目">任务 1：创建 DevOps Starter 项目</h4>

<p>在这个任务中，你将创建 Azure DevOps Starter 项目，它会自动设置 GitHub 存储库，并创建和触发 GitHub 工作流来基于 GitHub 存储库的内容部署 Azure Web 应用。</p>

<ol>
  <li>在实验室计算机上，启动 Web 浏览器，导航到 <a href="https://portal.azure.com"><strong>Azure 门户</strong></a>，然后使用在本实验室中使用的 Azure 订阅中至少具有参与者角色的用户帐户登录。</li>
  <li>在 Azure 门户中搜索并选择 <strong>“DevOps Starter”</strong> 资源类型，然后在 <strong>“DevOps Starter”</strong> 边栏选项卡上单击 <strong>“+ 添加”</strong>、 <strong>“+ 新建”</strong> 或 <strong>“+ 创建”</strong>。</li>
  <li>
    <p>在 <strong>“DevOps Starter”</strong> 边栏选项卡的 <strong>“使用新应用程序重新开始”</strong> 页面上，单击 <strong>“单击此处，使用 GitHub 设置 DevOps Starter”</strong> 文本中的 <strong>“此处”</strong> 链接。</p>

    <blockquote>
      <p><strong>备注</strong>：此时会显示 <strong>“DevOps Starter 设置”</strong> 边栏选项卡。</p>
    </blockquote>
  </li>
  <li>在 <strong>“DevOps Starter 设置”</strong> 边栏选项卡上确保已选中 <strong>“GitHub”</strong> 磁贴，然后单击 <strong>“完成”</strong>。</li>
  <li>返回 <strong>“DevOps Starter”</strong> 边栏选项卡，单击 <strong>“下一步: 框架”&gt;</strong>。</li>
  <li>在 <strong>“DevOps Starter”</strong> 边栏选项卡的 <strong>“选择应用程序框架”</strong> 页面上，选择 <strong>“ASP.NET Core”</strong> 磁贴并单击 <strong>“下一步: 服务”&gt;</strong>。</li>
  <li>在 <strong>“DevOps Starter”</strong> 边栏选项卡的 <strong>“选择 Azure 服务以部署应用程序”</strong> 页面上，确保已选中 <strong>“Windows Web 应用”</strong> 磁贴并单击 <strong>“下一步: 创建”&gt;</strong>。</li>
  <li>
    <p>在 <strong>“DevOps Starter”</strong> 边栏选项卡的 <strong>“选择存储库和订阅”</strong> 页面上，单击 <strong>“授权”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>：此时会显示 <strong>“授权 Azure GitHub Actions”</strong> 弹出 Web 浏览器窗口。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“授权 Azure GitHub Actions”</strong> 弹出窗口中查看所需权限，然后单击 <strong>“授权 AzureGithubActions”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>：此时会将该 Web 弹出浏览器窗口重定向到 Azure DevOps 站点，系统会提示你提供 Azure DevOps 信息。</p>
    </blockquote>
  </li>
  <li>看到提示时，请在弹出 Web 浏览器窗口中单击 <strong>“继续”</strong>。</li>
  <li>
    <p>返回至 <strong>“DevOps Starter”</strong> 边栏选项卡的 <strong>“选择存储库和订阅”</strong> 页面，指定以下设置并单击 <strong>“查看 + 创建”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>组织</td>
          <td>GitHub 帐户名称</td>
        </tr>
        <tr>
          <td>存储库</td>
          <td><strong>az400m08l01</strong></td>
        </tr>
        <tr>
          <td>订阅</td>
          <td>在本实验室中使用的 Azure 订阅的名称</td>
        </tr>
        <tr>
          <td>Web 应用名称</td>
          <td><strong>azurewebsites.net</strong> DNS 命名空间中任何有效的、全局唯一的主机名</td>
        </tr>
        <tr>
          <td>位置</td>
          <td>可以预配 Azure Web 应用的任何 Azure 区域的名称</td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <p><strong>备注</strong>： 等待预配完成。该过程大约需要 1 分钟。</p>
    </blockquote>
  </li>
  <li>在 <strong>“Deploy_DevOps_Project_az400m08l01 | 概述”</strong> 边栏选项卡上，单击 <strong>“转到资源”</strong>。</li>
  <li>在 <strong>“az400m08l01”</strong> 边栏选项卡的 <strong>“GitHub 工作流”</strong> 磁贴上单击 <strong>“授权”</strong>。</li>
  <li>在 <strong>“GitHub 授权”</strong> 边栏选项卡上再次单击 <strong>“授权”</strong>。</li>
  <li>
    <p>返回至 <strong>“az400m08l01”</strong> 边栏选项卡，在 <strong>“GitHub 工作流”</strong> 磁贴上监视操作进度。</p>

    <blockquote>
      <p><strong>备注</strong>： 等待 GitHub 工作流的构建、部署和功能测试作业完成。该过程需要约 5 分钟。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2查看创建-devops-starter-项目的结果">任务 2：查看创建 DevOps Starter 项目的结果</h4>

<p>在此任务中，你将查看创建 DevOps Starter 项目的结果。</p>

<ol>
  <li>在显示 Azure 门户的 Web 浏览器窗口中的 <strong>“az400m08l01”</strong> 边栏选项卡上，查看 <strong>“GitHub 工作流”</strong> 部分，并验证<strong>构建</strong>、<strong>部署</strong>和<strong>功能测试</strong>作业是否成功完成。</li>
  <li>在 <strong>“az400m08l01”</strong> 边栏选项卡上，查看 <strong>“Azure 资源”</strong> 部分，并验证是否包含一个应用服务 Web 应用实例和相应的Application Insights资源。</li>
  <li>在 <strong>“az400m08l01”</strong> 边栏选项卡的顶部，请注意在上一个任务中创建的指向<strong>工作流文件</strong>和 GitHub 存储库的链接。</li>
  <li>在 <strong>“az400m08l01”</strong> 边栏选项卡的顶部，单击指向 GitHub 存储库的链接。</li>
  <li>
    <p>在 GitHub 存储库页面上，注意三个带有以下标签的文件夹：</p>

    <ul>
      <li><strong>Github\workflows</strong> -  包含 YAML 格式的工作流文件</li>
      <li><strong>Application</strong> -  包含示例网站的代码</li>
      <li><strong>ArmTemplates</strong> -  包含工作流用于预配 Azure 资源的 Azure 资源管理器模板</li>
    </ul>
  </li>
  <li>在 GitHub 存储库页面，单击 <strong>“.github/workflows”</strong>，然后单击 <strong>devops-starter-workflow.yml</strong> 条目。</li>
  <li>在显示 <strong>devops-starter-workflow.yml</strong> 内容的 GitHub 存储库页面上检查其内容，并注意它包含<strong>构建</strong>、<strong>部署</strong>和<strong>功能测试</strong>作业定义。</li>
  <li>在 GitHub 存储库页面的工具栏中单击 <strong>“操作”</strong>。</li>
  <li>在 GitHub 存储库页面的 <strong>“操作”</strong> 选项卡上，在 <strong>“所有工作流”</strong> 部分中，单击表示最近运行的工作流的条目。</li>
  <li>在工作流运行页面上，查看工作流状态，以及<strong>注释</strong>和<strong>工件</strong>的列表。</li>
  <li>在 GitHub 存储库页面上的工具栏中单击 <strong>“设置”</strong>，然后在 <strong>“设置”</strong> 选项卡上单击 <strong>“机密”</strong>。</li>
  <li>在 <strong>“操作机密”</strong> 窗格上，请注意 <strong>AZURE_CREDENTIALS</strong> 条目，它表示访问目标 Azure 订阅所需的凭据。</li>
  <li>导航至 <strong>az400m08l01/Application/aspnet-core-dotnet-core/Pages/Index.cshtml</strong> GitHub 存储库页面，并单击右上角的铅笔图标切换到编辑模式。</li>
  <li>将第 19 行更改为 <code>&lt;div class="description line-1"&gt; GitHub工作流已成功更新&lt;/div&gt;</code>。</li>
  <li>向下滚动到页面底部并单击 <strong>“提交更改”</strong>。</li>
  <li>在 GitHub 存储库页面的工具栏中单击 <strong>“操作”</strong>。</li>
  <li>在 <strong>“所有工作流”</strong> 部分，单击 <strong>“Update Index.cshtml”</strong> 条目。</li>
  <li>在 <strong>“devops-starter-workflow.yml”</strong> 部分，监视部署进度并验证部署是否成功完成。
    <blockquote>
      <p><strong>备注</strong>：如果使用“<strong>azure/CLI@1</strong>”的操作失败，请将以下更改提交到 <strong>devops-starter-workflow.yml</strong> 文件（更改默认 Azure CLI 版本），并验证该操作是否成功完成：
   ```</p>
    </blockquote>
    <ul>
      <li>name: Deploy ARM Template
 uses: azure/CLI@v1
 continue-on-error: false
 with:
   azcliversion: 2.29.2
   inlineScript: |
     az group create –name “$” –location “$”
     az deployment group create –resource-group “$” –template-file ./ArmTemplates/windows-webapp-     template.json –parameters webAppName=”$” hostingPlanName=”$”   appInsightsLocation=”$” sku=”$”
   ```</li>
    </ul>
  </li>
  <li>切换到在 Azure 门户中显示 DevOps Starter 边栏选项卡的浏览器窗口，并单击 <strong>“Application 终结点”</strong> 条目旁边的 <strong>“浏览”</strong> 链接。</li>
  <li>在新打开的 Web 浏览器窗口中，验证更新后的文本（表示在 GitHub 存储库中提交的更改）是否显示在 Web 应用主页上。</li>
</ol>

<h3 id="练习-2删除-azure-实验室资源">练习 2：删除 Azure 实验室资源</h3>

<p>在本练习中，你将删除在本实验室中预配的 Azure 资源，避免产生意外费用。</p>

<blockquote>
  <p><strong>备注</strong>：请记得删除不再使用的所有新创建的 Azure 资源。删除未使用的资源，确保不产生意外费用。</p>
</blockquote>

<h4 id="任务-1删除-azure-实验室资源">任务 1：删除 Azure 实验室资源</h4>

<p>在此任务中，你将使用 Azure Cloud Shell 删除在本实验室中预配的 Azure 资源，避免产生不必要的费用。</p>

<ol>
  <li>在 Azure 门户中，在 <strong>Cloud Shell</strong> 窗格中打开 <strong>Bash</strong> Shell 会话。</li>
  <li>
    <p>运行以下命令，列出在本模块各实验室中创建的所有资源组：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="language-sh hljs bash">az group list --query <span class="hljs-string"><span class="hljs-string">"[?starts_with(name,'az400m08l01')].name"</span></span> --output tsv
</code></pre>
  </li>
  <li>
    <p>运行以下命令，删除在本模块各个实验室中创建的所有资源组：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="language-sh hljs bash">az group list --query <span class="hljs-string"><span class="hljs-string">"[?starts_with(name,'az400m08l01')].[name]"</span></span> --output tsv | xargs -L1 bash -c <span class="hljs-string"><span class="hljs-string">'az group delete --name $0 --no-wait --yes'</span></span>
</code></pre>

    <blockquote>
      <p><strong>备注</strong>：该命令以异步方式执行（由 –nowait 参数决定），因此，虽然你随后可在同一 Bash 会话中立即运行另一个 Azure CLI 命令，但实际上要花几分钟才能删除资源组。</p>
    </blockquote>
  </li>
</ol>

<h2 id="回顾">回顾</h2>

<p>在此实验室中，你使用 DevOps Starter 实现了部署 Azure Web 应用的 GitHub Action 工作流。</p>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-400ZH-Designing-and-Implementing-Microsoft-DevOps-solutions" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-400ZH-Designing-and-Implementing-Microsoft-DevOps-solutions
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D.js"></script>



</body></html>