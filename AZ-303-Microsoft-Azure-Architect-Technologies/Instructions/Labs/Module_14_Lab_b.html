<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-303-Microsoft-Azure-Architect-Technologies
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D479f9cfd893a2bea83ac41ba638fc5e7bd9113e0.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-303-Microsoft-Azure-Architect-Technologies
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-303-Microsoft-Azure-Architect-Technologies" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#exercise-1-configure-and-validate-an-azure-function-app-storage-blob-trigger">Exercise 1: Configure and validate an Azure Function App Storage Blob trigger</a></li><li class="nav-item"><a class="nav-link" href="#exercise-2-configure-and-validate-an-azure-event-grid-subscription-based-queue-messaging">Exercise 2: Configure and validate an Azure Event Grid subscription-based queue messaging</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="lab-configuring-a-message-based-integration-architecture">Lab: Configuring a Message-Based Integration Architecture</h1>

<h1 id="student-lab-manual">Student lab manual</h1>

<h2 id="lab-scenario">Lab scenario</h2>

<p>Adatum Corporation has several web applications that process files uploaded in regular intervals to their on-premises file servers. Files sizes vary, but they can reach up to 100 MB. Adatum is considering migrating the applications to Azure App Service or Azure Functions-based apps and using Azure Storage to host uploaded files. You plan to test two scenarios:</p>

<ul>
  <li>
    <p>using Azure Functions to automatically process new blobs uploaded to an Azure Storage container.</p>

    <ul>
      <li>using Event Grid to generate Azure Storage queue messages that will reference new blobs uploaded to an Azure Storage container.</li>
    </ul>
  </li>
</ul>

<p>These scenarios are intended to address a challenge common to a messaging-based architecture, when sending, receiving, and manipulating large messages. Sending large messages to a message queue directly is not recommended as they would require more resources to be used, result in more bandwidth to be consumed, and negatively impact the processing speed, since messaging platforms are usually fine-tuned to handle high volumes of small messages. In addition, messaging platforms usually limit the maximum message size they can process.</p>

<p>One potential solution is to store the message payload into an external service, like Azure Blob Store, Azure SQL or Azure Cosmos DB, get the reference to the stored payload and then send to the message bus only that reference. This architectural pattern is known as “claim check”. The clients interested in processing that specific message can use the obtained reference to retrieve the payload, if needed.</p>

<p>On Azure this pattern can be implemented in several ways and with different technologies, but it typically it relies on events to either automate the claim check generation and to push it into the message bus to be used by clients or to trigger payload processing directly. One of the common components included in such implementations is Event Grid, which is an event routing service responsible for delivery of events within a configurable period (up to 24 hours). After that, events are either discarded or dead lettered. If archival of event contents or replayability of event stream are needed, it is possible to facilitate this requirement by setting up an Event Grid subscription to the Event Hub or a queue in Azure Storage where messages can be retained for longer periods and archival of messages is supported.</p>

<p>In this lab, you will use Azure Storage Blob service to store files to be processed. A client just needs to drop the files to be shared into a designated Azure Blob container. In the first exercise, the files will be consumed directly by an Azure Function, leveraging its serverless nature. You will also take advantage of the Application Insights to provide instrumentation, facilitating monitoring and analyzing file processing. In the second exercise, you will use Event Grid to automatically generate a claim check message and send it to an Azure Storage queue. This allows a client application to poll the queue, get the message and then use the stored reference data to download the payload directly from Azure Blob Storage.</p>

<p>It is worth noting that the Azure Function in the first exercise relies on the Blob Storage trigger. You should opt for Event Grid trigger instead of the Blob storage trigger when dealing with the following requirements:</p>

<ul>
  <li>
    <p>blob-only storage accounts: blob storage accounts are supported for blob input and output bindings but not for blob triggers. Blob storage triggers require a general-purpose storage account.</p>

    <ul>
      <li>
        <p>high scale: high scale can be loosely defined as containers that have more than 100,000 blobs in them or storage accounts that have more than 100 blob updates per second.</p>
      </li>
      <li>
        <p>reduced latency: if your function app is on the Consumption plan, there can be up to a 10-minute delay in processing new blobs if a function app has gone idle. To avoid this latency, you can use an Event Grid trigger or switch to an App Service plan with the Always On setting enabled.</p>
      </li>
      <li>
        <p>processing of blob delete events: blob delete events are not supported by blob storage triggers.</p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="objectives">Objectives</h2>

<p>After completing this lab, you will be able to:</p>

<ul>
  <li>
    <p>Configure and validate an Azure Function App Storage Blob trigger</p>
  </li>
  <li>
    <p>Configure and validate an Azure Event Grid subscription-based queue messaging</p>
  </li>
</ul>

<h2 id="lab-environment">Lab Environment</h2>

<p>Estimated Time: 60 minutes</p>

<h2 id="lab-files">Lab Files</h2>

<p>None</p>

<h2 id="instructions">Instructions</h2>

<h3 id="exercise-1-configure-and-validate-an-azure-function-app-storage-blob-trigger">Exercise 1: Configure and validate an Azure Function App Storage Blob trigger</h3>

<p>The main tasks for this exercise are as follows:</p>

<ol>
  <li>
    <p>Configure an Azure Function App Storage Blob trigger</p>
  </li>
  <li>
    <p>Validate an Azure Function App Storage Blob trigger</p>
  </li>
</ol>

<h4 id="task-1-configure-an-azure-function-app-storage-blob-trigger">Task 1: Configure an Azure Function App Storage Blob trigger</h4>

<ol>
  <li>
    <p>From your lab computer, start a web browser, navigate to the <a href="https://portal.azure.com">Azure portal</a>, and sign in by providing credentials of a user account with the Owner role in the subscription you will be using in this lab.</p>
  </li>
  <li>
    <p>In the Azure portal, open <strong>Cloud Shell</strong> pane by selecting on the toolbar icon directly to the right of the search textbox.</p>
  </li>
  <li>
    <p>If prompted to select either <strong>Bash</strong> or <strong>PowerShell</strong>, select <strong>Bash</strong>.</p>

    <blockquote>
      <p><strong>Note</strong>: If this is the first time you are starting <strong>Cloud Shell</strong> and you are presented with the <strong>You have no storage mounted</strong> message, select the subscription you are using in this lab, and select <strong>Create storage</strong>.</p>
    </blockquote>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to generate a pseudo-random string of characters that will be used as a prefix for names of resources you will provision in this exercise:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PREFIX=$(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> `openssl rand -base64 5 | cut -c1-7 | tr <span class="hljs-string"><span class="hljs-string">'[:upper:]'</span></span> <span class="hljs-string"><span class="hljs-string">'[:lower:]'</span></span> | tr -<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-string"><span class="hljs-string">'[[:alnum:]]._-'</span></span>`)
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to designate the Azure region into which you want to provision resources in this lab (replace the <code>&lt;Azure region&gt;</code> placeholder with the name of the Azure region that is available in your subscription and which is closest to the location of your lab computer):</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LOCATION=<span class="hljs-string"><span class="hljs-string">'&lt;Azure region&gt;'</span></span>
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create a resource group that will host all resources that you will provision in this lab:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> RESOURCE_GROUP_NAME=<span class="hljs-string"><span class="hljs-string">'az30314b-labRG'</span></span>

az group create --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> --location <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$LOCATION</span></span></span><span class="hljs-string">"</span></span>
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create an Azure Storage account that will host container with blobs to be processed by the Azure function:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> STORAGE_ACCOUNT_NAME=<span class="hljs-string"><span class="hljs-string">"az30314b</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${PREFIX}</span></span></span><span class="hljs-string">"</span></span>

<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CONTAINER_NAME=<span class="hljs-string"><span class="hljs-string">"workitems"</span></span>

<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> STORAGE_ACCOUNT=$(az storage account create --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_NAME}</span></span></span><span class="hljs-string">"</span></span> --kind <span class="hljs-string"><span class="hljs-string">"StorageV2"</span></span> --location <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LOCATION}</span></span></span><span class="hljs-string">"</span></span> --resource-group <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> --sku <span class="hljs-string"><span class="hljs-string">"Standard_LRS"</span></span>)
</code></pre>

    <blockquote>
      <p><strong>Note</strong>: The same storage account will be also used by the Azure function to facilitate its own processing requirements. In real-world scenarios, you might want to consider creating a separate storage account for this purpose.</p>
    </blockquote>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create a variable storing the value of the connection string property of the Azure Storage account:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> STORAGE_CONNECTION_STRING=$(az storage account show-connection-string --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_NAME}</span></span></span><span class="hljs-string">"</span></span> --resource-group <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> -o tsv)
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create a container that will host blobs to be processed by the Azure function:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="language-sh hljs bash">az storage container create --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CONTAINER_NAME}</span></span></span><span class="hljs-string">"</span></span> --account-name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_NAME}</span></span></span><span class="hljs-string">"</span></span> --connection-string <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_CONNECTION_STRING}</span></span></span><span class="hljs-string">"</span></span>
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create an Application Insights resource that will provide monitoring of the Azure Function processing blobs and store its key in a variable:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> APPLICATION_INSIGHTS_NAME=<span class="hljs-string"><span class="hljs-string">"az30314bi</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${PREFIX}</span></span></span><span class="hljs-string">"</span></span>

az resource create --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${APPLICATION_INSIGHTS_NAME}</span></span></span><span class="hljs-string">"</span></span> --location <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LOCATION}</span></span></span><span class="hljs-string">"</span></span> --properties <span class="hljs-string"><span class="hljs-string">'{"Application_Type": "other", "ApplicationId": "function", "Flow_Type": "Redfield"}'</span></span> --resource-group <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> --resource-type <span class="hljs-string"><span class="hljs-string">"Microsoft.Insights/components"</span></span>

<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> APPINSIGHTS_KEY=$(az resource show --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${APPLICATION_INSIGHTS_NAME}</span></span></span><span class="hljs-string">"</span></span> --query <span class="hljs-string"><span class="hljs-string">"properties.InstrumentationKey"</span></span> --resource-group <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> --resource-type <span class="hljs-string"><span class="hljs-string">"Microsoft.Insights/components"</span></span> -o tsv)
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create the Azure Function that will process events corresponding to creation of Azure Storage blobs:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> FUNCTION_NAME=<span class="hljs-string"><span class="hljs-string">"az30314f</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${PREFIX}</span></span></span><span class="hljs-string">"</span></span>

az functionapp create --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${FUNCTION_NAME}</span></span></span><span class="hljs-string">"</span></span> --resource-group <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> --app-insights <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPLICATION_INSIGHTS_NAME</span></span></span><span class="hljs-string">"</span></span> --app-insights-key <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPINSIGHTS_KEY</span></span></span><span class="hljs-string">"</span></span> --storage-account <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_NAME}</span></span></span><span class="hljs-string">"</span></span> --consumption-plan-location <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LOCATION}</span></span></span><span class="hljs-string">"</span></span> --runtime <span class="hljs-string"><span class="hljs-string">"dotnet"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">functions</span></span>-version 2
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to configure Application Settings of the newly created function, linking it to the Application Insights and Azure Storage account:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock8" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock8" class="mt-0"><code class="language-sh hljs bash">az functionapp config appsettings <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${FUNCTION_NAME}</span></span></span><span class="hljs-string">"</span></span> --resource-group <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> --settings <span class="hljs-string"><span class="hljs-string">"APPINSIGHTS_INSTRUMENTATIONKEY=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPINSIGHTS_KEY</span></span></span><span class="hljs-string">"</span></span> FUNCTIONS_EXTENSION_VERSION=~2

az functionapp config appsettings <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${FUNCTION_NAME}</span></span></span><span class="hljs-string">"</span></span> --resource-group <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> --settings <span class="hljs-string"><span class="hljs-string">"STORAGE_CONNECTION_STRING=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$STORAGE_CONNECTION_STRING</span></span></span><span class="hljs-string">"</span></span> FUNCTIONS_EXTENSION_VERSION=~2
</code></pre>
  </li>
  <li>
    <p>Switch to the Azure portal and navigate to the blade of the Azure Function app you created earlier in this task.</p>
  </li>
  <li>
    <p>On the Azure Function app blade, select <strong>Functions</strong> and then, select <strong>+ Add</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Add Function</strong> blade, select <strong>Azure Blob Storage trigger</strong> template.</p>
  </li>
  <li>
    <p>On the <strong>Add Function</strong> blade, specify the following and select <strong>Add</strong> to create a new function within the Azure function:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Name</td>
          <td><strong>BlobTrigger</strong></td>
        </tr>
        <tr>
          <td>Path</td>
          <td><strong>workitems/{name}</strong></td>
        </tr>
        <tr>
          <td>Storage account connection</td>
          <td><strong>STORAGE_CONNECTION_STRING</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>On the Azure Function app <strong>BlobTrigger</strong> function blade, select <strong>Code + Test</strong> and review the content of the run.csx file.</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock9" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock9" class="mt-0"><code class="language-csharp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream myBlob, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, ILogger log</span></span></span><span class="hljs-function">)
</span></span>{
    log.LogInformation(<span class="hljs-string"><span class="hljs-string">$"C# Blob trigger function Processed blob\n Name:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string"> \n Size: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{myBlob.Length}</span></span></span><span class="hljs-string"> Bytes"</span></span>);
}
</code></pre>

    <blockquote>
      <p><strong>Note</strong>: By default, the function is configured to simply log the event corresponding to creation of a new blob. In order to carry out blob processing tasks, you would modify the content of this file.</p>
    </blockquote>
  </li>
</ol>

<h4 id="task-2-validate-an-azure-function-app-storage-blob-trigger">Task 2: Validate an Azure Function App Storage Blob trigger</h4>

<ol>
  <li>
    <p>If necessary, restart the Bash session in the Cloud Shell.</p>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to repopulate variables that you used in the previous task:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock10" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock10" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> RESOURCE_GROUP_NAME=<span class="hljs-string"><span class="hljs-string">'az30314b-labRG'</span></span>

<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> STORAGE_ACCOUNT_NAME=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(az storage account list --resource-group "${RESOURCE_GROUP_NAME}" --query "[0].name" --output tsv)</span></span></span><span class="hljs-string">"</span></span>

<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CONTAINER_NAME=<span class="hljs-string"><span class="hljs-string">"workitems"</span></span>
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to upload a test blob to the Azure Storage account you created earlier in this task:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock11" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock11" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> STORAGE_ACCESS_KEY=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(az storage account keys list --account-name "${STORAGE_ACCOUNT_NAME}" --resource-group "${RESOURCE_GROUP_NAME}" --query "[0].value" --output tsv)</span></span></span><span class="hljs-string">"</span></span>

<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> WORKITEM=<span class="hljs-string"><span class="hljs-string">'workitem1.txt'</span></span>

touch <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${WORKITEM}</span></span></span><span class="hljs-string">"</span></span>

az storage blob upload --file <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${WORKITEM}</span></span></span><span class="hljs-string">"</span></span> --container-name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CONTAINER_NAME}</span></span></span><span class="hljs-string">"</span></span> --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${WORKITEM}</span></span></span><span class="hljs-string">"</span></span> --auth-mode key --account-key <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCESS_KEY}</span></span></span><span class="hljs-string">"</span></span> --account-name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_NAME}</span></span></span><span class="hljs-string">"</span></span>
</code></pre>
  </li>
  <li>
    <p>In the Azure portal, navigate back to the blade displaying the Azure Function app you created in the previous task.</p>
  </li>
  <li>
    <p>From the Function app, click <strong>Functions</strong>.</p>
  </li>
  <li>
    <p>In the list of functions, click the name of your function.</p>
  </li>
  <li>
    <p>On the Azure Function app blade, select <strong>Monitor</strong> entry.</p>
  </li>
  <li>
    <p>Note a single event entry representing uploading of the blob. Select the entry to view the <strong>Invocation Traces</strong> details.</p>

    <blockquote>
      <p><strong>Note</strong>: Since the Azure function app in this exercise runs in the Consumption plan, there may be a delay of up to several minutes between uploading a blob and the function being triggered. It is possible to minimize the latency by implementing the Function app by using an App Service (rather than Consumption) plan.</p>
    </blockquote>
  </li>
  <li>
    <p>Under <strong>Invocation Traces</strong>, click <strong>Run query in Application Insights</strong>.</p>
  </li>
  <li>
    <p>In the Application Insights portal, review the autogenerated Kusto query and its results.</p>
  </li>
</ol>

<h3 id="exercise-2-configure-and-validate-an-azure-event-grid-subscription-based-queue-messaging">Exercise 2: Configure and validate an Azure Event Grid subscription-based queue messaging</h3>

<p>The main tasks for this exercise are as follows:</p>

<ol>
  <li>
    <p>Configure an Azure Event Grid subscription-based queue messaging</p>
  </li>
  <li>
    <p>Validate an Azure Event Grid subscription-based queue messaging</p>
  </li>
  <li>
    <p>Remove Azure resources deployed in the lab</p>
  </li>
</ol>

<h4 id="task-1-configure-an-azure-event-grid-subscription-based-queue-messaging">Task 1: Configure an Azure Event Grid subscription-based queue messaging</h4>

<ol>
  <li>
    <p>If necessary, restart the Bash session in the Cloud Shell.</p>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to register the eventgrid resource provider in your subscription:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock12" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock12" class="mt-0"><code class="language-sh hljs bash">az provider register --namespace microsoft.eventgrid
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to generate a pseudo-random string of characters that will be used as a prefix for names of resources you will provision in this exercise:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock13" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock13" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PREFIX=$(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> `openssl rand -base64 5 | cut -c1-7 | tr <span class="hljs-string"><span class="hljs-string">'[:upper:]'</span></span> <span class="hljs-string"><span class="hljs-string">'[:lower:]'</span></span> | tr -<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-string"><span class="hljs-string">'[[:alnum:]]._-'</span></span>`)
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to identify the Azure region hosting the target resource group and its existing resources:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock14" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock14" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> RESOURCE_GROUP_NAME_EXISTING=<span class="hljs-string"><span class="hljs-string">'az30314b-labRG'</span></span>

<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LOCATION=$(az group list --query <span class="hljs-string"><span class="hljs-string">"[?name == '</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME_EXISTING}</span></span></span><span class="hljs-string">'].location"</span></span> --output tsv)

<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> RESOURCE_GROUP_NAME=<span class="hljs-string"><span class="hljs-string">'az30314c-labRG'</span></span>

az group create --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> --location <span class="hljs-variable"><span class="hljs-variable">$LOCATION</span></span>
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create an Azure Storage account that will host a container to be used by the Event Grid subscription that you will configure in this task:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock15" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock15" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> STORAGE_ACCOUNT_NAME=<span class="hljs-string"><span class="hljs-string">"az30314cst</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${PREFIX}</span></span></span><span class="hljs-string">"</span></span>

<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CONTAINER_NAME=<span class="hljs-string"><span class="hljs-string">"workitems"</span></span>

<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> STORAGE_ACCOUNT=$(az storage account create --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_NAME}</span></span></span><span class="hljs-string">"</span></span> --kind <span class="hljs-string"><span class="hljs-string">"StorageV2"</span></span> --location <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LOCATION}</span></span></span><span class="hljs-string">"</span></span> --resource-group <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> --sku <span class="hljs-string"><span class="hljs-string">"Standard_LRS"</span></span>)
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create a variable storing the value of the connection string property of the Azure Storage account:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock16" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock16" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> STORAGE_CONNECTION_STRING=$(az storage account show-connection-string --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_NAME}</span></span></span><span class="hljs-string">"</span></span> --resource-group <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> -o tsv)
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create a container that will to be used by the Event Grid subscription:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock17" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock17" class="mt-0"><code class="language-sh hljs bash">az storage container create --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CONTAINER_NAME}</span></span></span><span class="hljs-string">"</span></span> --account-name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_NAME}</span></span></span><span class="hljs-string">"</span></span> --connection-string <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_CONNECTION_STRING}</span></span></span><span class="hljs-string">"</span></span>
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create a variable storing the value of the Resource Id property of the Azure Storage account:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock18" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock18" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> STORAGE_ACCOUNT_ID=$(az storage account show --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_NAME}</span></span></span><span class="hljs-string">"</span></span> --query <span class="hljs-string"><span class="hljs-string">"id"</span></span> --resource-group <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${RESOURCE_GROUP_NAME}</span></span></span><span class="hljs-string">"</span></span> -o tsv)
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create the Storage Account queue that will store messages generated by the Event Grid subscription that you will configure in this task:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock19" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock19" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> QUEUE_NAME=<span class="hljs-string"><span class="hljs-string">"az30314cq</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${PREFIX}</span></span></span><span class="hljs-string">"</span></span>

az storage queue create --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${QUEUE_NAME}</span></span></span><span class="hljs-string">"</span></span> --account-name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_NAME}</span></span></span><span class="hljs-string">"</span></span> --connection-string <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_CONNECTION_STRING}</span></span></span><span class="hljs-string">"</span></span>
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to create the Event Grid subscription that will facilitate generation of messages in Azure Storage queue in response to blob uploads to the designated container in the Azure Storage account:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock20" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock20" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> QUEUE_SUBSCRIPTION_NAME=<span class="hljs-string"><span class="hljs-string">"az30314cqsub</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${PREFIX}</span></span></span><span class="hljs-string">"</span></span>

az eventgrid event-subscription create --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${QUEUE_SUBSCRIPTION_NAME}</span></span></span><span class="hljs-string">"</span></span> --included-event-types <span class="hljs-string"><span class="hljs-string">'Microsoft.Storage.BlobCreated'</span></span> --endpoint <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_ID}</span></span></span><span class="hljs-string">/queueservices/default/queues/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${QUEUE_NAME}</span></span></span><span class="hljs-string">"</span></span> --endpoint-type <span class="hljs-string"><span class="hljs-string">"storagequeue"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>-resource-id <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_ID}</span></span></span><span class="hljs-string">"</span></span>
</code></pre>
  </li>
</ol>

<h4 id="task-2-validate-an-azure-event-grid-subscription-based-queue-messaging">Task 2: Validate an Azure Event Grid subscription-based queue messaging</h4>

<ol>
  <li>
    <p>From the Cloud Shell pane, run the following to upload a test blob to the Azure Storage account you created earlier in this task:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock21" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock21" class="mt-0"><code class="language-sh hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> AZURE_STORAGE_ACCESS_KEY=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(az storage account keys list --account-name "${STORAGE_ACCOUNT_NAME}" --resource-group "${RESOURCE_GROUP_NAME}" --query "[0].value" --output tsv)</span></span></span><span class="hljs-string">"</span></span>

<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> WORKITEM=<span class="hljs-string"><span class="hljs-string">'workitem2.txt'</span></span>

touch <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${WORKITEM}</span></span></span><span class="hljs-string">"</span></span>

az storage blob upload --file <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${WORKITEM}</span></span></span><span class="hljs-string">"</span></span> --container-name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CONTAINER_NAME}</span></span></span><span class="hljs-string">"</span></span> --name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${WORKITEM}</span></span></span><span class="hljs-string">"</span></span> --auth-mode key --account-key <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${AZURE_STORAGE_ACCESS_KEY}</span></span></span><span class="hljs-string">"</span></span> --account-name <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STORAGE_ACCOUNT_NAME}</span></span></span><span class="hljs-string">"</span></span>
</code></pre>
  </li>
  <li>
    <p>In the Azure portal, navigate to the blade displaying the Azure Storage account you created in the previous task of this exercise.</p>
  </li>
  <li>
    <p>On the blade of the Azure Storage account, select <strong>Queues</strong> to display the list of its queues.</p>
  </li>
  <li>
    <p>Select the entry representing the queue you created in the previous task of this exercise.</p>
  </li>
  <li>
    <p>Note that the queue contains a single message. Select its entry to display the <strong>Message properties</strong> blade.</p>
  </li>
  <li>
    <p>In the <strong>MESSAGE BODY</strong>, note the value of the <strong>url</strong> property, representing the URL of the Azure Storage blob you uploaded in the previous task.</p>
  </li>
</ol>

<h4 id="task-3-remove-azure-resources-deployed-in-the-lab">Task 3: Remove Azure resources deployed in the lab</h4>

<ol>
  <li>
    <p>From the Cloud Shell pane, run the following to list the resource group you created in this exercise:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock22" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock22" class="mt-0"><code class="language-sh hljs bash">az group list --query <span class="hljs-string"><span class="hljs-string">"[?starts_with(name,'az30314')]"</span></span>.name --output tsv
</code></pre>

    <blockquote>
      <p><strong>Note</strong>: Verify that the output contains only the resource group you created in this lab. This group will be deleted in this task.</p>
    </blockquote>
  </li>
  <li>
    <p>From the Cloud Shell pane, run the following to delete the resource group you created in this lab</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">shell</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock23" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock23" class="mt-0"><code class="language-sh hljs bash">az group list --query <span class="hljs-string"><span class="hljs-string">"[?starts_with(name,'az30314')]"</span></span>.name --output tsv | xargs -L1 bash -c <span class="hljs-string"><span class="hljs-string">'az group delete --name $0 --no-wait --yes'</span></span>
</code></pre>
  </li>
  <li>
    <p>Close the Cloud Shell pane.</p>
  </li>
</ol>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-303-Microsoft-Azure-Architect-Technologies" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-303-Microsoft-Azure-Architect-Technologies
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D479f9cfd893a2bea83ac41ba638fc5e7bd9113e0.js"></script>



</body></html>