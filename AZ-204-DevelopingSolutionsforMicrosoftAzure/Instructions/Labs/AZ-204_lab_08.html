<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-204: Developing solutions for Microsoft Azure
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D64f540ac7c8eef33997aaf23b6af9bd5b858530e.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-204: Developing solutions for Microsoft Azure
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-204-DevelopingSolutionsforMicrosoftAzure" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#before-you-start">Before you start</a></li><li class="nav-item"><a class="nav-link active" href="#exercise-1-create-an-azure-app-service-resource-by-using-a-docker-container-image">Exercise 1: Create an Azure App Service resource by using a Docker container image</a></li><li class="nav-item"><a class="nav-link" href="#exercise-2-build-an-api-proxy-tier-by-using-azure-api-management">Exercise 2: Build an API proxy tier by using Azure API Management</a></li><li class="nav-item"><a class="nav-link" href="#exercise-3-clean-up-your-subscription">Exercise 3: Clean up your subscription</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="lab-08-create-a-multi-tier-solution-by-using-azure-services">Lab 08: Create a multi-tier solution by using Azure services</h1>

<h2 id="microsoft-azure-user-interface">Microsoft Azure user interface</h2>

<p>Given the dynamic nature of Microsoft cloud tools, you might experience Azure UI changes that occur after the development of this training content. As a result, the lab instructions and lab steps might not align correctly.</p>

<p>Microsoft updates this training course when the community alerts us to needed changes. However, cloud updates occur frequently, so you might encounter UI changes before this training content updates. <strong>If this occurs, adapt to the changes, and then work through them in the labs as needed.</strong></p>

<h2 id="instructions">Instructions</h2>

<h3 id="before-you-start">Before you start</h3>

<h4 id="sign-in-to-the-lab-environment">Sign in to the lab environment</h4>

<p>Sign in to your Windows 10 virtual machine (VM) by using the following credentials:</p>

<ul>
  <li>
    <p>Username: <strong>Admin</strong></p>
  </li>
  <li>
    <p>Password: <strong>Pa55w.rd</strong></p>
  </li>
</ul>

<blockquote>
  <p><strong>Note</strong>: Your instructor will provide instructions to connect to the virtual lab environment.</p>
</blockquote>

<h4 id="review-the-installed-applications">Review the installed applications</h4>

<p>Find the taskbar on your Windows 10 desktop. The taskbar contains the icons for the applications that you’ll use in this lab:</p>

<ul>
  <li>Microsoft Edge</li>
</ul>

<h2 id="architecture-diagram">Architecture diagram</h2>

<p><a href="media/Lab08-Diagram.png" target="_blank"><img src="media/Lab08-Diagram.png" alt="Architecture diagram depicting the creation of a multi-tier application by using Azure services."></a></p>

<h3 id="exercise-1-create-an-azure-app-service-resource-by-using-a-docker-container-image">Exercise 1: Create an Azure App Service resource by using a Docker container image</h3>

<h4 id="task-1-open-the-azure-portal">Task 1: Open the Azure portal</h4>

<ol>
  <li>
    <p>On the taskbar, select the <strong>Microsoft Edge</strong> icon.</p>
  </li>
  <li>
    <p>In the browser window that opens, browse to the Azure portal (<a href="https://portal.azure.com">portal.azure.com</a>), and then sign in with the account you’ll be using for this lab.</p>

    <blockquote>
      <p><strong>Note</strong>: If this is your first time signing in to the Azure portal, you’ll be offered a tour of the portal. Select <strong>Get Started</strong> to skip the tour and begin using the portal.</p>
    </blockquote>
  </li>
</ol>

<h4 id="task-2-create-a-web-app-by-using-azure-app-service-resource-by-using-an-httpbin-container-image">Task 2: Create a web app by using Azure App Service resource by using an httpbin container image</h4>

<ol>
  <li>
    <p>In the Azure portal, use the <strong>Search resources, services, and docs</strong> text box to search for <strong>App Services</strong> and, in the list of results, select <strong>App Services</strong>.</p>
  </li>
  <li>
    <p>On the <strong>App Services</strong> blade, select <strong>+ Create</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Create Web App</strong> blade, on the <strong>Basics</strong> tab, perform the following actions:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Subscription</strong> drop-down list</td>
          <td>Retain the default value.</td>
        </tr>
        <tr>
          <td><strong>Resource group</strong> section</td>
          <td>Select <strong>Create new</strong>, enter <strong>ApiService</strong>,  and then select <strong>OK</strong>.</td>
        </tr>
        <tr>
          <td><strong>Name</strong> text box</td>
          <td>Enter <strong>httpapi</strong> <em>[yourname]</em>.</td>
        </tr>
        <tr>
          <td><strong>Publish</strong> section</td>
          <td>Select <strong>Docker Container</strong>.</td>
        </tr>
        <tr>
          <td><strong>Operating System</strong> section</td>
          <td>Select <strong>Linux</strong>.</td>
        </tr>
        <tr>
          <td><strong>Region</strong> drop-down  list</td>
          <td>Select any Azure region in which you can deploy an Azure web app.</td>
        </tr>
        <tr>
          <td><strong>App Service Plan</strong> section</td>
          <td>Select <strong>Create new</strong>, enter  the value <strong>ApiPlan</strong> in the <strong>Name</strong> text  box, and then select <strong>OK</strong>.</td>
        </tr>
        <tr>
          <td><strong>SKU and size</strong> section</td>
          <td>Select <strong>Change size</strong>, on the <strong>Spec  Picker</strong> blade, select <strong>See additional options</strong>, select <strong>S1</strong>, and then select <strong>Apply</strong>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Select <strong>Next: Docker &gt;</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Docker</strong> tab, perform the following actions, and then select <strong>Review + create</strong>:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Options</strong> drop-down list</td>
          <td>Select <strong>Single Container</strong>.</td>
        </tr>
        <tr>
          <td><strong>Image Source</strong> drop-down list</td>
          <td>Select <strong>Docker Hub</strong>.</td>
        </tr>
        <tr>
          <td><strong>Access Type</strong> drop-down list</td>
          <td>Select <strong>Public</strong>.</td>
        </tr>
        <tr>
          <td><strong>Image and tag</strong> text box</td>
          <td>Enter <strong>kennethreitz/httpbin:latest</strong>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>On the <strong>Review + create</strong> tab, review the options that you selected during the previous steps.</p>
  </li>
  <li>
    <p>Select <strong>Create</strong> to create the web app by using your specified configuration.</p>

    <blockquote>
      <p><strong>Note</strong>: Wait for the creation task to complete before you proceed with this lab.</p>
    </blockquote>
  </li>
</ol>

<h4 id="task-3-test-the-httpbin-web-application">Task 3: Test the httpbin web application</h4>

<ol>
  <li>
    <p>In the Azure portal, use the <strong>Search resources, services, and docs</strong> text box to search for <strong>App Services</strong> and, in the list of results, select <strong>App Services</strong>.</p>
  </li>
  <li>
    <p>On the <strong>App Services</strong> blade, select the newly created web app.</p>
  </li>
  <li>
    <p>On the blade displaying the newly created app properties, select <strong>Browse</strong>.</p>
  </li>
  <li>
    <p>Within the web application, perform the following actions:</p>

    <p>a.  Select <strong>Response formats</strong>.</p>

    <p>b.  Select <strong>GET /html</strong>.</p>

    <p>c.  Select <strong>Try it out</strong>.</p>

    <p>The following screenshot displays the <strong>Try it out</strong> section of the web application.</p>

    <p><a href="media/l08_httpbin_get_html_try.png" target="_blank"><img src="media/l08_httpbin_get_html_try.png" alt="httpbin.org API page GET /html try it out section"></a></p>

    <p>d.  Select <strong>Execute</strong>.</p>

    <p>e.  Review the value of the <strong>Response body</strong> and <strong>Response headers</strong> text boxes.</p>

    <p>f.  Review the value of the <strong>Request URL</strong> text box.</p>
  </li>
  <li>
    <p>Within the web application, perform the following actions:</p>

    <p>a.  Select <strong>Dynamic data</strong>.</p>

    <p>b.  Select <strong>GET /bytes/{n}</strong>.</p>

    <p>c.  Select <strong>Try it out</strong>.</p>

    <p>d.  In the <strong>n</strong> text box, enter <strong>25</strong>.</p>

    <p>e.  Select <strong>Execute</strong>.</p>

    <p>f.  Review the value of the <strong>Response body</strong> and <strong>Response headers</strong> text boxes.</p>

    <p>g.  Select <strong>Download file</strong>, and after the file downloads, open it in Notepad, review its content, and then close it.</p>

    <blockquote>
      <p><strong>Note</strong>: The file contains a sequence of randomly generated bytes.</p>
    </blockquote>

    <p>The following screenshot displays the dynamic data section of the web application.</p>

    <p><a href="media/l08_response_to_dynamic_data.png" target="_blank"><img src="media/l08_response_to_dynamic_data.png" alt="httpbin.org API page GET /bytes/{n} dynamic data section"></a></p>
  </li>
  <li>
    <p>Within the web application, perform the following actions:</p>

    <p>a.  Select <strong>Status codes</strong>.</p>

    <p>b.  Select <strong>GET /status/{codes}</strong>.</p>

    <p>c.  Select <strong>Try it out</strong>.</p>

    <p>d.  In the <strong>codes</strong> text box, enter <strong>404</strong>.</p>

    <p>e.  Select <strong>Execute</strong>.</p>

    <p>f.  Review the <strong>Server response</strong> and note that it includes <strong>Error: NOT FOUND</strong> entry.</p>
  </li>
  <li>
    <p>Close the browser window that displays the web application.</p>
  </li>
  <li>
    <p>Switch back to the browser window that displays the <strong>httpapi</strong><em>[yourname]</em> web app.</p>
  </li>
  <li>
    <p>In the <strong>Settings</strong> section, select the <strong>Properties</strong> link.</p>
  </li>
  <li>
    <p>In the <strong>Properties</strong> section, record the value of the <strong>URL</strong> link. You’ll use this value later in the lab to send requests to the corresponding API.</p>
  </li>
</ol>

<h4 id="review">Review</h4>

<p>In this exercise, you created a new Azure web app by using a container image sourced from Docker Hub.</p>

<h3 id="exercise-2-build-an-api-proxy-tier-by-using-azure-api-management">Exercise 2: Build an API proxy tier by using Azure API Management</h3>

<h4 id="task-1-create-an-api-management-resource">Task 1: Create an API Management resource</h4>

<ol>
  <li>
    <p>In the Azure portal, use the <strong>Search resources, services, and docs</strong> text box to search for <strong>API Management services</strong> and, in the list of results, select <strong>API Management services</strong>.</p>
  </li>
  <li>
    <p>On the <strong>API Management services</strong> blade, select <strong>+ Create</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Create API Management</strong> blade, perform the following actions, and then select <strong>Review + create</strong>:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Subscription</strong> drop-down list</td>
          <td>Retain the default value.</td>
        </tr>
        <tr>
          <td><strong>Resource group</strong> section</td>
          <td>Select the <strong>ApiService</strong> group that you created  earlier in the lab.</td>
        </tr>
        <tr>
          <td><strong>Resource name</strong> text box</td>
          <td>Enter <strong>proapi</strong> <em>[yourname]</em>.</td>
        </tr>
        <tr>
          <td><strong>Region</strong> list</td>
          <td>Select the same region you chose in the previous exercise.</td>
        </tr>
        <tr>
          <td><strong>Organization name</strong> text box</td>
          <td>Enter <strong>Contoso</strong>.</td>
        </tr>
        <tr>
          <td><strong>Administrator email</strong> text  box</td>
          <td>Enter <code>admin@contoso.com</code>.</td>
        </tr>
        <tr>
          <td><strong>Pricing tier</strong> drop-down  list</td>
          <td><strong>Consumption (99.95% SLA)</strong>.</td>
        </tr>
      </tbody>
    </table>

    <p>The following screenshot displays the configured settings of <strong>Create API Management</strong> blade of the web application.</p>

    <p><a href="media/l08_create_api_management.png" target="_blank"><img src="media/l08_create_api_management.png" alt="Create an API Management blade"></a></p>
  </li>
  <li>
    <p>On the <strong>Review + create</strong> tab, review the option that you specified in the previous step, and then select <strong>Create</strong>.</p>

    <blockquote>
      <p><strong>Note</strong>: Wait for the creation task to complete before you continue with this lab.</p>
    </blockquote>
  </li>
</ol>

<h4 id="task-2-define-a-new-api">Task 2: Define a new API</h4>

<ol>
  <li>
    <p>In the Azure portal, use the <strong>Search resources, services, and docs</strong> text box to search for <strong>API Management services</strong> and, in the list of results, select <strong>API Management services</strong>.</p>
  </li>
  <li>
    <p>On the <strong>API Management services</strong> blade, select the newly created API management service.</p>
  </li>
  <li>
    <p>On the <strong>API Management Service</strong> blade, in the <strong>APIs</strong> section, select <strong>APIs</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Define a new API</strong> section, select <strong>HTTP</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Create a blank API</strong> window, perform the following actions and select <strong>Create</strong>:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Display name</strong> text box</td>
          <td>Enter <strong>HTTPBin API</strong>.</td>
        </tr>
        <tr>
          <td><strong>Name</strong> text box</td>
          <td>Enter <strong>httpbin-api</strong>.</td>
        </tr>
        <tr>
          <td><strong>Web service URL</strong> text box</td>
          <td>Enter the URL for the web app that you copied earlier in this lab. <strong>Note</strong>: Make sure that the URL starts with the https:// prefix.</td>
        </tr>
        <tr>
          <td><strong>API URL suffix</strong> text box</td>
          <td>Leave it empty.</td>
        </tr>
      </tbody>
    </table>

    <p>The following screenshot displays the configured settings of <strong>Create a blank API</strong> window of the web application.</p>

    <p><a href="media/l08_create_blank_api.png" target="_blank"><img src="media/l08_create_blank_api.png" alt="Create a blank API pane"></a></p>

    <blockquote>
      <p><strong>Note</strong>: Wait for the new API to finish being created.</p>
    </blockquote>
  </li>
  <li>
    <p>On the <strong>Design</strong> tab, select <strong>+ Add operation</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Add operation</strong> section, perform the following actions, and then select <strong>Save</strong>:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Display name</strong> text box</td>
          <td>Enter <strong>Echo Headers</strong>.</td>
        </tr>
        <tr>
          <td><strong>Name</strong> text box</td>
          <td>Verify that its value is set to <strong>echo-headers</strong>.</td>
        </tr>
        <tr>
          <td><strong>URL</strong> list</td>
          <td>Select <strong>GET</strong>.</td>
        </tr>
        <tr>
          <td><strong>URL</strong> text box</td>
          <td>Enter <strong>/</strong>.</td>
        </tr>
      </tbody>
    </table>

    <p>The following screenshot displays the configured settings of the <strong>Add operation</strong> section.</p>

    <p><a href="media/l08_add_echo_headers_operation.png" target="_blank"><img src="media/l08_add_echo_headers_operation.png" alt="The properties of the Add Echo Headers operation"></a></p>
  </li>
  <li>
    <p>Back on the <strong>Design</strong> tab, in the list of operations, select <strong>Echo Headers</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Design</strong> section, on the <strong>Inbound processing</strong> tile select <strong>+ Add policy</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Add inbound policy</strong> section, select the <strong>Set headers</strong> tile.</p>
  </li>
  <li>
    <p>In the <strong>Set Headers</strong> section, perform the following actions, and then select <strong>Save</strong>:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Name</strong> text box</td>
          <td>Enter <strong>source</strong>.</td>
        </tr>
        <tr>
          <td><strong>Value</strong> text box</td>
          <td>Select the list, select <strong>Add Value</strong>, and then enter <strong>azure-api-mgmt</strong>.</td>
        </tr>
        <tr>
          <td><strong>Action</strong> list</td>
          <td>Select <strong>append</strong>.</td>
        </tr>
      </tbody>
    </table>

    <p>The following screenshot displays the configured settings of the <strong>Design</strong> section.</p>

    <p><a href="media/l08_get_echo_headers_design.png" target="_blank"><img src="media/l08_get_echo_headers_design.png" alt="The Echo Headers design pane"></a></p>
  </li>
  <li>
    <p>Back on the <strong>Design</strong> tab, in the list of operations, select <strong>Echo Headers</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Design</strong> section for <strong>Echo Headers</strong>, on the <strong>Backend</strong> tile, select the pencil icon.</p>
  </li>
  <li>
    <p>In the <strong>Backend</strong> section, perform the following actions, and then select <strong>Save</strong>:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Service URL</strong> section</td>
          <td>Select the <strong>Override</strong> check box.</td>
        </tr>
        <tr>
          <td><strong>Service URL</strong> text box</td>
          <td>Append the value <strong>/headers</strong> to its current value. <strong>Note</strong>: For example, if the current value is <code>http://httpapi[yourname].azurewebsites.net</code>, the new value will be <code>http://httpapi[yourname].azurewebsites.net/headers</code>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Back on the <strong>Design</strong> tab, in the list of operations, select <strong>Echo Headers</strong>, and then select the <strong>Test</strong> tab.</p>
  </li>
  <li>
    <p>In the <strong>Echo Headers</strong> section, select <strong>Send</strong>.</p>

    <p>The following screenshot displays the configured settings of the <strong>Echo Headers</strong> section.</p>

    <p><a href="media/l08_test_echo_headers.png" target="_blank"><img src="media/l08_test_echo_headers.png" alt="The Test Echo Headers tab"></a></p>
  </li>
  <li>
    <p>Review the results of the API request.</p>

    <blockquote>
      <p><strong>Note</strong>: Verify that there are many headers sent as part of your request that are echoed in the response. They should include the new <strong>Source</strong> header that you created as part of this task.</p>
    </blockquote>

    <p>The following screenshot displays the response to the <strong>Echo Headers</strong> request.</p>

    <p><a href="media/l08_response_to_echo_headers.png" target="_blank"><img src="media/l08_response_to_echo_headers.png" alt="A response to the test echo headers request"></a></p>
  </li>
  <li>
    <p>Select the <strong>Design</strong> tab to return to the list of operations.</p>
  </li>
</ol>

<h4 id="task-3-manipulate-an-api-response">Task 3: Manipulate an API response</h4>

<ol>
  <li>
    <p>On the <strong>Design</strong> tab, select <strong>+ Add operation</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Add operation</strong> section, perform the following actions, and then select <strong>Save</strong>:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Display name</strong> text box</td>
          <td>Enter <strong>Get Legacy Data</strong>.</td>
        </tr>
        <tr>
          <td><strong>Name</strong> text box</td>
          <td>Verify that its value is set to <strong>get-legacy-data</strong>.</td>
        </tr>
        <tr>
          <td><strong>URL</strong> list</td>
          <td>Verify that its value is set to <strong>GET</strong>.</td>
        </tr>
        <tr>
          <td><strong>URL</strong> text box</td>
          <td>Enter <strong>/xml</strong>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Back on the <strong>Design</strong> tab, in the list of operations, select <strong>Get Legacy Data</strong>.</p>
  </li>
  <li>
    <p>Select the <strong>Test</strong> tab, and then select <strong>Send</strong>.</p>
  </li>
  <li>
    <p>Review the results of the API request.</p>

    <blockquote>
      <p><strong>Note</strong>: At this point, the results should be in XML format.</p>
    </blockquote>

    <p>The following screenshot displays the results of the API request.</p>

    <p><a href="media/l08_response_to_get_legacy_data.png" target="_blank"><img src="media/l08_response_to_get_legacy_data.png" alt="A response to the get legacy data request"></a></p>
  </li>
  <li>
    <p>Select the <strong>Design</strong> tab, and then select <strong>Get Legacy Data</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Design</strong> pane, in the <strong>Outbound processing</strong> section, select <strong>Add policy</strong>.</p>

    <p>The following screenshot displays the <strong>Outbound processing</strong> section.</p>

    <p><a href="media/l08_get_legacy_data_outbound_processing.png" target="_blank"><img src="media/l08_get_legacy_data_outbound_processing.png" alt="An outbound processing section of the get legacy data operation"></a></p>
  </li>
  <li>
    <p>In the <strong>Add outbound policy</strong> section, select the <strong>Other policies</strong> tile.</p>
  </li>
  <li>
    <p>In the policy code editor, find the following block of XML content:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="hljs apache"><span class="hljs-section"><span class="hljs-section">&lt;outbound&gt;</span></span>
    <span class="hljs-section"><span class="hljs-section">&lt;base /&gt;</span></span>
<span class="hljs-section"><span class="hljs-section">&lt;/outbound&gt;</span></span>
</code></pre>
  </li>
  <li>
    <p>Replace that block of XML with the following XML:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">outbound</span></span></span><span class="hljs-tag">&gt;</span></span>
    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base</span></span></span><span class="hljs-tag"> /&gt;</span></span>
    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xml-to-json</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">kind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"direct"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">apply</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"always"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">consider-accept-header</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> /&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">outbound</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre>
  </li>
  <li>
    <p>In the policy code editor, select <strong>Save</strong>.</p>
  </li>
  <li>
    <p>Back on the <strong>Design</strong> tab, in the list of operations, select <strong>Get Legacy Data</strong>, and then select <strong>Test</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Get Legacy Data</strong> section, select <strong>Send</strong>.</p>
  </li>
  <li>
    <p>Review the results of the API request.</p>

    <blockquote>
      <p><strong>Note</strong>: The new results are in JavaScript Object Notation (JSON) format.</p>
    </blockquote>
  </li>
  <li>
    <p>Within the <strong>HTTP response</strong> section, perform the following actions:</p>

    <ol>
      <li>
        <p>Select <strong>Trace</strong>.</p>
      </li>
      <li>
        <p>Review the content in the <strong>Backend</strong> and <strong>Outbound</strong> text boxes, and note that they include details of the corresponding API operations with their timing information.</p>
      </li>
    </ol>
  </li>
  <li>
    <p>On the <strong>Design</strong> tab, select <strong>+ Add operation</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Add operation</strong> section, perform the following actions, and then select <strong>Save</strong>:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Display name</strong> text box</td>
          <td>Enter <strong>Generate Payload</strong>.</td>
        </tr>
        <tr>
          <td><strong>Name</strong> text box</td>
          <td>Verify that its value is set to <strong>generate-payload</strong>.</td>
        </tr>
        <tr>
          <td><strong>URL</strong> list</td>
          <td>Select <strong>GET</strong>.</td>
        </tr>
        <tr>
          <td><strong>URL</strong> text box</td>
          <td>Enter <strong>/bytes/{n}</strong>.</td>
        </tr>
        <tr>
          <td><strong>Template parameters</strong> section</td>
          <td>In the <strong>TYPE</strong> text box, enter <strong>int</strong>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Back on the <strong>Design</strong> tab, in the list of operations, select <strong>Generate Payload</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Design</strong> section, on the <strong>Outbound processing</strong> tile, select <strong>+ Add policy</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Add outbound policy</strong> section, select the <strong>Validate content</strong> tile.</p>
  </li>
  <li>
    <p>In the <strong>Outbound processing</strong> section, perform the following actions, and then select <strong>Save</strong>:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Unspecified content type action</strong> drop-down list</td>
          <td>Select <strong>Ignore</strong>.</td>
        </tr>
        <tr>
          <td><strong>Maximum payload size (in bytes)</strong> text box</td>
          <td>Enter <strong>128</strong>.</td>
        </tr>
        <tr>
          <td><strong>Size exceeded action</strong> drop-down list</td>
          <td>Select <strong>Prevent</strong>.</td>
        </tr>
        <tr>
          <td><strong>Errors variable name</strong> text box</td>
          <td>Enter <strong>validationErrors</strong>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Back on the <strong>Design</strong> tab, in the list of operations, select <strong>Generate Payload</strong>, and then select the <strong>Test</strong> tab.</p>
  </li>
  <li>
    <p>In the <strong>Generate Payload</strong> section, in the <strong>Template parameters</strong> subsection, in the <strong>VALUE</strong> text box of the <strong>n</strong> parameter, enter <strong>512</strong>, and then select <strong>Send</strong>.</p>
  </li>
  <li>
    <p>Review the results of the API request.</p>

    <blockquote>
      <p><strong>Note</strong>: You should receive the “HTTP/1.1 502 Response Not Allowed” message, because the payload’s size exceeds the limit that the outbound policy defines.</p>
    </blockquote>

    <p><a href="media/l08_response_to_generate_payload_fails.png" target="_blank"><img src="media/l08_response_to_generate_payload_fails.png" alt="A response to the generate payload request with the payload size violating the outbound policy"></a></p>
  </li>
  <li>
    <p>Select the <strong>Design</strong> tab, and then select <strong>Generate Payload</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Outbound processing</strong> tile, select the pencil icon.</p>
  </li>
  <li>
    <p>In the <strong>Maximum payload size (in bytes)</strong> text box, replace <strong>128</strong> with <strong>1024</strong>.</p>
  </li>
  <li>
    <p>Select <strong>Save</strong>.</p>
  </li>
  <li>
    <p>Back on the <strong>Design</strong> tab, in the list of operations, select <strong>Generate Payload</strong>, and then select the <strong>Test</strong> tab.</p>
  </li>
  <li>
    <p>In the <strong>Generate Payload</strong> section, in the <strong>Template parameters</strong> subsection, in the <strong>VALUE</strong> text box of the <strong>n</strong> parameter, enter <strong>512</strong> ,and then select <strong>Send</strong>.</p>
  </li>
  <li>
    <p>Review the results of the API request.</p>

    <blockquote>
      <p><strong>Note</strong>: You should receive the HTTP/1.1 200 OK response message because the payload’s size is now within the limit that the outbound policy defines.</p>
    </blockquote>

    <p><a href="media/l08_response_to_generate_payload_succeeds.png" target="_blank"><img src="media/l08_response_to_generate_payload_succeeds.png" alt="A response to the generate payload request with the payload size complying with the outbound policy"></a></p>
  </li>
</ol>

<h4 id="task-4-manipulate-an-api-request">Task 4: Manipulate an API request</h4>

<ol>
  <li>
    <p>On the <strong>Design</strong> tab, select <strong>+ Add operation</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Add operation</strong> section, perform the following actions, and then select <strong>Save</strong>:</p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Display name</strong> text box</td>
          <td>Enter <strong>Modify Status Code</strong>.</td>
        </tr>
        <tr>
          <td><strong>Name</strong> text box</td>
          <td>Verify that its value is set to <strong>modify-status-code</strong>.</td>
        </tr>
        <tr>
          <td><strong>URL</strong> list</td>
          <td>Select <strong>GET</strong>.</td>
        </tr>
        <tr>
          <td><strong>URL</strong> text box</td>
          <td>Enter <strong>/status/404</strong>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Back on the <strong>Design</strong> tab, in the list of operations, select <strong>Modify Status Code</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Design</strong> section, on the <strong>Inbound processing</strong> tile, select <strong>+ Add policy</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Add inbound policy</strong> section, select the <strong>Rewrite URL</strong> tile.</p>
  </li>
  <li>
    <p>In the <strong>Rewrite URL</strong> section, perform the following actions:</p>

    <p>a.  In the <strong>Backend</strong> text box, enter <strong>/status/200</strong>.</p>

    <p>b.  Select <strong>Save</strong>.</p>
  </li>
  <li>
    <p>Back on the <strong>Design</strong> tab, in the list of operations, select <strong>Modify Status Code</strong>, and then select the <strong>Test</strong> tab.</p>
  </li>
  <li>
    <p>In the <strong>Modify Status Code</strong> section, select <strong>Send</strong>.</p>
  </li>
  <li>
    <p>Review the results of the API request.</p>

    <blockquote>
      <p><strong>Note</strong>: Verify that the request returned the <strong>HTTP/1.1 200 OK</strong> response.</p>
    </blockquote>
  </li>
</ol>

<h4 id="review-1">Review</h4>

<p>In this exercise, you built a proxy tier between your App Service resource and any developers who wish to make queries against its API.</p>

<h3 id="exercise-3-clean-up-your-subscription">Exercise 3: Clean up your subscription</h3>

<h4 id="task-1-open-azure-cloud-shell">Task 1: Open Azure Cloud Shell</h4>

<ol>
  <li>
    <p>In the Azure portal, select the <strong>Cloud Shell</strong> icon <a href="media/az204_lab_CloudShell.png" target="_blank"><img src="media/az204_lab_CloudShell.png" alt="Cloud Shell icon"></a> to open a new Bash session. If Cloud Shell defaults to a PowerShell session, select <strong>PowerShell</strong> and then, in the drop-down menu, select <strong>Bash</strong>.</p>

    <blockquote>
      <p><strong>Note</strong>: If this is the first time you’re starting <strong>Cloud Shell</strong>, when prompted to select either <strong>Bash</strong> or <strong>PowerShell</strong>, select <strong>PowerShell</strong>. When you’re presented with the <strong>You have no storage mounted</strong> message, select the subscription you’re using in this lab, and then select <strong>Create storage</strong>.</p>
    </blockquote>
  </li>
</ol>

<h4 id="task-2-delete-resource-groups">Task 2: Delete resource groups</h4>

<ol>
  <li>
    <p>On the <strong>Cloud Shell</strong> pane, run the following command to delete the <strong>ApiService</strong> resource group:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="hljs coffeescript">az group <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> --name ApiService --<span class="hljs-literal"><span class="hljs-literal">no</span></span>-wait --<span class="hljs-literal"><span class="hljs-literal">yes</span></span>
</code></pre>

    <blockquote>
      <p><strong>Note</strong>: The command executes asynchronously (as determined by the <em>–no-wait</em> parameter), so while you’ll be able to run another Azure CLI command immediately afterwards within the same Bash session, it’ll take a few minutes before the resource groups are actually removed.</p>
    </blockquote>
  </li>
  <li>
    <p>Close the <strong>Cloud Shell</strong> pane in the portal.</p>
  </li>
</ol>

<h4 id="task-3-close-the-active-applications">Task 3: Close the active applications</h4>

<ol>
  <li>Close the currently running Microsoft Edge application.</li>
</ol>

<h4 id="review-2">Review</h4>

<p>In this exercise, you cleaned up your subscription by removing the resource groups used in this lab.</p>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-204-DevelopingSolutionsforMicrosoftAzure" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-204-DevelopingSolutionsforMicrosoftAzure
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D64f540ac7c8eef33997aaf23b6af9bd5b858530e.js"></script>



</body></html>