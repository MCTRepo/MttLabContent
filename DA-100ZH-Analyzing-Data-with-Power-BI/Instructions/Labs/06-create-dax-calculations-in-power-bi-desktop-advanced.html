<!DOCTYPE html><html lang="en"><head>
        <title>
            DA-100ZH-Analyzing-Data-with-Power-BI
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                DA-100ZH-Analyzing-Data-with-Power-BI
            </a>
            <a href="https://github.com/MicrosoftLearning/DA-100ZH-Analyzing-Data-with-Power-BI" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#实验室故事">实验室故事</a></li><li class="nav-item"><a class="nav-link" href="#任务-1入门">任务 1：入门</a></li><li class="nav-item"><a class="nav-link" href="#任务-2创建矩阵视觉对象">任务 2：创建矩阵视觉对象</a></li><li class="nav-item"><a class="nav-link" href="#任务-3处理筛选器上下文">任务 3：处理筛选器上下文</a></li><li class="nav-item"><a class="nav-link" href="#任务-1创建-ytd-度量值">任务 1：创建 YTD 度量值</a></li><li class="nav-item"><a class="nav-link" href="#任务-2创建同比增长度量">任务 2：创建同比增长度量</a></li><li class="nav-item"><a class="nav-link" href="#任务-3完成">任务 3：完成</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="在-power-bi-desktop-中创建-dax-计算第-2-部分"><strong>在 Power BI Desktop 中创建 DAX 计算，第 2 部分</strong></h1>

<p><strong>完成本实验室预计需要 45 分钟</strong></p>

<p>在本实验室中，你将使用涉及筛选器上下文操作的 DAX 表达式来创建度量值。</p>

<p>在本实验室中，你将学习如何：</p>

<ul>
  <li>
    <p>使用 CALCULATE() 函数操作筛选器上下文</p>
  </li>
  <li>
    <p>使用时间智能函数</p>
  </li>
</ul>

<h3 id="实验室故事"><strong>实验室故事</strong></h3>

<p>本实验室是一个实验室系列中的诸多实验室之一，设计为从数据准备到作为报表和仪表板发布的完整故事。可以按任意顺序完成这些实验室。但是，如果你打算完成多个实验室，对于前 10 个实验室，建议你按以下顺序完成：</p>

<ol>
  <li>
    <p>在 Power BI Desktop 中准备数据</p>
  </li>
  <li>
    <p>在 Power BI Desktop 中加载数据</p>
  </li>
  <li>
    <p>在 Power BI Desktop 中对数据建模，第 1 部分</p>
  </li>
  <li>
    <p>在 Power BI Desktop 中对数据建模，第 2 部分</p>
  </li>
  <li>
    <p>在 Power BI Desktop 中创建 DAX 计算，第 1 部分</p>
  </li>
  <li>
    <p><strong>在 Power BI Desktop 中创建 DAX 计算，第 2 部分</strong></p>
  </li>
  <li>
    <p>在 Power BI Desktop 中设计报表，第 1 部分</p>
  </li>
  <li>
    <p>在 Power BI Desktop 中设计报表，第 2 部分</p>
  </li>
  <li>
    <p>创建 Power BI 仪表板</p>
  </li>
  <li>
    <p>创建 Power BI 分页报表</p>
  </li>
  <li>
    <p>在 Power BI Desktop 中执行数据分析</p>
  </li>
  <li>
    <p>强制执行行级别安全性</p>
  </li>
</ol>

<h2 id="练习-1使用筛选器上下文"><strong>练习 1：使用筛选器上下文</strong></h2>

<p>在此练习中，你将使用涉及筛选器上下文操作的 DAX 表达式来创建度量值。</p>

<h3 id="任务-1入门"><strong>任务 1：入门</strong></h3>

<p>在此任务中，你将设置实验室环境。</p>

<p><em>重要说明：如果你从上一个实验室继续操作（并且已成功完成该实验室），则无需完成此任务；而是继续执行下一个任务。</em></p>

<ol>
  <li>
    <p>要打开 Power BI Desktop，请在任务栏上单击 Microsoft Power BI Desktop 快捷方式。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image1.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image1.png" alt="图片 12"></a></p>
  </li>
  <li>
    <p>要关闭开始窗口，请单击窗口左上角的 <strong>“X”</strong>。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image2.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image2.png" alt="图片 11"></a></p>
  </li>
  <li>
    <p>要打开入门 Power BI Desktop 文件，请单击 <strong>“文件”</strong> 功能区选项卡以打开 Backstage 视图。</p>
  </li>
  <li>
    <p>选择 <strong>“打开报表”</strong>。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image3.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image3.png" alt="图片 10"></a></p>
  </li>
  <li>
    <p>单击 <strong>“浏览报表”</strong>。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image4.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image4.png" alt="图片 9"></a></p>
  </li>
  <li>
    <p>在 <strong>“打开”</strong> 窗口，导航到 <strong>“D:\DA100\Labs\06-create-dax-calculations-in-power-bi-desktop-advanced\Starter”</strong> 文件夹。</p>
  </li>
  <li>
    <p>选择 <strong>“Sales Analysis”</strong> 文件。</p>
  </li>
  <li>
    <p>单击 <strong>“打开”</strong>。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image5.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image5.png" alt="图片 8"></a></p>
  </li>
  <li>
    <p>关闭可能打开的所有信息窗口。</p>
  </li>
  <li>
    <p>要创建该文件的副本，请单击 <strong>“文件”</strong> 功能区选项卡以打开 Backstage 视图。</p>
  </li>
  <li>
    <p>选择 <strong>“另存为”</strong>。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image6.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image6.png" alt="图片 7"></a></p>
  </li>
  <li>
    <p>如果系统提示应用更改，请单击 <strong>“应用”</strong>。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image7.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image7.png" alt="图片 6"></a></p>
  </li>
  <li>
    <p>在 <strong>“另存为”</strong> 窗口中，导航到 <strong>“D:\DA100\MySolution”</strong> 文件夹。</p>
  </li>
  <li>
    <p>单击 <strong>“保存”</strong>。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image8.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image8.png" alt="图片 2"></a></p>
  </li>
</ol>

<h3 id="任务-2创建矩阵视觉对象"><strong>任务 2：创建矩阵视觉对象</strong></h3>

<p>在此任务中，你将创建一个矩阵视觉对象来支持测试新的度量值。</p>

<ol>
  <li>
    <p>在 Power BI Desktop 的“报表”视图中，新建一个报表页。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image9.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image9.png" alt="图片 1"></a></p>
  </li>
  <li>
    <p>在第 <strong>3 页上</strong>，添加一个矩阵视觉对象。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image10.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image10.png" alt="图片 13"></a></p>
  </li>
  <li>
    <p>重设矩阵视觉对象的大小，使其填满整个页面。</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>若要配置矩阵视觉对象的字段，请将<strong>字段</strong>窗格中的 **“区域</td>
          <td>区域”** 层次结构拖放到视觉对象内。</td>
        </tr>
      </tbody>
    </table>

    <table>
      <tbody>
        <tr>
          <td>*实验室将使用速记表示法来引用字段或层次结构。如下所示： **Region</td>
          <td>Regions<strong>。在此示例中， **“Region”</strong> 是表名， <strong>“Regions”</strong> 是层次结构名称。*</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>还要添加 **“Sales</td>
          <td>Sales”** 字段。</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>若要展开整个层次结构，请单击矩阵视觉对象右上方的分叉箭头图标两次。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image11.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image11.png" alt="图片 47"></a></p>

    <p><em>回想一下， <strong>“Regions”</strong> 层次结构包含 <strong>“组”</strong>、 <strong>“国家/地区”</strong> 和 <strong>“区域”</strong> 级别。</em></p>
  </li>
  <li>
    <p>要设置视觉对象的格式，请选择 <strong>“可视化效果”</strong> 窗格下方的 <strong>“格式”</strong> 窗格。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image12.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image12.png" alt="图片 14"></a></p>
  </li>
  <li>
    <p>在 <strong>“搜索”</strong> 框中，输入 <strong>“渐变”</strong>。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image13.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image13.png" alt="图片 15"></a></p>
  </li>
  <li>
    <p>将 <strong>“渐变布局”</strong> 属性设置为 <strong>“关”</strong>。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image14.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image14.png" alt="图片 49"></a></p>
  </li>
  <li>
    <p>验证矩阵视觉对象是否有四个列标题。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image15.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image15.png" alt="图片 50"></a></p>

    <p><em>在 Adventure Works 中，销售区域分为组、国家/地区和区域。除美国外，所有国家/地区都只有一个区域以该国家/地区命名。由于美国的销售区域非常大，该国分为五个销售区域。</em></p>

    <p><em>在此练习中，你将创建几个度量值，然后将它们添加到矩阵视觉对象中进行测试。</em></p>
  </li>
</ol>

<h3 id="任务-3处理筛选器上下文"><strong>任务 3：处理筛选器上下文</strong></h3>

<p>在此任务中，你将使用 DAX 表达式创建几个度量值，这些度量值使用 CALCULATE() 函数来处理筛选器上下文。</p>

<ol>
  <li>
    <p>基于以下表达式向 <strong>“Sales”</strong> 表添加一个度量值：</p>

    <p><em>为了方便起见，可以从 <strong>D:\DA100\Labs\06-create-dax-calculations-in-power-bi-desktop-advanced\Assets\Snippets.txt</strong> 文件复制本实验室中的所有 DAX 定义。</em></p>

    <p><strong>DAX</strong></p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="hljs apache"> <span class="hljs-attribute"><span class="hljs-attribute">Sales</span></span> <span class="hljs-literal"><span class="hljs-literal">All</span></span> Region =

 <span class="hljs-attribute"><span class="hljs-attribute">CALCULATE</span></span>(SUM(Sales[Sales]), REMOVEFILTERS(Region))
</code></pre>

    <p><em>CALCULATE() 函数是一个功能强大的函数，用于处理筛选器上下文。第一个参数接收表达式或度量（度量只是一个命名表达式）。后续参数允许修改筛选上下文。</em></p>

    <p><em>REMOVEFILTERS() 函数删除活动的筛选器。它可以不使用任何参数、表、一列或多列作为其参数。</em></p>

    <p><em>在此公式中，度量值计算修改后的筛选器上下文中 <strong>“Sales”</strong> 列的总和，这将删除应用到 <strong>“Region”</strong> 表的任何筛选器。</em></p>
  </li>
  <li>
    <p>将 <strong>“Sales All Region”</strong> 度量值添加到矩阵视觉对象。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image16.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image16.png" alt="图片 52"></a></p>
  </li>
  <li>
    <p>请注意 <strong>“Sales All Region”</strong> 度量值计算每个区域、国家/地区（小计）和组（小计）的所有区域销售总额。</p>

    <p><em>此新度量值尚未生成有用的结果。将某个组、国家/地区或区域的销售额除以该值，便会得出一个有用的比率，称为“占总计的百分比”。</em></p>
  </li>
  <li>
    <p>务必选中 <strong>“字段”</strong> 窗格中的 <strong>“Sales All Region”</strong> 度量值（选中后呈现深灰色背景），然后将公式栏中的度量值名称和公式替换为以下公式：</p>

    <p><em>提示：若要替换现有公式，请先复制代码片段。然后，单击公式栏内部并按 <strong>Ctrl+A</strong> 选择所有文本。然后，按 <strong>Ctrl+V</strong> 粘贴该片段以覆盖所选文本。然后按 <strong>Enter</strong>。</em></p>

    <p><strong>DAX</strong></p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">Sales</span></span> % All Region =  
 ‎DIVIDE(  
 ‎ SUM(Sales[Sales]),  
 ‎ CALCULATE(  
 ‎ SUM(Sales[Sales]),  
 ‎ REMOVEFILTERS(Region)  
 ‎ )  
 ‎)
</code></pre>

    <p><em>此度量值已重命名，以准确反映更新后的公式。DIVIDE()函数将 <strong>Sales</strong> 度量值（未被筛选器上下文修改）除以修改后的上下文中的 <strong>Sales</strong> 度量值，该度量值删除应用于<strong>区域</strong>表的所有筛选器。</em></p>
  </li>
  <li>
    <p>请注意，矩阵视觉对象中的度量值已被重命名，并且每个组、国家/地区和区域现在都对应了不同的值。</p>
  </li>
  <li>
    <p>将 <strong>“Sales % All Region”</strong> 度量值的格式设置为一个百分比，保留两位小数。</p>
  </li>
  <li>
    <p>在矩阵视觉对象中，查看 <strong>“Sales % All Region”</strong> 度量值。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image17.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image17.png" alt="图片 53"></a></p>
  </li>
  <li>
    <p>基于以下表达式将另一个度量值添加到 <strong>“Sales”</strong> 表，并将其格式设置为百分比：</p>

    <p><strong>DAX</strong></p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">Sales</span></span> % Country =  
 ‎DIVIDE(  
 ‎ SUM(Sales[Sales]),  
 ‎ CALCULATE(  
 ‎ SUM(Sales[Sales]),  
 ‎ REMOVEFILTERS(Region[Region])  
 ‎ )  
 ‎)
</code></pre>
  </li>
  <li>
    <p>请注意， <strong>“Sales % Country”</strong> 度量值公式与 <strong>“Sales % All Region”</strong> 度量值公式略有不同。</p>

    <p><em>不同之处在于，分母在修改筛选器上下文时删除的是 <strong>“Region”</strong> 表中 <strong>“Region”</strong> 列上的筛选器，而不是删除 <strong>“Region”</strong> 表中所有列上的筛选器。这意味着将保留应用于 Group 或 Country 列的所有筛选器。它将得到代表一个国家/地区销售额百分比的结果。</em></p>
  </li>
  <li>
    <p>将 <strong>“Sales % Country”</strong> 度量值添加到矩阵视觉对象。</p>
  </li>
  <li>
    <p>请注意，仅 United States 区域得出的值不是 100%。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image18.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image18.png" alt="图片 54"></a></p>

    <p><em>回想一下，只有美国有多个区域。所有其他国家/地区都只有一个区域，这就解释了为什么它们对应的值都是 100%。</em></p>
  </li>
  <li>
    <p>为了提高该度量值在视觉对象中的可读性，可以用如下改进版公式覆盖 <strong>“Sales % Country”</strong> 度量值。</p>

    <p><strong>DAX</strong></p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Sales</span></span> % Country =  
‎IF(  
‎ ISINSCOPE(Region[Region]),  
‎ DIVIDE(  
‎ SUM(Sales[Sales]),  
‎ CALCULATE(  
‎ SUM(Sales[Sales]),  
‎ REMOVEFILTERS(Region[Region])  
‎ )  
‎ )  
‎)
</code></pre>

    <p><em>ISINSCOPE() 函数嵌入 IF() 函数中，用于测试“region”列所在的层次是否属于一个由多个层次组成的层次结构。当其结果为 true 时，将对 DIVIDE() 函数进行求值。没有错误的部分意味着当区域列不在范围内时返回空白。</em></p>
  </li>
  <li>
    <p>注意， <strong>“Sales % Country”</strong> 度量现在只会在某一区域在范围内时才返回值。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image19.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image19.png" alt="图片 55"></a></p>
  </li>
  <li>
    <p>基于以下表达式将另一个度量值添加到 <strong>“Sales”</strong> 表，并将其格式设置为百分比：</p>

    <p><strong>DAX</strong></p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Sales</span></span> % Group =  
‎DIVIDE(  
‎ SUM(Sales[Sales]),  
‎ CALCULATE(  
‎ SUM(Sales[Sales]),  
‎ REMOVEFILTERS(  
‎ Region[Region],  
‎ Region[Country]  
‎ )  
‎ )  
‎)
</code></pre>

    <p><em>为了得出销售额占组的百分比，可以应用两个筛选器以有效地删除两列上的筛选器。</em></p>
  </li>
  <li>
    <p>将 <strong>“Sales % Group”</strong> 度量添加到矩阵视觉对象。</p>
  </li>
  <li>
    <p>为了提高该度量在视觉对象中的可读性，可以用如下改进版公式覆盖 <strong>“Sales % Group”</strong> 度量。</p>

    <p><strong>DAX</strong></p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Sales</span></span> % Group =  
‎IF(  
‎ ISINSCOPE(Region[Region])  
‎ || ISINSCOPE(Region[Country]),  
‎ DIVIDE(  
‎ SUM(Sales[Sales]),  
‎ CALCULATE(  
‎ SUM(Sales[Sales]),  
‎ REMOVEFILTERS(  
‎ Region[Region],  
‎ Region[Country]  
‎ )  
‎ )  
‎ )  
‎)
</code></pre>
  </li>
  <li>
    <p>注意， <strong>“Sales % Group”</strong> 度量值现在只在区域或国家/地区在范围内时才返回值。</p>
  </li>
  <li>
    <p>在“模型”视图中，将三个新的度量值放入名为 <strong>“比率”</strong> 的显示文件夹中。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image20.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image20.png" alt="图片 56"></a></p>
  </li>
  <li>
    <p>保存 Power BI Desktop 文件。</p>

    <p><em>添加到 <strong>Sales</strong> 表中的度量值修改了筛选上下文，以实现分层导航。注意，要得到小计的计算，其模式需要从筛选上下文中删除一些列，而要得到总计，必须删除所有列。</em></p>
  </li>
</ol>

<h2 id="练习2使用时间智能"><strong>练习2：使用时间智能</strong></h2>

<p>在此练习中，你将创建年初至今 (YTD) 销售额度量值和年度同比 (YoY) 销售额增长率度量值。</p>

<h3 id="任务-1创建-ytd-度量值"><strong>任务 1：创建 YTD 度量值</strong></h3>

<p>在此任务中，你将创建一个 Sales YTD 额度量值。</p>

<ol>
  <li>
    <p>在“报表”视图中的 <strong>“第 2 页”</strong> 上，注意矩阵视觉对象显示了多个度量值，并在行上对年份和月份进行了分组。</p>
  </li>
  <li>
    <p>根据以下表达式，向 <strong>“Sales”</strong> 表添加一个度量值，并将格式设置为没有小数位：</p>

    <p><strong>DAX</strong></p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="hljs javascript"> Sales YTD =  
 ‎TOTALYTD(SUM(Sales[Sales]), <span class="hljs-string"><span class="hljs-string">'Date'</span></span>[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>], <span class="hljs-string"><span class="hljs-string">"6-30"</span></span>)
</code></pre>

    <p><em>TOTALYTD() 函数会对给定的日期列进行表达式求值，本例中是对 <strong>“Sales”</strong> 列求和。日期列必须属于标记为日期表的日期表，就像在 <strong>“在 Power BI Desktop 中创建 DAX 计算，第 1 部分”</strong> 实验室中所做的那样。</em></p>

    <p><em>该函数还可以采用第三个可选参数，该参数表示一年中的最后一天。如果没有此日期，则表示 12 月 31 日是该年的最后一个日期。对于 Adventure Works 而言，6 月是其年份的最后一个月，因此使用“6-30”。</em></p>
  </li>
  <li>
    <p>将 <strong>“销售额”</strong> 字段和 <strong>“本年累计销售额”</strong> 度量添加到矩阵视觉对象。</p>
  </li>
  <li>
    <p>注意当年销售额值的累积。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image21.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image21.png" alt="图片 59"></a></p>

    <p><em>TOTALYTD() 函数执行筛选操作，特别是时间筛选操作。例如，为了计算 2017 年 9 月（会计年度的第三个月）的本年迄今为止的销售额，已删除 <strong>Date</strong> 表中的所有筛选器，并替换为新的日期筛选器，该筛选器从年初（2017 年 7 月 1 日）开始，一直延伸到关联日期期间的最后一个日期（2017 年 9 月 30 日）。</em></p>

    <p><em>请注意，DAX 中提供了许多时间智能函数，以支持常用的时间筛选操作。</em></p>
  </li>
</ol>

<h3 id="任务-2创建同比增长度量"><strong>任务 2：创建同比增长度量</strong></h3>

<p>在此任务中，你将创建一个 Sales YoY Growth 度量值。</p>

<ol>
  <li>
    <p>根据以下表达式，向 <strong>“Sales”</strong> 表再添加一个度量值：</p>

    <p><strong>DAX</strong></p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="hljs php"> Sales YoY Growth =  
 ‎<span class="hljs-keyword"><span class="hljs-keyword">VAR</span></span> SalesPriorYear =  
 ‎ CALCULATE(  
 ‎ SUM(Sales[Sales]),  
 ‎ PARALLELPERIOD(  
 ‎ <span class="hljs-string"><span class="hljs-string">'Date'</span></span>[Date],  
 ‎ <span class="hljs-number"><span class="hljs-number">-12</span></span>,  
 ‎ MONTH  
 ‎ )  
 ‎ )  
 ‎<span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span>  
 ‎ SalesPriorYear
</code></pre>

    <p><em><strong>“Sales YoY Growth”</strong> 度量值公式声明了一个变量。变量可用于简化公式逻辑，当需要在公式中多次对表达式求值时（同比增长逻辑就是这种情况），变量将更有效。变量由唯一的名称声明，然后必须在 <strong>RETURN</strong> 关键字之后输出度量值表达式。</em></p>

    <p><em>向 <strong>SalesPriorYear</strong> 变量分配一个表达式，用于计算修改后的上下文中 <strong>“Sales”</strong> 列的总和，该上下文使用 PARALLELPERIOD() 函数将筛选上下文中的每个日期向后移 12 个月。</em></p>
  </li>
  <li>
    <p>将 <strong>“Sales YoY Growth”</strong> 度量值添加到“矩阵”视觉对象。</p>
  </li>
  <li>
    <p>请注意，新的度量值对前 12 个月返回 BLANK（2017 会计年度之前没有任何销售额记录）。</p>
  </li>
  <li>
    <p>请注意，<strong>2018 年 7 月</strong> 的 <strong>“Sales YoY Growth”</strong> 度量值的值是 <strong>2017 年 1 月</strong> 的 <strong>“Sales”</strong> 值。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image22.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image22.png" alt="图片 61"></a></p>

    <p><em>至此，公式的“困难部分”已经过测试，现在可以使用计算增长结果的最终公式覆盖度量值。</em></p>
  </li>
  <li>
    <p>若要完成度量值，请使用此公式覆盖 <strong>“销售额同比增长”</strong> 度量值，将其格式化为百分比，并保留两位小数：</p>

    <p><strong>DAX</strong></p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock8" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock8" class="mt-0"><code class="hljs php"> Sales YoY Growth =  
 ‎<span class="hljs-keyword"><span class="hljs-keyword">VAR</span></span> SalesPriorYear =  
 ‎ CALCULATE(  
 ‎ SUM(Sales[Sales]),  
 ‎ PARALLELPERIOD(  
 ‎ <span class="hljs-string"><span class="hljs-string">'Date'</span></span>[Date],  
 ‎ <span class="hljs-number"><span class="hljs-number">-12</span></span>,  
 ‎ MONTH  
 ‎ )  
 ‎ )  
 ‎<span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span>  
 ‎ DIVIDE(  
 ‎ (SUM(Sales[Sales]) - SalesPriorYear),  
 ‎ SalesPriorYear  
 ‎ )
</code></pre>
  </li>
  <li>
    <p>在公式中的 <strong>RETURN</strong> 子句中，请注意变量被引用了两次。</p>
  </li>
  <li>
    <p>验证并确认 <strong>2018 年 7</strong> 月的同比增长是 <strong>392.83%</strong>。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image23.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image23.png" alt="图片 62"></a></p>

    <p><em>也就是说，2018 年 7 月的销售额（2,411,559 美元）比去年同期的销售额（489,328 美元）增长了近 400%（约 4 倍）。</em></p>
  </li>
  <li>
    <p>在“模型”视图中，将两个新度量值放入名为 <strong>“Time Intelligence”</strong> 的显示文件夹。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image24.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image24.png" alt="图片 63"></a></p>
  </li>
</ol>

<h3 id="任务-3完成"><strong>任务 3：完成</strong></h3>

<p>在此任务中，你将完成实验室。</p>

<ol>
  <li>
    <p>要清理可用于开发报表的解决方案，请在左下角右键单击 <strong>“第 2 页”</strong> 选项卡，然后选择 <strong>“删除”</strong> 页面。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image25.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image25.png" alt="图片 17"></a></p>
  </li>
  <li>
    <p>当系统提示删除页面时，单击 <strong>“删除”</strong>。</p>

    <p><a href="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image26.png" target="_blank"><img src="Linked_image_Files/06-create-dax-calculations-in-power-bi-desktop-advanced_image26.png" alt="图片 18"></a></p>
  </li>
  <li>
    <p>还要删除 <strong>“第 3 页”</strong>。</p>
  </li>
  <li>
    <p>在其余页面上，要清除页面，请选择表视觉对象，然后按 <strong>Delete</strong> 键。</p>
  </li>
  <li>
    <p>保存 Power BI Desktop 文件。</p>
  </li>
  <li>
    <p>如果你打算开始下一个实验室，请让 Power BI Desktop 保持打开状态。</p>

    <p><em>你将在 <strong>“在 Power BI Desktop 中设计报表，第 1 部分”</strong> 实验室中根据数据模型创建报表。</em></p>
  </li>
</ol>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/DA-100ZH-Analyzing-Data-with-Power-BI" target="_blank" class="ml-2">
                    MicrosoftLearning/DA-100ZH-Analyzing-Data-with-Power-BI
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D.js"></script>



</body></html>