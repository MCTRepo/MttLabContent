<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#准备工作">准备工作</a></li><li class="nav-item"><a class="nav-link" href="#练习-1创建-azure-资源">练习 1：创建 Azure 资源</a></li><li class="nav-item"><a class="nav-link" href="#练习-2配置本地-azure-functions-项目">练习 2：配置本地 Azure Functions 项目</a></li><li class="nav-item"><a class="nav-link active" href="#练习-3创建被-http-申请触发的函数">练习 3：创建被 HTTP 申请触发的函数</a></li><li class="nav-item"><a class="nav-link" href="#练习-4创建一个按计划触发的函数">练习 4：创建一个按计划触发的函数</a></li><li class="nav-item"><a class="nav-link" href="#练习-5创建与其他服务集成的函数">练习 5：创建与其他服务集成的函数</a></li><li class="nav-item"><a class="nav-link" href="#练习-6将本地函数项目部署到-azure-functions-应用">练习 6：将本地函数项目部署到 Azure Functions 应用</a></li><li class="nav-item"><a class="nav-link" href="#练习-7清理订阅">练习 7：清理订阅</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="实验室-02使用-azure-functions-实现任务处理逻辑">实验室 02：使用 Azure Functions 实现任务处理逻辑</h1>

<h2 id="microsoft-azure-用户界面">Microsoft Azure 用户界面</h2>

<p>鉴于 Microsoft 云工具的动态特性，Azure 用户界面 (UI) 在此培训内容开发后可能会发生更改。这些更改可能会导致实验室说明和实验室步骤不一致。</p>

<p>当社区要求我们进行更改时，Microsoft 将更新此培训课程。但是，由于云更新频繁发生，因此在此培训内容更新之前，你可能会遇到 UI 更改情况。<strong>如果发生这种情况，请适应这些更改，并根据需要在实验室中熟悉这些更改。</strong></p>

<h2 id="说明">说明</h2>

<h3 id="准备工作">准备工作</h3>

<h4 id="登录到实验室虚拟机">登录到实验室虚拟机</h4>

<p>使用以下凭据登录到 Windows 10 虚拟机 (VM)：</p>

<ul>
  <li>用户名：<strong>Admin</strong></li>
  <li>密码： <strong>Pa55w.rd</strong></li>
</ul>

<blockquote>
  <p><strong>备注</strong>：你的讲师将提供连接到虚拟实验室环境的说明。</p>
</blockquote>

<h4 id="查看已安装的应用程序">查看已安装的应用程序</h4>

<p>在你的 Windows 10 桌面上找到任务栏。任务栏里有本实验室中你将使用的应用程序的图标：</p>

<ul>
  <li>Microsoft Edge</li>
  <li>文件资源管理器</li>
  <li>Windows 终端</li>
  <li>Visual Studio Code</li>
</ul>

<h3 id="练习-1创建-azure-资源">练习 1：创建 Azure 资源</h3>

<h4 id="任务-1打开-azure-门户">任务 1：打开 Azure 门户</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Microsoft Edge”</strong> 图标。</li>
  <li>在打开的浏览器窗口中，转到 Azure 门户 (<a href="https://portal.azure.com">https://portal.azure.com</a>)。</li>
  <li>输入你的 Microsoft 帐户的电子邮件地址，然后选择 <strong>“下一步”</strong>。</li>
  <li>输入你的 Microsoft 帐户的密码，然后选择 <strong>“登录”</strong>。
    <blockquote>
      <p><strong>备注</strong>： 第一次登录 Azure 门户时，你会看到一个门户教程。如果想跳过该导览，请选择 <strong>“开始使用”</strong> 以开始使用门户。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2创建-azure-存储帐户">任务 2：创建 Azure 存储帐户</h4>

<ol>
  <li>在 Azure 门户的“导航”窗格中，选择 <strong>“所有服务”</strong>。</li>
  <li>在 <strong>“所有服务”</strong> 边栏选项卡中，选择 <strong>“存储帐户”</strong>。</li>
  <li>在 <strong>“存储帐户”</strong> 边栏选项卡中，查看存储帐户实例列表。</li>
  <li>在“<strong>存储帐户</strong>”边栏选项卡中，选择“<strong>+ 创建</strong>”。</li>
  <li>在 <strong>“创建存储帐户”</strong> 边栏选项卡上，查看边栏选项卡上的选项卡，如 <strong>“基本”</strong>、 <strong>“标记”</strong> 和 <strong>“查看 + 创建”</strong>。
    <blockquote>
      <p><strong>备注</strong>： 每个选项卡代表工作流中创建新存储帐户的一个步骤。你可以随时选择 <strong>“查看 + 创建”</strong> 跳过其余选项卡。</p>
    </blockquote>
  </li>
  <li>选择 <strong>“基本”</strong> 选项卡，然后在选项卡区域内执行以下操作：
    <ol>
      <li>将 <strong>“订阅”</strong> 文本框保留设置为默认值。</li>
      <li>在 <strong>“资源组”</strong> 部分，选择 <strong>“新建”</strong>，输入 <strong>“Serverless”</strong>，然后选择 <strong>“确定”</strong>。</li>
      <li>在 <strong>“存储帐户名称”</strong> 文本框中，输入 <strong>“funcstor[yourname]”</strong>。</li>
      <li>在“<strong>区域</strong>”列表中，选择“<strong>(美国)美国东部</strong>”区域。</li>
      <li>在 <strong>“性能”</strong> 部分，选择 <strong>“标准”</strong>。</li>
      <li>在 <strong>“冗余”</strong> 列表中，选择 <strong>“本地冗余存储(LRS)”</strong>。</li>
      <li>选择 <strong>“查看 + 创建”</strong>。</li>
    </ol>
  </li>
  <li>在 <strong>“查看 + 创建”</strong> 选项卡中，查看在之前步骤中指定的选项。</li>
  <li>选择 <strong>“创建”</strong>，使用指定的配置创建存储帐户。
    <blockquote>
      <p><strong>备注</strong>： 在 <strong>“部署”</strong> 边栏选项卡中，等待创建任务完成后再继续本实验室。</p>
    </blockquote>
  </li>
  <li>在 Azure 门户的“导航”窗格中，选择 <strong>“所有服务”</strong>。</li>
  <li>在 <strong>“所有服务”</strong> 边栏选项卡中，选择 <strong>“存储帐户”</strong>。</li>
  <li>在 <strong>“存储帐户”</strong> 边栏选项卡，选择 <strong>funcstor[yourname]</strong> 存储帐户实例。</li>
  <li>在 <strong>“存储账户”</strong> 边栏选项卡中，找到 <strong>“安全性 + 网络”</strong> 部分，然后选择 <strong>“访问密钥”</strong>。</li>
  <li>从“<strong>访问密钥</strong>”边栏选项卡中，选择“<strong>显示密钥</strong>”。</li>
  <li>选择任一密钥，然后记录任一“<strong>连接字符串</strong>”框的值。
    <blockquote>
      <p><strong>备注</strong>： 你将在稍后的实验室中使用此值。你选择哪个连接字符串无关紧要。它们可以互换。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-3创建一个函数应用">任务 3：创建一个函数应用</h4>

<ol>
  <li>在 Azure 门户的“导航”窗格中，选择 <strong>“创建资源”</strong> 链接。</li>
  <li>在 <strong>“创建资源”</strong> 边栏选项卡上，找到 <strong>“搜索服务和市场”</strong> 文本框。</li>
  <li>在搜索文本框中，输入 <strong>“函数”</strong>，然后按 Enter。</li>
  <li>在 <strong>“全部内容”</strong> 搜索结果边栏选项卡中，选择 <strong>“函数应用”</strong> 结果。</li>
  <li>在 <strong>“函数应用”</strong> 边栏选项卡中，选择 <strong>“创建”</strong>。</li>
  <li>查看 <strong>“函数应用”</strong> 边栏选项卡的选项卡，例如 <strong>“基本”</strong>。
    <blockquote>
      <p><strong>备注</strong>： 每个选项卡都代表在工作流中新建函数应用的一个步骤。你可以随时选择 <strong>“查看 + 创建”</strong> 跳过其余选项卡。</p>
    </blockquote>
  </li>
  <li>在 <strong>“基本”</strong> 选项卡上，执行以下操作：
    <ol>
      <li>将 <strong>“订阅”</strong> 文本框保留设置为默认值。</li>
      <li>在 <strong>“资源组”</strong> 部分，选择 <strong>“使用现有”</strong>，然后从列表选择 <strong>“无服务器”</strong>。</li>
      <li>在 <strong>“函数应用名称”</strong> 文本框中，输入 <strong>“funclogic[yourname]”</strong>。</li>
      <li>在 <strong>“发布”</strong> 部分，选择 <strong>“代码”</strong>。</li>
      <li>在 <strong>“运行时堆栈”</strong> 下拉列表中，选择 <strong>“.NET”</strong>。</li>
      <li>在 <strong>“版本”</strong> 下拉列表中，选择 <strong>“3.1”</strong>。</li>
      <li>在 <strong>“区域”</strong> 下拉列表中，选择 <strong>“美国东部”</strong> 区域。</li>
      <li>选择 <strong>“下一步: 承载</strong>。</li>
    </ol>
  </li>
  <li>在 <strong>“托管”</strong> 选项卡中，执行以下操作：
    <ol>
      <li>在 <strong>“存储帐户”</strong> 下拉列表中，选择你之前在本实验室中创建的 <strong>“funcstor[yourname]”</strong> 存储帐户。</li>
      <li>在 <strong>“操作系统”</strong> 部分，选择 <strong>“Linux”</strong>。</li>
      <li>在 <strong>“计划类型”</strong> 下拉列表中，选择 <strong>“消耗(无服务器)”</strong> 选项。</li>
      <li>选择 <strong>“查看 + 创建”</strong>。</li>
    </ol>
  </li>
  <li>在 <strong>“查看 + 创建”</strong> 选项卡中，查看在上述步骤中选择的选项。</li>
  <li>选择 <strong>“创建”</strong>，使用指定的配置创建函数应用。
    <blockquote>
      <p><strong>备注</strong>： 等待创建任务完成，再继续本实验室。</p>
    </blockquote>
  </li>
</ol>

<blockquote>
  <p><strong>回顾</strong>： 在本练习中，你创建了本实验室所需的所有资源。</p>
</blockquote>

<h3 id="练习-2配置本地-azure-functions-项目">练习 2：配置本地 Azure Functions 项目</h3>

<h4 id="任务-1初始化函数项目">任务 1：初始化函数项目</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令，然后按 Enter 键将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\02\Starter\func
</code></pre>
  </li>
  <li>
    <p>收到打开的命令提示符时，输入以下命令，然后按 Enter 键以使用 <strong>Azure Functions Core Tools</strong> 在当前目录中创建使用 <strong>dotnet</strong> 运行时的新本地 Azure Functions 项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="language-powershell"> func init --worker-runtime dotnet --force
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 可以查看文档以使用 <strong>Azure Functions Core Tools</strong> <a href="https://docs.microsoft.com/azure/azure-functions/functions-run-local#create-a-local-functions-project">创建新项目</a>。</p>
    </blockquote>
  </li>
  <li>关闭当前正在运行的 <strong>“Windows 终端”</strong> 应用程序。</li>
</ol>

<h4 id="任务-2配置连接字符串">任务 2：配置连接字符串</h4>

<ol>
  <li>在 <strong>“启动”</strong> 屏幕上，选择 <strong>“Visual Studio Code”</strong> 磁贴。</li>
  <li>在 <strong>“文件”</strong> 菜单上，选择 <strong>“打开文件夹”</strong>。</li>
  <li>在打开的 <strong>“文件资源管理器”</strong> 窗口中，浏览到 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong>， 然后选择 <strong>“选择文件夹”</strong>。</li>
  <li>在 <strong>“Visual Studio Code”</strong> 窗口的“资源管理器”窗格中，打开 <strong>local.settings.json</strong> 文件。</li>
  <li>
    <p>观察 <strong>“AzureWebJobsStorage”</strong> 设置的当前值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="language-json hljs"> <span class="hljs-string">"AzureWebJobsStorage"</span>: <span class="hljs-string">"UseDevelopmentStorage=true"</span>,
</code></pre>
  </li>
  <li>通过将 <strong>“AzureWebJobsStorage”</strong> 的值设置为你之前在本实验室中记录的存储帐户的 <strong>“连接字符串”</strong> 来更新该值。</li>
  <li>保存 <strong>local.settings.json</strong> 文件。</li>
</ol>

<h4 id="任务-3生成和验证项目">任务 3：生成和验证项目</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”图标</strong>。</li>
  <li>
    <p>输入以下命令，然后按 Enter 键将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\02\Starter\func
</code></pre>
  </li>
  <li>
    <p>收到打开的命令提示符时，输入以下命令，然<strong>后按</strong> Enter 键生成 .NET Core 3.1 项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="language-powershell"> dotnet build
</code></pre>
  </li>
</ol>

<blockquote>
  <p><strong>回顾</strong>： 在本练习中，你创建了用于 Azure Functions 开发的本地项目。</p>
</blockquote>

<h3 id="练习-3创建被-http-申请触发的函数">练习 3：创建被 HTTP 申请触发的函数</h3>

<h4 id="任务-1创建-http-触发的函数">任务 1：创建 HTTP 触发的函数</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令，然后按 Enter 键将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\02\Starter\func
</code></pre>
  </li>
  <li>
    <p>收到打开的命令提示符时，输入以下命令，然后按 Enter 键以使用 <strong>Azure Functions Core Tools</strong> 创建使用 <strong>“HTTP 触发器”</strong> 模板的新函数（名为 <strong>“Echo”</strong>）：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="language-powershell"> func new --template "HTTP trigger" --name "Echo"
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 可以查看文档以使用 <strong>Azure Functions Core Tools</strong> <a href="https://docs.microsoft.com/azure/azure-functions/functions-run-local#create-func">创建新函数</a>。</p>
    </blockquote>
  </li>
  <li>关闭当前正在运行的 <strong>“Windows 终端”</strong> 应用程序。</li>
</ol>

<h4 id="任务-2编写-http-触发的函数代码">任务 2：编写 HTTP 触发的函数代码</h4>

<ol>
  <li>在 <strong>“启动”</strong> 屏幕上，选择 <strong>“Visual Studio Code”</strong> 磁贴。</li>
  <li>在 <strong>“文件”</strong> 菜单上，选择 <strong>“打开文件夹”</strong>。</li>
  <li>在打开的 <strong>“文件资源管理器”</strong> 窗口中，浏览到 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong>，然后选择 <strong>“选择文件夹”</strong>。</li>
  <li>在 <strong>“Visual Studio Code”</strong> 窗口的 <strong>“资源管理器”</strong> 窗格中，打开 <strong>Echo.cs</strong> 文件。</li>
  <li>
    <p>在代码编辑器中，观察示例实现：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">using</span> System;
 <span class="hljs-keyword">using</span> System.IO;
 <span class="hljs-keyword">using</span> System.Threading.Tasks;
 <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs.Extensions.Http;
 <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword">using</span> Microsoft.Extensions.Logging;
 <span class="hljs-keyword">using</span> Newtonsoft.Json;

 <span class="hljs-keyword">namespace</span> <span class="hljs-title">func</span>
 {
     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Echo</span>
     {
         [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"Echo"</span>)</span>]
         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">Run</span>(<span class="hljs-params">
             [HttpTrigger(AuthorizationLevel.Function, <span class="hljs-string">"get"</span>, <span class="hljs-string">"post"</span>, Route = <span class="hljs-literal">null</span></span>)] HttpRequest req,
             ILogger log)
         </span>{
             log.LogInformation(<span class="hljs-string">"C# HTTP trigger function processed a request."</span>);

             <span class="hljs-keyword">string</span> name = req.Query[<span class="hljs-string">"name"</span>];

             <span class="hljs-keyword">string</span> requestBody = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> StreamReader(req.Body).ReadToEndAsync();
             <span class="hljs-keyword">dynamic</span> data = JsonConvert.DeserializeObject(requestBody);
             name = name ?? data?.name;

             <span class="hljs-keyword">string</span> responseMessage = <span class="hljs-keyword">string</span>.IsNullOrEmpty(name)
                 ? <span class="hljs-string">"This HTTP triggered function executed successfully. Pass a name in the query string or in the request body for a personalized response."</span>
                 : <span class="hljs-string">$"Hello, <span class="hljs-subst">{name}</span>. This HTTP triggered function executed successfully."</span>;

             <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OkObjectResult(responseMessage);
         }
     }
 }
</code></pre>
  </li>
  <li>删除 <strong>Echo.cs</strong> 文件中的所有内容。</li>
  <li>
    <p>添加以下代码行，为 <strong>Microsoft.AspNetCore.Mvc</strong>、 <strong>Microsoft.Azure.WebJobs</strong>、 <strong>Microsoft.AspNetCore.Http</strong> 和 <strong>Microsoft.Extensions.Logging</strong> 命名空间添加 <strong>using 指令</strong>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock8" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock8" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword">using</span> Microsoft.Extensions.Logging;
</code></pre>
  </li>
  <li>
    <p>创建名为 <strong>Echo</strong> 的新<strong>公共静态</strong>类：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock9" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock9" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Echo</span>
 { }
</code></pre>
  </li>
  <li>
    <p>再次观察 <strong>Echo.cs</strong> 文件，该文件现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock10" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock10" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword">using</span> Microsoft.Extensions.Logging;

 <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Echo</span>
 { }
</code></pre>
  </li>
  <li>
    <p>在 <strong>Echo</strong> 类中，添加以下代码块，创建名为 <strong>Run</strong> 的新<strong>公共静态</strong>方法，该方法返回类型为 <strong>IActionResult</strong> 的变量，并且还将 <strong>HttpRequest</strong> 和 <strong>ILogger</strong> 类型的变量分别作为名为 <em>request</em> 和 <em>logger</em> 的参数：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock11" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock11" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActionResult <span class="hljs-title">Run</span>(<span class="hljs-params">
     HttpRequest request,
     ILogger logger</span>)
 </span>{ }
</code></pre>
  </li>
  <li>
    <p>添加以下代码，将属性追加到类型为 <strong>FunctionNameAttribute</strong> 的 <strong>Run</strong> 方法中，从而将 <strong>name</strong> 参数设置为 <strong>Echo</strong> 的值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock12" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock12" class="mt-0"><code class="language-csharp hljs"> [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"Echo"</span>)</span>]
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActionResult <span class="hljs-title">Run</span>(<span class="hljs-params">
     HttpRequest request,
     ILogger logger</span>)
 </span>{ }
</code></pre>
  </li>
  <li>
    <p>添加以下代码，将属性追加到类型为 <strong>HttpTriggerAttribute</strong> 的 <strong>request</strong> 参数，从而将 <strong>methods</strong> 参数数组设置为 <strong>POST</strong> 的一个值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock13" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock13" class="mt-0"><code class="language-csharp hljs"> [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"Echo"</span>)</span>]
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActionResult <span class="hljs-title">Run</span>(<span class="hljs-params">
     [HttpTrigger(<span class="hljs-string">"POST"</span></span>)] HttpRequest request,
     ILogger logger)
 </span>{ }
</code></pre>
  </li>
  <li>
    <p>再次观察 <strong>Echo.cs</strong> 文件，该文件现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock14" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock14" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword">using</span> Microsoft.Extensions.Logging;

 <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Echo</span>
 {
     [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"Echo"</span>)</span>]
     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActionResult <span class="hljs-title">Run</span>(<span class="hljs-params">
         [HttpTrigger(<span class="hljs-string">"POST"</span></span>)] HttpRequest request,
         ILogger logger)
     </span>{ }
 }
</code></pre>
  </li>
  <li>
    <p>在 <strong>Run</strong> 方法中，输入以下代码行，记录固定消息：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock15" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock15" class="mt-0"><code class="language-csharp hljs"> logger.LogInformation(<span class="hljs-string">"Received a request"</span>);
</code></pre>
  </li>
  <li>
    <p>输入以下代码行以将 HTTP 请求的正文作为 HTTP 响应进行回显：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock16" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock16" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OkObjectResult(request.Body);
</code></pre>
  </li>
  <li>
    <p>再次观察 <strong>Echo.cs</strong> 文件，该文件现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock17" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock17" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword">using</span> Microsoft.Extensions.Logging;

 <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Echo</span>
 {
     [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"Echo"</span>)</span>]
     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActionResult <span class="hljs-title">Run</span>(<span class="hljs-params">
         [HttpTrigger(<span class="hljs-string">"POST"</span></span>)] HttpRequest request,
         ILogger logger)
     </span>{
         logger.LogInformation(<span class="hljs-string">"Received a request"</span>);
         <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OkObjectResult(request.Body);
     }
 }
</code></pre>
  </li>
  <li>选择 <strong>“保存”</strong> 以保存对 <strong>Echo.cs</strong> 文件的更改。</li>
</ol>

<h4 id="任务-3使用-httprepl-测试-http-触发的函数">任务 3：使用 httprepl 测试 HTTP 触发的函数</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令，然后按 Enter 键将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock18" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock18" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\02\Starter\func
</code></pre>
  </li>
  <li>
    <p>收到打开的命令提示符时，输入以下命令，然后按 Enter 键运行函数应用项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock19" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock19" class="mt-0"><code class="language-powershell"> func start --build
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 可以查看文档以使用 <strong>Azure Functions Core Tools</strong> <a href="https://docs.microsoft.com/azure/azure-functions/functions-run-local#start">在本地启动函数应用项目</a>。</p>
    </blockquote>
  </li>
  <li>在任务栏上再次选择 <strong>“Windows 终端”</strong> 图标以打开 <strong>“Windows 终端”</strong> 应用程序的新实例。</li>
  <li>
    <p>系统显示打开的命令提示符时，输入以下命令然后按 Enter，以启动 <strong>httprepl</strong> 工具，将基本统一资源标识符 (URI) 设置为 <code>http://localhost:7071</code>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock20" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock20" class="mt-0"><code class="language-powershell"> httprepl http://localhost:7071
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： httprepl 工具会显示一条错误消息。出现此消息的原因是该工具正在搜索用于“遍历”API 的 Swagger 定义文件。由于函数项目不会生成 Swagger 定义文件，因此你需要手动遍历该 API。</p>
    </blockquote>
  </li>
  <li>
    <p>系统显示命令提示符时，输入以下命令然后按 Enter，以浏览到相关的 <strong>api</strong> 目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock21" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock21" class="mt-0"><code class="language-powershell"> cd api
</code></pre>
  </li>
  <li>
    <p>输入以下命令，然后按 Enter 浏览到相对的 <strong>“echo”</strong> 目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock22" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock22" class="mt-0"><code class="language-powershell"> cd echo
</code></pre>
  </li>
  <li>
    <p>输入以下命令，然后按 Enter 键使用 <strong>--content</strong> 选项运行 <strong>post</strong> 命令，以提交数值设为 <strong>3</strong> 的 HTTP 请求正文：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock23" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock23" class="mt-0"><code class="language-powershell"> post --content 3
</code></pre>
  </li>
  <li>
    <p>输入以下命令，然后按 Enter 键使用 <strong>--content</strong> 选项运行 <strong>post</strong> 命令，以提交数值设为 <strong>5</strong> 的 HTTP 请求正文：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock24" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock24" class="mt-0"><code class="language-powershell"> post --content 5
</code></pre>
  </li>
  <li>
    <p>输入以下命令，然后按 Enter 键使用 <strong>--content</strong> 选项运行 <strong>post</strong> 命令，以提交字符串值设为 <strong>Hello</strong> 的 HTTP 请求正文：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock25" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock25" class="mt-0"><code class="language-powershell"> post --content "Hello"
</code></pre>
  </li>
  <li>
    <p>输入以下命令，然后按 Enter 键使用 <strong>--content</strong> 选项运行 <strong>post</strong> 命令，以提交 JavaScript 对象表示法 (JSON) 值设为 <strong>{“msg”: “Successful”}</strong> 的 HTTP 请求正文：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock26" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock26" class="mt-0"><code class="language-powershell"> post --content "{"msg": "Successful"}"
</code></pre>
  </li>
  <li>
    <p>输入以下命令，然后按 Enter 退出 <strong>“httprepl”</strong> 应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock27" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock27" class="mt-0"><code class="language-powershell"> exit
</code></pre>
  </li>
  <li>关闭 <strong>“Windows 终端”</strong> 应用程序上所有当前运行的实例。</li>
</ol>

<blockquote>
  <p><strong>回顾</strong>： 在本练习中，你创建了一个基本函数，该函数可回响通过 HTTP POST 请求发送的内容。</p>
</blockquote>

<h3 id="练习-4创建一个按计划触发的函数">练习 4：创建一个按计划触发的函数</h3>

<h4 id="任务-1创建由计划触发的函数">任务 1：创建由计划触发的函数</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令，然后按 Enter 键将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock28" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock28" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\02\Starter\func
</code></pre>
  </li>
  <li>
    <p>收到打开的命令提示符时，输入以下命令，然后按 Enter 键以使用 <strong>Azure Functions Core Tools</strong> 创建使用 <strong>“计时器触发器”</strong> 模板的新函数（名为 <strong>“Recurring”</strong>）：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock29" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock29" class="mt-0"><code class="language-powershell"> func new --template "Timer trigger" --name "Recurring"
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 可以查看文档以使用 <strong>Azure Functions Core Tools</strong> <a href="https://docs.microsoft.com/azure/azure-functions/functions-run-local#create-func">创建新函数</a>。</p>
    </blockquote>
  </li>
  <li>关闭当前正在运行的 <strong>“Windows 终端”</strong> 应用程序。</li>
</ol>

<h4 id="任务-2观察函数代码">任务 2：观察函数代码</h4>

<ol>
  <li>在 <strong>“启动”</strong> 屏幕上，选择 <strong>“Visual Studio Code”</strong> 磁贴。</li>
  <li>在 <strong>“文件”</strong> 菜单上，选择 <strong>“打开文件夹”</strong>。</li>
  <li>在打开的 <strong>“文件资源管理器”</strong> 窗口中，浏览到 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong>，然后选择 <strong>“选择文件夹”</strong>。</li>
  <li>在 <strong>“Visual Studio Code”</strong> 窗口的 <strong>“资源管理器”</strong> 窗格中，打开 <strong>Recurring.cs</strong> 文件。</li>
  <li>
    <p>在代码编辑器中，观察实现：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock30" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock30" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">using</span> System;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs.Host;
 <span class="hljs-keyword">using</span> Microsoft.Extensions.Logging;

 <span class="hljs-keyword">namespace</span> <span class="hljs-title">func</span>
 {
     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Recurring</span>
     {
         [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"Recurring"</span>)</span>]
         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Run</span>(<span class="hljs-params">[TimerTrigger(<span class="hljs-string">"0 */5 * * * *"</span></span>)]TimerInfo myTimer, ILogger log)
         </span>{
             log.LogInformation(<span class="hljs-string">$"C# Timer trigger function executed at: <span class="hljs-subst">{DateTime.Now}</span>"</span>);
         }
     }
 }
</code></pre>
  </li>
</ol>

<h4 id="任务-3观察函数运行">任务 3：观察函数运行</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令，然后按 Enter 键将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock31" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock31" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\02\Starter\func
</code></pre>
  </li>
  <li>
    <p>收到打开的命令提示符时，输入以下命令，然后按 Enter 键运行函数应用项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock32" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock32" class="mt-0"><code class="language-powershell"> func start --build
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 可以查看文档以使用 <strong>Azure Functions Core Tools</strong> <a href="https://docs.microsoft.com/azure/azure-functions/functions-run-local#start">在本地启动函数应用项目</a>。</p>
    </blockquote>
  </li>
  <li>观察大约每 5 分钟运行一次的函数。每次运行函数都应向日志呈现一条简单的消息。</li>
  <li>关闭当前正在运行的 <strong>“Windows 终端”</strong> 应用程序。</li>
</ol>

<h4 id="任务-4更新函数集成配置">任务 4：更新函数集成配置</h4>

<ol>
  <li>在 <strong>“启动”</strong> 屏幕上，选择 <strong>“Visual Studio Code”</strong> 磁贴。</li>
  <li>在 <strong>“文件”</strong> 菜单上，选择 <strong>“打开文件夹”</strong>。</li>
  <li>在打开的 <strong>“文件资源管理器”</strong> 窗口中，浏览到 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong>，然后选择 <strong>“选择文件夹”</strong>。</li>
  <li>在 <strong>“Visual Studio Code”</strong> 窗口的 <strong>“资源管理器”</strong> 窗格中，打开 Recurring.cs 文件。</li>
  <li>
    <p>在代码编辑器中，观察现有的 <strong>Run</strong> 方法签名：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock33" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock33" class="mt-0"><code class="language-csharp hljs"> [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"Recurring"</span>)</span>]
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Run</span>(<span class="hljs-params">[TimerTrigger(<span class="hljs-string">"0 */5 * * * *"</span></span>)]TimerInfo myTimer, ILogger log)
</span></code></pre>
  </li>
  <li>
    <p>更新 <strong>Run</strong> 方法签名代码块以将计划更改为每 <strong>30 秒</strong>执行一次：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock34" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock34" class="mt-0"><code class="language-csharp hljs"> [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"Recurring"</span>)</span>]
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Run</span>(<span class="hljs-params">[TimerTrigger(<span class="hljs-string">"*/30 * * * * *"</span></span>)]TimerInfo myTimer, ILogger log)
</span></code></pre>
  </li>
  <li>选择 <strong>“保存”</strong> 以保存对 <strong>Recurring.cs</strong> 文件的更改。</li>
</ol>

<h4 id="任务-5观察函数运行">任务 5：观察函数运行</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令，然后按 Enter 键将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock35" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock35" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\02\Starter\func
</code></pre>
  </li>
  <li>
    <p>收到打开的命令提示符时，输入以下命令，然后按 Enter 键运行函数应用项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock36" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock36" class="mt-0"><code class="language-powershell"> func start --build
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 可以查看文档以使用 <strong>Azure Functions Core Tools</strong> <a href="https://docs.microsoft.com/azure/azure-functions/functions-run-local#start">在本地启动函数应用项目</a>。</p>
    </blockquote>
  </li>
  <li>观察大约每 30 秒运行一次的函数。每次运行函数都应向日志呈现一条简单的消息。</li>
  <li>关闭当前正在运行的 <strong>“Windows 终端”</strong> 应用程序。</li>
</ol>

<blockquote>
  <p><strong>回顾</strong>： 在本练习中，你创建了一个按照固定计划自动运行的函数。</p>
</blockquote>

<h3 id="练习-5创建与其他服务集成的函数">练习 5：创建与其他服务集成的函数</h3>

<h4 id="任务-1将示例内容上传到-azure-blob-存储">任务 1：将示例内容上传到 Azure Blob 存储</h4>

<ol>
  <li>在 Azure 门户的“导航”窗格中，选择 <strong>“资源组”</strong> 链接。</li>
  <li>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验室中创建的 <strong>“无服务器”</strong> 资源组。</li>
  <li>在 <strong>“无服务器”</strong> 边栏选项卡中，选择你之前在本实验室中创建的 <strong>“funcstor[yourname]”</strong> 存储帐户。</li>
  <li>在 <strong>“存储帐户”</strong> 边栏选项卡中，选择 <strong>“数据存储”</strong> 部分的 <strong>“容器”</strong> 链接。</li>
  <li>在 <strong>“容器”</strong> 部分，选择 <strong>“+ 容器”</strong>。</li>
  <li>在 <strong>“新建容器”</strong> 弹出窗口中，执行以下操作：
    <ol>
      <li>在 <strong>“名称”</strong> 文本框中，输入 <strong>“内容”</strong>。</li>
      <li>在 <strong>“公共访问级别”</strong> 下拉列表中，选择 <strong>“专用(非匿名访问)”</strong>。</li>
      <li>选择 <strong>“创建”</strong>。</li>
    </ol>
  </li>
  <li>返回到 <strong>“容器”</strong> 部分，然后选择最近创建的 <strong>“内容”</strong> 容器。</li>
  <li>在 <strong>“容器”</strong> 边栏选项卡中，选择 <strong>“上传”</strong>。</li>
  <li>在 <strong>“上传 Blob”</strong> 窗口中，执行以下操作：
    <ol>
      <li>在 <strong>“文件”</strong> 部分，选择 <strong>“文件夹”</strong> 图标。</li>
      <li>在 <strong>“文件资源管理器”</strong> 窗口中，浏览到 <strong>“Allfiles (F):\Allfiles\Labs\02\Starter”</strong>，选择 <strong>“settings.json”</strong> 文件，然后选择 <strong>“打开”</strong>。</li>
      <li>确保选中 <strong>“如果文件存储已经存在，则覆盖”</strong> 复选框，然后选择 <strong>“上传”</strong>。
        <blockquote>
          <p><strong>备注</strong>： 等待 blob 上传完成，然后再继续本实验室。</p>
        </blockquote>
      </li>
    </ol>
  </li>
</ol>

<h4 id="任务-2创建-http-触发的函数">任务 2：创建 HTTP 触发的函数</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令，然后按 Enter 键将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock37" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock37" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\02\Starter\func
</code></pre>
  </li>
  <li>
    <p>收到打开的命令提示符时，输入以下命令，然后按 Enter 键以使用 <strong>Azure Functions Core Tools</strong> 创建使用 <strong>“HTTP 触发器”</strong> 模板的新函数（名为 <strong>“GetSettingInfo”</strong>）：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock38" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock38" class="mt-0"><code class="language-powershell"> func new --template "HTTP trigger" --name "GetSettingInfo"
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 可以查看文档以使用 <strong>Azure Functions Core Tools</strong> <a href="https://docs.microsoft.com/azure/azure-functions/functions-run-local#create-func">创建新函数</a>。</p>
    </blockquote>
  </li>
  <li>关闭当前正在运行的 <strong>“Windows 终端”</strong> 应用程序。</li>
</ol>

<h4 id="任务-3编写-http-触发且-blob-输入的函数代码">任务 3：编写 HTTP 触发且 Blob 输入的函数代码</h4>

<ol>
  <li>在 <strong>“启动”</strong> 屏幕上，选择 <strong>“Visual Studio Code”</strong> 磁贴。</li>
  <li>在 <strong>“文件”</strong> 菜单上，选择 <strong>“打开文件夹”</strong>。</li>
  <li>在打开的 <strong>“文件资源管理器”</strong> 窗口中，浏览到 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong>，然后选择 <strong>“选择文件夹”</strong>。</li>
  <li>在 <strong>“Visual Studio Code”</strong> 窗口的“资源管理器”窗格中，打开 <strong>GetSettingInfo.cs</strong> 文件。</li>
  <li>
    <p>在代码编辑器中，观察示例实现：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock39" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock39" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">using</span> System;
 <span class="hljs-keyword">using</span> System.IO;
 <span class="hljs-keyword">using</span> System.Threading.Tasks;
 <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs.Extensions.Http;
 <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword">using</span> Microsoft.Extensions.Logging;
 <span class="hljs-keyword">using</span> Newtonsoft.Json;
    
 <span class="hljs-keyword">namespace</span> <span class="hljs-title">func</span>
 {
     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GetSettingInfo</span>
     {
         [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"GetSettingInfo"</span>)</span>]
         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">Run</span>(<span class="hljs-params">
             [HttpTrigger(AuthorizationLevel.Function, <span class="hljs-string">"get"</span>, <span class="hljs-string">"post"</span>, Route = <span class="hljs-literal">null</span></span>)] HttpRequest req,
             ILogger log)
         </span>{
             log.LogInformation(<span class="hljs-string">"C# HTTP trigger function processed a request."</span>);
    
             <span class="hljs-keyword">string</span> name = req.Query[<span class="hljs-string">"name"</span>];
    
             <span class="hljs-keyword">string</span> requestBody = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> StreamReader(req.Body).ReadToEndAsync();
             <span class="hljs-keyword">dynamic</span> data = JsonConvert.DeserializeObject(requestBody);
             name = name ?? data?.name;
    
             <span class="hljs-keyword">string</span> responseMessage = <span class="hljs-keyword">string</span>.IsNullOrEmpty(name)
                 ? <span class="hljs-string">"This HTTP triggered function executed successfully. Pass a name in the query string or in the request body for a personalized response."</span>
                 : <span class="hljs-string">$"Hello, <span class="hljs-subst">{name}</span>. This HTTP triggered function executed successfully."</span>;
    
             <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OkObjectResult(responseMessage);
         }
     }
 }
</code></pre>
  </li>
  <li>
    <p>删除 <strong>GetSettingInfo.cs</strong> 文件中的所有内容。</p>
  </li>
  <li>
    <p>添加以下代码行，为 <strong>Microsoft.AspNetCore.Http</strong>、 <strong>Microsoft.AspNetCore.Mvc</strong> 和 <strong>Microsoft.Azure.WebJobs</strong> 命名空间添加 <strong>using 指令</strong>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock40" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock40" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs;
</code></pre>
  </li>
  <li>
    <p>创建名为 <strong>GetSettingInfo</strong> 的新<strong>公共静态</strong>类：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock41" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock41" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GetSettingInfo</span>
 { }
</code></pre>
  </li>
  <li>
    <p>再次观察 <strong>GetSettingInfo.cs</strong> 文件，该文件现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock42" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock42" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs;

 <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GetSettingInfo</span>
 { }
</code></pre>
  </li>
  <li>
    <p>在 <strong>GetSettingInfo</strong> 类中，添加以下代码块，创建名为 <strong>Run</strong> 且以表达式为主体的新<strong>公共静态</strong>方法，该方法返回类型为 <strong>IActionResult</strong> 的变量，并且还将 <strong>HttpRequest</strong> 和<strong>字符串</strong>类型的变量分别作为名为 <em>request</em> 和 <em>json</em> 的参数：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock43" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock43" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActionResult <span class="hljs-title">Run</span>(<span class="hljs-params">
     HttpRequest request,
     <span class="hljs-keyword">string</span> json</span>)
     </span>=&gt; <span class="hljs-literal">null</span>;
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 你只是将返回值暂时设置为 <strong>null</strong>。</p>
    </blockquote>
  </li>
  <li>
    <p>添加以下代码，将属性追加到类型为 <strong>FunctionNameAttribute</strong> 的 Run 方法中，从而将 <strong>name</strong> 参数设置为 <strong>GetSettingInfo</strong> 的值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock44" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock44" class="mt-0"><code class="language-csharp hljs"> [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"GetSettingInfo"</span>)</span>]
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActionResult <span class="hljs-title">Run</span>(<span class="hljs-params">
     HttpRequest request,
     <span class="hljs-keyword">string</span> json</span>)
     </span>=&gt; <span class="hljs-literal">null</span>;
</code></pre>
  </li>
  <li>
    <p>添加以下代码，将属性追加到类型为 <strong>HttpTriggerAttribute</strong> 的 <strong>request</strong> 参数，从而将 <strong>methods</strong> 参数数组设置为 <strong>GET</strong> 的一个值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock45" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock45" class="mt-0"><code class="language-csharp hljs"> [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"GetSettingInfo"</span>)</span>]
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActionResult <span class="hljs-title">Run</span>(<span class="hljs-params">
     [HttpTrigger(<span class="hljs-string">"GET"</span></span>)] HttpRequest request,
     <span class="hljs-keyword">string</span> json)
     </span>=&gt; <span class="hljs-literal">null</span>;
</code></pre>
  </li>
  <li>
    <p>添加以下代码将属性追加到类型为 <strong>BlobAttribute</strong> 的 <strong>json</strong> 参数中，从而将 <strong>blobPath</strong> 参数设置为 <strong>content/settings.json</strong> 的值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock46" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock46" class="mt-0"><code class="language-csharp hljs"> [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"GetSettingInfo"</span>)</span>]
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActionResult <span class="hljs-title">Run</span>(<span class="hljs-params">
     [HttpTrigger(<span class="hljs-string">"GET"</span></span>)] HttpRequest request,
     [<span class="hljs-title">Blob</span>(<span class="hljs-params"><span class="hljs-string">"content/settings.json"</span></span>)] <span class="hljs-keyword">string</span> json)
     </span>=&gt; <span class="hljs-literal">null</span>;
</code></pre>
  </li>
  <li>
    <p>添加以下代码，更新以表达式为主体的 <strong>Run</strong> 方法来返回 <strong>OkObjectResult</strong> 类的新实例，以将 <strong>json</strong> 方法参数的值作为唯一的构造函数参数传入：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock47" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock47" class="mt-0"><code class="language-csharp hljs"> [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"GetSettingInfo"</span>)</span>]
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActionResult <span class="hljs-title">Run</span>(<span class="hljs-params">
     [HttpTrigger(<span class="hljs-string">"GET"</span></span>)] HttpRequest request,
     [<span class="hljs-title">Blob</span>(<span class="hljs-params"><span class="hljs-string">"content/settings.json"</span></span>)] <span class="hljs-keyword">string</span> json)
     </span>=&gt; <span class="hljs-keyword">new</span> OkObjectResult(json);
</code></pre>
  </li>
  <li>
    <p>再次观察 <strong>GetSettingInfo.cs</strong> 文件，该文件现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock48" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock48" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword">using</span> Microsoft.Azure.WebJobs;

 <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GetSettingInfo</span>
 {
     [<span class="hljs-meta">FunctionName(<span class="hljs-meta-string">"GetSettingInfo"</span>)</span>]
     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IActionResult <span class="hljs-title">Run</span>(<span class="hljs-params">
         [HttpTrigger(<span class="hljs-string">"GET"</span></span>)] HttpRequest request,
         [<span class="hljs-title">Blob</span>(<span class="hljs-params"><span class="hljs-string">"content/settings.json"</span></span>)] <span class="hljs-keyword">string</span> json)
         </span>=&gt; <span class="hljs-keyword">new</span> OkObjectResult(json);
 }
</code></pre>
  </li>
  <li>选择 <strong>“保存”</strong> 以保存对 <strong>GetSettingInfo.cs</strong> 文件的更改。</li>
</ol>

<h4 id="任务-4注册-azure-存储-blob-扩展">任务 4：注册 Azure 存储 Blob 扩展</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令，然后按 Enter 键将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock49" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock49" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\02\Starter\func
</code></pre>
  </li>
  <li>
    <p>收到打开的命令提示符时，输入以下命令，然后按 Enter 键<strong>注册</strong> <a href="https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.Storage/4.0.4">Microsoft.Azure.WebJobs.Extensions.Storage</a> 扩展：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock50" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock50" class="mt-0"><code class="language-powershell"> func extensions install --package Microsoft.Azure.WebJobs.Extensions.Storage --version 4.0.4
</code></pre>
  </li>
  <li>
    <p>输入以下命令，然<strong>后按</strong> Enter 键通过生成 .NET 项目来验证是否正确安装了扩展：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock51" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock51" class="mt-0"><code class="language-powershell"> dotnet build
</code></pre>
  </li>
  <li>关闭 <strong>“Windows 终端”</strong> 应用程序上所有当前运行的实例。</li>
</ol>

<h4 id="任务-5使用-httprepl-测试函数">任务 5：使用 httprepl 测试函数</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令，然后按 Enter 键将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock52" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock52" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\02\Starter\func
</code></pre>
  </li>
  <li>
    <p>收到打开的命令提示符时，输入以下命令，然后按 Enter 键运行函数应用项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock53" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock53" class="mt-0"><code class="language-powershell"> func start --build
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 可以查看文档以使用 <strong>Azure Functions Core Tools</strong> <a href="https://docs.microsoft.com/azure/azure-functions/functions-run-local#start">在本地启动函数应用项目</a>。</p>
    </blockquote>
  </li>
  <li>在任务栏上再次选择 <strong>“Windows 终端”</strong> 图标以打开 <strong>“Windows 终端”</strong> 应用程序的新实例。</li>
  <li>
    <p>系统显示打开的命令提示符时，输入以下命令然后按 Enter，以启动 <strong>httprepl</strong> 工具，将基本统一资源标识符 (URI) 设置为 <code>http://localhost:7071</code>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock54" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock54" class="mt-0"><code class="language-powershell"> httprepl http://localhost:7071
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： httprepl 工具会显示一条错误消息。出现此消息的原因是该工具正在搜索用于“遍历”API 的 Swagger 定义文件。由于函数项目不会生成 Swagger 定义文件，因此你需要手动遍历该 API。</p>
    </blockquote>
  </li>
  <li>
    <p>收到工具提示符时，输入以下命令，然后按 Enter 键浏览到相关的 <strong>api</strong> 终结点：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock55" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock55" class="mt-0"><code class="language-powershell"> cd api
</code></pre>
  </li>
  <li>
    <p>输入以下命令，然后选择“Enter”转到 <strong>“getsettinginfo”</strong> 相关终结点：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock56" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock56" class="mt-0"><code class="language-powershell"> cd getsettinginfo
</code></pre>
  </li>
  <li>
    <p>输入以下命令，然后按 Enter 来对当前终结点运行 <strong>“get”</strong> 命令：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock57" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock57" class="mt-0"><code class="language-powershell"> get
</code></pre>
  </li>
  <li>
    <p>查看函数应用响应的 JSON 内容，该内容现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock58" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock58" class="mt-0"><code class="language-json hljs"> {
     <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.2.4"</span>,
     <span class="hljs-attr">"root"</span>: <span class="hljs-string">"/usr/libexec/mews_principal/"</span>,
     <span class="hljs-attr">"device"</span>: {
         <span class="hljs-attr">"id"</span>: <span class="hljs-string">"21e46d2b2b926cba031a23c6919"</span>
     },
     <span class="hljs-attr">"notifications"</span>: {
         <span class="hljs-attr">"email"</span>: <span class="hljs-string">"joseph.price@contoso.com"</span>,
         <span class="hljs-attr">"phone"</span>: <span class="hljs-string">"(425) 555-0162 x4151"</span>
     }
 }
</code></pre>
  </li>
  <li>
    <p>输入以下命令，然后按 Enter 退出 <strong>“httprepl”</strong> 应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock59" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock59" class="mt-0"><code class="language-powershell"> exit
</code></pre>
  </li>
  <li>关闭 <strong>“Windows 终端”</strong> 应用程序上所有当前运行的实例。</li>
</ol>

<blockquote>
  <p><strong>回顾</strong>：在本练习中，你在 Storage 里创建了能退回 JSON 文件内容的函数。</p>
</blockquote>

<h3 id="练习-6将本地函数项目部署到-azure-functions-应用">练习 6：将本地函数项目部署到 Azure Functions 应用</h3>

<h4 id="任务-1使用-azure-functions-core-tools-进行部署">任务 1：使用 Azure Functions Core Tools 进行部署</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令，然后按 Enter 键将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\02\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock60" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock60" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\02\Starter\func
</code></pre>
  </li>
  <li>
    <p>收到打开的命令提示符时，输入以下命令，然后按 Enter 键登录 Azure 命令行接口 (CLI)：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock61" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock61" class="mt-0"><code class="language-powershell"> az login
</code></pre>
  </li>
  <li>在 <strong>Microsoft Edge</strong> 浏览器窗口中，执行以下操作：
    <ol>
      <li>输入你的 Microsoft 帐户的电子邮件地址，然后选择 <strong>“下一个”</strong>。</li>
      <li>输入你的 Microsoft 帐户的密码，然后选择 <strong>“登录”</strong>。</li>
    </ol>
  </li>
  <li>返回当前打开的 <strong>“Windows 终端”</strong> 窗口。等待登录过程完成。</li>
  <li>
    <p>输入以下命令，然后按 Enter 发布函数应用项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock62" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock62" class="mt-0"><code class="language-powershell"> func azure functionapp publish &lt;function-app-name&gt;
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 例如，如果<strong>函数应用名称</strong>为 <strong>funclogicstudent</strong>，则命令将为 <code>func azure functionapp publish funclogicstudent</code>。可以查看文档以使用 <strong>Azure Functions Core Tools</strong> <a href="https://docs.microsoft.com/azure/azure-functions/functions-run-local#publish">发布本地函数应用项目</a>。</p>
    </blockquote>
  </li>
  <li>等待部署完成后，再继续本实验室。</li>
  <li>关闭当前正在运行的 <strong>“Windows 终端”</strong> 应用程序。</li>
</ol>

<h4 id="任务-2验证部署">任务 2：验证部署</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Microsoft Edge”</strong> 图标。</li>
  <li>在打开的浏览器窗口中，转到 Azure 门户 (<a href="https://portal.azure.com">https://portal.azure.com</a>)。</li>
  <li>在 Azure 门户的“导航”窗格中，选择 <strong>“资源组”</strong> 链接。</li>
  <li>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验室中创建的 <strong>“无服务器”</strong> 资源组。</li>
  <li>在 <strong>“无服务器”</strong> 边栏选项卡上，选择你之前在本实验室中创建的 <strong>“funclogic[yourname]”</strong> 函数应用。</li>
  <li>在 <strong>“应用服务”</strong> 边栏选项卡中，从 <strong>“函数”</strong> 部分选择 <strong>“函数”</strong> 选项。</li>
  <li>在 <strong>“函数”</strong> 窗格中选择现有的 <strong>“GetSettingInfo”</strong> 函数。</li>
  <li>在 <strong>“函数”</strong> 边栏选项卡中，从 <strong>“开发人员”</strong> 部分选择 <strong>“代码 + 测试”</strong> 选项。</li>
  <li>在函数编辑器中，选择 <strong>“测试/运行”</strong>。</li>
  <li>在显示的弹出窗口中，执行以下操作：
    <ul>
      <li>在 <strong>“HTTP 方法”</strong> 列表中，选择 <strong>“GET”</strong>。</li>
    </ul>
  </li>
  <li>选择 <strong>“运行”</strong> 以测试函数。</li>
  <li>
    <p>观察运行测试的结果。JSON 内容现应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock63" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock63" class="mt-0"><code class="language-json hljs"> {
     <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.2.4"</span>,
     <span class="hljs-attr">"root"</span>: <span class="hljs-string">"/usr/libexec/mews_principal/"</span>,
     <span class="hljs-attr">"device"</span>: {
         <span class="hljs-attr">"id"</span>: <span class="hljs-string">"21e46d2b2b926cba031a23c6919"</span>
     },
     <span class="hljs-attr">"notifications"</span>: {
         <span class="hljs-attr">"email"</span>: <span class="hljs-string">"joseph.price@contoso.com"</span>,
         <span class="hljs-attr">"phone"</span>: <span class="hljs-string">"(425) 555-0162 x4151"</span>
     }
 }
</code></pre>
  </li>
</ol>

<blockquote>
  <p><strong>回顾</strong>： 在本练习中，你将本地函数项目部署到了 Azure Functions，并验证了这些函数在 Azure 中是否能够正常工作。</p>
</blockquote>

<h3 id="练习-7清理订阅">练习 7：清理订阅</h3>

<h4 id="任务-1打开-azure-cloud-shell-并列出资源组">任务 1：打开 Azure Cloud Shell 并列出资源组</h4>

<ol>
  <li>在 Azure 门户中，选择 <strong>“Cloud Shell”</strong> 图标以打开一个新的 shell 实例。
    <blockquote>
      <p><strong>备注</strong>： <strong>Cloud Shell</strong> 图标使用大于符号 (&gt;) 和下划线字符 (_) 表示。</p>
    </blockquote>
  </li>
  <li>如果这是你第一次使用订阅打开 Cloud Shell，则可以使用 <strong>“欢迎使用 Azure Cloud Shell 向导”</strong> 来配置 Cloud Shell，以便首次使用。在向导中执行以下操作：
    <ol>
      <li>对话框提示你配置 shell。选择 <strong>“Bash”</strong>，查看选定的订阅，然后选择 <strong>“创建存储”</strong>。
        <blockquote>
          <p><strong>备注</strong>： 等待 Cloud Shell 完成首次设置过程后，再继续本实验室。如果 Cloud Shell 配置选项未显示，这很可能是因为你在本课程实验室中使用的是现有订阅。实验是假设你使用的是新订阅的情况下编写的。</p>
        </blockquote>
      </li>
    </ol>
  </li>
</ol>

<h4 id="任务-2删除资源组">任务 2：删除资源组</h4>

<ol>
  <li>
    <p>系统显示命令提示符时，输入以下命令，然后按 Enter 键删除 <strong>“无服务器”</strong> 资源组：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock64" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock64" class="mt-0"><code class="language-powershell"> az group delete --name Serverless --no-wait --yes
</code></pre>
  </li>
  <li>
    <p>关闭门户中的 Cloud Shell 窗格。</p>
  </li>
</ol>

<h4 id="任务-3关闭活动的应用程序">任务 3：关闭活动的应用程序</h4>

<ol>
  <li>关闭当前正在运行的 Microsoft Edge 应用程序。</li>
</ol>

<blockquote>
  <p><strong>回顾</strong>： 在本练习中，你通过删除本实验室中曾经使用的资源组来清理订阅。</p>
</blockquote>


            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D.js"></script>



</body></html>