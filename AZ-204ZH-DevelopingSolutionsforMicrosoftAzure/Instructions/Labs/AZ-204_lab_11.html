<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#准备工作">准备工作</a></li><li class="nav-item"><a class="nav-link" href="#练习-1创建和配置-azure-资源">练习 1：创建和配置 Azure 资源</a></li><li class="nav-item"><a class="nav-link" href="#练习-2使用-application-insights-监视本地-web-应用程序">练习 2：使用 Application Insights 监视本地 Web 应用程序</a></li><li class="nav-item"><a class="nav-link" href="#练习-3使用-application-insights-监视-web-应用">练习 3：使用 Application Insights 监视 Web 应用</a></li><li class="nav-item"><a class="nav-link" href="#练习-4清理订阅">练习 4：清理订阅</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="实验室-11监视部署到-azure-的服务">实验室 11：监视部署到 Azure 的服务</h1>

<h2 id="microsoft-azure-用户界面">Microsoft Azure 用户界面</h2>

<p>鉴于 Microsoft 云工具的动态特性，Azure UI 在此培训内容开发后可能会发生更改。这些更改可能会导致实验室说明和步骤不匹配。</p>

<p>我们发现社区进行了必要更改时，Microsoft 将会更新此培训课程。但由于云更新频繁，在此培训内容更新前 UI 可能已更改。<strong>如果发生这种情况，请适应这些更改，并根据需要在实验室中熟悉这些更改。</strong></p>

<h2 id="说明">说明</h2>

<h3 id="准备工作">准备工作</h3>

<h4 id="登录到实验室虚拟机">登录到实验室虚拟机</h4>

<p>使用以下凭据登录到 Windows 10 虚拟机 (VM)：</p>

<ul>
  <li>
    <p>用户名：<strong>Admin</strong></p>
  </li>
  <li>
    <p>密码： <strong>Pa55w.rd</strong></p>
  </li>
</ul>

<blockquote>
  <p><strong>备注</strong>： 你的讲师将提供连接到虚拟实验室环境的说明。</p>
</blockquote>

<h4 id="查看已安装的应用程序">查看已安装的应用程序</h4>

<p>在你的 Windows 10 桌面上找到任务栏。任务栏里有本实验室中你将使用的应用程序的图标：</p>

<ul>
  <li>
    <p>Microsoft Edge</p>
  </li>
  <li>
    <p>文件资源管理器</p>
  </li>
  <li>
    <p>Visual Studio Code</p>
  </li>
  <li>
    <p>Windows PowerShell</p>
  </li>
</ul>

<h3 id="练习-1创建和配置-azure-资源">练习 1：创建和配置 Azure 资源</h3>

<h4 id="任务-1打开-azure-门户">任务 1：打开 Azure 门户</h4>

<ol>
  <li>
    <p>在任务栏上，选择 <strong>“Microsoft Edge”</strong> 图标。</p>
  </li>
  <li>
    <p>在打开的浏览器窗口中，转到 Azure 门户 (<a href="https://portal.azure.com">https://portal.azure.com</a>)。</p>
  </li>
  <li>
    <p>在登录页面，输入 Microsoft 帐户的电子邮件地址，然后选择 <strong>“下一步”</strong>。</p>
  </li>
  <li>
    <p>输入你的 Microsoft 帐户的密码，然后选择 <strong>“登录”</strong>。</p>
  </li>
</ol>

<blockquote>
  <p><strong>备注</strong>： 如果首次登录到 Azure 门户，则对话框会显示门户导览。选择 <strong>“开始使用”</strong>，以跳过导览并开始使用门户。</p>
</blockquote>

<h4 id="任务-2创建-application-insights-资源">任务 2：创建 Application Insights 资源</h4>

<ol>
  <li>
    <p>在 Azure 门户的导航窗格上，选择 <strong>“创建资源”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“创建资源”</strong> 边栏选项卡上，找到 <strong>“搜索服务和市场”</strong> 文本框。</p>
  </li>
  <li>
    <p>在搜索框中，输入 <strong>Insights</strong>，然后按 Enter。</p>
  </li>
  <li>
    <p>在 <strong>“市场”</strong> 搜索结果边栏选项卡中，选择 <strong>“Application Insights”</strong> 结果。</p>
  </li>
  <li>
    <p>在 <strong>“Application Insights”</strong> 边栏选项卡中，选择 <strong>“创建”</strong>。</p>
  </li>
  <li>
    <p>从第二个 <strong>“Application Insights”</strong> 边栏选项卡中查找选项卡，例如 <strong>“基本”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 每个选项卡都代表在工作流中新建 “Application Insights”实例的一个步骤。你可以随时选择 <strong>“查看 + 创建”</strong> 跳过其余选项卡。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“基本信息”</strong> 选项卡中，执行以下操作：</p>

    <ol>
      <li>
        <p>将 <strong>“订阅”</strong> 文本框保留设置为默认值。</p>
      </li>
      <li>
        <p>在 <strong>“资源组”</strong> 部分，选择 <strong>“新建”</strong>，输入 <strong>MonitoredAssets</strong>，然后选择 <strong>“确定”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“名称”</strong> 文本框中，输入 “<strong>instrm<em>[yourname]</em></strong>”。</p>
      </li>
      <li>
        <p>在 <strong>“区域”</strong> 下拉列表中，选择 <strong>“（美国）美国东部”</strong> 地区。</p>
      </li>
      <li>
        <p>在 <strong>“资源模式”</strong> 部分中，选择 <strong>“经典”</strong> 选项。</p>
      </li>
      <li>
        <p>选择 <strong>“查看 + 创建”</strong>。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>在 <strong>“查看 + 创建”</strong> 选项卡中，查看在先前步骤中选择的选项。</p>
  </li>
  <li>
    <p>选择 <strong>“创建”</strong>，使用指定的配置创建 Application Insights 实例。</p>

    <blockquote>
      <p><strong>备注</strong>： 等待创建任务完成，再继续本实验室。</p>
    </blockquote>
  </li>
  <li>
    <p>在 Azure 门户的“导航”窗格中，选择 <strong>“资源组”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>“MonitoredAssets”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“MonitoredAssets”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>instrm<em>[yourname]</em></strong> Application Insights 帐户。</p>
  </li>
  <li>
    <p>在 <strong>“Application Insights”</strong> 边栏选项卡的 <strong>“配置”</strong> 类别中，选择 <strong>“属性”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“属性”</strong> 部分，找到 <strong>“检测密钥”</strong> 文本框的值。客户端应用程序使用此密钥连接到 Application Insights。</p>
  </li>
</ol>

<h4 id="任务-3使用-azure-应用服务资源创建-web-应用">任务 3：使用 Azure 应用服务资源创建 Web 应用</h4>

<ol>
  <li>
    <p>在 Azure 门户的“导航”窗格上，选择 <strong>“创建资源”</strong>。</p>
  </li>
  <li>
    <p>在“创建资源”边栏选项卡上，找到 <strong>“搜索服务和市场”</strong> 文本框。</p>
  </li>
  <li>
    <p>在搜索框中，输入 <strong>“Web 应用”</strong>，然后按 Enter。</p>
  </li>
  <li>
    <p>在 <strong>“市场”</strong> 搜索结果边栏选项卡中，选择 <strong>“Web 应用”</strong> 结果。</p>
  </li>
  <li>
    <p>在 <strong>“Web 应用”</strong> 边栏选项卡中，选择 <strong>“创建”</strong>。</p>
  </li>
  <li>
    <p>查看 <strong>“创建 Web 应用”</strong> 边栏选项卡中的各个选项卡，例如 <strong>“基本”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 每个选项卡都代表在工作流中新建 Web 应用的一个步骤。你可以随时选择 <strong>“查看 + 创建”</strong> 跳过其余选项卡。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“基本信息”</strong> 选项卡中，执行以下操作：</p>

    <ol>
      <li>
        <p>将 <strong>“订阅”</strong> 文本框保留设置为默认值。</p>
      </li>
      <li>
        <p>在 <strong>“资源组”</strong> 下拉列表中，选择 <strong>“MonitoredAssets”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“名称”</strong> 文本框中，输入 <strong><em>smpapi***[yourname]</em></strong>。</p>
      </li>
      <li>
        <p>在 <strong>“发布”</strong> 部分，选择 <strong>“代码”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“运行时堆栈”</strong> 下拉列表中，选择 <strong>“.NET Core 3.1 (LTS)”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“操作系统”</strong> 部分，选择 <strong>“Windows”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“区域”</strong> 下拉列表中，选择 <strong>“美国东部”</strong> 区域。</p>
      </li>
      <li>
        <p>在 <strong>“Windows 计划（美国东部）”</strong> 部分中，选择 <strong>“新建”</strong>，然后将值 <strong>“MonitoredPlan”</strong> 输入 <strong>“名称”</strong> 文本框，接着选择 <strong>“确定”</strong>。</p>
      </li>
      <li>
        <p>将 <strong>“SKU 和大小”</strong> 部分保留设置为默认值。</p>
      </li>
      <li>
        <p>选择 <strong>“下一步: 部署(预览)”</strong>。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>在 <strong>“部署(预览)”</strong> 选项卡中，执行以下操作：</p>

    <ol>
      <li>选择 <strong>“下一步: 监视”</strong>。</li>
    </ol>
  </li>
  <li>
    <p>在<strong>监视</strong>选项卡中，执行以下操作：</p>

    <ol>
      <li>
        <p>在 <strong>“启用 Application Insights”</strong> 部分，选择 <strong>“是”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“Application Insights”</strong> 下拉列表中，选择先前在本实验室中创建的 “<strong>instrm<em>[yourname]</em></strong>” Application Insights 帐户。</p>
      </li>
      <li>
        <p>选择 <strong>“查看 + 创建”</strong>。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>在 <strong>“查看 + 创建”</strong> 选项卡中，查看在先前步骤中选择的选项。</p>
  </li>
  <li>
    <p>选择 <strong>“创建”</strong>，使用指定的配置创建 Web 应用。</p>

    <blockquote>
      <p><strong>备注</strong>：等待创建任务完成，再继续本实验室。</p>
    </blockquote>
  </li>
  <li>
    <p>在 Azure 门户的“导航”窗格中，选择 <strong>“资源组”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>“MonitoredAssets”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“MonitoredAssets”</strong> 边栏选项卡中，选择你之前在此实验室中创建的 <strong><em>smpapi***[yourname]</em></strong> Web 应用。</p>
  </li>
  <li>
    <p>在 <strong>“应用服务”</strong> 边栏选项卡的 <strong>“设置”</strong> 部分，选择 <strong>“配置”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“配置”</strong> 部分，执行以下操作：</p>

    <ol>
      <li>
        <p>选择 <strong>“应用程序设置”</strong> 选项卡。</p>
      </li>
      <li>
        <p>选择 <strong>“显示值”</strong> 以获取与 API 关联的机密。</p>
      </li>
      <li>
        <p>查找与 <strong>APPINSIGHTS_INSTRUMENTATIONKEY</strong> 密钥相对应的值。构建 Web 应用资源时会自动设置此值。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>在 <strong>“应用服务”</strong> 边栏选项卡的 <strong>“设置”</strong> 部分，选择 <strong>“属性”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“属性”</strong> 部分，记录 <strong>“URL”</strong> 文本框的值。稍后将在本实验室中使用此值来对 API 发出请求。</p>
  </li>
</ol>

<h4 id="任务-4配置-web-应用自动缩放选项">任务 4：配置 Web 应用自动缩放选项</h4>

<ol>
  <li>
    <p>在 <strong>“应用服务”</strong> 边栏选项卡的 <strong>“设置”</strong> 类别，选择 <strong>“横向扩展(应用服务计划)”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“横向扩展”</strong> 部分中，执行以下操作：</p>

    <ol>
      <li>
        <p>选择 <strong>“自定义自动缩放”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“自动缩放设置名称”</strong> 文本框中，输入 <strong>“ComputeScaler”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“资源组”</strong> 列表中，选择 <strong>“MonitoredAssets”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“缩放模式”</strong> 部分中，选择 <strong>“根据指标缩放”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“实例限制”</strong> 部分的 <strong>“最小”</strong> 字段，输入 <strong>“2”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“实例限制”</strong> 部分的 <strong>“最大”</strong> 文本框中，输入 <strong>“8”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“实例限制”</strong> 部分的 <strong>“默认值”</strong> 字段，输入 <strong>“3”</strong>。</p>
      </li>
      <li>
        <p>选择 <strong>“添加规则”</strong>。在显示的 <strong>“缩放规则”</strong> 弹出窗口中，将所有字段保留设置为默认值，然后选择 <strong>“添加”</strong>。</p>
      </li>
      <li>
        <p>在该部分中，选择 <strong>“保存”</strong>。</p>
      </li>
    </ol>

    <blockquote>
      <p><strong>备注</strong>： 等待保存操作完成后，再继续本实验室。</p>
    </blockquote>
  </li>
</ol>

<h4 id="回顾">回顾</h4>

<p>在此练习中，你创建了将用于本实验室其余部分的资源。</p>

<h3 id="练习-2使用-application-insights-监视本地-web-应用程序">练习 2：使用 Application Insights 监视本地 Web 应用程序</h3>

<h4 id="任务-1生成一个-net-web-api-项目">任务 1：生成一个 .NET Web API 项目</h4>

<ol>
  <li>
    <p>在任务栏上，选择 <strong>“Visual Studio Code”</strong> 图标。</p>
  </li>
  <li>
    <p>在 <strong>“文件”</strong> 菜单上，选择 <strong>“打开文件夹”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“文件资源管理器”</strong> 窗口中，前往 <strong>“Allfiles (F):\Allfiles\Labs\11\Starter\Api”</strong>，然后选择 <strong>“选择文件夹”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口中，右键单击“资源管理器”窗格或激活快捷方式菜单，然后选择 <strong>“在终端中打开”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Open”</strong> 命令提示符中，输入以下命令并按 Enter 键以在当前目录中创建一个名为 <strong>“SimpleApi”</strong> 的 .NET Web API 应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="hljs coffeescript">dotnet <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webapi --output . --name SimpleApi
</code></pre>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令然后按 Enter 键，以将 2.14.0 版本的 <strong>Microsoft.ApplicationInsights</strong> 从 NuGet 导入到当前项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">dotnet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">package</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Microsoft</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ApplicationInsights</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--version</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet add package</strong> 命令将从 NuGet 添加 <strong>Microsoft.ApplicationInsights</strong> 包。有关详细信息，请前往 <a href="https://www.nuget.org/packages/Microsoft.ApplicationInsights/2.14.0">“Microsoft.ApplicationInsights”</a>。</p>
    </blockquote>
  </li>
  <li>
    <p>在命令提示符中，输入以下命令并按 Enter，以从 NuGet 导入 2.14.0 版本的 <strong>Microsoft.ApplicationInsights.AspNetCore</strong>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">dotnet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">package</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Microsoft</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ApplicationInsights</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.AspNetCore</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--version</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet add package</strong> 命令从 NuGet 添加 <strong>Microsoft.ApplicationInsights.AspNetCore</strong> 包。有关详细信息，请前往 <a href="https://www.nuget.org/packages/Microsoft.ApplicationInsights.AspNetCore/2.14.0">“Microsoft.ApplicationInsights.AspNetCore”</a>。</p>
    </blockquote>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令并按 Enter 键，将 2.14.0 版本的 <strong>Microsoft.ApplicationInsights.PerfCounterCollector</strong> 从 NuGet 导入当前项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">dotnet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">package</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Microsoft</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ApplicationInsights</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.PerfCounterCollector</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">--version</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>Dotnet add package</strong> 命令将从 NuGet 添加 <strong>Microsoft.ApplicationInsights.PerfCounterCollector</strong>。有关详细信息，请转到 <a href="https://www.nuget.org/packages/Microsoft.ApplicationInsights.PerfCounterCollector/2.14.0">Microsoft.ApplicationInsights.PerfCounterCollector</a>。</p>
    </blockquote>
  </li>
  <li>
    <p>在命令提示符中，输入以下命令并按 Enter，生成 .NET Web 应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> build
</code></pre>
  </li>
</ol>

<h4 id="任务-2更新应用程序代码以禁用-https-并使用-application-insights">任务 2：更新应用程序代码以禁用 HTTPS 并使用 Application Insights</h4>

<ol>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口的“资源管理器”窗格中，选择 <strong>“Startup.cs”</strong> 文件以在编辑器中打开该文件。</p>
  </li>
  <li>
    <p>在编辑器的 <strong>“Startup”</strong> 类中，在第 39 行找到并删除以下代码行：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.UseHttpsRedirection</span></span>();
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 此代码行强制 Web 应用使用 HTTPS。对本实验室而言，这不是必要的。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>Startup</strong> 类中，添加名为 <strong>INSTRUMENTATION_KEY</strong> 的新静态字符串常数，并将其值设置为从在本实验室前面部分创建的 Application Insights 资源中复制的检测密钥：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> INSTRUMENTATION_KEY = <span class="hljs-string"><span class="hljs-string">"{your_instrumentation_key}"</span></span>;
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 例如，如果检测密钥是 <code>d2bb0eed-1342-4394-9b0c-8a56d21aaa43</code>，则代码行是 <code>private const string INSTRUMENTATION_KEY = "d2bb0eed-1342-4394-9b0c-8a56d21aaa43";</code></p>
    </blockquote>
  </li>
  <li>
    <p>找到 <strong>“Startup”</strong> 类中的 <strong>“ConfigureServices”</strong> 方法：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IServiceCollection services)</span></span></span><span class="hljs-function">
</span></span>{
    services.AddControllers();
}
</code></pre>
  </li>
  <li>
    <p>在 <strong>ConfigureServices</strong> 方法末尾添加新代码行，以使用提供的检测密钥配置 Application Insights：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock8" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock8" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">services</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.AddApplicationInsightsTelemetry</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">INSTRUMENTATION_KEY</span></span>);
</code></pre>
  </li>
  <li>
    <p>观察 <strong>ConfigureServices</strong> 方法，该方法现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock9" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock9" class="mt-0"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IServiceCollection services)</span></span></span><span class="hljs-function">
</span></span>{
    services.AddControllers();
    services.AddApplicationInsightsTelemetry(INSTRUMENTATION_KEY);        
}
</code></pre>
  </li>
  <li>
    <p>保存 <strong>Startup.cs</strong> 文件。</p>
  </li>
  <li>
    <p>在命令提示符中，输入以下命令并按 Enter，以生成 .NET Web 应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock10" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock10" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> build
</code></pre>
  </li>
</ol>

<h4 id="任务-3本地测试-api-应用程序">任务 3：本地测试 API 应用程序</h4>

<ol>
  <li>
    <p>在命令提示符中，输入以下命令并按 Enter，运行 .NET Web 应用程序。</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock11" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock11" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> run
</code></pre>
  </li>
  <li>
    <p>在任务栏上，打开 <strong>“Microsoft Edge”</strong> 图标的上下文菜单，然后打开一个新的浏览器窗口。</p>
  </li>
  <li>
    <p>在打开的浏览器窗口中，进入到托管在端口 <strong>5000</strong> 上的 <strong>localhost</strong> 上的测试应用程序的相对路径 <strong>/weatherforecast</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 完整的 URL 为 http://localhost:5000/weatherforecast</p>
    </blockquote>
  </li>
  <li>
    <p>关闭显示 http://localhost:5000/weatherforecast 地址的浏览器窗口。</p>
  </li>
  <li>
    <p>关闭当前正在运行的“Visual Studio Code”应用程序。</p>
  </li>
</ol>

<h4 id="任务-4获取-application-insights-中的指标">任务 4：获取 Application Insights 中的指标</h4>

<ol>
  <li>
    <p>返回显示 Azure 门户的当前打开的浏览器窗口。</p>
  </li>
  <li>
    <p>在门户中，选择 <strong>“资源组”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验室中创建的 <strong>“MonitoredAssets”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“MonitoredAssets”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>instrm<em>[yourname]</em></strong> Application Insights 帐户。</p>
  </li>
  <li>
    <p>在 <strong>“Application Insights”</strong> 边栏选项卡的位于边栏选项卡中心的磁贴中，观察显示的指标。具体来说，找到已经发生的服务器请求数量和平均服务器响应时间。</p>

    <blockquote>
      <p><strong>备注</strong>： 请求最多可能需要五分钟才可显示在 Application Insights 指标图表中。</p>
    </blockquote>
  </li>
</ol>

<h4 id="回顾-1">回顾</h4>

<p>在本练习中，你使用 ASP.NET Core 创建了一个 API，并将配置它将应用程序指标流式传输到 Application Insights。然后，你使用 Application Insights 仪表板查看有关 API 的性能详细信息。</p>

<h3 id="练习-3使用-application-insights-监视-web-应用">练习 3：使用 Application Insights 监视 Web 应用</h3>

<h4 id="任务-1将应用程序部署到-web-应用">任务 1：将应用程序部署到 Web 应用</h4>

<ol>
  <li>
    <p>在任务栏上，选择 <strong>“Visual Studio Code”</strong> 图标。</p>
  </li>
  <li>
    <p>在 <strong>“文件”</strong> 菜单上，选择 <strong>“打开文件夹”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“文件资源管理器”</strong> 窗口中，前往 <strong>“Allfiles (F):\Allfiles\Labs\11\Starter\Api”</strong>，然后选择 <strong>“选择文件夹”</strong>。</p>
  </li>
  <li>
    <p>在 Visual Studio Code 窗口中，右键单击资源管理器窗格或激活快捷菜单，然后选择 <strong>“在终端中打开”</strong>。</p>
  </li>
  <li>
    <p>在打开的命令提示符中，输入以下命令并按 Enter 键以登录 Azure 命令行接口 (CLI)：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock12" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock12" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">az</span></span> login
</code></pre>
  </li>
  <li>
    <p>在浏览器窗口中，执行以下操作：</p>

    <ol>
      <li>
        <p>输入你的 Microsoft 帐户的电子邮件地址，然后选择 <strong>“下一个”</strong>。</p>
      </li>
      <li>
        <p>输入你的 Microsoft 帐户的密码，然后选择 <strong>“登录”</strong>。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>返回当前打开的“命令提示符”应用程序。</p>

    <blockquote>
      <p><strong>备注</strong>： 请等待登录过程完成。</p>
    </blockquote>
  </li>
  <li>
    <p>在命令提示符中，输入以下命令并按 Enter 键以列出 <strong>“MonitoredAssets”</strong> 资源组中的所有应用：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock13" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock13" class="mt-0"><code class="hljs cpp">az webapp <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> --resource-group MonitoredAssets
</code></pre>
  </li>
  <li>
    <p>输入以下命令然后按 Enter，以查找前缀为 <strong>smpapi*</strong> 的应用：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock14" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock14" class="mt-0"><code class="hljs cpp">az webapp <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> --resource-group MonitoredAssets --query <span class="hljs-string"><span class="hljs-string">"[?starts_with(name, 'smpapi')]"</span></span>
</code></pre>
  </li>
  <li>
    <p>输入以下命令然后按 Enter，以呈现前缀为 <em>*smpapi*</em> 的单个应用的名称：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock15" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock15" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">az</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">webapp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">list</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--resource-group</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MonitoredAssets</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--query</span></span> "<span class="hljs-selector-attr"><span class="hljs-selector-attr">[?starts_with(name, 'smpapi')]</span></span>.{<span class="hljs-attribute"><span class="hljs-attribute">Name</span></span>:name}" <span class="hljs-selector-tag"><span class="hljs-selector-tag">--output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tsv</span></span>
</code></pre>
  </li>
  <li>
    <p>输入以下命令然后按 Enter，以将当前目录更改为包含部署文件的 <strong>Allfiles (F):\Allfiles\Labs\11\Starter</strong> 目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock16" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock16" class="mt-0"><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> F:\Allfiles\Labs\11\Starter\
</code></pre>
  </li>
  <li>
    <p>输入以下命令然后按 Enter，以将 <strong>api.zip</strong> 文件部署到之前在此实验室中创建的 Web 应用：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock17" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock17" class="mt-0"><code class="hljs sql">az webapp deployment source config-zip <span class="hljs-comment"><span class="hljs-comment">--resource-group MonitoredAssets --src api.zip --name &lt;name-of-your-api-app&gt;</span></span>
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 用你之前在本实验室中创建的 Web 应用的名称替换占位符 <em>name-of-your-api-app</em>。你最近在上一页步骤中查询了此应用的名称。</p>
    </blockquote>

    <blockquote>
      <p><strong>备注</strong>：等待部署完成后，再继续本实验室。</p>
    </blockquote>
  </li>
  <li>
    <p>关闭当前正在运行的“Visual Studio Code”应用程序。</p>
  </li>
  <li>
    <p>返回显示 Azure 门户的当前打开的浏览器窗口。</p>
  </li>
  <li>
    <p>在 Azure 门户的导航窗格中，选择 <strong>“资源组”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>“MonitoredAssets”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“MonitoredAssets”</strong> 边栏选项卡中，选择你之前在此实验室中创建的 <strong><em>smpapi***[yourname]</em></strong> Web 应用。</p>
  </li>
  <li>
    <p>在 <strong>“应用服务”</strong> 边栏选项卡中，选择 <strong>“浏览”</strong>。将打开一个新的浏览器窗口或选项卡并返回“404（未找到）”错误。</p>
  </li>
  <li>
    <p>在浏览器地址栏中，通过在当前 URL 末尾追加后缀 <strong>“/weatherforecast”</strong> 并按 Enter 键来更新 URL。</p>

    <blockquote>
      <p><strong>备注</strong>： 例如，如果你的 URL 为 https://smpapistudent.azurewebsites.net，则新的 URL 为 https://smpapistudent.azurewebsites.net/weatherforecast。</p>
    </blockquote>
  </li>
  <li>
    <p>找到作为使用 API 的结果返回的 JavaScript 对象表示法 (JSON) 数组。</p>
  </li>
</ol>

<h4 id="任务-2配置-web-应用的深入指标集合">任务 2：配置 Web 应用的深入指标集合</h4>

<ol>
  <li>
    <p>返回显示 Azure 门户的当前打开的浏览器窗口。</p>
  </li>
  <li>
    <p>在 Azure 门户的导航窗格中，选择 <strong>“资源组”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>“MonitoredAssets”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“MonitoredAssets”</strong> 边栏选项卡中，选择你之前在此实验室中创建的 <strong><em>smpapi***[yourname]</em></strong> Web 应用。</p>
  </li>
  <li>
    <p>在 <strong>“应用服务”</strong> 边栏选项卡中，选择 <strong>“Application Insights”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Application Insights”</strong> 边栏选项卡中，执行以下操作：</p>

    <ol>
      <li>
        <p>确保 <strong>“Application Insights”</strong> 部分设置为 <strong>“启用”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“检测应用程序”</strong> 部分，选择 <strong>“.NET”</strong> 选项卡。</p>
      </li>
      <li>
        <p>在 <strong>“集合级别”</strong> 部分，选择 <strong>“建议”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“探查器”</strong> 部分，选择 <strong>“开”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“快照调试器”</strong> 部分，选择 <strong>“关”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“SQL 命令”</strong> 部分，选择 <strong>“关”</strong>。</p>
      </li>
      <li>
        <p>选择 “<strong>应用</strong>”。</p>
      </li>
      <li>
        <p>在确认对话框中，选择 <strong>“是”</strong>。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>关闭 <strong>“Application Insights”</strong> 边栏选项卡。</p>
  </li>
  <li>
    <p>从 <strong>“应用服务”</strong> 边栏选项卡返回，选择 <strong>“浏览”</strong>。将打开一个新的浏览器窗口或选项卡并返回“404（未找到）”错误。</p>
  </li>
  <li>
    <p>在浏览器地址栏中，通过在当前 URL 末尾追加后缀 <strong>“/weatherforecast”</strong> 并按 Enter 键来更新 URL。</p>

    <blockquote>
      <p><strong>备注</strong>：例如，如果你的 URL 为 https://smpapistudent.azurewebsites.net，则新的 URL 为 https://smpapistudent.azurewebsites.net/weatherforecast。</p>
    </blockquote>
  </li>
  <li>
    <p>观察作为使用 API 结果返回的 JSON 数组。</p>
  </li>
  <li>
    <p>记录用于访问 JSON 数组的 URL。</p>

    <blockquote>
      <p><strong>备注</strong>： 使用前面步骤中的示例，你应记录 URL <code>https://smpapistudent.azurewebsites.net/weatherforecast</code>。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-3在-application-insights-中查看更新指标">任务 3：在 Application Insights 中查看更新指标</h4>

<ol>
  <li>
    <p>返回显示 Azure 门户的当前打开的浏览器窗口。</p>
  </li>
  <li>
    <p>在门户中，选择 <strong>“资源组”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验室中创建的 <strong>“MonitoredAssets”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“MonitoredAssets”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>instrm<em>[yourname]</em></strong> Application Insights 帐户。</p>
  </li>
  <li>
    <p>在 <strong>“Application Insights”</strong> 边栏选项卡的位于边栏选项卡中心的磁贴中，观察显示的指标。具体来说，找到已经发生的服务器请求数量和平均服务器响应时间。</p>

    <blockquote>
      <p><strong>备注</strong>： 请求最多可能需要五分钟才可显示在 Application Insights 指标图表中。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-4在-application-insights-中查看实时指标">任务 4：在 Application Insights 中查看实时指标</h4>

<ol>
  <li>
    <p>返回显示 Azure 门户的当前打开的浏览器窗口。</p>
  </li>
  <li>
    <p>在门户中，选择 <strong>“资源组”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验室中创建的 <strong>“MonitoredAssets”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“MonitoredAssets”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>instrm<em>[yourname]</em></strong> Application Insights 帐户。</p>
  </li>
  <li>
    <p>在 <strong>“Application Insights”</strong> 边栏选项卡中，选择 <strong>“调查”</strong> 部分中的 <strong>“实时指标”</strong>。</p>
  </li>
  <li>
    <p>在任务栏上，打开 <strong>“Microsoft Edge”</strong> 图标的上下文菜单，然后打开一个新的浏览器窗口。</p>
  </li>
  <li>
    <p>在新的浏览器窗口中，转到你之前在本实验室中记录的 URL。</p>
  </li>
  <li>
    <p>观察 JSON 数组的结果。</p>
  </li>
  <li>
    <p>返回显示 Azure 门户的当前打开的浏览器窗口。</p>
  </li>
  <li>
    <p>查看更新后的 <strong>“实时指标流”</strong> 边栏选项卡。</p>

    <blockquote>
      <p><strong>备注</strong>： <strong>“传入请求”</strong> 部分应该会在几秒钟内更新，显示你对 Web 应用发出的请求。</p>
    </blockquote>
  </li>
</ol>

<h4 id="回顾-2">回顾</h4>

<p>在本练习中，你将 Web 应用程序部署到 Azure App 服务，并从同一 Application Insights 实例监视指标。</p>

<h3 id="练习-4清理订阅">练习 4：清理订阅</h3>

<h4 id="任务-1打开-azure-cloud-shell">任务 1：打开 Azure Cloud Shell</h4>

<ol>
  <li>
    <p>在 Azure 门户中，选择 <strong>“Cloud Shell”</strong> 图标以打开一个新的 shell 实例。</p>

    <blockquote>
      <p><strong>备注</strong>： <strong>Cloud Shell</strong> 图标使用大于符号 (&gt;) 和下划线字符 (_) 表示。</p>
    </blockquote>
  </li>
  <li>
    <p>如果这是你第一次使用订阅打开 Cloud Shell，则可以使用 <strong>“欢迎使用 Azure Cloud Shell 向导”</strong> 来配置 Cloud Shell，以便首次使用。在向导中执行以下操作：</p>

    <ol>
      <li>对话框提示你配置 shell。选择 <strong>“Bash”</strong>，查看选定的订阅，然后选择 <strong>“创建存储”</strong>。</li>
    </ol>

    <blockquote>
      <p><strong>备注</strong>：等待 Cloud Shell 完成首次设置过程后，再继续本实验室。如果 Cloud Shell 配置选项未显示，很可能是因为你使用的是本课程实验室中的现有订阅。实验是假设你使用的是新订阅的情况下编写的。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2删除资源组">任务 2：删除资源组</h4>

<ol>
  <li>
    <p>输入以下命令，然后按 Enter 键删除 <strong>MonitoredAssets</strong> 资源组：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock18" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock18" class="mt-0"><code class="hljs coffeescript">az group <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> --name MonitoredAssets --<span class="hljs-literal"><span class="hljs-literal">no</span></span>-wait --<span class="hljs-literal"><span class="hljs-literal">yes</span></span>
</code></pre>
  </li>
  <li>
    <p>关闭门户中的 Cloud Shell 窗格。</p>
  </li>
</ol>

<h4 id="任务-3关闭活动应用程序">任务 3：关闭活动应用程序</h4>

<ol>
  <li>
    <p>关闭当前正在运行的 Microsoft Edge 应用程序。</p>
  </li>
  <li>
    <p>关闭当前正在运行的“Visual Studio Code”应用程序。</p>
  </li>
</ol>

<h4 id="回顾-3">回顾</h4>

<p>在本练习中，你通过删除本实验室中使用的资源组清理订阅。</p>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D.js"></script>



</body></html>