<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#准备工作">准备工作</a></li><li class="nav-item"><a class="nav-link" href="#练习-1创建-azure-资源">练习 1：创建 Azure 资源</a></li><li class="nav-item"><a class="nav-link" href="#练习-2配置机密和标识">练习 2：配置机密和标识</a></li><li class="nav-item"><a class="nav-link" href="#练习-3生成-azure-functions-应用">练习 3：生成 Azure Functions 应用</a></li><li class="nav-item"><a class="nav-link" href="#练习-4访问-azure-blob-存储数据">练习 4：访问 Azure Blob 存储数据</a></li><li class="nav-item"><a class="nav-link" href="#练习-5清理订阅">练习 5：清理订阅</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="实验室-07以更安全地方式跨服务访问资源机密">实验室 07：以更安全地方式跨服务访问资源机密</h1>

<h2 id="microsoft-azure-用户界面">Microsoft Azure 用户界面</h2>

<p>鉴于 Microsoft 云工具的动态特性，Azure 用户界面 (UI) 在此培训内容开发后可能会发生更改。这些更改可能会导致实验室说明和实验室步骤不一致。</p>

<p>当社区要求我们进行更改时，Microsoft 将更新此培训课程。但是，由于云更新频繁发生，因此在此培训内容更新之前，你可能会遇到 UI 更改情况。<strong>如果发生这种情况，请适应这些更改，并根据需要在实验室中熟悉这些更改。</strong></p>

<h2 id="说明">说明</h2>

<h3 id="准备工作">准备工作</h3>

<h4 id="登录到实验室虚拟机">登录到实验室虚拟机</h4>

<p>使用以下凭据登录到 Windows 10 虚拟机 (VM)：</p>

<ul>
  <li>用户名： <strong>Admin</strong></li>
  <li>密码： <strong>Pa55w.rd</strong></li>
</ul>

<blockquote>
  <p><strong>备注</strong>：你的讲师将提供连接到虚拟实验室环境的说明。</p>
</blockquote>

<h4 id="查看已安装的应用程序">查看已安装的应用程序</h4>

<p>在你的 Windows 10 桌面上找到任务栏。任务栏里有本实验室中你将使用的应用程序的图标：</p>

<ul>
  <li>Microsoft Edge</li>
  <li>文件资源管理器</li>
  <li>Windows 终端</li>
  <li>Visual Studio Code</li>
</ul>

<h3 id="练习-1创建-azure-资源">练习 1：创建 Azure 资源</h3>

<h4 id="任务-1打开-azure-门户">任务 1：打开 Azure 门户</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Microsoft Edge”</strong> 图标=。</li>
  <li>在打开的浏览器窗口中，导航至 <strong>“Azure 门户”</strong> (<a href="https://portal.azure.com">https://portal.azure.com</a>)。</li>
  <li>输入你的 Microsoft 帐户的电子邮件地址，然后选择 <strong>“下一个”</strong>。</li>
  <li>
    <p>输入你的 Microsoft 帐户<strong>密码</strong>，然后选择 <strong>“登录”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>：第一次登录 Azure 门户时，你会看到一个门户导览。如果想跳过该导览，请选择 <strong>“开始使用”</strong> 以开始使用门户。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2创建-azure-存储帐户">任务 2：创建 Azure 存储帐户</h4>

<ol>
  <li>在 Azure 门户的“导航”窗格中，选择 <strong>“所有服务”</strong>。</li>
  <li>在 <strong>“所有服务”</strong> 边栏选项卡中，选择 <strong>“存储帐户”</strong>。</li>
  <li>在 <strong>“存储帐户”</strong> 边栏选项卡中，找到存储实例列表。</li>
  <li>在“<strong>存储帐户</strong>”边栏选项卡中，选择“<strong>+ 创建</strong>”。</li>
  <li>
    <p>从 <strong>“创建存储帐户”</strong> 边栏选项卡中找到选项卡，例如 <strong>“基本”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>：每个选项卡代表工作流中创建新存储帐户的一个步骤。你可以随时选择“<strong>查看 + 创建</strong>”跳过其余选项卡。</p>
    </blockquote>
  </li>
  <li>在 <strong>“基本信息”</strong> 选项卡中，执行以下操作：
    <ol>
      <li>将 <strong>“订阅”</strong> 文本框保留设置为默认值。</li>
      <li>在 <strong>“资源组”</strong> 部分，选择 <strong>“新建”</strong>，输入 <strong>ConfidentialStack</strong>，然后选择 <strong>“确定”</strong>。</li>
      <li>在 <strong>“存储帐户名称”</strong> 文本框中，输入 <strong>securestor[yourname]</strong>。</li>
      <li>在 <strong>“位置”</strong> 下拉列表中，选择 <strong>“(美国)美国东部”</strong> 区域。</li>
      <li>在 <strong>“性能”</strong> 部分，选择 <strong>“标准”</strong>。</li>
      <li>在 <strong>“冗余”</strong> 下拉列表中，选择 <strong>“本地冗余存储(LRS)”</strong>。</li>
      <li>选择 <strong>“查看 + 创建”</strong>。</li>
    </ol>
  </li>
  <li>在 <strong>“查看 + 创建”</strong> 选项卡中，查看在先前步骤中选择的选项。</li>
  <li>选择 <strong>“创建”</strong>，使用指定的配置创建存储帐户。
    <blockquote>
      <p><strong>备注</strong>：等待创建任务完成，再继续本实验室。</p>
    </blockquote>
  </li>
  <li>在 Azure 门户的“导航”窗格中，选择 <strong>“所有服务”</strong>。</li>
  <li>在 <strong>“所有服务”</strong> 边栏选项卡中，选择 <strong>“存储帐户”</strong>。</li>
  <li>在 <strong>“存储帐户”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>“securestor[yourname]”</strong> 存储帐户。</li>
  <li>在 <strong>“存储账户”</strong> 边栏选项卡中，找到 <strong>“安全性 + 网络”</strong> 部分，然后选择 <strong>“访问密钥”</strong> 链接。</li>
  <li>从“<strong>访问密钥</strong>”边栏选项卡中，选择“<strong>显示密钥</strong>”。</li>
  <li>选择任一密钥，然后记录任一“<strong>连接字符串</strong>”框中的值。你稍后将在本实验室中使用此值。
    <blockquote>
      <p><strong>备注</strong>： 你选择哪个连接字符串无关紧要。它们可以互换。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-3创建-azure-key-vault">任务 3：创建 Azure Key Vault</h4>

<ol>
  <li>在 Azure 门户的导航窗格中，选择到 <strong>“创建资源”</strong> 链接。</li>
  <li>在 <strong>“创建资源”</strong> 边栏选项卡上，找到 <strong>“搜索服务和市场”</strong> 文本框。</li>
  <li>在搜索框中，输入 <strong>Key Vault</strong> 然后按 <strong>Enter</strong>。</li>
  <li>在 <strong>“市场”</strong> 搜索结果边栏选项卡中，选择 <strong>“Key Vault”</strong> 结果。</li>
  <li>在 <strong>“密钥保管库”</strong> 边栏选项卡中，选择 <strong>“创建”</strong>。</li>
  <li>从 <strong>“创建密钥库”</strong> 边栏选项卡中找到各选项卡，例如 <strong>“基本”</strong>。
    <blockquote>
      <p><strong>备注</strong>：每个选项卡都代表在工作流中新建密钥保管库的一个步骤。你可以随时选择 <strong>“查看 + 创建”</strong> 跳过其余选项卡。</p>
    </blockquote>
  </li>
  <li>在 <strong>“基本信息”</strong> 选项卡中，执行以下操作：
    <ol>
      <li>将 <strong>“订阅”</strong> 文本框保留设置为默认值。</li>
      <li>在 <strong>“资源组”</strong> 部分，选择 <strong>“使用现有”</strong>，然后从列表中选择 <strong>“ConfidentialStack”</strong>。</li>
      <li>在 <strong>“密钥保管库名称”</strong> 文本框中，输入 <strong>securevault[yourname]</strong>。</li>
      <li>在 <strong>“区域”</strong> 下拉列表中，选择 <strong>“美国东部”</strong> 地区。</li>
      <li>在 <strong>“定价层”</strong> 下拉列表中，选择 <strong>“标准”</strong>。</li>
      <li>选择 <strong>“查看 + 创建”</strong>。</li>
    </ol>
  </li>
  <li>在 <strong>“查看 + 创建”</strong> 选项卡中，查看在先前步骤中选择的选项。</li>
  <li>选择 <strong>“创建”</strong>，使用指定的配置创建密钥库。
    <blockquote>
      <p><strong>备注</strong>：等待创建任务完成，再继续本实验室。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-4创建-azure-functions-应用">任务 4：创建 Azure Functions 应用</h4>

<ol>
  <li>在 Azure 门户的导航窗格中，选择到 <strong>“创建资源”</strong> 链接。</li>
  <li>在 <strong>“创建资源”</strong> 边栏选项卡上，找到 <strong>“搜索服务和市场”</strong> 文本框。</li>
  <li>在搜索文本框中，输入 <strong>“函数”</strong>，然后按 Enter。</li>
  <li>在 <strong>“市场”</strong> 搜索结果边栏选项卡中，选择 <strong>“函数应用”</strong> 结果。</li>
  <li>在 <strong>“函数应用”</strong> 边栏选项卡中，选择 <strong>“创建”</strong>。</li>
  <li>从 <strong>“函数应用”</strong> 边栏选项卡中找到各选项卡，例如 <strong>“基本信息”</strong>。
    <blockquote>
      <p><strong>备注</strong>： 每个选项卡都代表在工作流中新建函数应用的一个步骤。你可以随时选择 <strong>“查看 + 创建”</strong> 跳过其余选项卡。</p>
    </blockquote>
  </li>
  <li>在 <strong>“基本信息”</strong> 选项卡中，执行以下操作：
    <ol>
      <li>将 <strong>“订阅”</strong> 文本框保留设置为默认值。</li>
      <li>在 <strong>“资源组”</strong> 部分，选择 <strong>“使用现有”</strong>，然后从列表中选择 <strong>“ConfidentialStack”</strong>。</li>
      <li>在 <strong>“函数应用名称”</strong> 文本框中，输入 <strong>securefunc[yourname]</strong>。</li>
      <li>在 <strong>“发布”</strong> 部分，选择 <strong>“代码”</strong>。</li>
      <li>在 <strong>“运行时堆栈”</strong> 下拉列表中，选择 <strong>“.NET”</strong>。</li>
      <li>在 <strong>“版本”</strong> 下拉列表中，选择 <strong>“3.1”</strong>。</li>
      <li>在 <strong>“区域”</strong> 下拉列表中，选择 <strong>“美国东部”</strong> 区域。</li>
      <li>选择“下一步:<strong>承载</strong>。</li>
    </ol>
  </li>
  <li>在 <strong>“托管”</strong> 选项卡中，执行以下操作：
    <ol>
      <li>在 <strong>“存储帐户”</strong> 下拉列表中，选择你之前在本实验室中创建的 <strong>“securestor[yourname]”</strong> 存储帐户。</li>
      <li>在“<strong>操作系统</strong>”部分，选择“<strong>Linux</strong>”。</li>
      <li>在 <strong>“计划类型”</strong> 下拉列表中，选择 <strong>“消耗(无服务器)”</strong> 选项。</li>
      <li>选择“<strong>查看 + 创建</strong>”。</li>
    </ol>
  </li>
  <li>在 <strong>“查看 + 创建”</strong> 选项卡中，查看在先前步骤中选择的选项。</li>
  <li>选择 <strong>“创建”</strong>，使用指定的配置创建函数应用。
    <blockquote>
      <p><strong>备注</strong>： 等待创建任务完成，再继续本实验室。</p>
    </blockquote>
  </li>
</ol>

<blockquote>
  <p><strong>回顾</strong>： 在本练习中，你创建了本实验室所需的所有资源。</p>
</blockquote>

<h3 id="练习-2配置机密和标识">练习 2：配置机密和标识</h3>

<h4 id="任务-1配置系统分配的托管服务标识">任务 1：配置系统分配的托管服务标识</h4>

<ol>
  <li>在 Azure 门户的“导航”窗口，选择 <strong>“资源组”</strong> 链接。</li>
  <li>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择之前在本实验室中创建的 <strong>“ConfidentialStack”</strong> 资源组。</li>
  <li>在 <strong>“ConfidentialStack”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>“securefunc[yourname]”</strong> 函数应用。
    <blockquote>
      <p><strong>备注</strong>： 将有两个资源；即函数应用资源和应用程序见解资源，两者的名称相同。确保选择函数应用资源。</p>
    </blockquote>
  </li>
  <li>在 <strong>“函数应用”</strong> 边栏选项卡中，从 <strong>“设置”</strong> 部分选择 <strong>“标识”</strong> 选项。</li>
  <li>在 <strong>“标识”</strong> 窗格中，找到 <strong>“系统分配”</strong> 选项卡，然后执行以下操作：
    <ol>
      <li>在 <strong>“状态”</strong> 部分，选择 <strong>“开启”</strong>，然后选择 <strong>“保存”</strong>。</li>
      <li>在确认对话框中，选择 <strong>“是”</strong>。
        <blockquote>
          <p><strong>备注</strong>： 等待系统分配的托管标识创建完成后再继续本实验室。</p>
        </blockquote>
      </li>
    </ol>
  </li>
</ol>

<h4 id="任务-2创建密钥保管库机密">任务 2：创建密钥保管库机密</h4>

<ol>
  <li>在 Azure 门户的“导航”窗口，选择 <strong>“资源组”</strong> 链接。</li>
  <li>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择之前在本实验室中创建的 <strong>“ConfidentialStack”</strong> 资源组。</li>
  <li>在 <strong>“ConfidentialStack”</strong> 边栏选项卡中，选择你之前在本实验室中创建的 <strong>“securevault[yourname]”</strong> 密钥保管库。</li>
  <li>在 <strong>“Key Vault”</strong> 边栏选项卡中，选择 <strong>“设置”</strong> 部分中的 <strong>“机密”</strong> 链接。</li>
  <li>在“<strong>机密</strong>”窗格中，选择“<strong>+ 生成/导入</strong>”。</li>
  <li>在 <strong>“创建机密”</strong> 边栏选项卡中，执行以下操作：
    <ol>
      <li>在 <strong>“上传选项”</strong> 下拉列表中，选择 <strong>“手动”</strong>。</li>
      <li>在 <strong>“名称”</strong> 文本框中，输入 <strong>“storagecredentials”</strong>。</li>
      <li>在 <strong>“值”</strong> 文本框中，输入之前在本实验室中记录的存储帐户连接字符串。</li>
      <li>将 <strong>“内容类型”</strong> 文本框保留设置为默认值。</li>
      <li>将 <strong>“设置激活日期”</strong> 文本框保留设置为默认值。</li>
      <li>将 <strong>“设置到期日期”</strong> 文本框保留设置为默认值。</li>
      <li>在 <strong>“已启用”</strong> 部分，选择 <strong>“是”</strong>，然后选择 <strong>“创建”</strong>。
        <blockquote>
          <p><strong>备注</strong>： 等待机密创建完成后再继续本实验室。</p>
        </blockquote>
      </li>
    </ol>
  </li>
  <li>返回“机密”窗格，选择列表中的 <strong>“storagecredentials”</strong> 项。</li>
  <li>在“版本”窗格中，选择最新版本的 <strong>“storagecredentials”</strong> 机密。</li>
  <li>在“机密版本”窗格中，执行以下操作：
    <ol>
      <li>找到最新版本机密的元数据。</li>
      <li>选择 <strong>“显示机密值”</strong>，可以找到机密的值。</li>
      <li>记录 <strong>“机密标识符”</strong> 文本框的值，稍后将在本实验室中用到。
        <blockquote>
          <p><strong>备注</strong>： 你将记录 <strong>“机密标识符”</strong> 文本框中的值，而不是 <strong>“机密值”</strong> 文本框中的值。</p>
        </blockquote>
      </li>
    </ol>
  </li>
</ol>

<h4 id="任务-3配置密钥保管库访问策略">任务 3：配置密钥保管库访问策略</h4>

<ol>
  <li>在 Azure 门户的“导航”窗口，选择 <strong>“资源组”</strong> 链接。</li>
  <li>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择之前在本实验室中创建的 <strong>“ConfidentialStack”</strong> 资源组。</li>
  <li>在 <strong>“ConfidentialStack”</strong> 边栏选项卡中，选择你之前在本实验室中创建的 <strong>“securevault[yourname]”</strong> 密钥保管库。</li>
  <li>在 <strong>“Key Vault”</strong> 边栏选项卡中，选择 <strong>“设置”</strong> 部分中的 <strong>“访问策略”</strong> 链接。</li>
  <li>在“访问策略”窗格中，选择 <strong>“添加访问策略”</strong>。</li>
  <li>在 <strong>“添加访问策略”</strong> 边栏选项卡中，执行以下操作：
    <ol>
      <li>选择 <strong>“选择主体”</strong> 链接。</li>
      <li>在 <strong>“主体”</strong> 边栏选项卡中，找到并选择名为 <strong>“securefunc[yourname]”</strong> 的服务主体，然后选择 <strong>“选择”</strong>。
        <blockquote>
          <p><strong>注意</strong>： 你之前在本实验室中创建的系统分配的托管标识将与 Azure Function 资源具有相同的名称。</p>
        </blockquote>
      </li>
      <li>将 <strong>“密钥权限”</strong> 列表保留设置为默认值。</li>
      <li>在 <strong>“机密权限”</strong> 下拉列表中，选择 <strong>“GET”</strong> 权限。</li>
      <li>将 <strong>“证书权限”</strong> 列表保留设置为默认值。</li>
      <li>将 <strong>“授权应用程序”</strong> 文本框保留设置为默认值。</li>
      <li>选择 <strong>“添加”</strong>。</li>
    </ol>
  </li>
  <li>返回”访问策略”窗格，选择 <strong>“保存”</strong>。
    <blockquote>
      <p><strong>备注</strong>： 等待访问策略更改保存后再继续本实验室。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-4创建密钥保管库派生的应用程序设置">任务 4：创建密钥保管库派生的应用程序设置</h4>

<ol>
  <li>在 Azure 门户的“导航”窗口，选择 <strong>“资源组”</strong> 链接。</li>
  <li>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择之前在本实验室中创建的 <strong>“ConfidentialStack”</strong> 资源组。</li>
  <li>在 <strong>“ConfidentialStack”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>“securefunc[yourname]”</strong> 函数应用。</li>
  <li>在 <strong>“应用服务”</strong> 边栏选项卡中，选择 <strong>“设置”</strong> 部分中的 <strong>“配置”</strong> 选项。</li>
  <li>在 <strong>“配置”</strong> 窗格中，执行以下操作：
    <ol>
      <li>选择 <strong>“应用程序设置”</strong> 选项卡，然后选择 <strong>“新应用程序设置”</strong>。</li>
      <li>在出现的 <strong>“添加/编辑应用程序设置”</strong> 弹出窗口中，在 <strong>“名称”</strong> 字段，输入 <strong>“StorageConnectionString”</strong>。</li>
      <li>在 <strong>“输入值”</strong> 文本框中，使用下列语法构造一个值： <code>@Microsoft.KeyVault(SecretUri=*Secret Identifier*)</code>
        <blockquote>
          <p><strong>备注</strong>： 你需要使用以上语法构建对 Secret Identifier 的引用。例如，如果机密标识符为 <code>https://securevaultstudent.vault.azure.net/secrets/storagecredentials/17b41386df3e4191b92f089f5efb4cbf</code>，则值应为 <code>@Microsoft.KeyVault(SecretUri=https://securevaultstudent.vault.azure.net/secrets/storagecredentials/17b41386df3e4191b92f089f5efb4cbf)</code>。</p>
        </blockquote>
      </li>
      <li>将 <strong>“部署槽位设置”</strong> 文本框保留设置为默认值。</li>
      <li>选择 <strong>“确定”</strong> 关闭弹出窗口并返回到 <strong>“配置”</strong> 部分。</li>
      <li>在边栏选项卡选择 <strong>“保存”</strong> 以保存设置。</li>
      <li>在 <strong>“保存更改”</strong> 确认弹出对话框中，选择 <strong>“继续”</strong>。
        <blockquote>
          <p><strong>备注</strong>： 等待应用程序设置保存后再继续本实验室。</p>
        </blockquote>
      </li>
    </ol>
  </li>
</ol>

<blockquote>
  <p><strong>回顾</strong>： 在本练习中，你为函数应用创建了系统分配的托管服务标识，然后为该标识提供了相应的权限，以获取密钥保管库中的机密值。最后，你创建了函数应用的配置设置中所引用的机密。</p>
</blockquote>

<h3 id="练习-3生成-azure-functions-应用">练习 3：生成 Azure Functions 应用</h3>

<h4 id="任务-1初始化函数项目">任务 1：初始化函数项目</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令然后按 Enter，以将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\07\Starter\func
</code></pre>
  </li>
  <li>
    <p>在打开的命令提示符处，输入以下命令然后按 Enter，以使用 <strong>Azure Functions Core Tools</strong> 在当前目录中创建使用 <strong>dotnet</strong> 运行时的新本地 Functions 项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="language-powershell"> func init --worker-runtime dotnet --force
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 可以查看文档以使用 <strong>Azure Functions Core Tools</strong> [创建新项目][azure-functions-core-tools-new-project]。</p>
    </blockquote>
  </li>
  <li>
    <p>输入以下命令然后按 Enter，以<strong>生成</strong> .NET Core 3.1 项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="language-powershell"> dotnet build
</code></pre>
  </li>
</ol>

<h4 id="任务-2创建-http-触发的函数">任务 2：创建 HTTP 触发的函数</h4>

<ol>
  <li>
    <p>同样在打开的命令提示符处，输入以下命令然后按 Enter，以使用 <strong>Azure Functions Core Tools</strong> 创建使用 <strong>HTTP 触发</strong>模板的新函数（名为 <strong>“FileParser”</strong>）：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="language-powershell"> func new --template "HTTP trigger" --name "FileParser"
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 可以查看文档以使用 <strong>Azure Functions Core Tools</strong> [创建新函数][azure-functions-core-tools-new-function]。</p>
    </blockquote>
  </li>
  <li>
    <p>关闭当前正在运行的 <strong>“Windows 终端”</strong> 应用程序。</p>
  </li>
</ol>

<h4 id="任务-3配置和读取应用程序设置">任务 3：配置和读取应用程序设置</h4>

<ol>
  <li>在 <strong>“启动”</strong> 屏幕上，选择 <strong>“Visual Studio Code”</strong> 磁贴。</li>
  <li>在 <strong>“文件”</strong> 菜单上，选择 <strong>“打开文件夹”</strong>。</li>
  <li>在打开的 <strong>“文件资源管理器”</strong> 窗口中，浏览到 <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong>，然后选择 <strong>“选择文件夹”</strong>。</li>
  <li>在 <strong>“Visual Studio Code”</strong> 窗口的 <strong>“资源管理器”</strong> 窗格中，打开 <strong>local.settings.json</strong> 文件。</li>
  <li>
    <p>查看 <strong>Values</strong> 对象的当前值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="language-json hljs"> <span class="hljs-string"><span class="hljs-string">"Values"</span></span>: {
     <span class="hljs-attr"><span class="hljs-attr">"AzureWebJobsStorage"</span></span>: <span class="hljs-string"><span class="hljs-string">"UseDevelopmentStorage=true"</span></span>,
     <span class="hljs-attr"><span class="hljs-attr">"FUNCTIONS_WORKER_RUNTIME"</span></span>: <span class="hljs-string"><span class="hljs-string">"dotnet"</span></span>
 }
</code></pre>
  </li>
  <li>
    <p>通过添加名为 <strong>StorageConnectionString</strong> 的新设置并将其设置为 <strong>[TEST VALUE]</strong> 的字符串值来更新 <strong>Values</strong> 对象的值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="language-json hljs"> <span class="hljs-string"><span class="hljs-string">"Values"</span></span>: {
     <span class="hljs-attr"><span class="hljs-attr">"AzureWebJobsStorage"</span></span>: <span class="hljs-string"><span class="hljs-string">"UseDevelopmentStorage=true"</span></span>,
     <span class="hljs-attr"><span class="hljs-attr">"FUNCTIONS_WORKER_RUNTIME"</span></span>: <span class="hljs-string"><span class="hljs-string">"dotnet"</span></span>,
     <span class="hljs-attr"><span class="hljs-attr">"StorageConnectionString"</span></span>: <span class="hljs-string"><span class="hljs-string">"[TEST VALUE]"</span></span>
 }
</code></pre>
  </li>
  <li>
    <p><strong>Local.settings.json</strong> 文件现应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="language-json hljs"> {
     <span class="hljs-attr"><span class="hljs-attr">"IsEncrypted"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>,
     <span class="hljs-attr"><span class="hljs-attr">"Values"</span></span>: {
         <span class="hljs-attr"><span class="hljs-attr">"AzureWebJobsStorage"</span></span>: <span class="hljs-string"><span class="hljs-string">"UseDevelopmentStorage=true"</span></span>,
         <span class="hljs-attr"><span class="hljs-attr">"FUNCTIONS_WORKER_RUNTIME"</span></span>: <span class="hljs-string"><span class="hljs-string">"dotnet"</span></span>,
         <span class="hljs-attr"><span class="hljs-attr">"StorageConnectionString"</span></span>: <span class="hljs-string"><span class="hljs-string">"[TEST VALUE]"</span></span>
     }
 }
</code></pre>
  </li>
  <li>在 <strong>“Visual Studio Code”</strong> 窗口的“资源管理器”窗格中，打开 <strong>FileParser.cs</strong> 文件。</li>
  <li>
    <p>在代码编辑器中，观察示例实现：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Azure.WebJobs.Extensions.Http;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Extensions.Logging;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Newtonsoft.Json;

 <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">func</span></span>
 {
     <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FileParser</span></span>
     {
         [<span class="hljs-meta"><span class="hljs-meta">FunctionName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"FileParser"</span></span></span><span class="hljs-meta">)</span></span>]
         <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">
             [HttpTrigger(AuthorizationLevel.Function, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"get"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"post"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Route = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)] HttpRequest req,
             ILogger log)
         </span></span>{
             log.LogInformation(<span class="hljs-string"><span class="hljs-string">"C# HTTP trigger function processed a request."</span></span>);

             <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name = req.Query[<span class="hljs-string"><span class="hljs-string">"name"</span></span>];

             <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> requestBody = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(req.Body).ReadToEndAsync();
             <span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span> data = JsonConvert.DeserializeObject(requestBody);
             name = name ?? data?.name;

             <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> responseMessage = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(name)
                 ? <span class="hljs-string"><span class="hljs-string">"This HTTP triggered function executed successfully. Pass a name in the query string or in the request body for a personalized response."</span></span>
                 : <span class="hljs-string"><span class="hljs-string">$"Hello, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string">. This HTTP triggered function executed successfully."</span></span>;

             <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkObjectResult(responseMessage);
         }
     }
 }
</code></pre>
  </li>
  <li>删除 <strong>FileParser.cs</strong> 文件中的所有内容。</li>
  <li>
    <p>添加以下代码行，为 <strong>Microsoft.AspNetCore.Mvc</strong>、 <strong>Microsoft.Azure.WebJobs</strong>、 <strong>Microsoft.AspNetCore.Http</strong>、 <strong>System</strong> 和 <strong>System.Threading.Tasks</strong> 命名空间添加 <strong>using 指令</strong>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock8" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock8" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks;
</code></pre>
  </li>
  <li>
    <p>创建名为 <strong>FileParser</strong> 的新<strong>公共静态类</strong>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock9" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock9" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FileParser</span></span>
 { }
</code></pre>
  </li>
  <li>
    <p>再次查看 <strong>FileParser.cs</strong> 文件，该文件现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock10" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock10" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks;

 <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FileParser</span></span>
 { }
</code></pre>
  </li>
  <li>
    <p>在 <strong>FileParser</strong> 类中，添加以下代码块，创建名为 <strong>Run</strong> 的新<strong>公共</strong>静态<strong>异步</strong>方法，该方法返回类型为 <strong>Task&lt;IActionResult&gt;</strong> 的变量，并且还采用类型为 <strong>HttpRequest</strong> 的变量 <em>request</em>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock11" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock11" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">
     HttpRequest request</span></span></span><span class="hljs-function">)
 </span></span>{ }
</code></pre>
  </li>
  <li>
    <p>添加以下代码，将属性追加到类型为 <strong>FunctionNameAttribute</strong> 的 <strong>Run</strong> 方法中，该方法的 <strong>name</strong> 参数设置为 <strong>FileParser</strong> 的值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock12" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock12" class="mt-0"><code class="language-csharp hljs"> [<span class="hljs-meta"><span class="hljs-meta">FunctionName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"FileParser"</span></span></span><span class="hljs-meta">)</span></span>]
 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">
     HttpRequest request</span></span></span><span class="hljs-function">)
 </span></span>{ }
</code></pre>
  </li>
  <li>
    <p>添加以下代码，将属性追加到类型为 <strong>HttpTriggerAttribute</strong> 的 <strong>request</strong> 参数，该参数的 <strong>methods</strong> 参数数组设置为 <strong>GET</strong> 的一个值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock13" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock13" class="mt-0"><code class="language-csharp hljs"> [<span class="hljs-meta"><span class="hljs-meta">FunctionName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"FileParser"</span></span></span><span class="hljs-meta">)</span></span>]
 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">
     [HttpTrigger(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"GET"</span></span></span></span></span><span class="hljs-function">)] HttpRequest request)
 </span></span>{ }
</code></pre>
  </li>
  <li>
    <p>再次查看 <strong>FileParser.cs</strong> 文件，该文件现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock14" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock14" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks;

 <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FileParser</span></span>
 {
     [<span class="hljs-meta"><span class="hljs-meta">FunctionName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"FileParser"</span></span></span><span class="hljs-meta">)</span></span>]
     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">
         [HttpTrigger(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"GET"</span></span></span></span></span><span class="hljs-function">)] HttpRequest request)
     </span></span>{ }
 }
</code></pre>
  </li>
  <li>
    <p>在 <strong>Run</strong> 方法中输入以下代码行，通过使用 <strong>Environment.GetEnvironmentVariable</strong> 方法并将结果存储在名为 <strong>connectionString</strong> 的字符串变量中来检索 <strong>StorageConnectionString</strong> 应用程序设置的值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock15" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock15" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> connectionString = Environment.GetEnvironmentVariable(<span class="hljs-string"><span class="hljs-string">"StorageConnectionString"</span></span>);
</code></pre>
  </li>
  <li>
    <p>输入以下代码行以将 <strong>connectionString</strong> 变量的值作为 HTTP 响应返回：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock16" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock16" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkObjectResult(connectionString);
</code></pre>
  </li>
  <li>
    <p>再次查看 <strong>FileParser.cs</strong> 文件，该文件现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock17" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock17" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks;

 <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FileParser</span></span>
 {
     [<span class="hljs-meta"><span class="hljs-meta">FunctionName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"FileParser"</span></span></span><span class="hljs-meta">)</span></span>]
     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">
         [HttpTrigger(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"GET"</span></span></span></span></span><span class="hljs-function">)] HttpRequest request)
     </span></span>{
         <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> connectionString = Environment.GetEnvironmentVariable(<span class="hljs-string"><span class="hljs-string">"StorageConnectionString"</span></span>);
         <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkObjectResult(connectionString);
     }
 }
</code></pre>
  </li>
  <li>选择 <strong>“保存”</strong> 以保存对 <strong>FileParser.cs</strong> 文件的更改。</li>
</ol>

<h4 id="任务-4验证本地函数">任务 4：验证本地函数</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令然后按 Enter，以将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock18" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock18" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\07\Starter\func
</code></pre>
  </li>
  <li>
    <p>在打开的命令提示符处，输入以下命令然后按 Enter，以运行函数应用项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock19" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock19" class="mt-0"><code class="language-powershell"> func start --build
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 可以查看文档以使用 Azure Functions Core Tools [在本地启动函数应用项目][azure-functions-core-tools-start-function]。</p>
    </blockquote>
  </li>
  <li>在任务栏上再次选择 <strong>“Windows 终端”</strong> 图标以打开 <strong>“Windows 终端”</strong> 应用程序的新实例。</li>
  <li>
    <p>系统显示打开的命令提示符时，输入以下命令然后按 Enter，以启动 <strong>httprepl</strong> 工具，将基本统一资源标识符 (URI) 设置为 <code>http://localhost:7071</code>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock20" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock20" class="mt-0"><code class="language-powershell"> httprepl http://localhost:7071
</code></pre>

    <blockquote>
      <p><strong>备注</strong>：httprepl 工具会显示一条错误消息。出现此消息的原因是该工具正在搜索用于“遍历”API 的 Swagger 定义文件。由于函数项目不会生成 Swagger 定义文件，因此你需要手动遍历该 API。</p>
    </blockquote>
  </li>
  <li>
    <p>系统显示命令提示符时，输入以下命令然后按 Enter，以浏览到相关的 <strong>api</strong> 目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock21" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock21" class="mt-0"><code class="language-powershell"> cd api
</code></pre>
  </li>
  <li>
    <p>输入以下命令然后按 Enter，以浏览到相关的 <strong>fileparser</strong> 目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock22" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock22" class="mt-0"><code class="language-powershell"> cd fileparser
</code></pre>
  </li>
  <li>
    <p>输入以下命令然后按 Enter，以运行 <strong>get</strong> 命令：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock23" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock23" class="mt-0"><code class="language-powershell"> get
</code></pre>
  </li>
  <li>
    <p>查看作为 HTTP 请求结果返回的 <strong>StorageConnectionString</strong> 的 <strong>[TEST VALUE]</strong> 值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock24" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock24" class="mt-0"><code class="language-powershell"> HTTP/1.1 200 OK
 Content-Type: text/plain; charset=utf-8
 Date: Tue, 01 Sep 2020 23:35:39 GMT
 Server: Kestrel
 Transfer-Encoding: chunked

 [TEST VALUE]

</code></pre>
  </li>
  <li>
    <p>输入以下命令，然后按 Enter 退出 <strong>“httprepl”</strong> 应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock25" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock25" class="mt-0"><code class="language-powershell"> exit
</code></pre>
  </li>
  <li>关闭 <strong>“Windows 终端”</strong> 应用程序上所有当前运行的实例。</li>
</ol>

<h4 id="任务-5使用-azure-functions-core-tools-进行部署">任务 5：使用 Azure Functions Core Tools 进行部署</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令然后按 Enter，以将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock26" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock26" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\07\Starter\func
</code></pre>
  </li>
  <li>
    <p>在打开的命令提示符处，输入以下命令然后按 Enter，以登录 Azure 命令行接口 (CLI)：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock27" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock27" class="mt-0"><code class="language-powershell"> az login
</code></pre>
  </li>
  <li>在 <strong>Microsoft Edge</strong> 浏览器窗口中，执行以下操作：
    <ol>
      <li>输入你的 Microsoft 帐户的电子邮件地址，然后选择 <strong>“下一个”</strong>。</li>
      <li>输入你的 Microsoft 帐户的密码，然后选择 <strong>“登录”</strong>。</li>
    </ol>
  </li>
  <li>返回当前打开的 <strong>“Windows 终端”</strong> 窗口。等待登录过程完成。</li>
  <li>
    <p>输入以下命令，然后按 Enter 发布函数应用项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock28" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock28" class="mt-0"><code class="language-powershell"> func azure functionapp publish &lt;function-app-name&gt;
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 例如，如果<strong>函数应用名称</strong>为 <strong>funclogicstudent</strong>， 则命令将为 <code>func azure functionapp publish funclogicstudent</code>。可以查看文档以使用 <strong>Azure Functions Core Tools</strong> [发布本地函数应用项目][azure-functions-core-tools-publish-azure]。</p>
    </blockquote>
  </li>
  <li>等待部署完成后，再继续本实验室。</li>
  <li>关闭当前正在运行的 <strong>“Windows 终端”</strong> 应用程序。</li>
</ol>

<h4 id="任务-6测试密钥保管库派生的应用程序设置">任务 6：测试密钥保管库派生的应用程序设置</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Microsoft Edge”</strong> 图标。</li>
  <li>在打开的浏览器窗口中，转到 Azure 门户 (<a href="https://portal.azure.com">https://portal.azure.com</a>)。</li>
  <li>在 Azure 门户的“导航”窗格中，选择 <strong>“资源组”</strong> 链接。</li>
  <li>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择之前在本实验室中创建的 <strong>“ConfidentialStack”</strong> 资源组。</li>
  <li>在 <strong>“ConfidentialStack”</strong> 边栏选项卡上，选择之前在本实验室中创建的 <strong>“securefunc[yourname]”</strong> 函数应用。</li>
  <li>在 <strong>“应用服务”</strong> 边栏选项卡中，从 <strong>“函数”</strong> 部分选择 <strong>“函数”</strong> 选项。</li>
  <li>在 <strong>“函数”</strong> 窗格中选择现有的 <strong>“FileParser”</strong> 函数。</li>
  <li>在 <strong>“函数”</strong> 边栏选项卡中，从 <strong>“开发人员”</strong> 部分选择 <strong>“代码 + 测试”</strong> 选项。</li>
  <li>在函数编辑器中，选择 <strong>“测试/运行”</strong>。</li>
  <li>在显示的弹出对话框中，执行以下操作：
    <ul>
      <li>在 <strong>“HTTP 方法”</strong> 列表中，选择 <strong>“GET”</strong>。</li>
    </ul>
  </li>
  <li>选择 <strong>“运行”</strong> 以测试函数。</li>
  <li>观察运行测试的结果。结果应为 Azure 存储连接字符串。</li>
</ol>

<blockquote>
  <p><strong>回顾</strong>： 在本练习中，你使用了服务标识来读取存储在 Key Vault 中的机密值，并返回该值作为函数应用的结果。</p>
</blockquote>

<h3 id="练习-4访问-azure-blob-存储数据">练习 4：访问 Azure Blob 存储数据</h3>

<h4 id="任务-1上传示例存储-blob">任务 1：上传示例存储 blob</h4>

<ol>
  <li>在 Azure 门户的“导航”窗口，选择 <strong>“资源组”</strong> 链接。</li>
  <li>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择之前在本实验室中创建的 <strong>“ConfidentialStack”</strong> 资源组。</li>
  <li>在 <strong>“ConfidentialStack”</strong> 边栏选项卡中，选择之前在本实验室中创建的 <strong>“securestor[yourname]”</strong> 存储帐户。</li>
  <li>从 <strong>“存储帐户”</strong> 边栏选项卡中，选择 <strong>“数据存储”</strong> 部分中的 <strong>“容器”</strong> 链接。</li>
  <li>在 <strong>“容器”</strong> 部分，选择 <strong>“+ 容器”</strong>。</li>
  <li>在 <strong>“新建容器”</strong> 弹出窗口中，执行以下操作：
    <ol>
      <li>在 <strong>“名称”</strong> 文本框中，输入 <strong>“drop”</strong>。</li>
      <li>从 <strong>“公共访问级别”</strong> 下拉列表中，选择 <strong>“Blob (仅限 Blob 的匿名读取访问)”</strong>， 然后选择 <strong>“创建”</strong>。</li>
    </ol>
  </li>
  <li>返回 <strong>“容器”</strong> 部分，然后选择新创建的 <strong>drop</strong> 容器。</li>
  <li>在 <strong>“容器”</strong> 边栏选项卡中，选择 <strong>“上传”</strong>。</li>
  <li>在 <strong>“上传 blob”</strong> 弹出窗口中，执行以下操作：
    <ol>
      <li>在 <strong>“文件”</strong> 部分，选择 <strong>“文件夹”</strong> 图标。</li>
      <li>在 <strong>“文件资源管理器”</strong> 窗口中，浏览到 <strong>“Allfiles (F):\Allfiles\Labs\07\Starter”</strong>，选择 <strong>“records.json”</strong> 文件，然后选择 <strong>“打开”</strong>。</li>
      <li>确保 <strong>“如果文件已存在，则覆盖”</strong> 已选中，然后选择 <strong>“上传”</strong>。
        <blockquote>
          <p><strong>备注</strong>：等待 Blob 上传完成，然后再继续本实验室。</p>
        </blockquote>
      </li>
    </ol>
  </li>
  <li>返回 <strong>“容器”</strong> 边栏选项卡，选择 Blob 列表中的 <strong>“records.json”</strong> Blob。</li>
  <li>在 <strong>“blob”</strong> 边栏选项卡中，找到 blob 元数据，然后复制该 blob 的 URL。</li>
  <li>在任务栏上，右键选择 <strong>“Microsoft Edge”</strong> 图标或激活快捷菜单，然后选择 <strong>“新窗口”</strong>。</li>
  <li>在新的浏览器窗口中，前往你为 blob 复制的 URL。</li>
  <li>现在应该显示 Blob 的 JavaScript 对象表示法 (JSON) 内容。关闭显示 JSON 内容的浏览器窗口。</li>
  <li>返回显示 Azure 门户的浏览器窗口，然后关闭 <strong>“Blob”</strong> 边栏选项卡。</li>
  <li>返回 <strong>“容器”</strong> 边栏选项卡，然后选择 <strong>“更改访问级别”</strong>。</li>
  <li>在 <strong>“更改访问级别”</strong> 弹出窗口中，执行以下操作：
    <ol>
      <li>在 <strong>“公共访问级别”</strong> 下拉列表中，选择 <strong>“专用(非匿名访问)”</strong>。</li>
      <li>选择 <strong>“确定”</strong>。</li>
    </ol>
  </li>
  <li>在任务栏上，右键选择 <strong>“Microsoft Edge”</strong> 图标或激活快捷菜单，然后选择 <strong>“新窗口”</strong>。</li>
  <li>在新的浏览器窗口中，前往你为 blob 复制的 URL。</li>
  <li>现在应该显示一条表示未找到资源的错误消息。
    <blockquote>
      <p><strong>备注</strong>：如果没有显示该错误消息，则浏览器可能缓存了该文件。按 Ctrl+F5 刷新页面，直到出现错误提示。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2请求并配置用于-net-的-azure-sdk">任务 2：请求并配置用于 .NET 的 Azure SDK</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令然后按 Enter，以将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock29" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock29" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\07\Starter\func
</code></pre>
  </li>
  <li>
    <p>在打开的命令提示符处，输入以下命令然后按 Enter，以从 NuGet 添加 <strong>12.6.0</strong> 版本的 <strong>Azure.Storage.Blobs</strong> 包：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock30" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock30" class="mt-0"><code class="language-powershell"> dotnet add package Azure.Storage.Blobs --version 12.6.0
</code></pre>

    <blockquote>
      <p><strong>备注</strong>：<a href="https://www.nuget.org/packages/Azure.Storage.Blobs/12.6.0">Azure.Storage.Blobs</a> NuGet 包引用为 Azure Blob 存储编写代码所需的用于 .NET 的 Azure SDK 的子集。</p>
    </blockquote>
  </li>
  <li>关闭当前正在运行的 <strong>“Windows 终端”</strong> 应用程序。</li>
  <li>在 <strong>“启动”</strong> 屏幕上，选择 <strong>“Visual Studio Code”</strong> 磁贴。</li>
  <li>在 <strong>“文件”</strong> 菜单上，选择 <strong>“打开文件夹”</strong>。</li>
  <li>在打开的 <strong>“文件资源管理器”</strong> 窗口中，浏览到 <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong>，然后选择 <strong>“选择文件夹”</strong>。</li>
  <li>在 <strong>“Visual Studio Code”</strong> 窗口的 <strong>“资源管理器”</strong> 窗格中，打开 <strong>FileParser.cs</strong> 文件。</li>
  <li>
    <p>为 <strong>Azure.Storage.Blobs</strong> 命名空间添加 <strong>using 指令</strong>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock31" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock31" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Azure.Storage.Blobs;
</code></pre>
  </li>
  <li>
    <p>查看 <strong>FileParser.cs</strong> 文件，该文件现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock32" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock32" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Azure.Storage.Blobs;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks;

 <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FileParser</span></span>
 {
     [<span class="hljs-meta"><span class="hljs-meta">FunctionName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"FileParser"</span></span></span><span class="hljs-meta">)</span></span>]
     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">
         [HttpTrigger(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"GET"</span></span></span></span></span><span class="hljs-function">)] HttpRequest request)
     </span></span>{
         <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> connectionString = Environment.GetEnvironmentVariable(<span class="hljs-string"><span class="hljs-string">"StorageConnectionString"</span></span>);
         <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkObjectResult(connectionString);
     }
 }
</code></pre>
  </li>
</ol>

<h4 id="任务-3使用用于-net-的-azure-sdk-编写-azure-blob-存储代码">任务 3：使用用于 .NET 的 Azure SDK 编写 Azure Blob 存储代码</h4>

<ol>
  <li>
    <p>在 <strong>FileParser</strong> 类的 <strong>Run</strong> 方法中，删除以下代码行：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock33" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock33" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkObjectResult(connectionString);
</code></pre>
  </li>
  <li>
    <p>同样是在 <strong>Run</strong> 方法中，添加以下代码块，通过将 <em>connectionString</em> 变量、<code>"drop"</code> 字符串值和 <code>"records.json"</code> 字符串值传递给构造函数来创建 <strong>BlobClient</strong> 类的新实例：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock34" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock34" class="mt-0"><code class="language-csharp hljs"> BlobClient blob = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BlobClient(connectionString, <span class="hljs-string"><span class="hljs-string">"drop"</span></span>, <span class="hljs-string"><span class="hljs-string">"records.json"</span></span>);
</code></pre>
  </li>
  <li>
    <p>同样是在 <strong>Run</strong> 方法中，添加以下代码块，使用 <strong>BlobClient.DownloadAsync</strong> 方法异步下载引用的 Blob 的内容，并将结果存储在名为 <em>response</em> 的变量中：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock35" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock35" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> blob.DownloadAsync();
</code></pre>
  </li>
  <li>
    <p>同样是在 <strong>Run</strong> 方法中，添加以下代码块，使用 <strong>FileStreamResult</strong> 类构造函数返回存储在 <em>content</em> 变量中的各种内容的值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock36" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock36" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStreamResult(response?.Value?.Content, response?.Value?.ContentType);
</code></pre>
  </li>
  <li>
    <p>再次查看 <strong>FileParser.cs</strong> 文件，该文件现在应包括：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock37" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock37" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Azure.Storage.Blobs;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Mvc;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Azure.WebJobs;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Http;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System;
 <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks;

 <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FileParser</span></span>
 {
     [<span class="hljs-meta"><span class="hljs-meta">FunctionName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"FileParser"</span></span></span><span class="hljs-meta">)</span></span>]
     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">
         [HttpTrigger(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"GET"</span></span></span></span></span><span class="hljs-function">)] HttpRequest request)
     </span></span>{
         <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> connectionString = Environment.GetEnvironmentVariable(<span class="hljs-string"><span class="hljs-string">"StorageConnectionString"</span></span>);
         BlobClient blob = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BlobClient(connectionString, <span class="hljs-string"><span class="hljs-string">"drop"</span></span>, <span class="hljs-string"><span class="hljs-string">"records.json"</span></span>);
         <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> blob.DownloadAsync();
         <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStreamResult(response?.Value?.Content, response?.Value?.ContentType);
     }
 }
</code></pre>
  </li>
  <li>
    <p>选择 <strong>“保存”</strong> 以保存对 <strong>FileParser.cs</strong> 文件的更改。</p>
  </li>
</ol>

<h4 id="任务-4部署和验证-azure-functions-应用">任务 4：部署和验证 Azure Functions 应用</h4>

<ol>
  <li>在任务栏上，选择 <strong>“Windows 终端”</strong> 图标。</li>
  <li>
    <p>输入以下命令然后按 Enter，以将当前目录更改为 <strong>Allfiles (F):\Allfiles\Labs\07\Starter\func</strong> 空目录：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock38" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock38" class="mt-0"><code class="language-powershell"> cd F:\Allfiles\Labs\07\Starter\func
</code></pre>
  </li>
  <li>
    <p>在打开的命令提示符处，输入以下命令然后按 Enter，以登录 Azure CLI：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock39" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock39" class="mt-0"><code class="language-powershell"> az login
</code></pre>
  </li>
  <li>在 <strong>Microsoft Edge</strong> 浏览器窗口中，执行以下操作：
    <ol>
      <li>输入你的 Microsoft 帐户的电子邮件地址，然后选择 <strong>“下一个”</strong>。</li>
      <li>输入你的 Microsoft 帐户的密码，然后选择 <strong>“登录”</strong>。</li>
    </ol>
  </li>
  <li>返回当前打开的 <strong>“Windows 终端”</strong> 窗口。等待登录过程完成。</li>
  <li>
    <p>输入以下命令，然后按 Enter 再次发布函数应用项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock40" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock40" class="mt-0"><code class="language-powershell"> func azure functionapp publish &lt;function-app-name&gt;
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 例如，如果<strong>函数应用名称</strong>为 <strong>securefuncstudent</strong>，则命令将为 <code>func azure functionapp publish funclogicstudent</code>。可以查看文档以使用 <strong>Azure Functions Core Tools</strong> [发布本地函数应用项目][azure-functions-core-tools-publish-azure]。</p>
    </blockquote>
  </li>
  <li>等待部署完成后，再继续本实验室。</li>
  <li>关闭当前正在运行的 <strong>“Windows 终端”</strong> 应用程序。</li>
  <li>在任务栏上，选择 <strong>“Microsoft Edge”</strong> 图标。</li>
  <li>在打开的浏览器窗口中，转到 Azure 门户 (<a href="https://portal.azure.com">https://portal.azure.com</a>)。</li>
  <li>在 Azure 门户的“导航”窗格中，选择 <strong>“资源组”</strong> 链接。</li>
  <li>在“资源组”边栏选项卡中，找到并选择之前在本实验室中创建的 <strong>“ConfidentialStack”</strong> 资源组。</li>
  <li>在 <strong>“ConfidentialStack”</strong> 边栏选项卡上，选择之前在本实验室中创建的 <strong>“securefunc[yourname]”</strong> 函数应用。</li>
  <li>在 <strong>“应用服务”</strong> 边栏选项卡中，从 <strong>“函数”</strong> 部分选择 <strong>“函数”</strong> 选项。</li>
  <li>在“函数”窗格中选择现有的 <strong>“FileParser”</strong> 函数。</li>
  <li>在 <strong>“函数”</strong> 边栏选项卡中，从 <strong>“开发人员”</strong> 部分选择 <strong>“代码 + 测试”</strong> 选项。</li>
  <li>在函数编辑器中，选择 <strong>“测试/运行”</strong>。</li>
  <li>在显示的弹出对话框中，执行以下操作：
    <ul>
      <li>在 <strong>“HTTP 方法”</strong> 列表中，选择 <strong>“GET”</strong>。</li>
    </ul>
  </li>
  <li>选择 <strong>“运行”</strong> 以测试函数。</li>
  <li>观察运行测试的结果。输出将包含存储在 Azure 存储帐户中的 <strong>$/drop/records.json</strong> Blob 的内容。</li>
</ol>

<blockquote>
  <p><strong>回顾</strong>： 在本练习中，你使用了 C# 代码来访问存储帐户，然后下载了 Blob 的内容。</p>
</blockquote>

<h3 id="练习-5清理订阅">练习 5：清理订阅</h3>

<h4 id="任务-1打开-azure-cloud-shell-并列出资源组">任务 1：打开 Azure Cloud Shell 并列出资源组</h4>

<ol>
  <li>
    <p>在 Azure 门户的“导航”窗格中，选择 <strong>“Cloud Shell”</strong> 图标以打开一个新的 shell 实例。</p>

    <blockquote>
      <p><strong>备注</strong>： <strong>Cloud Shell</strong>  图标使用大于符号 (&gt;) 和下划线字符 (_) 表示。</p>
    </blockquote>
  </li>
  <li>
    <p>如果这是你第一次使用订阅打开 Cloud Shell，则可以使用 <strong>“欢迎使用 Azure Cloud Shell 向导”</strong> 来配置 Cloud Shell，以便首次使用。在向导中执行以下操作：</p>

    <ol>
      <li>对话框提示你配置 shell。选择 <strong>“Bash”</strong>，查看选定的订阅，然后选择 <strong>“创建存储”</strong>。</li>
    </ol>

    <blockquote>
      <p><strong>备注</strong>：等待 Cloud Shell 完成首次设置过程后，再继续本实验室。如果 Cloud Shell 配置选项未显示，这很可能是因为你在本课程实验室中使用的是现有订阅。实验室是在你使用的是新订阅的假设下编写的。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2删除资源组">任务 2：删除资源组</h4>

<ol>
  <li>
    <p>系统显示命令提示符时，输入以下命令然后按 Enter，以删除 <strong>ConfidentialStack</strong> 资源组：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock41" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock41" class="mt-0"><code class="language-powershell"> az group delete --name ConfidentialStack --no-wait --yes
</code></pre>
  </li>
  <li>
    <p>关闭门户中的 Cloud Shell 窗格。</p>
  </li>
</ol>

<h4 id="任务-3关闭活动的应用程序">任务 3：关闭活动的应用程序</h4>

<ol>
  <li>关闭当前正在运行的 Microsoft Edge 应用程序。</li>
</ol>

<blockquote>
  <p><strong>回顾</strong>： 在本练习中，你通过删除本实验室中使用的资源组清理了订阅。</p>
</blockquote>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D.js"></script>



</body></html>