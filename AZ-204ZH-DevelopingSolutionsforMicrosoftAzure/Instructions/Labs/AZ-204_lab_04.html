<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#准备工作">准备工作</a></li><li class="nav-item"><a class="nav-link" href="#练习-1在-azure-中创建数据库资源">练习 1：在 Azure 中创建数据库资源</a></li><li class="nav-item"><a class="nav-link" href="#练习-2导入并验证数据">练习 2：导入并验证数据</a></li><li class="nav-item"><a class="nav-link" href="#练习-3打开并配置-net-web-应用程序">练习 3：打开并配置 .NET Web 应用程序</a></li><li class="nav-item"><a class="nav-link" href="#练习-4将-sql-数据迁移到-azure-cosmos-db">练习 4：将 SQL 数据迁移到 Azure Cosmos DB</a></li><li class="nav-item"><a class="nav-link" href="#练习-5使用-net-访问-azure-cosmos-db">练习 5：使用 .NET 访问 Azure Cosmos DB</a></li><li class="nav-item"><a class="nav-link" href="#练习-6清理订阅">练习 6：清理订阅</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="实验室-04构造多语言数据解决方案">实验室 04：构造多语言数据解决方案</h1>

<h2 id="microsoft-azure-用户界面">Microsoft Azure 用户界面</h2>

<p>鉴于 Microsoft 云工具的动态特性，Azure UI 可能会在开发此培训内容之后发生更改。这些更改可能会导致实验室说明和步骤不相符。</p>

<p>我们发现社区进行了必要更改时，Microsoft 将会更新此培训课程。但由于云更新频繁，在此培训内容更新前 UI 可能已更改。<strong>如果发生这种情况，请适应这些更改，并根据需要在实验室中熟悉这些更改。</strong></p>

<h2 id="说明">说明</h2>

<h3 id="准备工作">准备工作</h3>

<h4 id="登录到实验室虚拟机">登录到实验室虚拟机</h4>

<p>使用以下凭据登录到 Windows 10 虚拟机 (VM)：</p>

<ul>
  <li>
    <p>用户名： <strong>Admin</strong></p>
  </li>
  <li>
    <p>密码： <strong>Pa55w.rd</strong></p>
  </li>
</ul>

<blockquote>
  <p><strong>备注</strong>： 你的讲师将提供连接到虚拟实验室环境的说明。</p>
</blockquote>

<h4 id="查看已安装的应用程序">查看已安装的应用程序</h4>

<p>在你的 Windows 10 桌面上找到任务栏。任务栏里有本实验室中你将使用的应用程序的图标：</p>

<ul>
  <li>
    <p>Microsoft Edge</p>
  </li>
  <li>
    <p>文件资源管理器</p>
  </li>
  <li>
    <p>Visual Studio Code</p>
  </li>
</ul>

<h3 id="练习-1在-azure-中创建数据库资源">练习 1：在 Azure 中创建数据库资源</h3>

<h4 id="任务-1打开-azure-门户">任务 1：打开 Azure 门户</h4>

<ol>
  <li>
    <p>在任务栏上，选择 <strong>“Microsoft Edge”</strong> 图标。</p>
  </li>
  <li>
    <p>在打开的浏览器窗口中，浏览到 Azure 门户 (<a href="https://portal.azure.com">portal.azure.com</a>)。</p>
  </li>
  <li>
    <p>输入你的 Microsoft 帐户的电子邮件地址，然后选择 <strong>“下一个”</strong>。</p>
  </li>
  <li>
    <p>输入你的 Microsoft 帐户的密码，然后选择 <strong>“登录”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>：你第一次登录 Azure 门户时会为你提供门户导览。选择 <strong>“开始使用”</strong>，以跳过导览并开始使用门户。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2创建-azure-sql-数据库服务器资源">任务 2：创建 Azure SQL 数据库服务器资源</h4>

<ol>
  <li>
    <p>在 Azure 门户的“导航”窗格中，选择 <strong>“所有服务”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“所有服务”</strong> 边栏选项卡中，选择 <strong>“SQL 服务器”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“SQL 服务器”</strong> 边栏选项卡中，查找 SQL 服务器实例列表。</p>
  </li>
  <li>
    <p>在“<strong>SQL 服务器</strong>”边栏选项卡中，选择“<strong>+ 创建</strong>”。</p>
  </li>
  <li>
    <p>在 <strong>“创建 SQL 数据库服务器”</strong> 边栏选项卡中，查看边栏选项卡中的选项卡，如 <strong>“基本”</strong>、 <strong>“网络”</strong> 和 <strong>“附加设置”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 每个选项卡都代表创建新 Azure SQL 数据库服务器的工作流中的一个步骤。你可以随时选择 <strong>“查看 + 创建”</strong> 跳过其余选项卡。</p>
    </blockquote>

    <ol>
      <li>
        <p>在 <strong>“基本信息”</strong> 选项卡中，执行以下操作：</p>
      </li>
      <li>
        <p>将 <strong>“订阅”</strong> 下拉列表设置为默认值。</p>
      </li>
      <li>
        <p>在 <strong>“资源组”</strong> 部分，选择 <strong>“新建”</strong>，输入 <strong>“PolyglotData”</strong>，然后选择 <strong>“确定”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“服务器名称”</strong> 文本框中，输入 “<strong>polysqlsrvr<em>[yourname]</em></strong>”。</p>
      </li>
      <li>
        <p>在 <strong>“位置”</strong> 下拉列表中，选择 <strong>“（美国）美国东部”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“服务器管理员登录”</strong> 文本框中，输入 <strong>“testuser”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“密码”</strong> 文本框中，输入 <strong>“TestPa55w.rd”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“确认密码”</strong> 文本框中，再次输入 <strong>“TestPa55w.rd”</strong>。</p>
      </li>
      <li>
        <p>选择 <strong>“下一步: 网络”</strong>。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>在 <strong>“网络”</strong> 选项卡中，执行以下操作：</p>

    <ol>
      <li>
        <p>在 <strong>“允许 Azure 服务和资源访问此服务器”</strong> 部分，选择 <strong>“是”</strong>。</p>
      </li>
      <li>
        <p>选择 <strong>“查看 + 创建”</strong>。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>在 <strong>“查看 + 创建”</strong> 选项卡中，查看在先前步骤中选择的选项。</p>
  </li>
  <li>
    <p>选择 <strong>“创建”</strong> 以使用你指定的配置创建 SQL 数据库服务器。</p>

    <blockquote>
      <p><strong>备注</strong>： 在当前实验室中，我们仅创建 Azure SQL 逻辑服务器。我们将在稍后的实验室中创建 Azure SQL 数据库实例。</p>
    </blockquote>

    <blockquote>
      <p><strong>备注</strong>： 等待创建任务完成，再继续本实验室。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-3创建-azure-cosmos-db-帐户资源">任务 3：创建 Azure Cosmos DB 帐户资源</h4>

<ol>
  <li>
    <p>在 Azure 门户导航窗格中，选择 <strong>“所有服务”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“所有服务”</strong> 边栏选项卡中，选择 <strong>“Azure Cosmos DB”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Azure Cosmos DB”</strong> 边栏选项卡中，查看 Azure Cosmos DB 实例列表。</p>
  </li>
  <li>
    <p>在“<strong>Azure Cosmos DB</strong>”边栏选项卡中，选择“<strong>+ 创建</strong>”。</p>
  </li>
  <li>
    <p>从 <strong>“选择 API 选项”</strong> 边栏选项卡中，选择 <strong>“核心(SQL) - 推荐”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“创建 Azure Cosmos DB 帐户”</strong> 边栏选项卡中，查看边栏选项卡中的选项卡，如 <strong>“基本”</strong>、 <strong>“网络”</strong> 和 <strong>“标记”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 每个选项卡代表创建新 Azure Cosmos DB 帐户的工作流中的一个步骤。你可以随时选择 <strong>“查看 + 创建”</strong> 跳过其余选项卡。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“基本信息”</strong> 选项卡中，执行以下操作：</p>

    <ol>
      <li>
        <p>将 <strong>“订阅”</strong> 列表设置为其默认值。</p>
      </li>
      <li>
        <p>在 <strong>“资源组”</strong> 部分，从列表中选择 <strong>“PolyglotData”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“帐户名”</strong> 文本框中，输入“<strong>polycosmos<em>[yourname]</em></strong>”。</p>
      </li>
      <li>
        <p>在 <strong>“位置”</strong> 下拉列表中，选择 <strong>“(美国)美国东部”</strong> 区域。</p>
      </li>
      <li>
        <p>在 <strong>“容量模式”</strong> 部分，选择 <strong>“无服务器”</strong>。</p>
      </li>
      <li>
        <p>选择 <strong>“查看 + 创建”</strong>。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>在 <strong>“查看 + 创建”</strong> 选项卡中，查看在先前步骤中选择的选项。</p>
  </li>
  <li>
    <p>选择 <strong>“创建”</strong>，以使用你指定的配置创建 Azure Cosmos DB 帐户。</p>

    <blockquote>
      <p><strong>备注</strong>：等待创建任务完成，再继续本实验室。</p>
    </blockquote>
  </li>
  <li>
    <p>在 Azure 门户的“导航”窗口，选择 <strong>“资源组”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验中创建的 <strong>“PolyglotData”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“PolyglotData”</strong> 边栏选项卡中，选择你之前在本实验中创建的 “<strong>polycosmos<em>[yourname]</em></strong>” Azure Cosmos DB 帐户。</p>
  </li>
  <li>
    <p>在 <strong>“Azure Cosmos DB 帐户”</strong> 边栏选项卡中，找到边栏选项卡中的 <strong>“设置”</strong> 部分，然后选择 <strong>“密钥”</strong> 链接。</p>
  </li>
  <li>
    <p>在“密钥”窗格中，将值记录在 <strong>“主连接字符串”</strong> 文本框中。你稍后将在本实验室中使用此值。</p>
  </li>
</ol>

<h4 id="任务-4创建-azure-存储帐户资源">任务 4：创建 Azure 存储帐户资源</h4>

<ol>
  <li>
    <p>在 Azure 门户导航窗格中，选择 <strong>“所有服务”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“所有服务”</strong> 边栏选项卡中，选择 <strong>“存储帐户”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“存储帐户”</strong> 边栏选项卡中，找到存储实例列表。</p>
  </li>
  <li>
    <p>在 <strong>“存储帐户”</strong> 边栏选项卡中，选择 <strong>“新建”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“创建存储帐户”</strong> 边栏选项卡中，查看边栏选项卡中的选项卡，如 <strong>“基本”</strong>、<strong>“高级”</strong> 和 <strong>“标记”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 每个选项卡代表创建新的 Azure 存储帐户的工作流中的一个步骤。你可以随时选择 <strong>“查看 + 创建”</strong> 跳过其余选项卡。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“基本信息”</strong> 选项卡中，执行以下操作：</p>

    <ol>
      <li>
        <p>将 <strong>“订阅”</strong> 列表设置为其默认值。</p>
      </li>
      <li>
        <p>在 <strong>“资源组”</strong> 部分，从列表中选择 <strong>“PolyglotData”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“存储帐户名”</strong> 文本框中，输入<strong>polystor<em>[yourname]</em></strong>。</p>
      </li>
      <li>
        <p>在“<strong>区域</strong>”下拉列表中，选择“<strong>(美国) 美国东部</strong>”地区。</p>
      </li>
      <li>
        <p>在 <strong>“性能”</strong> 部分，选择 <strong>“标准”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“冗余”</strong> 下拉列表中，选择 <strong>“本地冗余存储(LRS)”</strong>。</p>
      </li>
      <li>
        <p>选择 <strong>“查看 + 创建”</strong>。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>在 <strong>“查看 + 创建”</strong> 选项卡中，查看在先前步骤中选择的选项。</p>
  </li>
  <li>
    <p>选择 <strong>“创建”</strong>，使用指定的配置创建存储帐户。</p>

    <blockquote>
      <p><strong>备注</strong>：等待创建任务完成，再继续本实验室。</p>
    </blockquote>
  </li>
</ol>

<h4 id="回顾">回顾</h4>

<p>在本练习中，创建了多语言数据解决方案所需的所有 Azure 资源。</p>

<h3 id="练习-2导入并验证数据">练习 2：导入并验证数据</h3>

<h4 id="任务-1上传映像-blob">任务 1：上传映像 blob</h4>

<ol>
  <li>
    <p>在 Azure 门户的 “导航”窗格中，选择 <strong>“资源组”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验中创建的 <strong>“PolyglotData”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“PolyglotData”</strong> 边栏选项卡中，选择你之前在本实验中创建的 <strong>polystor<em>[yourname]</em></strong> 存储帐户。</p>
  </li>
  <li>
    <p>在 <strong>“存储帐户”</strong> 边栏选项卡中的 <strong>“数据存储”</strong> 部分中选择 <strong>“容器”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“容器”</strong> 部分，选择 <strong>“+ 容器”</strong>。</p>
  </li>
  <li>
    <p>在“<strong>新建容器</strong>”弹出窗口中，执行以下操作：</p>

    <ol>
      <li>
        <p>在 <strong>“名称”</strong> 文本框中，输入 <strong>“images”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“公共访问级别”</strong> 下拉列表中，选择 <strong>“Blob（仅限 blob 匿名读取权限）”</strong>。</p>
      </li>
      <li>
        <p>选择 <strong>“创建”</strong>。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>返回 <strong>“容器”</strong> 部分，选择新创建的 <strong>“映像”</strong> 容器。</p>
  </li>
  <li>
    <p>在“<strong>容器</strong>”边栏选项卡中，找到边栏选项卡中的“<strong>设置</strong>”部分，然后选择“<strong>属性</strong>”链接。</p>
  </li>
  <li>
    <p>在“属性”窗格中，将值记录在“<strong>URL</strong>”字段中。你稍后将在本实验室中使用此值。</p>
  </li>
  <li>
    <p>在边栏选项卡中找到并选择 <strong>“概览”</strong> 链接。</p>
  </li>
  <li>
    <p>在边栏选项卡中，选择 <strong>“上传”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“上传 blob”</strong> 弹出窗口中，执行以下操作：</p>

    <ol>
      <li>
        <p>在 <strong>“文件”</strong> 部分，选择 <strong>“文件夹”</strong> 图标。</p>
      </li>
      <li>
        <p>在 <strong>“文件资源管理器”</strong> 窗口中，浏览到 <strong>“Allfiles (F):\Allfiles\Labs\04\Starter\Images”</strong>，选择 42 个单独的 <strong>.jpg</strong> 图像文件，然后选择 <strong>“打开”</strong>。</p>
      </li>
      <li>
        <p>确保 <strong>“如果文件已存在，则覆盖”</strong> 已选中，然后选择 <strong>“上传”</strong>。</p>
      </li>
    </ol>

    <blockquote>
      <p><strong>备注</strong>： 等待所有 Blob 上传完成，然后再继续本实验室。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2上传-sql-bacpac-文件">任务 2：上传 SQL .bacpac 文件</h4>

<ol>
  <li>
    <p>在 Azure 门户的“导航”窗口，选择 <strong>“资源组”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验中创建的 <strong>“PolyglotData”资源组</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“PolyglotData”</strong> 边栏选项卡中，选择你之前在本实验中创建的 <strong>polystor<em>[yourname]</em></strong> 存储帐户。</p>
  </li>
  <li>
    <p>在 <strong>“存储帐户”</strong> 边栏选项卡中的 <strong>“数据存储”</strong> 部分中选择 <strong>“容器”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“容器”</strong> 部分，选择 <strong>“+ 容器”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“新建容器”</strong> 弹出窗口中，执行以下操作：</p>

    <ol>
      <li>
        <p>在 <strong>“名称”</strong> 文本框中，输入 <strong>“databases”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“公共访问级别”</strong> 下拉列表中，选择 <strong>“专用(非匿名访问)”</strong>。</p>
      </li>
      <li>
        <p>选择“<strong>创建</strong>”。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>返回 <strong>“容器”</strong> 部分，选择新创建的 <strong>“数据库”</strong> 容器。</p>
  </li>
  <li>
    <p>在 <strong>“容器”</strong> 边栏选项卡中，选择 <strong>“上传”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“上传 blob”</strong> 弹出窗口中，执行以下操作：</p>

    <ol>
      <li>
        <p>在 <strong>“文件”</strong> 部分，选择 <strong>“文件夹”</strong> 图标。</p>
      </li>
      <li>
        <p>在 <strong>“文件资源管理器”</strong> 对话框中，浏览到 <strong>“Allfiles (F):\Allfiles\Labs\04\Starter”</strong>，选择 <strong>“AdventureWorks.bacpac”</strong> 文件，然后选择 <strong>“打开”</strong>。</p>
      </li>
      <li>
        <p>确保 <strong>“如果文件已存在，则覆盖”</strong> 已选中，然后选择 <strong>“上传”</strong>。</p>
      </li>
    </ol>

    <blockquote>
      <p><strong>备注</strong>： 等待 Blob 上传完成，然后再继续本实验室。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-3导入-sql-数据库">任务 3：导入 SQL 数据库</h4>

<ol>
  <li>
    <p>在 Azure 门户的“导航”窗口，选择 <strong>“资源组”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验中创建的 <strong>“PolyglotData”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“PolyglotData”</strong> 边栏选项卡中，选择你之前在本实验中创建的 “<strong>polysqlsrvr<em>[yourname]</em></strong>” SQL 服务器。</p>
  </li>
  <li>
    <p>在 <strong>“SQL 服务器”</strong> 边栏选项卡中，选择 <strong>“导入数据库”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“导入数据库”</strong> 边栏选项卡中，执行以下操作：</p>

    <ol>
      <li>
        <p>将 <strong>“订阅”</strong> 列表设置为其默认值。</p>
      </li>
      <li>
        <p>在 <strong>“存储”</strong> 部分中，选择 <strong>“选择备份”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“存储帐户”</strong> 边栏选项卡中，选择你之前在本实验室中创建的 <strong>“polystor<em>[yourname]”</em></strong> 存储帐户。</p>
      </li>
      <li>
        <p>在 <strong>“容器”</strong> 边栏选项卡中，选择你之前在本实验中创建的 <strong>“databases”</strong> 容器。</p>
      </li>
      <li>
        <p>在 <strong>“容器”</strong> 边栏选项卡中，选择你在本实验室前面部分创建的 <strong>“AdventureWorks.bacpac”</strong> lob，然后选择 <strong>“选择”</strong> 关闭边栏选项卡。</p>
      </li>
      <li>
        <p>从 <strong>“导入数据库”</strong> 边栏选项卡返回，将 <strong>“定价层”</strong> 选项设置为其默认值。</p>
      </li>
      <li>
        <p>在 <strong>“数据库名称”</strong> 文本框中，输入 <strong>AdventureWorks</strong>。</p>
      </li>
      <li>
        <p>将 <strong>“排序”</strong> 文本框保留设置为默认值。</p>
      </li>
      <li>
        <p>在 <strong>“服务器管理员登录”</strong> 文本框中，输入 <strong>“testuser”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“密码”</strong> 文本框中，输入 <strong>“TestPa55w.rd”</strong>。</p>
      </li>
      <li>
        <p>选择 <strong>“确定”</strong>。</p>
      </li>
    </ol>

    <blockquote>
      <p><strong>备注</strong>： 等待数据库创建完成，然后再继续本实验室。如果在导入步骤中收到与防火墙相关的错误，则表示你没有在实验室早些时候在 SQL Server 上正确配置 <strong>“允许 Azure 服务访问服务器”</strong> 设置。  查看你的设置，删除空白 <strong>AdventureWorks</strong> 数据库，然后再次尝试导入。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-4使用导入的-sql-数据库">任务 4：使用导入的 SQL 数据库</h4>

<ol>
  <li>
    <p>在 Azure 门户的“导航”窗口，选择 <strong>“资源组”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验中创建的 <strong>“PolyglotData”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“PolyglotData”</strong> 边栏选项卡中，选择你之前在本实验中创建的 “<strong>polysqlsrvr<em>[yourname]</em></strong>” SQL 服务器。</p>
  </li>
  <li>
    <p>在 <strong>“SQL 服务器”</strong> 边栏选项卡中，找到边栏选项卡中的 <strong>“安全性”</strong> 部分，然后选择 <strong>“防火墙和虚拟网络”</strong> 链接。</p>
  </li>
  <li>
    <p>在“防火墙和虚拟网络”窗格中执行以下操作：</p>

    <ol>
      <li>
        <p>选择 <strong>“添加客户端 IP”</strong></p>
      </li>
      <li>
        <p>选择 <strong>“保存”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“成功!”</strong> 确认对话框中，选择 <strong>“确定”</strong>。</p>
      </li>
    </ol>

    <blockquote>
      <p><strong>备注</strong>： 此步骤将确保本地计算机可以访问与此服务器关联的数据库。</p>
    </blockquote>
  </li>
  <li>
    <p>在 Azure 门户的“导航”窗口，选择 <strong>“资源组”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验中创建的 <strong>“PolyglotData”资源组</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“PolyglotData”</strong> 边栏选项卡中，选择你之前在本实验中创建的 <strong>“AdventureWorks”</strong> SQL 数据库。</p>
  </li>
  <li>
    <p>在 <strong>“SQL 数据库”</strong> 边栏选项卡中，找到 <strong>“设置”</strong> 部分，然后选择 <strong>“连接字符串”</strong> 链接。</p>
  </li>
  <li>
    <p>在“连接字符串”窗格中，将值记录在 <strong>“ADO.NET（SQL 身份验证）”</strong> 文本框中。你稍后将在本实验室中使用此值。</p>
  </li>
  <li>
    <p>通过执行以下操作更新记录的连接字符串：</p>

    <ol>
      <li>
        <p>在连接字符串中，找到 <em>“your_username”</em> 占位符，并将其替换为 <strong>“testuser”</strong>。</p>
      </li>
      <li>
        <p>在连接字符串中，找到 <em>“your_password”</em> 占位符，并将其替换为 <strong>“TestPa55w.rd”</strong>。</p>

        <blockquote>
          <p><strong>备注</strong>： 例如，如果连接字符串最初是 <code>Server=tcp:polysqlsrvrinstructor.database.windows.net,1433;Initial Catalog=AdventureWorks;User ID={your_username};Password={your_password};</code>，则更新后的连接字符串将是 <code>Server=tcp:polysqlsrvrinstructor.database.windows.net,1433;Initial Catalog=AdventureWorks;User ID=testuser;Password=TestPa55w.rd;</code></p>
        </blockquote>
      </li>
    </ol>
  </li>
  <li>
    <p>在边栏选项卡中找到并选择 <strong>“查询编辑器（预览版）”</strong> 链接。</p>
  </li>
  <li>
    <p>在“查询编辑器”窗格中，执行以下操作：</p>

    <ol>
      <li>
        <p>在 <strong>“登录”</strong> 文本框中，输入 <strong>“testuser”</strong>。</p>
      </li>
      <li>
        <p>在 <strong>“密码”</strong> 文本框中，输入 <strong>“TestPa55w.rd”</strong>。</p>
      </li>
      <li>
        <p>选择 <strong>“确定”</strong>。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>在打开的查询编辑器中，输入以下查询命令：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">SELECT</span></span> * <span class="hljs-selector-tag"><span class="hljs-selector-tag">FROM</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AdventureWorks</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.dbo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Models</span></span>
</code></pre>
  </li>
  <li>
    <p>选择 <strong>“运行”</strong> 以运行查询，然后查看结果。</p>

    <blockquote>
      <p><strong>备注</strong>： 此查询将返回 Web 应用程序主页上的模型列表。</p>
    </blockquote>
  </li>
  <li>
    <p>在查询编辑器中，将现有查询内容替换为以下查询：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">SELECT</span></span> * <span class="hljs-selector-tag"><span class="hljs-selector-tag">FROM</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">AdventureWorks</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.dbo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Products</span></span>
</code></pre>
  </li>
  <li>
    <p>选择 <strong>“运行”</strong> 以运行查询，然后查看结果。</p>

    <blockquote>
      <p><strong>备注</strong>： 此查询将返回与每个模型关联的产品列表。</p>
    </blockquote>
  </li>
</ol>

<h4 id="回顾-1">回顾</h4>

<p>在本练习中，你导入了将与 Web 应用程序一起使用的所有资源。</p>

<h3 id="练习-3打开并配置-net-web-应用程序">练习 3：打开并配置 .NET Web 应用程序</h3>

<h4 id="任务-1打开并生成-web-应用程序">任务 1：打开并生成 Web 应用程序</h4>

<ol>
  <li>
    <p>在 <strong>“启动”</strong> 屏幕上，选择 <strong>“Visual Studio Code”</strong> 磁贴。</p>
  </li>
  <li>
    <p>在 <strong>“文件”</strong> 菜单上，选择 <strong>“打开文件夹”</strong>。</p>
  </li>
  <li>
    <p>在打开的 <strong>“文件资源管理器”</strong> 窗口中，浏览到 <strong>“Allfiles (F):\Allfiles\Labs\04\Starter\AdventureWorks”</strong>，然后选择 <strong>“选择文件夹”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口中，右键单击或激活“资源管理器”窗格的快捷菜单，然后选择 <strong>“在终端中打开”</strong>。</p>
  </li>
  <li>
    <p>在打开的命令提示符中，输入以下命令并选择 Enter 以生成 .NET Web 应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> build
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet build</strong> 命令将在生成文件夹中的所有项目之前自动还原所有丢失的 NuGet 包。</p>
    </blockquote>
  </li>
  <li>
    <p>查看在终端上打印的生成结果。生成应成功完成，不会出现错误或警告消息。</p>
  </li>
  <li>
    <p>选择 <strong>“终止终端”</strong> 或者 <strong>“回收站”</strong> 图标以关闭当前打开的终端和所有关联的进程。</p>
  </li>
</ol>

<h4 id="任务-2更新-sql-连接字符串">任务 2：更新 SQL 连接字符串</h4>

<ol>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口的 <strong>“资源管理器”窗格中，展开“AdventureWorks.Web”</strong> 项目。</p>
  </li>
  <li>
    <p>打开 <strong>“appsettings.json”</strong> 文件。</p>
  </li>
  <li>
    <p>在“JavaScript 对象表示法 (JSON)”对象的第 3 行，找到 <strong>“ConnectionStrings.AdventureWorksSqlContext”</strong> 路径。注意当前值为空：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="hljs bash"><span class="hljs-string"><span class="hljs-string">"ConnectionStrings"</span></span>: {
    <span class="hljs-string"><span class="hljs-string">"AdventureWorksSqlContext"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>,
    ...
},
</code></pre>
  </li>
  <li>
    <p>通过将 <strong>AdventureWorksSqlContext</strong> 属性的值设置为你之前在本实验室中记录的 SQL 数据库的 <strong>ADO.NET（SQL 身份验证）连接字符串</strong>来更新该值。</p>

    <blockquote>
      <p><strong>备注</strong>： 请务必在此处使用更新后的连接字符串。从门户复制的原始连接字符串将不具有连接到 SQL 数据库所需的用户名和密码。</p>
    </blockquote>
  </li>
  <li>
    <p>保存 <strong>“appsettings.json”</strong> 文件。</p>
  </li>
</ol>

<h4 id="任务-3更新-blob-基本-url">任务 3：更新 blob 基本 URL</h4>

<ol>
  <li>
    <p>在 JSON 对象的第 8 行，找到 <strong>“Settings.BlobContainerUrl”</strong> 路径。注意当前值为空：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="hljs bash"><span class="hljs-string"><span class="hljs-string">"Settings"</span></span>: {
    <span class="hljs-string"><span class="hljs-string">"BlobContainerUrl"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>,
    ...
}
</code></pre>
  </li>
  <li>
    <p>通过将 <strong>BlobContainerUrl</strong> 属性的值设置为你之前在本实验室中记录的名为 <strong>images</strong> 的 Azure 存储 Blob 容器的 <strong>URL</strong> 属性来更新该值。</p>
  </li>
  <li>
    <p>保存 <strong>“appsettings.json”</strong> 文件。</p>
  </li>
</ol>

<h4 id="任务-4验证-web-应用程序">任务 4：验证 Web 应用程序</h4>

<ol>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口中，访问快捷方式菜单或右键单击或激活“资源管理器”窗格的快捷方式菜单，然后选择 <strong>“在终端中打开”</strong>。</p>
  </li>
  <li>
    <p>在打开的命令提示符中，输入以下命令然后按 Enter，以将终端上下文切换到 <strong>AdventureWorks.Web</strong> 文件夹：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .\AdventureWorks.Web\
</code></pre>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令然后按 Enter，以运行 .NET Web 应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> run
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet run</strong> 命令将自动生成对项目的更改，然后在不连接调试程序的情况下启动 Web 应用程序。此命令将输出正在运行的应用程序和所有已分配端口的 URL。</p>
    </blockquote>
  </li>
  <li>
    <p>在任务栏上，选择 <strong>“Microsoft Edge”</strong> 图标。</p>
  </li>
  <li>
    <p>在打开的浏览器窗口中，浏览到当前正在运行的 Web 应用程序 (<a href="http://localhost:5000">http://localhost:5000</a>)。</p>
  </li>
  <li>
    <p>在 Web 应用程序中，查看首页上显示的模型列表。</p>
  </li>
  <li>
    <p>找到 <strong>“水壶”</strong> 模型并选择 <strong>“查看详细信息”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“水壶”</strong> 产品详细信息页面，找到 <strong>“添加到购物车”</strong>，然后看到结账功能当前已禁用。</p>
  </li>
  <li>
    <p>关闭显示 Web 应用程序的浏览器窗口。</p>
  </li>
  <li>
    <p>返回 <strong>“Visual Studio Code”</strong> 窗口，然后选择 <strong>“终止终端”</strong> 或者 <strong>“回收站”</strong> 图标，以关闭当前打开的终端和所有关联的进程。</p>
  </li>
</ol>

<h4 id="回顾-2">回顾</h4>

<p>在本练习中，你配置了 ASP.NET Web 应用程序，以连接到 Azure 中的资源。</p>

<h3 id="练习-4将-sql-数据迁移到-azure-cosmos-db">练习 4：将 SQL 数据迁移到 Azure Cosmos DB</h3>

<h4 id="任务-1创建迁移项目">任务 1：创建迁移项目</h4>

<ol>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口中，访问快捷方式菜单或右键单击或激活“资源管理器”窗格的快捷方式菜单，然后选择 <strong>“在终端中打开”</strong>。</p>
  </li>
  <li>
    <p>在打开的命令提示符处，输入以下命令然后按 Enter，在同名文件夹中创建一个名为 <strong>AdventureWorks.Migrate</strong> 的新 .NET 控制台项目：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="hljs coffeescript">dotnet <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span> --name AdventureWorks.Migrate
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet new</strong> 命令将在与项目同名的文件夹中创建一个新的 <strong>“控制台”</strong> 项目。</p>
    </blockquote>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令然后按 Enter，以添加对现有 <strong>AdventureWorks.Models</strong> 项目的引用：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock8" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock8" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">dotnet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> .\<span class="hljs-selector-tag"><span class="hljs-selector-tag">AdventureWorks</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Migrate</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">AdventureWorks</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Migrate</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csproj</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">reference</span></span> .\<span class="hljs-selector-tag"><span class="hljs-selector-tag">AdventureWorks</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Models</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">AdventureWorks</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Models</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csproj</span></span>
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet add reference</strong> 命令将添加对 <strong>AdventureWorks.Models</strong> 项目中包含的模型类的引用。</p>
    </blockquote>
  </li>
  <li>
    <p>在命令提示符中，输入以下命令，然后选择“Enter”，以添加对现有 <strong>“AdventureWorks.Context”</strong> 项目的引用：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock9" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock9" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">dotnet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> .\<span class="hljs-selector-tag"><span class="hljs-selector-tag">AdventureWorks</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Migrate</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">AdventureWorks</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Migrate</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csproj</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">reference</span></span> .\<span class="hljs-selector-tag"><span class="hljs-selector-tag">AdventureWorks</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Context</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">AdventureWorks</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Context</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csproj</span></span>
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet add reference</strong> 命令将添加对 <strong>AdventureWorks.Context</strong> 项目中包含的上下文类的引用。</p>
    </blockquote>
  </li>
  <li>
    <p>在命令提示符中输入以下命令，然后选择“Enter”，将终端上下文切换到 <strong>“AdventureWorks.Migrate”</strong> 文件夹：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock10" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock10" class="mt-0"><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .\AdventureWorks.Migrate\
</code></pre>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令然后按 Enter，以从 NuGet 导入 2.2.6 版本的 <strong>“Microsoft.EntityFrameworkCore.SqlServer”</strong>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock11" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock11" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">dotnet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">package</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Microsoft</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.EntityFrameworkCore</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.SqlServer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--version</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet add package</strong> 命令将从 <strong>NuGet</strong> 添加 <strong>Microsoft.EntityFrameworkCore.SqlServer</strong> 包。有关更多信息，请转到：<a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.SqlServer/3.0.1">Microsoft.EntityFrameworkCore.SqlServer</a>。</p>
    </blockquote>
  </li>
  <li>
    <p>在命令提示符中输入以下命令，然后选择“Enter”，以从 NuGet 中导入 3.4.1 版的 <strong>Microsoft.Azure.Cosmos</strong>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock12" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock12" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">dotnet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">package</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Microsoft</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Azure</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Cosmos</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--version</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet add package</strong> 命令将从 <strong>NuGet</strong> 添加 <strong>Microsoft.Azure.Cosmos</strong> 包。有关更多信息，请转到：<a href="https://www.nuget.org/packages/Microsoft.Azure.Cosmos/3.4.1">Microsoft.Azure.Cosmos</a>。</p>
    </blockquote>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令，然后按 Enter 以生成 .NET 控制台应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock13" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock13" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> build
</code></pre>
  </li>
  <li>
    <p>选择 <strong>“终止终端”</strong> 或者 <strong>“回收站”</strong> 图标以关闭当前打开的终端和所有关联的进程。</p>
  </li>
</ol>

<h4 id="任务-2创建-net-类">任务 2：创建 .NET 类</h4>

<ol>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口的“资源管理器”窗格中，展开 <strong>“AdventureWorks.Migrate”</strong> 项目。</p>
  </li>
  <li>
    <p>打开 <strong>“Program.cs”</strong> 文件。</p>
  </li>
  <li>
    <p>在 <strong>“Program.cs”</strong> 文件的代码编辑器选项卡中，删除现有文件中的所有代码。</p>
  </li>
  <li>
    <p>添加以下代码行，以从引用的 <strong>“AdventureWorks.Models”</strong> 和 <strong>“AdventureWorks.Context”</strong> 项目中导入 <strong>“AdventureWorks.Models”</strong> 和 <strong>“AdventureWorks.Context”</strong> 命名空间：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock14" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock14" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> AdventureWorks.Context;
<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> AdventureWorks.Models;
</code></pre>
  </li>
  <li>
    <p>添加以下代码行，通过从 NuGet 导入的 <strong>Microsoft.Azure.Cosmos</strong> 包导入 <strong>Microsoft.Azure.Cosmos</strong> 命名空间：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock15" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock15" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Microsoft</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Azure</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Cosmos</span></span>;
</code></pre>
  </li>
  <li>
    <p>添加以下代码行，通过从 NuGet 导入的 <strong>Microsoft.EntityFrameworkCore.SqlServer</strong> 包导入 <strong>Microsoft.EntityFrameworkCore</strong> 命名空间：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock16" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock16" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.EntityFrameworkCore;
</code></pre>
  </li>
  <li>
    <p>添加以下代码行，为此文件将使用的内置命名空间添加 <strong>using</strong> 指令：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock17" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock17" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">System</span></span>;
<span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">System</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Collections</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Generic</span></span>;
<span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">System</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Linq</span></span>;
<span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">System</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Threading</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Tasks</span></span>;
</code></pre>
  </li>
  <li>
    <p>输入以下代码，创建一个新的 <strong>Program</strong> 类：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock18" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock18" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Program</span></span></span><span class="hljs-class">
{</span></span>
}
</code></pre>
  </li>
  <li>
    <p>在 <strong>Program</strong> 类中，输入以下代码行，创建一个名为 <strong>sqlDBConnectionString</strong> 的新字符串常量：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock19" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock19" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sqlDBConnectionString = <span class="hljs-string"><span class="hljs-string">""</span></span>;
</code></pre>
  </li>
  <li>
    <p>通过将 <strong>sqlDBConnectionString</strong> 字符串常量的值设置为你之前在本实验室中记录的 SQL 数据库的 <strong>ADO.NET（SQL 身份验证）连接字符串</strong>来更新该字符串常量。</p>

    <blockquote>
      <p><strong>备注</strong>： 请务必在此处使用更新后的连接字符串。从门户复制的原始连接字符串将不具有连接到 SQL 数据库所需的用户名和密码。</p>
    </blockquote>
  </li>
  <li>
    <p>在<strong>Program</strong>类中，输入以下代码行，以创建一个名为<strong>cosmosDBConnectionString</strong>的新的字符串常数：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock20" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock20" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> cosmosDBConnectionString = <span class="hljs-string"><span class="hljs-string">""</span></span>;
</code></pre>
  </li>
  <li>
    <p>通过将 <strong>cosmosDBConnectionString</strong> 字符串常量的值设置为你之前在本实验室中记录的 Azure Cosmos DB 帐户的 <strong>“主连接字符串”</strong> 来更新该字符串常量。</p>
  </li>
  <li>
    <p>在 <strong>Program</strong> 类中输入以下代码，以新建 <strong>Main</strong> 异步方法：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock21" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock21" class="mt-0"><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)
</span></span>{
}
</code></pre>
  </li>
  <li>
    <p>在 <strong>Main</strong> 方法中，添加以下代码行以向控制台打印介绍性消息：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock22" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock22" class="mt-0"><code class="hljs coffeescript"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Console.Out.WriteLineAsync(<span class="hljs-string"><span class="hljs-string">"Start Migration"</span></span>);
</code></pre>
  </li>
  <li>
    <p>保存 <strong>Program.cs</strong> 文件。</p>
  </li>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口中，访问快捷方式菜单或右键单击或激活“资源管理器”窗格的快捷方式菜单，然后选择 <strong>“在终端中打开”</strong>。</p>
  </li>
  <li>
    <p>在打开的命令提示符中，输入以下命令，然后按 Enter，以将终端上下文切换到<strong>AdventureWorks.Migrate</strong>文件夹：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock23" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock23" class="mt-0"><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .\AdventureWorks.Migrate\
</code></pre>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令然后按 Enter，以生成 .NET 控制台应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock24" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock24" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> build
</code></pre>
  </li>
  <li>
    <p>选择 <strong>“终止终端”</strong> 或者 <strong>“回收站”</strong> 图标以关闭当前打开的终端和所有关联的进程。</p>
  </li>
</ol>

<h4 id="任务-3使用实体框架获取-sql-数据库记录">任务 3：使用实体框架获取 SQL 数据库记录</h4>

<ol>
  <li>
    <p>在 <strong>Program.cs</strong> 文件内的 <strong>Program</strong> 类的 <strong>Main</strong> 方法中，添加以下代码行，以创建 <strong>AdventureWorksSqlContext</strong> 类的新实例，并传入 <em>sqlDBConnectionString</em> 变量作为连接字符串值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock25" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock25" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> AdventureWorksSqlContext context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdventureWorksSqlContext(sqlDBConnectionString);
</code></pre>
  </li>
  <li>
    <p>在 <strong>Main</strong> 方法中，添加以下代码块以发出语言集成查询 (LINQ)，从而从数据库中获取所有<strong>模型</strong>和子<strong>产品</strong>，并将其存储在内存中的 <strong>List&lt;&gt;</strong> 集合中：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock26" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock26" class="mt-0"><code class="hljs javascript">List&lt;Model&gt; items = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> context.Models
    .Include(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m</span></span></span><span class="hljs-function"> =&gt;</span></span> m.Products)
    .ToListAsync&lt;Model&gt;();
</code></pre>
  </li>
  <li>
    <p>在 <strong>Main</strong> 方法中，添加以下代码行，以打印从 SQL 数据库导入的记录数：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock27" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock27" class="mt-0"><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Console.Out.WriteLineAsync(<span class="hljs-string"><span class="hljs-string">$"Total Azure SQL DB Records: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{items.Count}</span></span></span><span class="hljs-string">"</span></span>);
</code></pre>
  </li>
  <li>
    <p>保存 <strong>Program.cs</strong> 文件。</p>
  </li>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口中，访问快捷方式菜单或右键单击或激活“资源管理器”窗格的快捷方式菜单，然后选择 <strong>“在终端中打开”</strong>。</p>
  </li>
  <li>
    <p>在打开的命令提示符中，输入以下命令，然后按 Enter，以将终端上下文切换到<strong>AdventureWorks.Migrate</strong>文件夹：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock28" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock28" class="mt-0"><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .\AdventureWorks.Migrate\
</code></pre>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令然后按 Enter，以生成 .NET 控制台应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock29" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock29" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> build
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 如果出现任何生成错误，请查看位于 <strong>Allfiles (F):\Allfiles\Labs\04\Solution\AdventureWorks\AdventureWorks.Migrate</strong> 文件夹中的 <strong>Program.cs</strong> 文件。</p>
    </blockquote>
  </li>
  <li>
    <p>选择 <strong>“终止终端”</strong> 或者 <strong>“回收站”</strong> 图标以关闭当前打开的终端和所有关联的进程。</p>
  </li>
</ol>

<h4 id="任务-4将项插入-azure-cosmos-db">任务 4：将项插入 Azure Cosmos DB</h4>

<ol>
  <li>
    <p>在 <strong>Program.cs</strong> 文件内的 <strong>Program</strong> 类的 <strong>Main</strong> 方法中，添加以下代码行，以创建 <strong>CosmosClient</strong> 类的新实例，并传入 <em>cosmosDBConnectionString</em> 变量作为连接字符串值：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock30" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock30" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CosmosClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CosmosClient(cosmosDBConnectionString);
</code></pre>
  </li>
  <li>
    <p>如果 Azure Cosmos DB 帐户中还没有数据库，请在 <strong>Main</strong> 方法中添加以下代码行，以创建一个名为 <strong>Retail</strong> 的新<strong>数据库</strong>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock31" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock31" class="mt-0"><code class="hljs coffeescript">Database database = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> client.CreateDatabaseIfNotExistsAsync(<span class="hljs-string"><span class="hljs-string">"Retail"</span></span>);
</code></pre>
  </li>
  <li>
    <p>如果 Azure Cosmos DB 帐户中还没有名为 <strong>Online</strong> <strong>的容器</strong>，请在 <strong>Main</strong> 方法中添加以下代码块，以创建该容器，其分区键路径为 <strong>/Category</strong>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock32" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock32" class="mt-0"><code class="hljs cs">Container container = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> database.CreateContainerIfNotExistsAsync(<span class="hljs-string"><span class="hljs-string">"Online"</span></span>,
    partitionKeyPath: <span class="hljs-string"><span class="hljs-string">$"/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">nameof</span></span></span></span><span class="hljs-string"><span class="hljs-subst">(Model.Category)}</span></span></span><span class="hljs-string">"</span></span>
);
</code></pre>
  </li>
  <li>
    <p>在 <strong>Main</strong>  方法中，添加以下代码行，创建一个名为 <strong>count</strong> 的 <strong>int</strong> 变量：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock33" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock33" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>;
</code></pre>
  </li>
  <li>
    <p>在 <strong>Main</strong> 方法中，添加以下代码块，以创建一个循环访问 <strong>items</strong> 集合中的对象的 <strong>foreach</strong> 循环：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock34" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock34" class="mt-0"><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items)
{
}
</code></pre>
  </li>
  <li>
    <p>在 <strong>Main</strong> 方法的 <strong>foreach</strong> 循环中，添加以下代码行，以将对象更新<strong>插入</strong> Azure Cosmos DB 集合，并将结果保存在名为 <em>document</em> 且类型为 <em>ItemResponse&lt;&gt;</em> 的变量中：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock35" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock35" class="mt-0"><code class="hljs coffeescript">ItemResponse&lt;Model&gt; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> container.UpsertItemAsync&lt;Model&gt;(item);
</code></pre>
  </li>
  <li>
    <p>在 <strong>Main</strong> 方法中包含的 <strong>foreach</strong> 循环中，添加以下代码行，以打印每个 upsert 操作的活动 ID：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock36" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock36" class="mt-0"><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Console.Out.WriteLineAsync(<span class="hljs-string"><span class="hljs-string">$"Upserted document #</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{++count:</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">000</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string"> [Activity Id: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{document.ActivityId}</span></span></span><span class="hljs-string">]"</span></span>);
</code></pre>
  </li>
  <li>
    <p>返回到 <strong>Main</strong> 方法中（在 <strong>foreach</strong> 循环之外），添加以下代码行，以打印导出到 Azure Cosmos DB 的文档数：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock37" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock37" class="mt-0"><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Console.Out.WriteLineAsync(<span class="hljs-string"><span class="hljs-string">$"Total Azure Cosmos DB Documents: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{count}</span></span></span><span class="hljs-string">"</span></span>);
</code></pre>
  </li>
  <li>
    <p>保存 <strong>Program.cs</strong> 文件。</p>
  </li>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口中，访问快捷方式菜单或右键单击或激活“资源管理器”窗格的快捷方式菜单，然后选择 <strong>“在终端中打开”</strong>。</p>
  </li>
  <li>
    <p>在打开的命令提示符中，输入以下命令，然后按 Enter，以将终端上下文切换到<strong>AdventureWorks.Migrate</strong>文件夹：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock38" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock38" class="mt-0"><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .\AdventureWorks.Migrate\
</code></pre>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令然后按 Enter，以生成 .NET 控制台应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock39" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock39" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> build
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 如果出现任何生成错误，请查看位于 <strong>Allfiles (F):\Allfiles\Labs\04\Solution\AdventureWorks\AdventureWorks.Migrate</strong> 文件夹中的 <strong>Program.cs</strong> 文件。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-5执行迁移">任务 5：执行迁移</h4>

<ol>
  <li>
    <p>在打开的命令提示符处，输入以下命令，然后按 Enter 以运行 .NET 控制台应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock40" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock40" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> run
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet run</strong> 命令将启动控制台应用程序。</p>
    </blockquote>
  </li>
  <li>
    <p>查看输出到屏幕上的各种数据，其中包括初始 SQL 记录计数、单个更新插入活动标识符以及最终 Azure Cosmos DB 文档计数。</p>
  </li>
  <li>
    <p>选择 <strong>“终止终端”</strong> 或者 <strong>“回收站”</strong> 图标以关闭当前打开的终端和所有关联的进程。</p>
  </li>
</ol>

<h4 id="任务-6验证迁移">任务 6：验证迁移</h4>

<ol>
  <li>
    <p>返回显示“Azure 门户”的 <strong>“Microsoft Edge”</strong> 浏览器窗口。</p>
  </li>
  <li>
    <p>在 Azure 门户的“导航”窗口，选择 <strong>“资源组”</strong> 链接。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 边栏选项卡中，找到并选择你之前在本实验中创建的 <strong>“PolyglotData”</strong> 资源组。</p>
  </li>
  <li>
    <p>在 <strong>“PolyglotData”</strong> 边栏选项卡中，选择你之前在本实验中创建的 “<strong>polycosmos<em>[yourname]</em></strong>” Azure Cosmos DB 帐户。</p>
  </li>
  <li>
    <p>在 <strong>“Azure Cosmos DB 帐户”</strong> 边栏选项卡中，找到并选择边栏选项卡中的 <strong>“数据资源管理器”</strong> 链接。</p>
  </li>
  <li>
    <p>在“数据资源管理器”窗格中，展开 <strong>“零售”</strong> 数据库节点。</p>
  </li>
  <li>
    <p>展开 <strong>“在线”</strong> 容器节点，然后选择 <strong>“新的 SQL 查询”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 此选项的标签可能会隐藏。可以通过将鼠标悬停在“数据资源管理器”窗格的图标上来查看标签。</p>
    </blockquote>
  </li>
  <li>
    <p>在“查询”选项卡中，输入以下文本：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock41" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock41" class="mt-0"><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> models
</code></pre>
  </li>
  <li>
    <p>选择 <strong>“执行查询”</strong>，然后观察查询返回的 JSON 模型列表。</p>
  </li>
  <li>
    <p>返回查询编辑器，将现有文本替换为以下文本：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock42" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock42" class="mt-0"><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> models
</code></pre>
  </li>
  <li>
    <p>选择 <strong>“执行查询”</strong>，然后查看 <strong>COUNT</strong> 聚合操作的结果。</p>
  </li>
  <li>
    <p>返回 <strong>“Visual Studio Code”</strong> 窗口。</p>
  </li>
</ol>

<h4 id="回顾-3">回顾</h4>

<p>在本练习中，你使用了 Entity Framework 和用于 Azure Cosmos DB 的 .NET SDK 将数据从 SQL 数据库迁移到了 Azure Cosmos DB。</p>

<h3 id="练习-5使用-net-访问-azure-cosmos-db">练习 5：使用 .NET 访问 Azure Cosmos DB</h3>

<h4 id="任务-1使用-cosmos-sdk-和引用来更新库">任务 1：使用 Cosmos SDK 和引用来更新库</h4>

<ol>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口中，访问快捷方式菜单或右键单击或激活“资源管理器”窗格的快捷方式菜单，然后选择 <strong>“在终端中打开”</strong>。</p>
  </li>
  <li>
    <p>在打开的命令提示符中，输入以下命令，然后选择“Enter”，以将终端上下文切换到 <strong>“AdventureWorks.Context”</strong> 文件夹：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock43" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock43" class="mt-0"><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .\AdventureWorks.Context\
</code></pre>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令然后按 Enter，以从 NuGet 导入 <strong>Microsoft.Azure.Cosmos</strong>：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock44" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock44" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">dotnet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">package</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Microsoft</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Azure</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Cosmos</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--version</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet add package</strong> 命令将从 <strong>NuGet</strong> 添加 <strong>Microsoft.Azure.Cosmos</strong> 包。有关更多信息，请转到：<a href="https://www.nuget.org/packages/Microsoft.Azure.Cosmos/3.4.1">Microsoft.Azure.Cosmos</a>。</p>
    </blockquote>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令然后按 Enter，以生成 .NET Web 应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock45" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock45" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> build
</code></pre>
  </li>
  <li>
    <p>选择 <strong>“终止终端”</strong> 或者 <strong>“回收站”</strong> 图标以关闭当前打开的终端和所有关联的进程。</p>
  </li>
</ol>

<h4 id="任务-2编写-net-代码以连接到-azure-cosmos-db">任务 2：编写 .NET 代码，以连接到 Azure Cosmos DB</h4>

<ol>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口的“资源管理器”窗格中，展开 <strong>“AdventureWorks.Context”</strong> 项目。</p>
  </li>
  <li>
    <p>访问快捷方式菜单或右键单击或激活 <strong>“AdventureWorks.Context”</strong> 文件夹节点的快捷方式菜单，然后选择 <strong>“新建文件”</strong>。</p>
  </li>
  <li>
    <p>在新文件提示符下，输入 <strong>“AdventureWorksCosmosContext.cs”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>AdventureWorksCosmosContext.cs</strong> 文件的代码编辑器选项卡中，添加以下代码行，以从引用的 <strong>AdventureWorks.Models</strong> 项目中导入 <strong>AdventureWorks.Models</strong> 命名空间：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock46" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock46" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> AdventureWorks.Models;
</code></pre>
  </li>
  <li>
    <p>添加以下代码行，以从 NuGet 中导入的 <strong>Microsoft.Azure.Cosmos</strong> 包中导入 <strong>Microsoft.Azure.Cosmos</strong> 和 <strong>Microsoft.Azure.Cosmos.Linq</strong> 命名空间：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock47" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock47" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Microsoft</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Azure</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Cosmos</span></span>;
<span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Microsoft</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Azure</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Cosmos</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Linq</span></span>;
</code></pre>
  </li>
  <li>
    <p>添加以下代码行，为此文件将使用的内置命名空间添加 <strong>using</strong> 指令：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock48" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock48" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">System</span></span>;
<span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">System</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Collections</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Generic</span></span>;
<span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">System</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Linq</span></span>;
<span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">System</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Threading</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Tasks</span></span>;
</code></pre>
  </li>
  <li>
    <p>输入以下代码，以添加 <strong>AdventureWorks.Context</strong> 命名空间块：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock49" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock49" class="mt-0"><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AdventureWorks.Context</span></span>
{
}
</code></pre>
  </li>
  <li>
    <p>在 <strong>AdventureWorks.Context</strong> 命名空间中，输入以下代码以创建新的 <strong>AdventureWorksCosmosContext</strong> 类：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock50" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock50" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdventureWorksCosmosContext</span></span></span><span class="hljs-class">
{</span></span>
}
</code></pre>
  </li>
  <li>
    <p>通过添加表示此类将实现 <strong>IAdventureWorksProductContext</strong> 接口的说明来更新 <strong>AdventureWorksCosmosContext</strong> 类的声明：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock51" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock51" class="mt-0"><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdventureWorksCosmosContext</span></span></span><span class="hljs-class"> :</span></span> IAdventureWorksProductContext
{
}
</code></pre>
  </li>
  <li>
    <p>在 <strong>AdventureWorksCosmosContext</strong> 类中，输入以下代码行，以创建一个名为 <strong>_container</strong> 的新只读 <em>Container</em> 变量：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock52" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock52" class="mt-0"><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Container _container;
</code></pre>
  </li>
  <li>
    <p>在 <strong>AdventureWorksCosmosContext</strong> 类中，添加一个使用以下签名的新构造函数：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock53" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock53" class="mt-0"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdventureWorksCosmosContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> connectionString, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> database = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Retail"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> container = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Online"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">
</span></span>{
}
</code></pre>
  </li>
  <li>
    <p>在构造函数中，添加以下代码块以创建 <strong>CosmosClient</strong> 类的新实例，然后从客户端获取 <strong>“数据库”</strong> 和 <strong>“容器”</strong> 实例：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock54" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock54" class="mt-0"><code class="hljs makefile">_container = new CosmosClient(connectionString)
    .GetDatabase(database)
    .GetContainer(container);
</code></pre>
  </li>
  <li>
    <p>在 <strong>AdventureWorksCosmosContext</strong> 类中，添加一个使用以下签名的新 <strong>FindModelAsync</strong> 方法：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock55" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock55" class="mt-0"><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;Model&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindModelAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Guid id</span></span></span><span class="hljs-function">)
</span></span>{
}
</code></pre>
  </li>
  <li>
    <p>在 <strong>FindModelAsync</strong> 方法中，添加以下代码块以创建一个 LINQ 查询，并将其转换为迭代器，循环访问结果集，然后返回结果集中的单个项：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock56" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock56" class="mt-0"><code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> iterator = _container.GetItemLinqQueryable&lt;Model&gt;()
    .Where(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m</span></span></span><span class="hljs-function"> =&gt;</span></span> m.id == id)
    .ToFeedIterator&lt;Model&gt;();

List&lt;Model&gt; matches = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Model&gt;();
<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (iterator.HasMoreResults)
{
    <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> next = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> iterator.ReadNextAsync();
    matches.AddRange(next);
}

<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> matches.SingleOrDefault();
</code></pre>
  </li>
  <li>
    <p>在 <strong>AdventureWorksCosmosContext</strong> 类中，添加一个使用以下签名的新 <strong>GetModelsAsync</strong> 方法：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock57" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock57" class="mt-0"><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> Task&lt;List&lt;Model&gt;&gt; GetModelsAsync()
{
}
</code></pre>
  </li>
  <li>
    <p>在 <strong>GetModelsAsync</strong> 方法中，添加以下代码块，以运行 SQL 查询，获取查询结果迭代器，循环访问结果集，然后返回所有结果的并集：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock58" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock58" class="mt-0"><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> query = <span class="hljs-string"><span class="hljs-string">$@"SELECT * FROM items"</span></span>;

<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> iterator = _container.GetItemQueryIterator&lt;Model&gt;(query);

List&lt;Model&gt; matches = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Model&gt;();
<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (iterator.HasMoreResults)
{
    <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> next = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> iterator.ReadNextAsync();
    matches.AddRange(next);
}

<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> matches;
</code></pre>
  </li>
  <li>
    <p>在 <strong>AdventureWorksCosmosContext</strong> 类中，添加一个使用以下签名的新 <strong>FindProductAsync</strong> 方法：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock59" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock59" class="mt-0"><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindProductAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Guid id</span></span></span><span class="hljs-function">)
</span></span>{
}
</code></pre>
  </li>
  <li>
    <p>在 <strong>FindProductAsync</strong> 方法中，添加以下代码块，以运行 SQL 查询，获取查询结果迭代器，循环访问结果集，然后返回结果集中的单个项：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock60" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock60" class="mt-0"><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> query = <span class="hljs-string"><span class="hljs-string">$@"SELECT VALUE products
                    FROM models
                    JOIN products in models.Products
                    WHERE products.id = '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{id}</span></span></span><span class="hljs-string">'"</span></span>;

<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> iterator = _container.GetItemQueryIterator&lt;Product&gt;(query);

List&lt;Product&gt; matches = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Product&gt;();
<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (iterator.HasMoreResults)
{
    <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> next = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> iterator.ReadNextAsync();
    matches.AddRange(next);
}

<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> matches.SingleOrDefault();
</code></pre>
  </li>
  <li>
    <p>保存 <strong>AdventureWorksCosmosContext.cs</strong> 文件。</p>
  </li>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口中，访问快捷方式菜单或右键单击或激活“资源管理器”窗格的快捷方式菜单，然后选择 <strong>“在终端中打开”</strong>。</p>
  </li>
  <li>
    <p>在打开的命令提示符中，输入以下命令，然后选择“Enter”，以将终端上下文切换到 <strong>“AdventureWorks.Context”</strong> 文件夹：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock61" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock61" class="mt-0"><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .\AdventureWorks.Context\
</code></pre>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令然后按 Enter，以生成 .NET Web 应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock62" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock62" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> build
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 如果出现任何生成错误，请查看 <strong>Allfiles (F):\Allfiles\Labs\04\Solution\AdventureWorks\AdventureWorks.Context</strong> 文件夹中的 <strong>AdventureWorksCosmosContext.cs</strong> 文件。</p>
    </blockquote>
  </li>
  <li>
    <p>选择 <strong>“终止终端”</strong> 或者 <strong>“回收站”</strong> 图标以关闭当前打开的终端和所有关联的进程。</p>
  </li>
</ol>

<h4 id="任务-3更新-azure-cosmos-db-连接字符串">任务 3：更新 Azure Cosmos DB 连接字符串</h4>

<ol>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口的“资源管理器”窗格中，展开 <strong>“AdventureWorks.Web”</strong> 项目。</p>
  </li>
  <li>
    <p>打开 <strong>“appsettings.json”</strong> 文件。</p>
  </li>
  <li>
    <p>在 JSON 对象的第 4 行中，找到 <strong>ConnectionStrings.AdventureWorksCosmosContext</strong> 路径。注意当前值为空：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock63" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock63" class="mt-0"><code class="hljs bash"><span class="hljs-string"><span class="hljs-string">"ConnectionStrings"</span></span>: {
    ...
    <span class="hljs-string"><span class="hljs-string">"AdventureWorksCosmosContext"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>,
    ...
},
</code></pre>
  </li>
  <li>
    <p>通过将 <strong>AdventureWorksCosmosContext</strong> 属性的值设置为你之前在本实验室中记录的 Azure Cosmos DB 帐户的 <strong>“主连接字符串”</strong> 来更新该值。</p>
  </li>
  <li>
    <p>保存 <strong>“appsettings.json”</strong> 文件。</p>
  </li>
</ol>

<h4 id="任务-4更新-net-应用程序启动逻辑">任务 4：更新 .NET 应用程序启动逻辑</h4>

<ol>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口的“资源管理器”窗格中，展开 <strong>“AdventureWorks.Web”</strong> 项目。</p>
  </li>
  <li>
    <p>打开 <strong>“Startup.cs”</strong> 文件。</p>
  </li>
  <li>
    <p>在 <strong>“Startup”</strong> 类中，找到现有的 <strong>“ConfigureProductService”</strong> 方法。</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock64" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock64" class="mt-0"><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureProductService</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceCollection services</span></span></span><span class="hljs-function">)
</span></span>{
    services.AddScoped&lt;IAdventureWorksProductContext, AdventureWorksSqlContext&gt;(provider =&gt;
        <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdventureWorksSqlContext(
            _configuration.GetConnectionString(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(AdventureWorksSqlContext))
        )
    );
}
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 当前产品服务使用 SQL 作为其数据库。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“ConfigureProductService”</strong> 方法中，删除现有的所有代码行：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock65" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock65" class="mt-0"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureProductService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IServiceCollection services)</span></span></span><span class="hljs-function">
</span></span>{
}
</code></pre>
  </li>
  <li>
    <p>在 <strong>ConfigureProductService</strong> 方法中，添加以下代码块，以将产品提供程序更改为之前在本实验室中创建的 <strong>AdventureWorksCosmosContext</strong> 实现：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock66" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock66" class="mt-0"><code class="hljs javascript">services.AddScoped&lt;IAdventureWorksProductContext, AdventureWorksCosmosContext&gt;(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provider</span></span></span><span class="hljs-function"> =&gt;</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdventureWorksCosmosContext(
        _configuration.GetConnectionString(nameof(AdventureWorksCosmosContext))
    )
);
</code></pre>
  </li>
  <li>
    <p>保存 <strong>Startup.cs</strong> 文件。</p>
  </li>
</ol>

<h4 id="任务-5验证-net-应用程序是否成功连接到-azure-cosmos-db">任务 5：验证 .NET 应用程序是否成功连接到 Azure Cosmos DB</h4>

<ol>
  <li>
    <p>在 <strong>“Visual Studio Code”</strong> 窗口中，访问快捷方式菜单或右键单击或激活“资源管理器”窗格的快捷方式菜单，然后选择 <strong>“在终端中打开”</strong>。</p>
  </li>
  <li>
    <p>在打开的命令提示符中，输入以下命令然后按 Enter，以将终端上下文切换到 <strong>AdventureWorks.Web</strong> 文件夹：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock67" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock67" class="mt-0"><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .\AdventureWorks.Web\
</code></pre>
  </li>
  <li>
    <p>在命令提示符处，输入以下命令然后按 Enter，以运行 ASP.NET 应用程序：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock68" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock68" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dotnet</span></span> run
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： <strong>dotnet run</strong> 命令将自动生成对项目的更改，然后在不连接调试程序的情况下启动 Web 应用程序。此命令将输出正在运行的应用程序和所有已分配端口的 URL。</p>
    </blockquote>
  </li>
  <li>
    <p>在任务栏上，选择 <strong>“Microsoft Edge”</strong> 图标。</p>
  </li>
  <li>
    <p>在打开的浏览器窗口中，浏览到当前正在运行的 Web 应用程序 (<a href="http://localhost:5000">http://localhost:5000</a>)。</p>
  </li>
  <li>
    <p>在 Web 应用程序中，查看首页上显示的模型列表。</p>
  </li>
  <li>
    <p>找到 <strong>“Touring-1000”</strong> 模型，并选择 <strong>“查看详细信息”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Touring-1000”</strong> 产品详细信息页面上，执行以下操作：</p>

    <ol>
      <li>
        <p>在 <strong>“选择选项”</strong> 列表中，选择 <strong>“Touring-1000 Yellow, 50, $2,384.07”</strong>。</p>
      </li>
      <li>
        <p>找到 <strong>“添加到购物车”</strong>，然后观察签出功能仍然被禁用。</p>
      </li>
    </ol>
  </li>
  <li>
    <p>关闭显示 Web 应用程序的浏览器窗口。</p>
  </li>
  <li>
    <p>返回 <strong>“Visual Studio Code”</strong> 窗口，然后选择 <strong>“终止终端”</strong> 或者 <strong>“回收站”</strong> 图标，以关闭当前打开的终端和所有关联的进程。</p>
  </li>
</ol>

<h4 id="回顾-4">回顾</h4>

<p>在本练习中，你编写了 C# 代码以使用 .NET SDK 查询 Azure Cosmos DB 集合。</p>

<h3 id="练习-6清理订阅">练习 6：清理订阅</h3>

<h4 id="任务-1打开-azure-cloud-shell">任务 1：打开 Azure Cloud Shell</h4>

<ol>
  <li>
    <p>在 Azure 门户中，选择 <strong>“Cloud Shell”</strong> 图标以打开一个新的 shell 实例。</p>

    <blockquote>
      <p><strong>备注</strong>： <strong>Cloud Shell</strong> 图标使用大于符号 (&gt;) 和下划线字符 (_) 表示。</p>
    </blockquote>
  </li>
  <li>
    <p>如果这是你第一次使用订阅打开 Cloud Shell，则可以使用 <strong>“欢迎使用 Azure Cloud Shell 向导”</strong> 来配置 Cloud Shell，以便首次使用。在向导中执行以下操作：</p>

    <ol>
      <li>对话框提示你配置 shell。选择 <strong>“Bash”</strong>，查看选定的订阅，然后选择 <strong>“创建存储”</strong>。</li>
    </ol>

    <blockquote>
      <p><strong>备注</strong>： 等待 Cloud Shell 完成其初始设置过程后，再继续本实验室。如果没有看到 Cloud Shell 配置选项，很可能是因为你正在使用本课程实验室中的现有订阅。实验是假设你使用的是新订阅的情况下编写的。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2删除资源组">任务 2：删除资源组</h4>

<ol>
  <li>
    <p>在命令提示符中，输入以下命令，然后按 Enter，以删除 <strong>PolyglotData</strong> 资源组：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock69" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock69" class="mt-0"><code class="hljs coffeescript">az group <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> --name PolyglotData --<span class="hljs-literal"><span class="hljs-literal">no</span></span>-wait --<span class="hljs-literal"><span class="hljs-literal">yes</span></span>
</code></pre>
  </li>
  <li>
    <p>关闭门户中的 Cloud Shell 窗格。</p>
  </li>
</ol>

<h4 id="任务-3关闭活动应用程序">任务 3：关闭活动应用程序</h4>

<ol>
  <li>
    <p>关闭当前正在运行的 Microsoft Edge 应用程序。</p>
  </li>
  <li>
    <p>关闭当前正在运行的“Visual Studio Code”应用程序。</p>
  </li>
</ol>

<h4 id="回顾-5">回顾</h4>

<p>在本练习中，你通过删除本实验室中使用的资源组清理订阅。</p>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-204ZH-DevelopingSolutionsforMicrosoftAzure
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D.js"></script>



</body></html>