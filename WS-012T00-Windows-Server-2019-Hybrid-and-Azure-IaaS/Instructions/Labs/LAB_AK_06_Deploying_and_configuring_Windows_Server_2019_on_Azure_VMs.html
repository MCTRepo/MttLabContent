<!DOCTYPE html><html lang="en"><head>
        <title>
            WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D0a85806b00854f6395723020d7125becaf7760ed.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS
            </a>
            <a href="https://github.com/MicrosoftLearning/WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#task-1-enable-the-standard-tier-of-security-center">Task 1: Enable the Standard tier of Security Center</a></li><li class="nav-item"><a class="nav-link" href="#task-2-generate-an-arm-template-and-parameters-files-by-using-the-azure-portal">Task 2: Generate an ARM template and parameters files by using the Azure portal</a></li><li class="nav-item"><a class="nav-link" href="#task-3-download-the-arm-template-and-parameters-files-from-the-azure-portal">Task 3: Download the ARM template and parameters files from the Azure portal</a></li><li class="nav-item"><a class="nav-link" href="#task-1-review-the-arm-template-and-parameters-files-for-azure-vm-deployment">Task 1: Review the ARM template and parameters files for Azure VM deployment</a></li><li class="nav-item"><a class="nav-link" href="#task-2-add-an-azure-vm-extension-section-to-the-existing-template">Task 2: Add an Azure VM extension section to the existing template</a></li><li class="nav-item"><a class="nav-link" href="#task-1-deploy-an-azure-vm-by-using-an-arm-template">Task 1: Deploy an Azure VM by using an ARM template</a></li><li class="nav-item"><a class="nav-link" href="#task-2-review-results-of-the-azure-vm-deployment">Task 2: Review results of the Azure VM deployment</a></li><li class="nav-item"><a class="nav-link" href="#task-1-verify-the-azure-security-center-standard-tier">Task 1: Verify the Azure Security Center Standard tier</a></li><li class="nav-item"><a class="nav-link" href="#task-2-review-just-in-time-vm-access-settings">Task 2: Review Just in time VM access settings</a></li><li class="nav-item"><a class="nav-link" href="#task-1-create-and-configure-an-nsg">Task 1: Create and configure an NSG</a></li><li class="nav-item"><a class="nav-link" href="#task-2-configure-inbound-http-access-to-an-azure-vm">Task 2: Configure Inbound HTTP access to an Azure VM</a></li><li class="nav-item"><a class="nav-link" href="#task-3-trigger-re-evaluation-of-the-jit-status-of-an-azure-vm">Task 3: Trigger re-evaluation of the JIT status of an Azure VM</a></li><li class="nav-item"><a class="nav-link" href="#task-4-configure-inbound-rdp-access-to-the-azure-vm">Task 4: Configure Inbound RDP access to the Azure VM</a></li><li class="nav-item"><a class="nav-link" href="#task-5-connect-to-the-azure-vm-via-jit-vm-access">Task 5: Connect to the Azure VM via JIT VM access</a></li><li class="nav-item"><a class="nav-link" href="#task-1-start-a-powershell-session-in-cloud-shell">Task 1: Start a PowerShell session in Cloud Shell</a></li><li class="nav-item"><a class="nav-link" href="#task-2-identify-all-azure-resources-provisioned-in-the-lab">Task 2: Identify all Azure resources provisioned in the lab</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="lab-answer-key-deploying-and-configuring-windows-server-2019-on-azure-vms">Lab answer key: Deploying and configuring Windows Server 2019 on Azure VMs</h1>

<h2 id="exercise-1-authoring-azure-resource-manager-arm-templates-for-azure-vm-deployment">Exercise 1: Authoring Azure Resource Manager (ARM) templates for Azure VM deployment</h2>

<h3 id="task-1-enable-the-standard-tier-of-security-center">Task 1: Enable the Standard tier of Security Center</h3>

<p>In this task, you will enable the Standard tier of Azure Security Center.</p>

<blockquote>
  <p><strong>Note</strong>: Skip this task and proceed directly to the next one if you have already upgraded Security Center in your Azure subscription to the Standard tier.</p>
</blockquote>

<ol>
  <li>From  <strong>SEA-CL1</strong>, start Microsoft Edge, and then navigate to the <a href="https://portal.azure.com">Azure portal</a>. When prompted, sign in using a user account with the Owner role in the Azure subscription you will be using in this lab.</li>
  <li>In the Azure portal, in the <strong>Search resources, services, and docs</strong> text box, on the toolbar, search for and select <strong>Security Center</strong>.</li>
  <li>On the <strong>Security Center | Getting started</strong> blade, select <strong>Upgrade</strong> and then, select <strong>Install agents</strong>.</li>
</ol>

<h3 id="task-2-generate-an-arm-template-and-parameters-files-by-using-the-azure-portal">Task 2: Generate an ARM template and parameters files by using the Azure portal</h3>

<p>In this task, you will use the Azure portal to create resource groups and create a disk in the resource group.</p>

<ol>
  <li>From  <strong>SEA-CL1</strong>, start Microsoft Edge, and then navigate to the <a href="https://portal.azure.com">Azure portal</a>. When prompted, sign in using a user account with the Owner or the Contributor role, in the Azure subscription you will be using in this lab.</li>
  <li>In the Azure portal, in the <strong>Search resources, services, and docs</strong> text box, on the toolbar, search for and select <strong>Virtual machines</strong>. In the <strong>Virtual machines</strong> blade, select <strong>+ Add</strong> and then select <strong>Virtual machine</strong>.</li>
  <li>
    <p>In the <strong>Create a virtual machine</strong> blade, on the <strong>Basics</strong> tab, specify the following settings and leave all other settings with their default values, but do not deploy it:</p>

    <p><em>Table 1: Azure VM Basics settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Subscription</td>
          <td>Use the name of the Azure subscription you will be using in this lab.</td>
        </tr>
        <tr>
          <td>Resource group</td>
          <td>ws2019-06-rg1</td>
        </tr>
        <tr>
          <td>Virtual machine name</td>
          <td>ws2019-06-vm0</td>
        </tr>
        <tr>
          <td>Region</td>
          <td>Use the name of an Azure region in which you can provision Azure virtual machines.</td>
        </tr>
        <tr>
          <td>Availability options</td>
          <td>No infrastructure redundancy required</td>
        </tr>
        <tr>
          <td>Image</td>
          <td>Windows Server 2019 Datacenter-Gen1</td>
        </tr>
        <tr>
          <td>Azure Spot instance</td>
          <td>No</td>
        </tr>
        <tr>
          <td>Size</td>
          <td>Standard D2s v3</td>
        </tr>
        <tr>
          <td>Username</td>
          <td>Mike</td>
        </tr>
        <tr>
          <td>Password</td>
          <td>Pa55w.rd1234</td>
        </tr>
        <tr>
          <td>Public inbound ports</td>
          <td>None</td>
        </tr>
        <tr>
          <td>Already have a Windows Server license</td>
          <td>No</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Select <strong>Next: Disks &gt;</strong>, and then in the <strong>Create a virtual machine</strong> blade, on the <strong>Disks</strong> tab, specify the following settings, leaving all other settings with their default values:</p>

    <p><em>Table 2: Azure VM Disks settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>OS disk type</td>
          <td>Standard HDD</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Select <strong>Next: Networking &gt;</strong>, and in the <strong>Create a virtual machine</strong> blade, on the  <strong>Networking</strong> tab, select <em>Create new** hyperlink that follows the *Virtual network** text box</em>.</p>
  </li>
  <li>
    <p>On the <strong>Create virtual network</strong> blade, specify the following settings, leaving all other settings with their default values, and then select <strong>OK</strong>:</p>

    <p><em>Table 3: Azure VM virtual network settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Name</td>
          <td>ws2019-06-vnet</td>
        </tr>
        <tr>
          <td>Address range</td>
          <td>10.60.0.0/20</td>
        </tr>
        <tr>
          <td>Subnet name</td>
          <td>subnet0</td>
        </tr>
        <tr>
          <td>Subnet range</td>
          <td>10.60.0.0/24</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Back in the <strong>Create a virtual machine</strong> blade, on the <strong>Networking</strong> tab, specify the following settings, leaving all other settings with their default values:</p>

    <p><em>Table 4: Azure VM networking settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Public IP</td>
          <td>None</td>
        </tr>
        <tr>
          <td>NIC network security group</td>
          <td>None</td>
        </tr>
        <tr>
          <td>Accelerated networking</td>
          <td>Off</td>
        </tr>
        <tr>
          <td>Place this virtual machine behind an existing load balancing solution?</td>
          <td>No</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Select <strong>Next: Management &gt;</strong>, and in the <strong>Create a virtual machine</strong> blade, on the <strong>Management</strong> tab, specify the following settings, leaving all other settings with their default values:</p>

    <p><em>Table 5: Azure VM management settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Boot diagnostics</td>
          <td>Enabled with managed storage account (reccommended)</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Select <strong>Next: Advanced &gt;</strong>, on the <strong>Advanced</strong> tab of the <strong>Create a virtual machine</strong> blade, review the available settings without modifying any of them, and then select <strong>Review + Create</strong>.</p>

    <blockquote>
      <p><strong>Note</strong>: Do not create the virtual machine. You will use for this purpose the autogenerated template.</p>
    </blockquote>
  </li>
</ol>

<h3 id="task-3-download-the-arm-template-and-parameters-files-from-the-azure-portal">Task 3: Download the ARM template and parameters files from the Azure portal</h3>

<ol>
  <li>In the Azure portal, on the <strong>Create a virtual machine</strong> blade, select <strong>Download a template for automation</strong>.</li>
  <li>On the <strong>Template</strong> blade, select <strong>Download</strong>.</li>
  <li>Select the ellipsis button next to the <strong>template.zip</strong> and, in the pop-up menu, select <strong>Show in folder</strong>. This will automatically open File Explorer displaying the content of the <strong>Downloads</strong> folder.</li>
  <li>In the File Explorer window, copy <strong>template.zip</strong> to the <strong>C:\Labfiles\Mod06</strong> folder on SEA-CL1 (create a new folder if needed).</li>
  <li>From the <strong>Template</strong> blade, navigate back to the <strong>Create a virtual machine</strong> blade, and close it without completing the deployment.</li>
</ol>

<h2 id="exercise-2-modifying-arm-templates-to-include-vm-extension-based-configuration">Exercise 2: Modifying ARM templates to include VM extension-based configuration</h2>

<h3 id="task-1-review-the-arm-template-and-parameters-files-for-azure-vm-deployment">Task 1: Review the ARM template and parameters files for Azure VM deployment</h3>

<ol>
  <li>On <strong>SEA-CL1</strong>, start File Explorer, and then browse to the <strong>C:\Labfiles\Mod06</strong> folder.</li>
  <li>Extract the content of the <strong>template.zip</strong> file into the same folder.</li>
  <li>Open the <strong>template.json</strong> file in Notepad, and review its content. Keep the Notepad window open.</li>
  <li>From File Explorer, open the <strong>C:\Labfiles\Mod06\parameters.json</strong> file in Notepad and review its content.</li>
  <li>Close the Notepad window displaying the <strong>parameters.json</strong> file.</li>
</ol>

<h3 id="task-2-add-an-azure-vm-extension-section-to-the-existing-template">Task 2: Add an Azure VM extension section to the existing template</h3>

<ol>
  <li>
    <p>On <strong>SEA-CL1</strong>, in the Notepad window displaying the content of the <strong>template.json</strong> file, insert the following code directly after the `    “resources”: [` line):</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="language-json hljs">     {
        <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Microsoft.Compute/virtualMachines/extensions"</span></span>,
        <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"[concat(parameters('virtualMachineName'), '/customScriptExtension')]"</span></span>,
        <span class="hljs-attr"><span class="hljs-attr">"apiVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-06-01"</span></span>,
        <span class="hljs-attr"><span class="hljs-attr">"location"</span></span>: <span class="hljs-string"><span class="hljs-string">"[resourceGroup().location]"</span></span>,
        <span class="hljs-attr"><span class="hljs-attr">"dependsOn"</span></span>: [
            <span class="hljs-string"><span class="hljs-string">"[concat('Microsoft.Compute/virtualMachines/', parameters('virtualMachineName'))]"</span></span>
        ],
        <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: {
            <span class="hljs-attr"><span class="hljs-attr">"publisher"</span></span>: <span class="hljs-string"><span class="hljs-string">"Microsoft.Compute"</span></span>,
            <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"CustomScriptExtension"</span></span>,
            <span class="hljs-attr"><span class="hljs-attr">"typeHandlerVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.7"</span></span>,
            <span class="hljs-attr"><span class="hljs-attr">"autoUpgradeMinorVersion"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,
            <span class="hljs-attr"><span class="hljs-attr">"settings"</span></span>: {
                <span class="hljs-attr"><span class="hljs-attr">"commandToExecute"</span></span>: <span class="hljs-string"><span class="hljs-string">"powershell.exe Install-WindowsFeature -name Web-Server -IncludeManagementTools &amp;&amp; powershell.exe remove-item 'C:\\inetpub\\wwwroot\\iisstart.htm' &amp;&amp; powershell.exe Add-Content -Path 'C:\\inetpub\\wwwroot\\iisstart.htm' -Value $('Hello World from ' + $env:computername)"</span></span>
           }
        }
     },
</code></pre>
  </li>
  <li>
    <p>Save the change and close the file.</p>
  </li>
</ol>

<h2 id="exercise-3-deploying-azure-vms-running-windows-server-2019-by-using-arm-templates">Exercise 3: Deploying Azure VMs running Windows Server 2019 by using ARM templates</h2>

<h3 id="task-1-deploy-an-azure-vm-by-using-an-arm-template">Task 1: Deploy an Azure VM by using an ARM template</h3>

<ol>
  <li>On <strong>SEA-CL1</strong>, switch to the browser window displaying the Azure portal.</li>
  <li>In the Azure portal, on the toolbar, in the <strong>Search resources, services, and docs</strong> text box, search for and select <strong>Template deployment (deploy using custom templates)</strong>.</li>
  <li>In the <strong>Custom deployment</strong> blade, select <strong>Build your own template in the editor</strong>.</li>
  <li>In the <strong>Edit template</strong> blade, select <strong>Load file</strong>, upload the template file <strong>template.json</strong> that you edited in the previous exercise, and then select <strong>Save</strong>.</li>
  <li>In the <strong>Custom deployment</strong> blade, select <strong>Edit parameters</strong>.</li>
  <li>In the <strong>Edit parameters</strong> blade, select <strong>Load file</strong>, upload the parameters file <strong>parameters.json</strong> that you reviewed in the previous exercise, and then select <strong>Save</strong>.</li>
  <li>
    <p>Back in the <strong>Custom deployment</strong> blade, specify the following settings, and leave the other settings with their default values:</p>

    <p><em>Table 6: Custom template deployment settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Subscription</td>
          <td>Use the name of the Azure subscription you are using in this lab.</td>
        </tr>
        <tr>
          <td>Resource group</td>
          <td>ws2019-06-rg1</td>
        </tr>
        <tr>
          <td>Region</td>
          <td>Use the name of the Azure region into which you can provision Azure VMs.</td>
        </tr>
        <tr>
          <td>Admin Password</td>
          <td>Pa55w.rd1234</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>Select <strong>Review + create</strong> and then select <strong>Create</strong>.</li>
  <li>
    <p>Verify that the deployment completed successfully.</p>

    <blockquote>
      <p><strong>Note</strong>: The deployment might take about 10 minutes.</p>
    </blockquote>
  </li>
</ol>

<h3 id="task-2-review-results-of-the-azure-vm-deployment">Task 2: Review results of the Azure VM deployment</h3>

<ol>
  <li>In the Azure portal, on the toolbar, in the <strong>Search resources, services, and docs</strong> text box, search for and select <strong>Resource groups</strong>.</li>
  <li>On the <strong>Resource groups</strong> blade, select the <strong>ws2019-06-rg1</strong> entry.</li>
  <li>On the <strong>ws2019-06-rg1</strong> blade, on the <strong>Overview</strong> blade, review the list of resources, including the Azure VM <strong>ws2019-06-vm0</strong>.</li>
  <li>Within the list of resources, select the Azure VM <strong>ws2019-06-vm0</strong> entry. 1. On the <strong>ws2019-06-vm0</strong> blade, select <strong>Extensions</strong>, and on the list of extensions, verify that the <strong>customScriptExtension</strong> has been provisioned successfully.</li>
  <li>Navigate back to the <strong>ws2019-06-rg1</strong> blade, and in the <strong>Settings</strong> section, select <strong>Deployments</strong>.</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>On the **ws2019-06-rg1</td>
          <td>Deployments** blade, select the <strong>Microsoft.Template</strong> link.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>On the **Microsoft.Template</td>
          <td>Overview** blade, select <strong>Template</strong>, and note that this is the same template you used for deployment.</td>
        </tr>
      </tbody>
    </table>
  </li>
</ol>

<h2 id="exercise-4-configuring-administrative-access-to-azure-vms-running-windows-server-2019">Exercise 4: Configuring administrative access to Azure VMs running Windows Server 2019</h2>

<h3 id="task-1-verify-the-azure-security-center-standard-tier">Task 1: Verify the Azure Security Center Standard tier</h3>

<ol>
  <li>In the Azure portal, on the toolbar, in the <strong>Search resources, services, and docs</strong> text box, search for and select <strong>Security Center</strong>.</li>
  <li>On the <strong>Security Center</strong> blade, in the <strong>Management</strong> section, select <strong>Coverage</strong>.</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>On the **Security Center</td>
          <td>Coverage** blade, to the right of the entry representing the Azure subscription you are using for this lab, select <strong>Edit plan</strong>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>On the <strong>Pricing</strong> blade, verify that the <strong>Standard</strong> tile is selected.</li>
</ol>

<h3 id="task-2-review-just-in-time-vm-access-settings">Task 2: Review Just in time VM access settings</h3>

<ol>
  <li>
    <table>
      <tbody>
        <tr>
          <td>Navigate to the **Security Center</td>
          <td>Azure Defender** blade and under <strong>Advanced Protection</strong> select <strong>Just-in-Time VM Access</strong>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>On the **Security Center</td>
          <td>Just in time VM access** blade, select the <strong>Unsupported</strong> tab, and note the entry representing the <strong>ws2019-06-vm0</strong> Azure VM.</td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <p><strong>Note</strong>: This is expected because the Azure VM is currently not accessible from internet and doesn’t have an NSG associated with its network interface.
Navigate to the <strong>Security Center|Azure Defender</strong> blade and under <strong>Advanced Protection</strong> select <strong>Just-in-Time VM Access</strong>.
<strong>Note</strong>: It might take about 10 minutes for the VM to appear in the Unsupported tab. You may continue with the next exercise.</p>
    </blockquote>
  </li>
</ol>

<h2 id="exercise-5-configuring-windows-server-2019-security-in-azure-vms">Exercise 5: Configuring Windows Server 2019 security in Azure VMs</h2>

<h3 id="task-1-create-and-configure-an-nsg">Task 1: Create and configure an NSG</h3>

<ol>
  <li>In the Azure portal, on the toolbar, in the <strong>Search resources, services, and docs</strong> text box, search for and select <strong>Network security groups</strong>.</li>
  <li>On the <strong>Network security groups</strong> blade, select <strong>+ Create</strong>.</li>
  <li>
    <p>On the <strong>Basics</strong> tab of the <strong>Create network security group</strong> blade, specify the following settings (leave others with their default values):</p>

    <p><em>Table 7: Network security group settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Subscription</td>
          <td>the name of the Azure subscription you are using in this lab</td>
        </tr>
        <tr>
          <td>Resource group</td>
          <td>ws2019-06-rg1</td>
        </tr>
        <tr>
          <td>Name</td>
          <td>ws2019-06-vm0-nsg1</td>
        </tr>
        <tr>
          <td>Region</td>
          <td>the name of the Azure region into which you provisioned the Azure VM ws2019-06-vm0</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>On the <strong>Create network security group</strong> blade, on the <strong>Basics</strong> tab of, select <strong>Review + create</strong>, and then select <strong>Create</strong>.</li>
  <li>In the Azure portal, navigate back to the <strong>ws2019-06-rg1</strong> blade, and then in the list of resources, select the entry representing the newly created network security group <strong>ws2019-06-vm0-nsg1</strong>.</li>
  <li>On the <strong>ws2019-06-vm0-nsg1</strong> blade, review the listing of the default inbound and outbound security rules, and then in the <strong>Settings</strong> section, select <strong>Inbound security rules</strong>.</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>On the **ws2019-06-vm0-nsg1</td>
          <td>Inbound security rules** blade, select <strong>+ Add</strong>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>On the <strong>Add inbound security rule</strong> blade, specify the following settings, leaving all others with their default values, and then select <strong>Add</strong>:</p>

    <p><em>Table 8: Network security group rule settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Source</td>
          <td>Any</td>
        </tr>
        <tr>
          <td>Source port ranges</td>
          <td>*</td>
        </tr>
        <tr>
          <td>Destination</td>
          <td>Any</td>
        </tr>
        <tr>
          <td>Destination port ranges</td>
          <td>80</td>
        </tr>
        <tr>
          <td>Protocol</td>
          <td>TCP</td>
        </tr>
        <tr>
          <td>Action</td>
          <td>Allow</td>
        </tr>
        <tr>
          <td>Priority</td>
          <td>300</td>
        </tr>
        <tr>
          <td>Name</td>
          <td>AllowHTTPInBound</td>
        </tr>
      </tbody>
    </table>
  </li>
</ol>

<h3 id="task-2-configure-inbound-http-access-to-an-azure-vm">Task 2: Configure Inbound HTTP access to an Azure VM</h3>

<ol>
  <li>In the Azure portal, navigate back to the <strong>ws2019-06-rg1</strong> blade, and then in the list of resources, select the entry representing the Azure VM <strong>ws2019-06-vm0</strong>.</li>
  <li>On the <strong>ws2019-06-vm0</strong> blade, select <strong>Networking</strong>.</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>On the **ws2019-06-vm0</td>
          <td>Networking** blade, select the link designating the network interface attached to <strong>ws2019-06-vm0</strong>.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>On the blade displaying the network interface properties, select <strong>Network security group</strong>, and then select the dropdown menu next to <strong>None</strong>.</li>
  <li>On the <strong>Choose network security group</strong> blade, select <strong>ws2019-06-vm0-nsg1</strong>, and then select <strong>Save</strong>.</li>
  <li>Back on the blade displaying the properties of the network interface, select <strong>IP configurations</strong>, and then select the <strong>ipconfig1</strong> entry.</li>
  <li>On the <strong>ipconfig1</strong> blade, in the <strong>Public IP address</strong> section, select <strong>Associate</strong> and then, below the <strong>Public IP address</strong> drop-down list, select <strong>Create new</strong>.</li>
  <li>
    <p>In the <strong>Add a public IP address</strong> window, specify the following settings and then select <strong>OK</strong>:</p>

    <p><em>Table 9: Public IP address settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Name</td>
          <td>ws2019-06-vm0-pip1</td>
        </tr>
        <tr>
          <td>SKU</td>
          <td>Standard</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>Back on the <strong>ipconfig1</strong> blade, select <strong>Save</strong>.</li>
  <li>Navigate back to the blade displaying the network interface properties, select <strong>Overview</strong>. Note the value of the public IP address assigned to the interface.</li>
  <li>Open another browser tab, navigate to that IP address, and verify that a webpage opens, displaying <strong>Hello World from ws2019-06-vm0</strong>.</li>
  <li>
    <p>From the lab computer, start the Remote Desktop app, and try connecting to the same IP address. Verify that the connection fails.</p>

    <blockquote>
      <p><strong>Note</strong>: This is expected because the Azure VM is currently not accessible from internet via TCP port 3389, only via TCP port 80.</p>
    </blockquote>
  </li>
</ol>

<h3 id="task-3-trigger-re-evaluation-of-the-jit-status-of-an-azure-vm">Task 3: Trigger re-evaluation of the JIT status of an Azure VM</h3>

<blockquote>
  <p><strong>Note</strong>: This task is necessary to trigger re-evaluation of the JIT status of the Azure VM. By default, this might take up to 24 hours.</p>
</blockquote>

<ol>
  <li>In the Azure portal, navigate back to the <strong>Azure Security Center</strong> blade, and in the <strong>Management</strong> section, select <strong>Coverage</strong>.</li>
  <li>On the <strong>Security Center | Coverage</strong> blade, select the <strong>Edit plan</strong> link.</li>
  <li>
    <p>On the <strong>Pricing</strong> blade, switch to the <strong>Free</strong> tier by selecting <strong>Azure Defender off</strong> and <strong>Save</strong>. Clear the check box <strong>Microsoft may contact me about my feedback</strong>, and select <strong>Confirm</strong>.</p>

    <blockquote>
      <p><strong>Note</strong>: Wait for about 2 minutes before you proceed to the next step.</p>
    </blockquote>
  </li>
  <li>In the Azure portal, navigate back to the <strong>Security Center | Getting started</strong> blade.</li>
  <li>On the <strong>Security Center | Getting started</strong> blade, in the <strong>Enable standard tier on 1 subscription</strong> blade, ensure that the check box next to your Azure subscription is selected, select the check box next to the workspace which name starts with the <strong>DefaultWorkspace</strong> string, select <strong>Upgrade</strong> and then, select <strong>Install agents</strong>.</li>
  <li>Refresh the browser window displaying the Azure portal.</li>
</ol>

<h3 id="task-4-configure-inbound-rdp-access-to-the-azure-vm">Task 4: Configure Inbound RDP access to the Azure VM</h3>

<ol>
  <li>In the Azure portal, navigate back to the <strong>Azure Security Center</strong> blade, select <strong>Azure Defender</strong> in the <strong>Cloud Security</strong> section, and then select <strong>Just in time VM access</strong> in the <strong>Advanced Protection</strong> section.</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>On the **Security Center</td>
          <td>Just in time VM access** blade, select the <strong>Not configured</strong> tab, and note the entry representing the <strong>ws2019-06-vm0</strong> Azure VM.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>Select the <strong>ws2019-06-vm0</strong> check box, and then select <strong>Enable JIT on 1 VMs</strong>.</li>
  <li>
    <p>On the <strong>JIT VM access configuration</strong> blade, select and hold, right-click, or access the context menu from the ellipsis next to the <strong>22</strong> entry, select <strong>Delete</strong>, and then select <strong>Save</strong>.</p>

    <blockquote>
      <p><strong>Note</strong>: It might take about 10 minutes for the VM to appear in the <strong>Not configured</strong> tab. To accelerate this process, select <strong>Configuration</strong> on the <strong>ws2019-06-vm0</strong> Azure VM and enable JIT VM access. Then select the link to <strong>Open Azure Security Center</strong>.</p>
    </blockquote>
  </li>
</ol>

<h3 id="task-5-connect-to-the-azure-vm-via-jit-vm-access">Task 5: Connect to the Azure VM via JIT VM access</h3>

<ol>
  <li>
    <p>Navigate back to the <strong>ws2019-06-vm0</strong> blade, select <strong>Connect</strong>, and then in the drop-down list, select <strong>RDP</strong>. 1. Note the message indicating that this VM has just-in-time access policy.</p>
  </li>
  <li>
    <p>In the <strong>Source IP</strong> section, select <strong>My IP</strong>, and then select <strong>Request access</strong>.</p>
  </li>
  <li>
    <p>When the request is approved, select <strong>Download RDP File</strong> and follow prompts to connect to the target Azure VM.</p>
  </li>
  <li>
    <p>When prompted for credentials, specify the following values, and then select <strong>OK</strong>:</p>

    <p><em>Table 10: Sign-in credentials</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Username</td>
          <td>Mike</td>
        </tr>
        <tr>
          <td>Password</td>
          <td>Pa55w.rd1234</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Verify that you can successfully sign in to the Azure VM via Remote Desktop and close the Remote Desktop session.</p>
  </li>
</ol>

<h2 id="exercise-6-deprovisioning-the-azure-environment">Exercise 6: Deprovisioning the Azure environment</h2>

<h3 id="task-1-start-a-powershell-session-in-cloud-shell">Task 1: Start a PowerShell session in Cloud Shell</h3>

<ol>
  <li>Back in the Azure portal, open the <strong>Azure Cloud Shell</strong> blade  by selecting the Cloud Shell button in the Azure portal.</li>
  <li>
    <p>If prompted to select either <strong>Bash</strong> or <strong>PowerShell</strong>, and then select <strong>PowerShell</strong>.</p>

    <blockquote>
      <p><strong>Note</strong>: If this is the first time you’re starting <strong>Cloud Shell</strong> and you’re presented with the <strong>You have no storage mounted</strong> message, select the subscription you are using in this lab, and then select <strong>Create storage</strong>.</p>
    </blockquote>
  </li>
</ol>

<h3 id="task-2-identify-all-azure-resources-provisioned-in-the-lab">Task 2: Identify all Azure resources provisioned in the lab</h3>

<ol>
  <li>
    <p>From the Cloud Shell blade, run the following command to list all resource groups created throughout this lab:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="language-pwsh">Get-AzResourceGroup -Name 'ws2019-06-*'
</code></pre>
  </li>
  <li>
    <p>From the Cloud Shell blade, run the following command to delete all resource groups created throughout this lab:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="language-pwsh">Get-AzResourceGroup -Name 'ws2019-06-*'|Remove-AzResourceGroup -Force -AsJob
</code></pre>

    <blockquote>
      <p><strong>Note</strong>: The command executes asynchronously (as determined by the <em>-AsJob</em> parameter), so while you will be able to run another PowerShell command immediately after within the same PowerShell session, it will take a few minutes before the resource groups are actually removed.</p>
    </blockquote>
  </li>
</ol>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS" target="_blank" class="ml-2">
                    MicrosoftLearning/WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D0a85806b00854f6395723020d7125becaf7760ed.js"></script>



</body></html>