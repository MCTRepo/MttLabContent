<!DOCTYPE html><html lang="en"><head>
        <title>
            WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D0a85806b00854f6395723020d7125becaf7760ed.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS
            </a>
            <a href="https://github.com/MicrosoftLearning/WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#task-1-create-a-custom-domain-in-azure">Task 1: Create a custom domain in Azure</a></li><li class="nav-item"><a class="nav-link" href="#task-2-create-a-user-with-the-global-administrator-role">Task 2: Create a user with the Global Administrator role</a></li><li class="nav-item"><a class="nav-link" href="#task-3-reset-the-password-for-the-user-with-the-global-administrator-role">Task 3: Reset the password for the user with the Global Administrator role</a></li><li class="nav-item"><a class="nav-link" href="#task-1-install-idfix">Task 1: Install IdFix</a></li><li class="nav-item"><a class="nav-link" href="#task-2-run-idfix">Task 2: Run IdFix</a></li><li class="nav-item"><a class="nav-link" href="#task-1-install-and-configure-azure-ad-connect">Task 1: Install and configure Azure AD Connect</a></li><li class="nav-item"><a class="nav-link" href="#task-1-verify-synchronization-in-the-azure-portal">Task 1: Verify synchronization in the Azure portal</a></li><li class="nav-item"><a class="nav-link" href="#task-2-verify-synchronization-in-the-synchronization-service-manager">Task 2: Verify synchronization in the Synchronization Service Manager</a></li><li class="nav-item"><a class="nav-link" href="#task-3-update-a-user-account-in-active-directory">Task 3: Update a user account in Active Directory</a></li><li class="nav-item"><a class="nav-link" href="#task-4-create-a-user-account-in-active-directory">Task 4: Create a user account in Active Directory</a></li><li class="nav-item"><a class="nav-link" href="#task-5-sync-changes-to-azure-ad">Task 5: Sync changes to Azure AD</a></li><li class="nav-item"><a class="nav-link" href="#task-6-verify-changes-in-azure-ad">Task 6: Verify changes in Azure AD</a></li><li class="nav-item"><a class="nav-link" href="#task-1-enable-self-service-password-reset-in-azure">Task 1: Enable self-service password reset in Azure</a></li><li class="nav-item"><a class="nav-link" href="#task-2-enable-password-writeback-in-azure-ad-connect">Task 2: Enable password writeback in Azure AD Connect</a></li><li class="nav-item"><a class="nav-link" href="#task-3-enable-pass-through-authentication-in-azure-ad-connect">Task 3: Enable pass-through authentication in Azure AD Connect</a></li><li class="nav-item"><a class="nav-link" href="#task-4-verify-pass-through-authentication-in-azure">Task 4: Verify pass-through authentication in Azure</a></li><li class="nav-item"><a class="nav-link" href="#task-5-install-and-register-the-azure-ad-password-protection-proxy-service-and-dc-agent">Task 5: Install and register the Azure AD Password Protection proxy service and DC agent</a></li><li class="nav-item"><a class="nav-link" href="#task-6-enable-password-protection-in-azure">Task 6: Enable password protection in Azure</a></li><li class="nav-item"><a class="nav-link" href="#task-1-uninstall-azure-ad-connect">Task 1: Uninstall Azure AD Connect</a></li><li class="nav-item"><a class="nav-link" href="#task-2-disable-directory-synchronization-in-azure">Task 2: Disable directory synchronization in Azure</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="lab-implementing-integration-between-ad-ds-and-azure-ad">Lab: Implementing integration between AD DS and Azure AD</h1>

<h2 id="exercise-1-preparing-azure-ad-for-ad-ds-integration">Exercise 1: Preparing Azure AD for AD DS integration</h2>

<h3 id="task-1-create-a-custom-domain-in-azure">Task 1: Create a custom domain in Azure</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, start Microsoft Edge, and then browse to the Microsoft Azure portal.</p>
  </li>
  <li>
    <p>Use the credentials that your instructor provides to sign in to the Azure portal.</p>
  </li>
  <li>
    <p>In the Azure portal, browse to <strong>Azure Active Directory</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Azure Active Directory</strong> page, select <strong>Custom domain names</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Custom domain names</strong> page, select <strong>Add custom domain</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Custom domain name</strong> pane, in the <strong>Custom domain name</strong> text box, enter <code>contoso.com</code>, and then select <strong>Add domain</strong>.</p>
  </li>
  <li>
    <p>On the <strong>contoso.com</strong> custom domain name page, review the Domain Name System (DNS) record types that you would use to verify the domain.</p>
  </li>
  <li>
    <p>Close the pane without verifying the domain name.</p>
  </li>
</ol>

<blockquote>
  <p><strong>Note:</strong> The domain name provided might not be a valid domain. While you would use DNS records to verify a domain, this lab doesn’t require that verification step.</p>
</blockquote>

<h3 id="task-2-create-a-user-with-the-global-administrator-role">Task 2: Create a user with the Global Administrator role</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, on the <strong>Azure Active Directory</strong> page in the Azure portal, select <strong>Users</strong>.</p>
  </li>
  <li>
    <p>On the <strong>All Users</strong> page, select <strong>New User</strong>.</p>
  </li>
  <li>
    <p>On the <strong>New User</strong> page, under <strong>Identity</strong>, in the <strong>User name</strong> and <strong>Name</strong> text boxes, enter <strong>admin</strong>.</p>

    <blockquote>
      <p><strong>Note:</strong> Ensure the domain name drop-down menu for the <strong>User name</strong> lists the default domain name ending with <code>onmicrosoft.com</code>.</p>
    </blockquote>
  </li>
  <li>
    <p>Under <strong>Password</strong>, select the <strong>Show Password</strong> check box. Make note of the password as you’ll use it later.</p>
  </li>
  <li>
    <p>Under <strong>Groups and roles</strong>, next to <strong>Roles</strong>, select <strong>User</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Directory roles</strong> page, from the list of roles, select <strong>Global administrator</strong>, and then select <strong>Select</strong>.</p>
  </li>
  <li>
    <p>On the <strong>New user</strong> page, select <strong>Create</strong>.</p>
  </li>
</ol>

<h3 id="task-3-reset-the-password-for-the-user-with-the-global-administrator-role">Task 3: Reset the password for the user with the Global Administrator role</h3>

<ol>
  <li>
    <p>On the Azure portal, select your user account, and then select <strong>Sign out</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Pick an account</strong> page, select <strong>Use another account</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Sign in</strong> page, enter the fully-qualified username of the user account you previously created, and then select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>For the current password, use the password that you wrote down in the previous step.</p>
  </li>
  <li>
    <p>Enter <strong>Pa55w.rdPa55w.rd</strong> as the new password, and then select <strong>Sign in</strong>.</p>
  </li>
</ol>

<blockquote>
  <p><strong>Note:</strong> The Azure portal might not allow using the shorter password when updating.</p>
</blockquote>

<h2 id="exercise-2-preparing-on-premises-ad-ds-for-azure-ad-integration">Exercise 2: Preparing on-premises AD DS for Azure AD integration</h2>

<h3 id="task-1-install-idfix">Task 1: Install IdFix</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, open Microsoft Edge, and then browse to <strong>https://github.com/microsoft/idfix</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Github</strong> page, under <strong>ClickOnce Launch</strong>, select <strong>launch</strong>.</p>
  </li>
  <li>
    <p>On the status bar, select <strong>Open file</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Application Install - Security Warning</strong> dialog box, select <strong>Install</strong>.</p>
  </li>
  <li>
    <p>In the <strong>IdFix Privacy Statement</strong> dialog box, review the disclaimer, and then select <strong>OK</strong>.</p>
  </li>
</ol>

<h3 id="task-2-run-idfix">Task 2: Run IdFix</h3>

<ol>
  <li>
    <p>In the <strong>IdFix</strong> window, select <strong>Query</strong>.</p>
  </li>
  <li>
    <p>Review the list of objects from Active Directory, and observe the <strong>ERROR</strong> and <strong>ATTRIBUTE</strong> columns. In this scenario, the value of <strong>displayName</strong> for <strong>ContosoAdmin</strong> is blank, and the tool’s recommended new value appears in the attribute column.</p>
  </li>
  <li>
    <p>In the <strong>IdFix</strong> window, from the <strong>ACTION</strong> drop-down menu, select <strong>Edit</strong>, and then select <strong>Apply</strong> to automatically implement the recommended changes.</p>
  </li>
  <li>
    <p>In the <strong>Apply Pending</strong> dialog box, select <strong>Yes</strong>.</p>
  </li>
  <li>
    <p>Close the IdFix tool.</p>
  </li>
</ol>

<h2 id="exercise-3-downloading-installing-and-configuring-azure-ad-connect">Exercise 3: Downloading, installing, and configuring Azure AD Connect</h2>

<h3 id="task-1-install-and-configure-azure-ad-connect">Task 1: Install and configure Azure AD Connect</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, open Microsoft Edge, browse to the Microsoft website, and search for “Install Azure AD Connect” to find the <strong>Microsoft Azure Active Directory Connect</strong> page.</p>
  </li>
  <li>
    <p>On the <strong>Microsoft Azure Active Directory Connect</strong> page, select <strong>Download</strong>.</p>
  </li>
  <li>
    <p>On the status bar, select <strong>Open file</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Microsoft Azure Active Directory Connect</strong> page, select the <strong>I agree to the license terms and privacy notice</strong> check box, and then select <strong>Continue</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Express Settings</strong> page, select <strong>Use express settings</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Connect to Azure AD</strong> page, enter the username and password of the Global Administrator account you created in exercise 1, then select <strong>Next</strong>.</p>
  </li>
  <li>On the <strong>Connect to AD DS</strong> page, enter the following credentials, and then select <strong>Next</strong>:
    <ul>
      <li>Username: <strong>CONTOSO\Administrator</strong></li>
      <li>Password: <strong>Pa55w.rd</strong></li>
    </ul>
  </li>
  <li>
    <p>On the <strong>Azure AD sign-in configuration</strong> page, verify that the new domain you added is in the list of Active Directory UPN Suffixes.</p>

    <blockquote>
      <p><strong>Note:</strong> The domain name provided might not be a verified domain. While you typically must verify a domain prior to installing Azure AD Connect, this lab doesn’t require that verification step.</p>
    </blockquote>
  </li>
  <li>
    <p>Select the <strong>Continue without matching all UPN suffixes to verified domains</strong> check box, and then select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Ready to configure</strong> page, review the list of actions, and then select <strong>Install</strong>.</p>
  </li>
  <li>On the <strong>Configuration complete</strong> page, select <strong>Exit</strong>.</li>
</ol>

<h2 id="exercise-4-verifying-integration-between-ad-ds-and-azure-ad">Exercise 4: Verifying integration between AD DS and Azure AD</h2>

<h3 id="task-1-verify-synchronization-in-the-azure-portal">Task 1: Verify synchronization in the Azure portal</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, start Microsoft Edge, and then browse to the Azure portal.</p>
  </li>
  <li>
    <p>Sign in to the Azure portal by using the credentials for the account you created in exercise 1.</p>
  </li>
  <li>
    <p>In the Azure portal, open <strong>Azure Active Directory</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Azure Active Directory</strong> page, select <strong>Azure AD Connect</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Azure AD Connect</strong> page, review the information under <strong>Provision from Active Directory</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Azure Active Directory</strong> page, select <strong>Users</strong>.</p>
  </li>
  <li>
    <p>Observe the list of users that synced from the on-premises Active Directory.</p>

    <blockquote>
      <p><strong>Note:</strong> When you begin directory synchronization, it can take 15 minutes for Active Directory objects to appear in the Azure AD portal.</p>
    </blockquote>
  </li>
  <li>
    <p>In Microsoft Edge, select the <strong>Back</strong> button.</p>
  </li>
  <li>
    <p>On the <strong>Azure Active Directory</strong> page, select <strong>Groups</strong>.</p>
  </li>
  <li>
    <p>Observe the list of groups that synced from the on-premises Active Directory.</p>
  </li>
</ol>

<h3 id="task-2-verify-synchronization-in-the-synchronization-service-manager">Task 2: Verify synchronization in the Synchronization Service Manager</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, on the <strong>Start</strong> menu, expand <strong>Azure AD Connect</strong>, and then select <strong>Synchronization Service</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Synchronization Service Manager</strong> window, under the <strong>Operations</strong> tab, observe the tasks that were performed to sync the Active Directory objects.</p>
  </li>
  <li>
    <p>Select the <strong>Connectors</strong> tab and observe the two connectors.</p>

    <blockquote>
      <p><strong>Note:</strong> One connector is for the on-premises Active Directory and the other is for the Azure domain.</p>
    </blockquote>
  </li>
  <li>
    <p>Close the <strong>Synchronization Service Manager</strong> window.</p>
  </li>
</ol>

<h3 id="task-3-update-a-user-account-in-active-directory">Task 3: Update a user account in Active Directory</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, from <strong>Server Manager</strong>, open <strong>Active Directory Users and Computers</strong>.</p>
  </li>
  <li>
    <p>In <strong>Active Directory Users and Computers</strong>, expand the <strong>Sales</strong> organizational unit (OU), and then open the properties for <strong>Ben Miller</strong>.</p>
  </li>
  <li>In the properties of the user, select the <strong>Organization</strong> tab.</li>
  <li>In the <strong>Job Title</strong> text box, enter <strong>Manager</strong>, and then select <strong>OK</strong>.</li>
</ol>

<h3 id="task-4-create-a-user-account-in-active-directory">Task 4: Create a user account in Active Directory</h3>

<ol>
  <li>
    <p>In <strong>Active Directory Users and Computers</strong>, right-click or access the context menu for the <strong>Sales</strong> OU, select <strong>New</strong>, and then select <strong>User</strong>.</p>
  </li>
  <li>
    <p>In the <strong>New Object - User</strong> window, enter the following user details for each field, and then select <strong>Next</strong>:</p>

    <ul>
      <li>First name: <strong>Jordan</strong></li>
      <li>Last name: <strong>Mitchell</strong></li>
      <li>User logon name: <strong>Jordan</strong></li>
    </ul>
  </li>
  <li>
    <p>In the <strong>Password</strong> and <strong>Confirm password</strong> fields, enter <strong>Pa55w.rd</strong>, and then select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>Select <strong>Finish</strong>.</p>
  </li>
</ol>

<h3 id="task-5-sync-changes-to-azure-ad">Task 5: Sync changes to Azure AD</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, on the <strong>Start</strong> menu, select <strong>Windows PowerShell</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Windows PowerShell</strong> window, enter the following, and then select Enter:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="language-powershell"> Start-ADSyncSyncCycle
</code></pre>
  </li>
</ol>

<blockquote>
  <p><strong>Note:</strong> When you begin directory synchronization, it can take 15 minutes for Active Directory objects to appear in the Azure AD portal</p>
</blockquote>

<h3 id="task-6-verify-changes-in-azure-ad">Task 6: Verify changes in Azure AD</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, start Microsoft Edge, and then browse to the Azure portal.</p>
  </li>
  <li>
    <p>On the <strong>Azure Active Directory</strong> page, select <strong>Users</strong>.</p>
  </li>
  <li>
    <p>On the <strong>All Users</strong> page, search for the user <code>Ben</code>.</p>
  </li>
  <li>
    <p>Open the properties page of the user <strong>Ben Miller</strong>, and then verify the <strong>Job title</strong> attribute that synced from Active Directory.</p>
  </li>
  <li>
    <p>In Microsoft Edge, select the <strong>Back</strong> button.</p>
  </li>
  <li>
    <p>On the <strong>All Users</strong> page, search for the user <code>Jordan</code>.</p>
  </li>
  <li>
    <p>Open the properties page of the user <strong>Jordan Mitchell</strong>, and then verify the attributes that synced from Active Directory.</p>
  </li>
  <li>
    <p>In Microsoft Edge, select the <strong>Back</strong> button twice.</p>
  </li>
</ol>

<h2 id="exercise-5-implementing-azure-ad-integration-features-in-ad-ds">Exercise 5: Implementing Azure AD integration features in AD DS</h2>

<h3 id="task-1-enable-self-service-password-reset-in-azure">Task 1: Enable self-service password reset in Azure</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, in the Azure portal, on the <strong>Azure Active Directory</strong> page, select <strong>Password reset</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Password reset</strong> page, select <strong>Get a free Premium trial to use this feature</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Activate</strong> page, under <strong>AZURE AD PREMIUM P2</strong>, select <strong>Free trial</strong>, and then select <strong>Activate</strong>.</p>
  </li>
  <li>
    <p>Right-click or access the context menu for the <strong>Start</strong> menu, select <strong>Shut down or sign out</strong>, and then select <strong>Sign out</strong>.</p>
  </li>
  <li>sign in to <strong>SEA-SVR2</strong> by using the following credentials:
    <ul>
      <li>Username: <strong>CONTOSO\Administrator</strong></li>
      <li>Password: <strong>Pa55w.rd</strong></li>
    </ul>
  </li>
  <li>
    <p>Start Microsoft Edge, and then browse to the Azure portal.</p>
  </li>
  <li>
    <p>Sign in to the Azure portal by using the credentials of the account you created in exercise 1.</p>
  </li>
  <li>
    <p>In the Azure portal, in the <strong>Search resources, services, and docs</strong> text box, enter <strong>Azure Active Directory</strong>, and then select <strong>Azure Active Directory</strong> from the drop-down menu.</p>
  </li>
  <li>
    <p>On the <strong>Azure Active Directory</strong> page, select <strong>Password reset</strong>.</p>
  </li>
  <li>On the <strong>Password reset</strong> page, observe how you can select the scope of users to which to apply the configuration.</li>
</ol>

<blockquote>
  <p><strong>Note:</strong> Don’t enable the password reset feature because it will break the configuration steps that are required later in this lab.</p>
</blockquote>

<h3 id="task-2-enable-password-writeback-in-azure-ad-connect">Task 2: Enable password writeback in Azure AD Connect</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, open <strong>Azure AD Connect</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Microsoft Azure Active Directory Connect</strong> window, select <strong>Configure</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Additional tasks</strong> page, select <strong>Customize synchronization options</strong>, and then select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Connect to Azure AD</strong> page, enter the username and password of the user account you created in exercise 1, and then select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Connect your directories</strong> page, select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Domain and OU filtering</strong> page, select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Optional features</strong> page, select <strong>Password writeback</strong>, and then select <strong>Next</strong>.</p>

    <blockquote>
      <p><strong>Note:</strong> Password writeback is required for self-service password reset. This allows passwords changed by users in Azure AD to sync to the on-premises Active Directory.</p>
    </blockquote>
  </li>
  <li>
    <p>On the <strong>Ready to configure</strong> page, review the list of actions to be performed, and then select <strong>Configure</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Configuration complete</strong> page, select <strong>Exit</strong>.</p>
  </li>
</ol>

<h3 id="task-3-enable-pass-through-authentication-in-azure-ad-connect">Task 3: Enable pass-through authentication in Azure AD Connect</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, on the <strong>Start</strong> menu, expand <strong>Azure AD Connect</strong>, and then select <strong>Azure AD Connect</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Microsoft Azure Active Directory Connect</strong> window, select <strong>Configure</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Additional tasks</strong> page, select <strong>Change user sign-in</strong>, then select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Connect to Azure AD</strong> page, enter the username and password of the user account you created in exercise 1, and then select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>On the <strong>User sign-in</strong> page, select <strong>Pass-through authentication</strong>.</p>
  </li>
  <li>
    <p>Verify that the <strong>Enable single sign-on</strong> check box is selected, and then select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Enable single sign-on</strong> page, select <strong>Enter credentials</strong>.</p>
  </li>
  <li>In the <strong>Forest credentials</strong> dialog box, enter the following credentials, and then select <strong>OK</strong>:
    <ul>
      <li>Username: <strong>Administrator</strong></li>
      <li>Password: <strong>Pa55w.rd</strong></li>
    </ul>
  </li>
  <li>
    <p>On the <strong>Enable single sign-on</strong> page, verify that there’s a green check mark next to <strong>Enter credentials</strong>, and then select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Ready to configure</strong> page, review the list of actions to be performed, and then select <strong>Configure</strong>.</p>
  </li>
  <li>On the <strong>Configuration complete</strong> page, select <strong>Exit</strong>.</li>
</ol>

<h3 id="task-4-verify-pass-through-authentication-in-azure">Task 4: Verify pass-through authentication in Azure</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, on the <strong>Azure Active Directory</strong> page in the Azure portal, select <strong>Azure AD Connect</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Azure AD Connect</strong> page, review the information under <strong>User Sign-In</strong>.</p>
  </li>
  <li>
    <p>Under <strong>User Sign-In</strong>, select <strong>Seamless single sign-on</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Seamless single sign-on</strong> page, review the on-premises domain name.</p>
  </li>
  <li>
    <p>In Microsoft Edge, select the <strong>Back</strong> button to return to the previous page.</p>
  </li>
  <li>
    <p>On the <strong>Azure Active Directory</strong> page in the Azure portal, select <strong>Azure AD Connect</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Azure AD Connect</strong> page, under <strong>User Sign-In</strong>, select <strong>Pass-through authentication</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Pass-through authentication</strong> page, review the list of servers under <strong>Authentication Agent</strong>.</p>
  </li>
</ol>

<blockquote>
  <p><strong>Note:</strong> To install the Azure AD Authentication Agent on multiple servers in your environment, you can open the <strong>Azure AD Connect</strong> page from the server, and then choose the <strong>Download</strong> option to install it on other servers.</p>
</blockquote>

<h3 id="task-5-install-and-register-the-azure-ad-password-protection-proxy-service-and-dc-agent">Task 5: Install and register the Azure AD Password Protection proxy service and DC agent</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, start Microsoft Edge, and then browse to the Microsoft website, and search for “Azure AD Password Protection for Windows Server Active Directory” to find the <strong>Azure AD Password Protection for Windows Server Active Directory</strong> page, and select <strong>Download</strong>.</p>
  </li>
  <li>
    <p>On <strong>the Azure AD Password Protection for Windows Server Active Directory</strong> page, select the AzureADPasswordProtectionProxySetup.msi and the AzureADPasswordProtectionDCAgentSetup.msi files, and then select <strong>Next</strong>.</p>
  </li>
  <li>
    <p>Select <strong>Download</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Download multiple files</strong> dialog box, select <strong>Allow</strong>.</p>

    <blockquote>
      <p><strong>Note:</strong> We recommend installing the proxy service on a server that isn’t a domain controller.</p>
    </blockquote>
  </li>
  <li>
    <p>On the status bar, locate the <strong>AzureADPasswordProtectionProxySetup.msi</strong> file, and then select <strong>Open file</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Azure AD Password Protection Proxy Bundle Setup</strong> window, select the <strong>I agree to the license terms and conditions</strong> check box, and then select <strong>Install</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Completed the Azure AD Password Protection Proxy Setup Wizard</strong> window, select <strong>Finish</strong>.</p>
  </li>
  <li>
    <p>Open the <strong>AzureADPasswordProtectionDCAgentSetup.msi</strong> file to install the DC agent.</p>
  </li>
  <li>
    <p>In the <strong>Azure AD Password Protection DC Agent Setup</strong> window, select the <strong>I agree to the license terms and conditions</strong> check box, and then select <strong>Install</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Completed the Azure AD Password Protection DC Password Protection Proxy Setup Wizard</strong> window, select <strong>Finish</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Azure AD Password Protection DC Agent Setup</strong> dialog box, select <strong>No</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Start</strong> menu, select <strong>Windows PowerShell</strong>.</p>
  </li>
  <li>
    <p>In Windows PowerShell, enter the following command, and then select Enter:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="language-powershell"> Get-Service AzureADPasswordProtectionProxy | fl
</code></pre>
  </li>
  <li>
    <p>Verify that the status is <strong>Running</strong>.</p>
  </li>
  <li>
    <p>To register the proxy service with Azure AD, enter the following command, and then select Enter:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="language-powershell"> Register-AzureADPasswordProtectionProxy -AccountUpn &lt;NewUser&gt;
</code></pre>

    <blockquote>
      <p><strong>Note:</strong> Replace &lt;NewUser&gt; with the fully-qualified user principal name of the account you created in exercise 1.</p>
    </blockquote>
  </li>
  <li>
    <p>In the authentication window, enter the credentials for the account, and then select <strong>Sign in</strong>.</p>
  </li>
  <li>
    <p>To register the proxy service with on-premises Active Directory, in Windows PowerShell, enter the following command, and then select Enter:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="language-powershell"> Register-AzureADPasswordProtectionForest -AccountUpn &lt;NewUser&gt;
</code></pre>

    <blockquote>
      <p><strong>Note:</strong> Replace &lt;NewUser&gt; with the fully-qualified user principal name of the account you created in exercise 1.</p>
    </blockquote>
  </li>
</ol>

<h3 id="task-6-enable-password-protection-in-azure">Task 6: Enable password protection in Azure</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, in the Azure portal, on the <strong>Azure Active Directory</strong> page, select <strong>Security</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Security</strong> page, select <strong>Authentication methods</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Authentication methods</strong> page, select <strong>Password protection</strong>.</p>
  </li>
  <li>
    <p>On the <strong>Password protection</strong> page, change the slider for <strong>Enforce custom list</strong> to <strong>Yes</strong>.</p>
  </li>
  <li>In the <strong>Custom banned password list</strong> text box, enter the following words (one per line):
    <ul>
      <li><code>Contoso</code></li>
      <li><code>London</code></li>
    </ul>

    <blockquote>
      <p><strong>Note:</strong> The list of banned passwords should be words that are relevant to your organization.</p>
    </blockquote>
  </li>
  <li>
    <p>Confirm the slider for <strong>Enable password protection on Windows Server Active Directory</strong> is set to <strong>Yes</strong>.</p>
  </li>
  <li>Confirm the slider for <strong>Mode</strong> is set to <strong>Audit</strong>, and then select <strong>Save</strong>.</li>
</ol>

<h2 id="exercise-6-cleaning-up">Exercise 6: Cleaning up</h2>

<h3 id="task-1-uninstall-azure-ad-connect">Task 1: Uninstall Azure AD Connect</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, on the <strong>Start</strong> menu, select <strong>Control Panel</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Control Panel</strong> window, under <strong>Programs</strong>, select <strong>Uninstall a program</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Uninstall or change a program</strong> window, select <strong>Microsoft Azure AD Connect</strong>, and then select <strong>Uninstall</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Programs and features</strong> dialog box, select <strong>Yes</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Uninstall Azure AD Connect</strong> window, select <strong>Remove</strong>.</p>
  </li>
  <li>
    <p>After the uninstall completes, in the <strong>Uninstall Azure AD Connect</strong> window, select <strong>Exit</strong>.</p>
  </li>
</ol>

<h3 id="task-2-disable-directory-synchronization-in-azure">Task 2: Disable directory synchronization in Azure</h3>

<ol>
  <li>
    <p>On <strong>SEA-SVR2</strong>, on the <strong>Start</strong> menu, select <strong>Windows PowerShell</strong>.</p>
  </li>
  <li>
    <p>To install the Microsoft Online module for Azure AD, in Windows PowerShell, enter the following command, and then select Enter:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="language-powershell"> Install-Module -Name MSOnline
</code></pre>
  </li>
  <li>
    <p>When prompted to install the NuGet provider, enter <strong>Y</strong>, and then select Enter.</p>
  </li>
  <li>
    <p>When prompted to install the modules from an untrusted repository, enter <strong>Y</strong>, and then select Enter.</p>
  </li>
  <li>
    <p>In Windows PowerShell, enter the following command to provide credentials to Azure, and then select Enter:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="language-powershell"> $msolcred=Get-Credential
</code></pre>
  </li>
  <li>
    <p>In the <strong>Windows PowerShell credential request</strong> dialog box, enter the credentials of the user account you created in exercise 1, and then select <strong>OK</strong>.</p>
  </li>
  <li>
    <p>In Windows PowerShell, enter the following to connect to Azure, and then select Enter:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="language-powershell"> Connect-MsolService -Credential $msolcred
</code></pre>
  </li>
  <li>
    <p>In Windows PowerShell, enter the following to disable directory synchronization in Azure, and then select Enter:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="language-powershell"> Set-MsolDirSyncEnabled -EnableDirSync $false
</code></pre>
  </li>
  <li>
    <p>When prompted to confirm, enter <strong>Y</strong>, and then select Enter.</p>
  </li>
</ol>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS" target="_blank" class="ml-2">
                    MicrosoftLearning/WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D0a85806b00854f6395723020d7125becaf7760ed.js"></script>



</body></html>