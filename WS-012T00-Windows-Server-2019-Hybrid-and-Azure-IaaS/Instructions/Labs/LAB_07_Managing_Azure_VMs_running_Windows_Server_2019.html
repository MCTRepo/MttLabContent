<!DOCTYPE html><html lang="en"><head>
        <title>
            WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D0a85806b00854f6395723020d7125becaf7760ed.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS
            </a>
            <a href="https://github.com/MicrosoftLearning/WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#task-1-create-a-resource-group">Task 1: Create a resource group</a></li><li class="nav-item"><a class="nav-link" href="#task-2-upload-powershell-scripts-into-cloud-shell-home-directory">Task 2: Upload PowerShell scripts into Cloud Shell home directory</a></li><li class="nav-item"><a class="nav-link" href="#task-3-create-two-azure-vms-by-using-azure-cloud-shell">Task 3: Create two Azure VMs by using Azure Cloud Shell</a></li><li class="nav-item"><a class="nav-link" href="#task-1-install-microsoft-edge-and-windows-admin-center-on-the-mod07gateway-azure-vm">Task 1: Install Microsoft Edge and Windows Admin Center on the Mod07Gateway Azure VM</a></li><li class="nav-item"><a class="nav-link" href="#task-2-add-the-mod07target-vm-to-windows-admin-center-on-mod07gateway-vm">Task 2: Add the Mod07Target VM to Windows Admin Center on Mod07Gateway VM</a></li><li class="nav-item"><a class="nav-link active" href="#task-3-use-windows-admin-center-to-install-the-web-server-role-on-mod07target">Task 3: Use Windows Admin Center to install the Web Server role on Mod07Target</a></li><li class="nav-item"><a class="nav-link" href="#task-1-configure-powershell-remoting-of-an-azure-vm-running-windows-server-2019">Task 1: Configure PowerShell Remoting of an Azure VM running Windows Server 2019</a></li><li class="nav-item"><a class="nav-link" href="#task-2-manage-windows-server-2019-running-in-an-azure-vm-by-using-powershell-remoting">Task 2: Manage Windows Server 2019 running in an Azure VM by using PowerShell Remoting</a></li><li class="nav-item"><a class="nav-link" href="#task-1-use-the-enableremoteps-command">Task 1: Use the EnableRemotePS command</a></li><li class="nav-item"><a class="nav-link" href="#task-2-use-the-runpowershellscript-command">Task 2: Use the RunPowerShellScript command</a></li><li class="nav-item"><a class="nav-link" href="#task-1-create-a-storage-account">Task 1: Create a storage account</a></li><li class="nav-item"><a class="nav-link" href="#task-2-configure-boot-diagnostics-for-an-azure-vm">Task 2: Configure boot diagnostics for an Azure VM</a></li><li class="nav-item"><a class="nav-link" href="#task-3-use-the-serial-console">Task 3: Use the serial console</a></li><li class="nav-item"><a class="nav-link" href="#task-1-enable-the-guest-configuration-resource-provider">Task 1: Enable the Guest Configuration resource provider</a></li><li class="nav-item"><a class="nav-link" href="#task-2-assign-an-azure-policy-guest-configuration-by-using-the-azure-portal">Task 2: Assign an Azure Policy Guest Configuration by using the Azure portal</a></li><li class="nav-item"><a class="nav-link" href="#task-3-review-results-of-the-guest-configuration-policy">Task 3: Review results of the Guest Configuration policy</a></li><li class="nav-item"><a class="nav-link" href="#task-1-remove-the-policy-assignment">Task 1: Remove the policy assignment</a></li><li class="nav-item"><a class="nav-link" href="#task-2-delete-the-ws2019-07-rg1-resource-group">Task 2: Delete the ws2019-07-rg1 resource group</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="lab-managing-azure-vms-running-windows-server-2019">Lab: Managing Azure VMs running Windows Server 2019</h1>

<h2 id="lab-scenario">Lab scenario</h2>

<p>To address concerns regarding the outdated operational model and Information Security concerns regarding additional controls that should be applied to Azure VMs running Windows Server-based workloads, you will test a new approach to management tasks that target Windows Server 2019 running in Azure VMs.</p>

<p>Rather than relying on Remote Desktop sessions—which are currently used for management of the on-premises computers running the Windows OS—for this purpose you will use a range of other tools at your disposal that streamline the running of management tasks.</p>

<h2 id="objectives">Objectives</h2>

<p>After completing this lab, you’ll be able to:</p>

<ul>
  <li>Provision Azure VMs running Windows Server 2019.</li>
  <li>Manage Azure VMs running Windows Server 2019 by using Windows Admin Center.</li>
  <li>Manage Windows Server 2019 running in Azure VMs by using PowerShell Remoting.</li>
  <li>Manage Windows Server 2019 running in Azure VMs by using Run Command.</li>
  <li>Manage Windows Server 2019 in Azure VMs by using the serial console.</li>
  <li>Manage Windows Server 2019 in Azure VMs by using Azure Policy Guest Configuration.</li>
  <li>Deprovision the Azure lab environment.</li>
</ul>

<h2 id="estimated-time-60-minutes">Estimated time: 60 minutes</h2>

<h2 id="lab-setup">Lab setup</h2>

<p>You’ll need <strong>WS-012T00A-SEA-DC1</strong> and <strong>WS-012T00A-SEA-CL1</strong> to complete this lab.</p>

<p>Sign in to <strong>SEA-CL1</strong> as <strong>Contoso\Administrator</strong> by using <strong>Pa55w.rd</strong> as the password.</p>

<p>You will browse to the Azure portal from <strong>SEA-CL1</strong> and then use Azure VMs running Windows Server 2019 installed by using Azure PowerShell.</p>

<h2 id="exercise-1-provisioning-azure-vms-running-windows-server-2019">Exercise 1: Provisioning Azure VMs running Windows Server 2019</h2>

<h2 id="scenario">Scenario</h2>

<p>You need to test a number of Azure VM management scenarios. To start, you will provision Azure VMs running Windows Server 2019 by using Azure PowerShell.</p>

<p>The main tasks for this exercise are to complete the following preparation steps:</p>

<ol>
  <li>Create a resource group.</li>
  <li>Upload PowerShell scripts into Cloud Shell home directory.</li>
  <li>Create two Azure VMs by using Azure Cloud Shell.</li>
</ol>

<h3 id="task-1-create-a-resource-group">Task 1: Create a resource group</h3>

<ol>
  <li>On <strong>SEA-CL1</strong>, start Microsoft Edge, navigate to the <a href="https://portal.azure.com">Azure portal</a>, and sign in by using a user account with the Owner role in the Azure subscription you will be using in this lab.</li>
  <li>
    <p>In the Azure portal, create a resource group with the following settings:</p>

    <p><em>Table 1: Resource group settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Subscription</td>
          <td>Use the name of the Azure subscription you will be using in this lab.</td>
        </tr>
        <tr>
          <td>Resource group</td>
          <td>ws2019-07-rg1</td>
        </tr>
        <tr>
          <td>Region</td>
          <td>Use the name of an Azure region in which you can provision Azure virtual machines.</td>
        </tr>
      </tbody>
    </table>
  </li>
</ol>

<h3 id="task-2-upload-powershell-scripts-into-cloud-shell-home-directory">Task 2: Upload PowerShell scripts into Cloud Shell home directory</h3>

<ol>
  <li>
    <p>On <strong>SEA-CL1</strong>, in the Microsoft Edge browser displaying the Azure portal, in a new browser tab, start a PowerShell session in the <a href="https://shell.azure.com">Cloud Shell</a>. If prompted to authenticate, sign in by using a user account with the Owner role in the Azure subscription you are using in this lab.</p>

    <blockquote>
      <p><strong>Note</strong>: If this is the first time you are starting <strong>Cloud Shell</strong>, use the default settings to configure it.</p>
    </blockquote>
  </li>
  <li>
    <p>In the Cloud Shell tab, upload the following scripts from <strong>C:\Labfiles\Mod07\Scripts</strong>:</p>

    <ul>
      <li><strong>Mod07Network.ps1</strong></li>
      <li><strong>Mod07GW.ps1</strong></li>
      <li><strong>Mod07TG.ps1</strong></li>
    </ul>
  </li>
</ol>

<h3 id="task-3-create-two-azure-vms-by-using-azure-cloud-shell">Task 3: Create two Azure VMs by using Azure Cloud Shell</h3>

<ol>
  <li>
    <p>On <strong>SEA-CL1</strong>, in the Microsoft Edge browser displaying the Cloud Shell, from the PowerShell prompt, run the following command to create virtual network resources:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="language-powershell">./Mod07Network.ps1
</code></pre>

    <blockquote>
      <p><strong>Note</strong>: Ignore warnings regarding changes to PowerShell syntax.</p>
    </blockquote>
  </li>
  <li>
    <p>In the Cloud Shell window, at the PowerShell prompt, run the following command to create the <strong>Mod07Gateway</strong> VM:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="language-powershell">./Mod07GW.ps1
</code></pre>
  </li>
  <li>
    <p>When prompted, authenticate by using the following credentials:</p>

    <p><em>Table 2: Mod07Gateway VM local Administrator credentials</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>User</td>
          <td>Student</td>
        </tr>
        <tr>
          <td>Password</td>
          <td>Pa55w.rd1234</td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <p><strong>Note</strong>: It might take about 3-5 minutes to create the <strong>Mod07Gateway</strong> VM.</p>
    </blockquote>
  </li>
  <li>
    <p>In the Cloud Shell window, at the PowerShell prompt, run the following command to create the <strong>Mod07Target</strong> VM:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="language-powershell">./Mod07TG.ps1
</code></pre>
  </li>
  <li>
    <p>When prompted, authenticate by using the following credentials:</p>

    <p><em>Table 3: Mod07Target VM local Administrator credentials</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>User</td>
          <td>Student</td>
        </tr>
        <tr>
          <td>Password</td>
          <td>Pa55w.rd1234</td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <p><strong>Note</strong>: It might take approximately three to five minutes to create the <strong>Mod07Target</strong> VM.</p>
    </blockquote>

    <blockquote>
      <p><strong>Note</strong>: Leave the Azure Cloud Shell tab open, because you’ll use it later in this lab. After 20 minutes, the Cloud Shell will automatically disconnect, but you can select the <strong>Reconnect</strong> button to return to the PowerShell prompt.</p>
    </blockquote>
  </li>
</ol>

<h2 id="exercise-2-managing-azure-vms-running-windows-server-2019-by-using-windows-admin-center">Exercise 2: Managing Azure VMs running Windows Server 2019 by using Windows Admin Center</h2>

<h2 id="scenario-1">Scenario</h2>

<p>To manage Azure VMs in a consistent manner, you’ll install Windows Admin Center into an Azure VM and use it for common management tasks on another Azure VM.</p>

<p>The main tasks for this exercise are:</p>

<ol>
  <li>Install Microsoft Edge and Windows Admin Center on the Mod07Gateway Azure VM.</li>
  <li>Add the Mod07Target VM to Windows Admin Center on Mod07Gateway VM.</li>
  <li>Use Windows Admin Center to install the Web Server role on Mod07Target.</li>
</ol>

<h3 id="task-1-install-microsoft-edge-and-windows-admin-center-on-the-mod07gateway-azure-vm">Task 1: Install Microsoft Edge and Windows Admin Center on the Mod07Gateway Azure VM</h3>

<ol>
  <li>On <strong>SEA-CL1</strong>, in the Microsoft Edge window, from the Azure portal, connect to <strong>Mod07Gateway</strong> via Remote Desktop.</li>
  <li>When prompted to authenticate, sign in as <strong>Student</strong> with the <strong>Pa55w.rd1234</strong> password.</li>
  <li>Within the Remote Desktop session to <strong>Mod07Gateway</strong>, disable the <strong>IE Enhanced Security Configuration</strong> for Administrators.</li>
  <li>Within the Remote Desktop session to <strong>Mod07Gateway</strong>, use Internet Explorer to download Microsoft Edge and install it with the default settings.
    <blockquote>
      <p><strong>Note</strong>: The <strong>Mod07Gateway</strong> may be need time to apply Windows Updates before the Edge browser can be installed.  Installing a Chrome browser can be a quicker option.</p>
    </blockquote>
  </li>
  <li>Within the Remote Desktop session to <strong>Mod07Gateway</strong>, use Microsoft Edge to download <a href="https://aka.ms/windows-admin-center-overview">Windows Admin Center</a>.</li>
  <li>Within the Remote Desktop session to <strong>Mod07Gateway</strong>, install Windows Admin Center with the default settings.</li>
</ol>

<h3 id="task-2-add-the-mod07target-vm-to-windows-admin-center-on-mod07gateway-vm">Task 2: Add the Mod07Target VM to Windows Admin Center on Mod07Gateway VM</h3>

<ol>
  <li>Within the Remote Desktop session to <strong>Mod07Gateway</strong>, use Microsoft Edge to access the locally installed Windows Admin Center instance at <code>https://Mod07Gateway</code>.</li>
  <li>From <strong>Windows Admin Center</strong>, add a connection to <strong>Mod07Target</strong>.</li>
</ol>

<h3 id="task-3-use-windows-admin-center-to-install-the-web-server-role-on-mod07target">Task 3: Use Windows Admin Center to install the Web Server role on Mod07Target</h3>

<ol>
  <li>Within the Remote Desktop session to <strong>Mod07Gateway</strong>, in the Microsoft Edge browser, open a new tab and browse to <code>http://mod07target</code>. Note that the target page can’t be reached. Keep the tab open and switch back to <strong>Windows Admin Center</strong>.</li>
  <li>In <strong>Windows Admin Center</strong>, connect to <strong>Mod07Target</strong> and use the <strong>Roles &amp; features</strong> feature to install on it the <strong>Web Server (IIS)</strong> server role and its services.</li>
  <li>When the installation completes, switch to the Microsoft Edge tab targeting the <code>http://mod07target</code> URL and refresh the browser page. Verify that the browser displays the <strong>Internet Information Services Welcome</strong> page.</li>
  <li>Switch back to <strong>Windows AdminCenter</strong> and, from the connection to <strong>Mod07Target</strong>, shut down its operating system.</li>
  <li>Leave the Remote Desktop connection to <strong>Mod07Gateway</strong> open.</li>
</ol>

<h2 id="exercise-3-managing-windows-server-2019-running-in-azure-vms-by-using-powershell-remoting">Exercise 3: Managing Windows Server 2019 running in Azure VMs by using PowerShell Remoting</h2>

<h2 id="scenario-2">Scenario</h2>

<p>You must verify that you can perform scripted tasks targeting Azure VMs via PowerShell Remoting. For this purpose, you’ll use Azure Cloud Shell.</p>

<p>The main tasks for this exercise are:</p>

<ol>
  <li>Configure PowerShell Remoting of an Azure VM running Windows Server 2019.</li>
  <li>Manage Windows Server 2019 running in an Azure VM by using PowerShell Remoting.</li>
</ol>

<h3 id="task-1-configure-powershell-remoting-of-an-azure-vm-running-windows-server-2019">Task 1: Configure PowerShell Remoting of an Azure VM running Windows Server 2019</h3>

<ol>
  <li>
    <p>On <strong>SEA-CL1</strong>, in the Microsoft Edge window, switch to Azure Cloud Shell. If needed, select <strong>Reconnect</strong>.</p>
  </li>
  <li>
    <p>From the Cloud Shell blade, run the following commands to disable certificate verification for PowerShell remoting.</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="language-pwsh">install-module pswsman
Disable-WSManCertVerification -All
</code></pre>
  </li>
  <li>
    <p>In the Cloud Shell window, at the PowerShell prompt, run the following command to start the <strong>Mod07Target</strong> Azure VM:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="language-powershell">Start-AzVM -ResourceGroupName ws2019-07-rg1 -Name Mod07Target
</code></pre>
  </li>
  <li>
    <p>After the VM successfully starts, in the Cloud Shell window, at the PowerShell prompt, run the following command to configure PowerShell Remoting on the <strong>Mod07Target</strong> Azure VM:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="language-powershell">Enable-AzVMPSRemoting -Name 'Mod07Target' -ResourceGroupName 'ws2019-07-rg1' -Protocol https -OsType Windows
</code></pre>

    <blockquote>
      <p><strong>Note</strong>: The <strong>Enable-AzureVMPSRemoting</strong> cmdlet configures WinRM on the target VM and configures its Network Security Group to allow access via Windows Remote Management.</p>
    </blockquote>
  </li>
</ol>

<h3 id="task-2-manage-windows-server-2019-running-in-an-azure-vm-by-using-powershell-remoting">Task 2: Manage Windows Server 2019 running in an Azure VM by using PowerShell Remoting</h3>

<ol>
  <li>
    <p>In the Cloud Shell window, at the PowerShell prompt, run the following command to list Windows services that have names that begin with <strong>Win</strong> installed within the operating system of the <strong>Mod07Target</strong> Azure VM:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="language-powershell">Invoke-AzVMCommand -Name 'Mod07Target' -ResourceGroupName 'ws2019-07-rg1' -ScriptBlock {get-service win*} -Credential $Cred
</code></pre>
  </li>
  <li>When prompted, authenticate as <strong>Student</strong> with the <strong>Pa55w.rd1234</strong> password.</li>
  <li>Review the results displayed in the Cloud Shell pane and verify that they include a list of services that have names that begin with <strong>Win</strong>.</li>
  <li>
    <p>In the Cloud Shell window, at the PowerShell prompt, run the following command to start an interactive PowerShell Remoting session within the operating system of the <strong>Mod07Target</strong> Azure VM:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="language-powershell">Enter-AzVM -Name Mod07Target -ResourceGroupName ws2019-07-rg1 -Credential $Cred
</code></pre>
  </li>
  <li>
    <p>When prompted, authenticate as <strong>Student</strong> with the <strong>Pa55w.rd1234</strong> password.</p>

    <blockquote>
      <p><strong>Note</strong>: You will be presented with an interactive session prompt. This allows you to run Windows PowerShell cmdlets directly against the target VM until you exit the session.</p>
    </blockquote>
  </li>
  <li>
    <p>At the PowerShell Remoting session, run the following command to list locally installed Windows services that have names that begin with <strong>Win</strong>:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock8" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock8" class="mt-0"><code class="language-powershell">Get-Service Win*
</code></pre>

    <blockquote>
      <p><strong>Note</strong>: The results should include the same list of services that you reviewed earlier in this task.</p>
    </blockquote>
  </li>
  <li>
    <p>At the PowerShell Remoting session, run the following command to exit the interactive PowerShell Remoting session.</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock9" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock9" class="mt-0"><code class="language-powershell">Exit
</code></pre>
  </li>
  <li>Keep the <strong>Cloud Shell</strong> tab open.</li>
</ol>

<h2 id="exercise-4-managing-windows-server-2019-running-in-azure-vms-by-using-run-command">Exercise 4: Managing Windows Server 2019 running in Azure VMs by using Run Command</h2>

<h2 id="scenario-3">Scenario</h2>

<p>You want to explore the functionality of the Run command in the Azure portal for running simple commands targeting the Windows Server 2019 OS running in Azure VMs.</p>

<p>The main tasks for this exercise are:</p>

<ol>
  <li>Use the <strong>EnableRemotePS</strong> command.</li>
  <li>Use the <strong>RunPowerShellScript</strong> command.</li>
</ol>

<h3 id="task-1-use-the-enableremoteps-command">Task 1: Use the EnableRemotePS command</h3>

<ol>
  <li>On <strong>SEA-CL1</strong>, on the Microsoft Edge tab displaying the Azure Portal, navigate to the <strong>Mod07Target</strong> blade.</li>
  <li>From the <strong>Mod07Target</strong> blade, navigate to the <strong>Mod07Target | Run command</strong> blade.</li>
  <li>From the <strong>Mod07Target | Run command</strong> blade, use the <strong>EnableRemotePS</strong> feature to enable PowerShell Remoting on the target operating system.</li>
  <li>Wait until script execution completes.</li>
</ol>

<h3 id="task-2-use-the-runpowershellscript-command">Task 2: Use the RunPowerShellScript command</h3>

<ol>
  <li>On <strong>SEA-CL1</strong>, on the Microsoft Edge tab displaying the Azure Portal, from the <strong>Mod07Target | Run command</strong> blade, use the <strong>RunPowerShellScript</strong> feature to run <code>Get-Service Win*</code> Windows PowerShell cmdlet.</li>
  <li>Verify that the results include the same list of services that you reviewed in the previous task.</li>
  <li>Close the <strong>Run Command Script</strong> blade.</li>
</ol>

<h2 id="exercise-5-managing-windows-server-2019-in-azure-vms-by-using-the-serial-console">Exercise 5: Managing Windows Server 2019 in Azure VMs by using the serial console</h2>

<h2 id="scenario-4">Scenario</h2>

<p>You must ensure that you can recover the Windows Server 2019 OS running in an Azure VM, in case you can no longer access it using either RDP, the Run command, or PowerShell Remoting. To accomplish this, you’ll test the Azure VM Serial console connection.</p>

<p>The main tasks for this exercise are:</p>

<ol>
  <li>Create a storage account.</li>
  <li>Configure boot diagnostics for an Azure VM.</li>
  <li>Use the serial console.</li>
</ol>

<h3 id="task-1-create-a-storage-account">Task 1: Create a storage account</h3>

<blockquote>
  <p><strong>Note</strong>: Storage account names must be globally unique and can contain between 3 and 24 characters, including lowercase letters and numbers, starting with a letter.</p>
</blockquote>

<ol>
  <li>On <strong>SEA-CL1</strong>, in the Microsoft Edge browser, in the Azure portal, navigate to the <strong>Storage accounts</strong> blade.</li>
  <li>
    <p>From the <strong>Storage accounts</strong> blade, create a storage account with the following settings (leave others with their default values):</p>

    <p><em>Table 4: Storage account settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Subscription</td>
          <td>the name of the Azure subscription you are using in this lab</td>
        </tr>
        <tr>
          <td>Resource group</td>
          <td>ws2019-07-rg1</td>
        </tr>
        <tr>
          <td>Storage account name</td>
          <td>any globally unique name between 3 and 24 in length consisting of letters and digits</td>
        </tr>
        <tr>
          <td>Location</td>
          <td>the name of the Azure region where you created the resource group in the previous task</td>
        </tr>
        <tr>
          <td>Performance</td>
          <td>Standard</td>
        </tr>
        <tr>
          <td>Account kind</td>
          <td>Storage (general purpose v1)</td>
        </tr>
        <tr>
          <td>Replication</td>
          <td>Locally redundant storage (LRS)</td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <p><strong>Note</strong>: Wait for the Storage account to be created. This should take about two minutes.</p>
    </blockquote>
  </li>
</ol>

<h3 id="task-2-configure-boot-diagnostics-for-an-azure-vm">Task 2: Configure boot diagnostics for an Azure VM</h3>

<ol>
  <li>On <strong>SEA-CL1</strong>, in the Microsoft Edge window displaying the Azure portal, navigate to the <strong>Mod07Target</strong> Azure VM blade.</li>
  <li>
    <p>From the <strong>Mod07Target</strong> Azure VM blade, enable its boot diagnostics with the <strong>Enable with custom storage account</strong> option, using the storage account you created earlier in this exercise.</p>

    <blockquote>
      <p><strong>Note</strong>: Managed storage account does not support the serial console functionality.</p>
    </blockquote>
  </li>
</ol>

<h3 id="task-3-use-the-serial-console">Task 3: Use the serial console</h3>

<ol>
  <li>
    <p>On <strong>SEA-CL1</strong>, on the Microsoft Edge tab displaying the Azure Portal, from the <strong>Mod07Target</strong> blade, activate the serial console.</p>

    <blockquote>
      <p><strong>Note</strong>: The <strong>Mod07Target | Serial console</strong> blade should display the <strong>SAC&gt;</strong> prompt</p>
    </blockquote>
  </li>
  <li>On the <strong>Mod07Target | Serial console</strong> blade, at the <strong>SAC&gt;</strong> prompt, run <strong>cmd</strong> to create a channel that contains a CMD instance.</li>
  <li>On the <strong>Mod07Target | Serial console</strong> blade, at the <strong>SAC&gt;</strong> prompt, run <strong>ch -si 1</strong> to switch to the channel that’s running the CMD instance.</li>
  <li>
    <p>On the <strong>Mod07Target | Serial console</strong> blade, select the Enter key, and then sign in with the following credentials:</p>

    <p><em>Table 5: Mod07Target VM local Administrator credentials</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>User</td>
          <td>Student</td>
        </tr>
        <tr>
          <td>Domain</td>
          <td>Mod07Target</td>
        </tr>
        <tr>
          <td>Password</td>
          <td>Pa55w.rd1234</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>On <strong>Mod07Target | Serial console</strong> blade, at the <strong>C:\windows\system32</strong> prompt, run the following to configure operating system boot options:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock10" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock10" class="mt-0"><code class="language-cmd">bcdedit /set {bootmgr} displaybootmenu yes
bcdedit /set {bootmgr} timeout 20
bcdedit /set {bootmgr} bootems yes
shutdown -r -t 0
</code></pre>
  </li>
  <li>On the <strong>Mod07Target | Serial console</strong> blade, when the EMS window displays, select the <strong>F8</strong> key to display the <strong>Advanced Boot Option</strong> screen.</li>
  <li>On the <strong>Mod07Target | Serial console</strong> blade, within the serial console session, navigate the <strong>Advanced Boot Option</strong> screen and select the <strong>Start Windows normally</strong> option.</li>
  <li>
    <p>On the <strong>Mod07Target | Serial console</strong> blade, navigate back to the the <strong>Mod07Target</strong> blade.</p>

    <blockquote>
      <p><strong>Note</strong>: The <strong>Advanced Boot options</strong> screen displays the message, <strong>Choose Advanced Options for: Windows server 2016</strong>. Mod07Target is running Windows Server 2019. This is expected, because the serial console code has not been updated on Windows Server 2019.</p>
    </blockquote>
  </li>
</ol>

<h2 id="exercise-6-managing-windows-server-2019-in-azure-vms-by-using-azure-policy-guest-configuration">Exercise 6: Managing Windows Server 2019 in Azure VMs by using Azure Policy Guest Configuration</h2>

<h2 id="scenario-5">Scenario</h2>

<p>You want to evaluate the capability of configuring Windows Server 2019 running in Azure VMs by using the Guest Configuration extension.</p>

<p>The main tasks for this exercise are:</p>

<ol>
  <li>Enable the Guest Configuration resource provider.</li>
  <li>Assign an Azure Policy Guest Configuration by using the Azure portal.</li>
  <li>Review results of the Guest Configuration policy.</li>
</ol>

<h3 id="task-1-enable-the-guest-configuration-resource-provider">Task 1: Enable the Guest Configuration resource provider</h3>

<ol>
  <li>On <strong>SEA-CL1</strong>, in the Microsoft Edge window, switch to the tab displaying Azure Cloud Shell. If needed, select <strong>Reconnect</strong>.</li>
  <li>
    <p>In the Cloud Shell window, at the PowerShell prompt, run the following command to register the Guest Configuration resource provider:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock11" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock11" class="mt-0"><code class="language-powershell">Register-AzResourceProvider -ProviderNamespace 'Microsoft.GuestConfiguration'
</code></pre>
  </li>
  <li>
    <p>Wait until the resource provider is registered.</p>

    <blockquote>
      <p><strong>Note</strong>: To verify the registration status, you can re-run the <strong>Register-AzResourceProvider</strong> cmdlet.</p>
    </blockquote>
  </li>
</ol>

<h3 id="task-2-assign-an-azure-policy-guest-configuration-by-using-the-azure-portal">Task 2: Assign an Azure Policy Guest Configuration by using the Azure portal</h3>

<ol>
  <li>
    <p>On SEA-CL1, in the Microsoft Edge window displaying the Azure portal, navigate to the <strong>Policy | Definitions</strong> blade.</p>
  </li>
  <li>
    <p>On the <strong>Policy | Definitions</strong> blade, locate the <strong>Audit Windows machines on which the specified services are not installed and ‘Running’</strong> inititative definition.</p>
  </li>
  <li>
    <p>From the <strong>Policy | Definitions</strong> blade, create an assignment of the <strong>Audit Windows VMs on which the specified services are not installed and ‘Running’</strong> initiative definition with the following settings:</p>

    <p><em>Table 6: Initiative assignment settings</em></p>

    <table>
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Scope</td>
          <td><strong>ws2019-07-rg1</strong> resource group</td>
        </tr>
        <tr>
          <td>Description</td>
          <td>Auditing Windows services settings</td>
        </tr>
        <tr>
          <td>Parameters (Service names)</td>
          <td>W3SVC</td>
        </tr>
        <tr>
          <td>Create remediation task</td>
          <td>enabled with the default settings</td>
        </tr>
        <tr>
          <td>Managed identity location</td>
          <td>the same Azure region you used to deploy all Azure resources in this lab</td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <p><strong>Note</strong>: <strong>W3SVC</strong> is the name of the World Wide Web Publishing Service, which you installed on <strong>Mod07Target</strong> earlier in this lab.</p>
    </blockquote>
  </li>
</ol>

<h3 id="task-3-review-results-of-the-guest-configuration-policy">Task 3: Review results of the Guest Configuration policy</h3>

<ol>
  <li>
    <p>On <strong>SEA-CL1</strong>, in the Microsoft Edge window displaying the Azure portal, navigate back to the <strong>Policy</strong> blade.</p>
  </li>
  <li>
    <p>On the <strong>Policy</strong> blade, note the <strong>Audit Windows VMs on which the specified services are not installed and ‘Running’</strong> entry and verify that its <strong>Compliance state</strong> is listed as <strong>Not started</strong></p>
  </li>
  <li>
    <p>On <strong>SEA-CL1</strong>, in the Microsoft Edge window, switch to the tab displaying Azure Cloud Shell. If needed, select <strong>Reconnect</strong>.</p>
  </li>
  <li>
    <p>In the Cloud Shell window, at the PowerShell prompt, run the following command to trigger an on-demand Azure Policy compliance scan targeting resources in the resource group <strong>ws2019-07-rg1</strong>:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock12" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock12" class="mt-0"><code class="language-powershell">Start-AzPolicyComplianceScan -ResourceGroupName 'ws2019-07-rg1'
</code></pre>

    <blockquote>
      <p><strong>Note</strong>: Wait for the compliance scan to complete. For more information regarding time it takes to complete different types of Azure Policy processing, refer to <a href="https://aka.ms/evaluation-triggers">Evaluation triggers</a> and <a href="https://aka.ms/guest-configuration-validation-frequency">Validation frequency</a>.</p>
    </blockquote>

    <blockquote>
      <p><strong>Note</strong>: Since you installed Web Server (IIS) server role on <strong>Mod07Target</strong>, that VM should be listed as compliant. However, since the resource group <strong>ws2019-07-rg1</strong> also contains the <strong>Mod07Gateway</strong> VM which does not include the Web Server (IIS) server role, the state of that resource and the assignment should be listed as <strong>Non-compliant</strong>.</p>
    </blockquote>
  </li>
  <li>
    <p>To verify compliance status of individual resources, on <strong>SEA-CL1</strong>, in the Microsoft Edge window displaying the Azure portal, navigate to the <strong>Mod07Target</strong> blade.</p>
  </li>
  <li>
    <p>From the <strong>Mod07Target</strong> blade, navigate to its <strong>Policies</strong> blade.</p>
  </li>
  <li>
    <p>Verify that the <strong>Audit Windows VMs on which the specified services are not installed and ‘Running’</strong> policy is listed as <strong>Compliant</strong>.</p>
  </li>
  <li>
    <p>To verify compliance status of individual resources, on <strong>SEA-CL1</strong>, in the Microsoft Edge window displaying the Azure portal, navigate to the <strong>Mod07Gateway</strong> blade.</p>
  </li>
  <li>
    <p>From the <strong>Mod07Gateway</strong> blade, navigate to its <strong>Policies</strong> blade.</p>
  </li>
  <li>
    <p>Verify that the <strong>Audit Windows VMs on which the specified services are not installed and ‘Running’</strong> policy is listed as <strong>Non-compliant</strong>.</p>
  </li>
</ol>

<h2 id="exercise-7-deprovisioning-the-azure-lab-environment">Exercise 7: Deprovisioning the Azure lab environment</h2>

<h2 id="scenario-6">Scenario</h2>

<p>To minimize Azure-related charges, you will deprovision the Azure resources provisioned throughout this lab.</p>

<p>The main tasks for this exercise are:</p>

<ol>
  <li>Remove the policy assignment.</li>
  <li>Delete the ws2019-07-rg1 resource group.</li>
</ol>

<h3 id="task-1-remove-the-policy-assignment">Task 1: Remove the policy assignment</h3>

<ol>
  <li>On SEA-CL1, in the Microsoft Edge window displaying the Azure portal, navigate to the <strong>Policy</strong> blade.</li>
  <li>On the <strong>Policy</strong> blade, delete the <strong>Audit Windows VMs on which the specified services are not installed and ‘Running’</strong> assignment.</li>
</ol>

<h3 id="task-2-delete-the-ws2019-07-rg1-resource-group">Task 2: Delete the ws2019-07-rg1 resource group</h3>

<ol>
  <li>In the Azure portal, navigate to the <strong>ws2019-07-rg1</strong> resource group blade.</li>
  <li>From the <strong>ws2019-07-rg1</strong> resource group blade, delete the resource group.</li>
</ol>

<h2 id="results">Results</h2>

<p>After completing this lab, you will have:</p>

<ul>
  <li>Provisioned Azure VMs running Windows Server 2019.</li>
  <li>Managed Azure VMs running Windows Server 2019 by using Windows Admin Center.</li>
  <li>Managed Windows Server 2019 running in Azure VMs by using PowerShell Remoting.</li>
  <li>Managed Windows Server 2019 running in Azure VMs by using Run Command.</li>
  <li>Managed Windows Server 2019 in Azure VMs by using the serial console.</li>
  <li>Managed Windows Server 2019 in Azure VMs by using Azure Policy Guest Configuration.</li>
  <li>Deprovisioned the Azure lab environment.</li>
</ul>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS" target="_blank" class="ml-2">
                    MicrosoftLearning/WS-012T00-Windows-Server-2019-Hybrid-and-Azure-IaaS
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D0a85806b00854f6395723020d7125becaf7760ed.js"></script>



</body></html>