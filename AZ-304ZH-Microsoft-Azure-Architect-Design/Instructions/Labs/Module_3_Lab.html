<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-304ZH-Microsoft-Azure-Architect-Design
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-304ZH-Microsoft-Azure-Architect-Design
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-304ZH-Microsoft-Azure-Architect-Design" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link active" href="#练习-0准备实验室环境">练习 0：准备实验室环境</a></li><li class="nav-item"><a class="nav-link" href="#练习-1使用-azure-migrate-准备评估和迁移">练习 1：使用 Azure Migrate 准备评估和迁移</a></li><li class="nav-item"><a class="nav-link" href="#练习-2使用-azure-migrate-评估-hyper-v-迁移">练习 2：使用 Azure Migrate 评估 Hyper-V 迁移</a></li><li class="nav-item"><a class="nav-link" href="#练习-3使用-azure-migrate-迁移-hyper-v-vm">练习 3：使用 Azure Migrate 迁移 Hyper-V VM</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="实验室使用-azure-migrate-将-hyper-v-vm-迁移到-azure">实验室：使用 Azure Migrate 将 Hyper-V VM 迁移到 Azure</h1>
<h1 id="学生实验室手册">学生实验室手册</h1>

<h2 id="实验室场景">实验室场景</h2>

<p>尽管 Adatum 企业体系结构团队雄心勃勃地将工作负载现代化以迁移到 Azure，但他们意识到，由于时间紧迫，在许多情况下，仍然有必要采用直接迁移法。为了简化此任务，Adatum 企业体系结构团队开始探索 Azure Migrate 的功能。Azure Migrate 是一个集中式中心，用于评估和迁移到 Azure 本地服务器、基础结构、应用程序和数据。</p>

<p>Azure Migrate 提供以下功能：</p>

<ul>
  <li>统一的迁移平台：启动、运行和跟踪向 Azure 迁移的单个门户。</li>
  <li>系列工具：一系列用于评估和迁移的工具。工具包含 Azure Migrate：服务器评估和 Azure Migrate：服务器迁移。Azure Migrate 可与其他 Azure 服务以及其他工具和独立软件供应商 (ISV) 产品/服务集成。</li>
  <li>评估和迁移：在 Azure Migrate 中心，你可以评估和迁移以下项：</li>
  <li>服务器：评估本地服务器，并将其迁移到 Azure 虚拟机。</li>
  <li>数据库：评估本地数据库，并将其迁移到 Azure SQL 数据库或 SQL 托管实例。</li>
  <li>Web 应用程序：评估本地 Web 应用程序，并使用 Azure 应用服务迁移助手将其迁移到 Azure 应用服务。</li>
  <li>虚拟桌面：评估本地虚拟桌面基础结构 (VDI)，并将其迁移到 Azure 中的 Windows 虚拟桌面。</li>
  <li>数据：利用 Azure Data Box 产品快速、经济高效地将大量数据迁移到 Azure。</li>
</ul>

<p>虽然数据库、Web 应用和虚拟桌面属于迁移计划下一阶段的内容，但 Adatum 企业体系结构团队希望先对使用 Azure Migrate 将其本地 Hyper-V 虚拟机迁移到 Azure VM 进行评估。</p>

<h2 id="目标">目标</h2>

<p>完成本实验室后，你将能够：</p>

<ul>
  <li>
    <p>准备好 Hyper-V 以使用 Azure Migrate 进行评估和迁移</p>
  </li>
  <li>
    <p>使用 Azure Migrate 评估 Hyper-V 的迁移</p>
  </li>
  <li>
    <p>使用 Azure Migrate 迁移 Hyper-V VM</p>
  </li>
</ul>

<h2 id="实验室环境">实验室环境</h2>

<p>Windows Server 管理员凭据</p>

<ul>
  <li>
    <p>用户名： <strong>Student</strong></p>
  </li>
  <li>
    <p>密码： <strong>Pa55w.rd1234</strong></p>
  </li>
</ul>

<p>预计用时：120 分钟</p>

<h2 id="实验室文件">实验室文件</h2>

<ul>
  <li>\\AZ304\AllFiles\Labs\08\azuredeploy30308suba.json</li>
</ul>

<h3 id="练习-0准备实验室环境">练习 0：准备实验室环境</h3>

<p>本次练习的主要任务如下：</p>

<ol>
  <li>
    <p>使用 Azure 资源管理器快速启动模板部署 Azure VM</p>
  </li>
  <li>
    <p>在 Azure VM 中配置嵌套虚拟化</p>
  </li>
</ol>

<h4 id="任务-1使用-azure-资源管理器快速启动模板部署-azure-vm">任务 1：使用 Azure 资源管理器快速启动模板部署 Azure VM</h4>

<ol>
  <li>
    <p>在实验室计算机上，启动 Web 浏览器，导航至 <a href="https://portal.azure.com">Azure 门户</a> - <code>portal.azure.com</code>，然后通过在本实验室中使用的订阅中提供具有所有者角色的用户帐户凭据来登录。</p>
  </li>
  <li>
    <p>在 Azure 门户中，通过直接选择搜索文本框右侧的工具栏图标打开 <strong>“Cloud Shell”</strong> 窗格。</p>
  </li>
  <li>
    <p>提示选择 <strong>“Bash”</strong> 或 <strong>“PowerShell”</strong> 时，选择 <strong>“PowerShell”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 如果这是第一次启动 <strong>Cloud Shell</strong>，并显示消息 <strong>“未装载任何存储”</strong>，请选择你将在本实验室中使用的订阅，然后选择 <strong>“创建存储”</strong>。</p>
    </blockquote>
  </li>
  <li>
    <p>在“Cloud Shell”窗格的工具栏中，选择 <strong>“上传/下载文件”</strong> 图标，在下拉菜单中选择 <strong>“上传”</strong>，然后将文件 <strong>“\\AZ303\AllFiles\Labs\08\azuredeploy30308suba.json”</strong> 上传到 Cloud Shell 主目录中。</p>
  </li>
  <li>
    <p>在 Cloud Shell 中，运行以下命令以设置一个 Azure 区域离你比较近的变量命名位置（将“&lt;Azure region&gt;”占位符替换为在你的订阅中可用于部署 Azure VM 且最靠近实验室计算机位置的 Azure 区域的名称，例如“eastus”）：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="language-powershell">$location = '&lt;Azure region&gt;'
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 若要标识可在其中预配 Azure VM 的 Azure 区域，请参阅 <a href="https://azure.microsoft.com/zh-cn/regions/offers/"><strong>https://azure.microsoft.com/zh-cn/regions/offers/</strong></a></p>
    </blockquote>
  </li>
  <li>
    <p>从 Cloud Shell 窗格运行以下命令，以创建资源组：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="language-powershell">New-AzSubscriptionDeployment `
  -Location $location `
  -Name az30308subaDeployment `
  -TemplateFile $HOME/azuredeploy30308suba.json `
  -rgLocation $location `
  -rgName 'az30308a-labRG'
</code></pre>
  </li>
  <li>
    <p>在 Azure 门户中，关闭 <strong>“Cloud Shell”</strong> 窗格。</p>
  </li>
  <li>
    <p>在实验室计算机上，打开另一个浏览器选项卡，导航到 <a href="https://github.com/az140mp/azure-quickstart-templates/tree/master/demos/nested-vms-in-virtual-network">301-nested-vms-in-virtual-network Azure 快速启动模板</a>并选择“<strong>部署到 Azure</strong>”（可以在模板创建的资源列表后的 <code>README.md</code> 文件中找到“<strong>部署到 Azure</strong>”按钮）。这会自动将浏览器重定向到 Azure 门户中“<strong>具有嵌套 VM 的 Hyper-V 主机虚拟机</strong>”边栏选项卡。</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="language-url"> https://github.com/az140mp/azure-quickstart-templates/tree/master/demos/nested-vms-in-virtual-network
</code></pre>
  </li>
  <li>
    <p>在 Azure 门户中 <strong>“具有嵌套 VM 的 Hyper-V 主机虚拟机”</strong> 边栏选项卡上，指定以下设置（将其他设置保留为其默认值）：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>订阅</td>
          <td>在本实验室中使用的 Azure 订阅的名称</td>
        </tr>
        <tr>
          <td>资源组</td>
          <td><strong>az30308a-labRG</strong></td>
        </tr>
        <tr>
          <td>虚拟网络名称</td>
          <td><strong>az30308a-hv-vnet</strong></td>
        </tr>
        <tr>
          <td>主机网络接口 1 名称</td>
          <td><strong>az30308a-hv-vm-nic1</strong></td>
        </tr>
        <tr>
          <td>主机网络接口 2 名称</td>
          <td><strong>az30308a-hv-vm-nic2</strong></td>
        </tr>
        <tr>
          <td>主机虚拟机名称</td>
          <td><strong>az30308a-hv-vm</strong></td>
        </tr>
        <tr>
          <td>主机管理员用户名</td>
          <td><strong>Student</strong></td>
        </tr>
        <tr>
          <td>主机管理员密码</td>
          <td><strong>Pa55w.rd1234</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 <strong>“具有嵌套 VM 的 Hyper-V 主机虚拟机”</strong> 边栏选项卡上，选择 <strong>“查看 + 创建”</strong>，然后选择 <strong>“创建”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 等待部署完成。部署可能需要大约 10 分钟。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2部署-azure-bastion">任务 2：部署 Azure Bastion</h4>

<blockquote>
  <p><strong>备注</strong>：通过 Azure Bastion，可以连接到你在本练习的上一个任务中部署的没有公共终结点的 Azure VM，同时提供针对操作系统级别凭据的暴力攻击防护。</p>
</blockquote>

<ol>
  <li>
    <p>在显示 Azure 门户的浏览器窗口中，打开另一个选项卡，然后在该浏览器选项卡中导航到 Azure 门户。</p>
  </li>
  <li>
    <p>在 Azure 门户中，通过选择搜索文本框右侧的“工具栏”图标，打开 <strong>Cloud Shell</strong> 窗格。</p>
  </li>
  <li>
    <p>在 Cloud Shell 窗格中的 PowerShell 会话中运行以下命令，将名为 <strong>AzureBastionSubnet</strong> 的子网添加到你在本练习前面部分创建的名为 <strong>az30308a-hv-vnet</strong> 的虚拟网络中：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="language-powershell">$resourceGroupName = 'az30308a-labRG'
$vnet = Get-AzVirtualNetwork -ResourceGroupName $resourceGroupName -Name 'az30308a-hv-vnet'
$subnetConfig = Add-AzVirtualNetworkSubnetConfig `
  -Name 'AzureBastionSubnet' `
  -AddressPrefix 10.0.7.0/24 `
  -VirtualNetwork $vnet
$vnet | Set-AzVirtualNetwork
</code></pre>
  </li>
  <li>
    <p>关闭 Cloud Shell 窗格。</p>
  </li>
  <li>
    <p>在 Azure 门户中搜索并选择“<strong>Bastion</strong>”，然后在“<strong>Bastion</strong>”边栏选项卡中，选择“<strong>+ 创建</strong>”。</p>
  </li>
  <li>
    <p>在“<strong>创建 Bastion</strong>”边栏选项卡的“<strong>基本信息</strong>”选项卡中，指定以下设置并选择“<strong>查看 + 创建</strong>”：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>订阅</td>
          <td>在本实验室中使用的 Azure 订阅的名称</td>
        </tr>
        <tr>
          <td>资源组</td>
          <td><strong>az30308a-labRG</strong></td>
        </tr>
        <tr>
          <td>名称</td>
          <td><strong>az30308a-bastion</strong></td>
        </tr>
        <tr>
          <td>区域</td>
          <td>在本练习前面的任务中向其中部署了资源的同一 Azure 区域</td>
        </tr>
        <tr>
          <td>层级</td>
          <td><strong>基本</strong></td>
        </tr>
        <tr>
          <td>虚拟网络</td>
          <td><strong>az30308a-hv-vnet</strong></td>
        </tr>
        <tr>
          <td>子网</td>
          <td><strong>AzureBastionSubnet (10.0.7.0/24)</strong></td>
        </tr>
        <tr>
          <td>公共 IP 地址</td>
          <td><strong>新建</strong></td>
        </tr>
        <tr>
          <td>公共 IP 名称</td>
          <td><strong>az30308a-hv-vnet-ip</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在“<strong>创建 Bastion</strong>”边栏选项卡的“<strong>查看 + 创建</strong>”选项卡中，选择“<strong>创建</strong>”：</p>

    <blockquote>
      <p><strong>备注</strong>：等待部署完成后，再继续执行下一个任务。该部署可能需要 5 分钟左右。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-3在-azure-vm-中配置嵌套虚拟化">任务 3：在 Azure VM 中配置嵌套虚拟化</h4>

<ol>
  <li>
    <p>在 Azure 门户中搜索并选择“<strong>虚拟机</strong>”，然后在“<strong>虚拟机</strong>”边栏选项卡中选择“<strong>az30308a-hv-vm</strong>”。</p>
  </li>
  <li>
    <p>在“<strong>az30308a-hv-vm</strong>”边栏选项卡上，选择“<strong>连接</strong>”，在下拉菜单中，选择“<strong>Bastion</strong>”，在“<strong>az30308a-hv-vm | 连接</strong>”边栏选项卡的“<strong>Bastion</strong>”选项卡上，选择“<strong>使用 Bastion</strong>”。</p>
  </li>
  <li>
    <p>出现提示时，请提供以下凭据并选择“<strong>连接</strong>”：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>用户名</td>
          <td><strong>Student</strong></td>
        </tr>
        <tr>
          <td>密码</td>
          <td><strong>Pa55w.rd1234</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在与 <strong>“az30308a-hv-vm”</strong> 的远程桌面会话中，在“服务器管理器”窗口中，单击 <strong>“本地服务器”</strong>，再单击 <strong>“IE 增强的安全性配置”</strong> 标签旁边的 <strong>“开启”</strong> 链接，然后在 <strong>“IE 增强的安全性配置”</strong> 对话框中选择 <strong>“关闭”</strong> 选项，然后单击 <strong>“确定”</strong>。</p>
  </li>
  <li>
    <p>在远程桌面会话中，打开文件资源管理器，然后导航至 <strong>“F:”</strong>。创建名为 <strong>VHDs</strong> 的文件夹。</p>
  </li>
  <li>
    <p>在与 <strong>“az30308a-hv-vm”</strong> 的远程桌面会话中，启动 Internet Explorer，导航至 <a href="https://www.microsoft.com/zh-cn/edge/business/download">Microsoft Edge</a> 的下载页面，下载 Microsoft Edge 安装程序并执行安装。</p>
  </li>
  <li>
    <p>在与 <strong>“az30308a-hv-vm”</strong> 的远程桌面会话中，在 Microsoft Edge 中，浏览至 <a href="https://www.microsoft.com/zh-cn/evalcenter/evaluate-windows-server-2019">Windows Server 评估</a>，然后将 Windows Server 2019 <strong>VHD</strong> 文件下载到 <strong>“F:\VHDs”</strong> 文件夹。</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="language-url"> https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2019
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 评估页面将要求输入个人信息才能完成下载。选择“英国”或其他国家/地区，以退出通知。</p>
    </blockquote>
  </li>
  <li>
    <p>在与 <strong>az30308a-hv-vm</strong> 的远程桌面会话中，单击“开始”，再单击 <strong>“Windows 管理工具”</strong>，然后启动 <strong>“Hyper-V 管理器”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Hyper-V 管理器”</strong> 控制台中，选择 <strong>az30308a-hv-vm</strong> 节点。</p>
  </li>
  <li>
    <p>单击 <strong>“新建”</strong>，然后在级联菜单中选择 <strong>“虚拟机”</strong>。这将启动 <strong>“新建虚拟机向导”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“新建虚拟机向导”</strong> 的 <strong>“准备工作”</strong> 页面上，选择 <strong>“下一步 &gt;”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“新建虚拟机向导”</strong> 的 <strong>“指定名称和位置”</strong> 页面 ，指定以下设置并选择 <strong>“下一步 &gt;”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>名称</td>
          <td><strong>az30308a-vm1</strong></td>
        </tr>
        <tr>
          <td>将虚拟机存储在其他位置</td>
          <td>已选择</td>
        </tr>
        <tr>
          <td>位置</td>
          <td><strong>F:\VMs</strong></td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <p><strong>备注</strong>： 确保创建 <strong>“F:\VMs”</strong> 文件夹。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“新建虚拟机向导”</strong> 的 <strong>“指定代数”</strong> 页面上，确保选择了 <strong>“第一代”</strong> 选项，然后选择 <strong>“下一步 &gt;”</strong>：</p>
  </li>
  <li>
    <p>在 <strong>“新建虚拟机向导”</strong> 的 <strong>“分配内存”</strong> 页面上，将 <strong>“启动内存”</strong> 设置为 <strong>“2048”</strong>，然后选择 <strong>“下一步 &gt;”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“新建虚拟机向导”</strong> 的 <strong>“配置网络”</strong> 页面上， 在 <strong>“连接”</strong> 下拉列表中选择 <strong>“NestedSwitch”</strong>，然后选择 <strong>“下一步 &gt;”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“新建虚拟机向导”</strong> 的 <strong>“连接虚拟硬盘”</strong> 页面上，选择 <strong>“使用现有的虚拟硬盘”</strong> 选项，将 VHD 文件下载到的位置设置为 <strong>F:\VHDs</strong> 文件夹，然后选择 <strong>“下一步 &gt;”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“新建虚拟机向导”</strong> 的 <strong>“摘要”</strong> 页面上， 选择 <strong>“完成”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Hyper-V 管理器”</strong> 控制台中，选择新创建的虚拟机，然后选择 <strong>“启动”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Hyper-V 管理器”</strong> 控制台中，确认虚拟机正在运行，然后选择 <strong>“连接”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“az30308a-vm1”</strong> 的“虚拟机连接”窗口中，在 <strong>“你好”</strong> 页面上，选择 <strong>“下一步”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“az30308a-vm1”</strong> 的“虚拟机连接”窗口中，在 <strong>“许可条款”</strong> 页面上，选择 <strong>“接受”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“az30308a-vm1”</strong> 的“虚拟机连接”窗口中，在 <strong>“自定义设置”</strong> 页面上，将内置管理员帐户的密码设置为 <strong>“Pa55w.rd1234”</strong>，然后选择 <strong>“完成”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“az30308a-vm1”</strong> 的“虚拟机连接”窗口中，使用新设置的密码登录。</p>
  </li>
  <li>
    <p>在 <strong>“az30308a-vm1”</strong> 的“虚拟机连接”窗口中，启动 Windows PowerShell，然后在 <strong>“管理员： Windows PowerShell”</strong> 窗口运行以下命令来设置计算机名称。</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="language-powershell">Rename-Computer -NewName 'az30308a-vm1' -Restart
</code></pre>
  </li>
</ol>

<h3 id="练习-1使用-azure-migrate-准备评估和迁移">练习 1：使用 Azure Migrate 准备评估和迁移</h3>

<p>本次练习的主要任务如下：</p>

<ol>
  <li>
    <p>配置 Hyper-V 环境</p>
  </li>
  <li>
    <p>创建 Azure Migrate 项目</p>
  </li>
  <li>
    <p>实现目标 Azure 环境</p>
  </li>
</ol>

<h4 id="任务-1配置-hyper-v-环境">任务 1：配置 Hyper-V 环境</h4>

<ol>
  <li>
    <p>在与 <strong>“az30308a-hv-vm”</strong> 的远程桌面会话中，启动 Microsoft Edge，导航至 <a href="https://aka.ms/migrate/script/hyperv">Microsoft 下载中心</a>，然后将配置 PowerShell 脚本下载到 <strong>“F:”</strong> 中。</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="language-url"> https://aka.ms/migrate/script/hyperv
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 脚本将执行以下任务：</p>
    </blockquote>

    <ul>
      <li>
        <p>检查你是否在受支持的 PowerShell 版本上运行脚本。</p>
      </li>
      <li>
        <p>验证你在 Hyper-V 主机上是否具有管理权限。</p>
      </li>
      <li>
        <p>允许你创建 Azure Migrate 服务用来与 Hyper-V 主机进行通信的本地用户帐户。该用户帐户将被添加到 Hyper-V 主机上的“远程管理用户”、“Hyper-V 管理员”和“性能监视器用户”组。</p>
      </li>
      <li>
        <p>检查主机是否正在运行受支持的 Hyper-V 版本以及 Hyper-V 角色。</p>
      </li>
      <li>
        <p>启用 WinRM 服务，并在主机上打开端口 5985 (HTTP) 和 5986 (HTTPS)。这是元数据收集所必需的。</p>
      </li>
      <li>
        <p>在主机上启用 PowerShell 远程处理。</p>
      </li>
      <li>
        <p>检查在主机托管的所有 VM 上是否启用了 Hyper-V 集成服务。</p>
      </li>
      <li>
        <p>如果需要，在主机上启用 CredSSP。</p>
      </li>
    </ul>
  </li>
  <li>
    <p>在与 <strong>az30308a-hv-vm</strong> 的远程桌面会话中，启动 <strong>“Windows PowerShell ISE”</strong>。</p>
  </li>
  <li>
    <p>在<strong>管理员： “Windows PowerShell ISE”</strong> 窗口，在“控制台”窗格中，运行以下命令以删除 Zone.Identifier 备用数据流，在这种情况下，该备用数据流表示文件是从 Internet 下载的。</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="language-powershell">Unblock-File -Path F:\MicrosoftAzureMigrate-Hyper-V.ps1
</code></pre>
  </li>
  <li>
    <p>在 <strong>“管理员: Windows PowerShell ISE”</strong> 窗口中，打开位于 <strong>“F:”</strong> 文件夹中的 <strong>“MicrosoftAzureMigrate-Hyper-V.ps1”</strong> 脚本并运行该脚本。系统提示进行确认时，请按 <strong>Y</strong> 键，然后按 <strong>Enter</strong> 键，但以下提示除外，在这种情况下，键入 <strong>N</strong>，然后按 <strong>Enter</strong> 键：</p>
  </li>
</ol>

<ul>
  <li>
    <p>是否使用 SMB 共享来存储 VHD？</p>
  </li>
  <li>
    <p>是否要为 Azure Migrate 和 Hyper-V 主机通信创建非管理员本地用户？</p>
  </li>
</ul>

<h4 id="任务-2创建-azure-migrate-项目">任务 2：创建 Azure Migrate 项目</h4>

<ol>
  <li>
    <p>在与 <strong>“az30308a-hv-vm”</strong> 的远程桌面会话中，启动 Microsoft Edge，导航至 <a href="https://portal.azure.com">Azure 门户</a>，然后通过提供在本实验中使用的订阅中具有所有者角色的用户帐户凭据来登录。</p>
  </li>
  <li>
    <p>在 Azure 门户中，搜索并选择 <strong>“Azure Migrate”</strong>，在 <strong>“Azure Migrate”</strong> 边栏选项卡的 <strong>“迁移目标”</strong> 部分，选择 <strong>“Windows、Linux 和 SQL Server”</strong>，然后选择 <strong>“创建项目”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Azure Migrate”</strong> 边栏选项卡中，指定以下设置（将其他设置保留为默认值），然后选择 <strong>“创建”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>订阅</td>
          <td>在本实验室中使用的 Azure 订阅的名称</td>
        </tr>
        <tr>
          <td>资源组</td>
          <td>新资源组 <strong>“az30308b-labRG”</strong> 的名称</td>
        </tr>
        <tr>
          <td>迁移项目</td>
          <td><strong>az30308b-migrate-project</strong></td>
        </tr>
        <tr>
          <td>地理</td>
          <td>所在国家/地区或地理区域的名称</td>
        </tr>
      </tbody>
    </table>
  </li>
</ol>

<h4 id="任务-3实现目标-azure-环境">任务 3：实现目标 Azure 环境</h4>

<ol>
  <li>
    <p>在 Azure 门户中，搜索并选择 <strong>“虚拟网络”</strong>，然后在 <strong>“虚拟网络”</strong> 边栏选项卡的命令栏中，选择 <strong>“+ 添加”</strong> （或 <strong>“+ 创建”</strong>）。</p>
  </li>
  <li>
    <p>在 <strong>“创建虚拟网络”</strong> 边栏选项卡的 <strong>“基本信息”</strong> 选项卡上，指定以下设置（将其他设置保留为默认值）并选择 <strong>“下一步： IP 地址”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>订阅</td>
          <td>在本实验室中使用的 Azure 订阅的名称</td>
        </tr>
        <tr>
          <td>资源组</td>
          <td>新资源组的名称为 <strong>“az30308c-labRG”</strong></td>
        </tr>
        <tr>
          <td>名称</td>
          <td><strong>az30308c-migration-vnet</strong></td>
        </tr>
        <tr>
          <td>区域</td>
          <td>本实验室初期向其部署虚拟机的 Azure 区域的名称</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 <strong>“创建虚拟网络”</strong> 边栏选项卡的 <strong>“IP 地址”</strong> 选项卡中，在 <strong>“IPv4 地址空间”</strong> 文本框键入 <strong>“10.8.0.0/16”</strong>，然后选择 <strong>“+ 添加子网”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“添加子网”</strong> 边栏选项卡中，指定以下设置（将其他设置保留为默认值）并选择 <strong>“添加”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>子网名称</td>
          <td><strong>subnet0</strong></td>
        </tr>
        <tr>
          <td>子网地址范围</td>
          <td><strong>10.8.0.0/24</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>返回到 <strong>“创建虚拟网络”</strong> 边栏选项卡中的 <strong>“IP 地址”</strong> 选项卡，选择 <strong>“查看 + 创建”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“创建虚拟网络”</strong> 边栏选项卡中的 <strong>“查看 + 创建”</strong> 选项卡中，选择 <strong>“创建”</strong>。</p>
  </li>
  <li>
    <p>在 Azure 门户中，搜索并选择 <strong>“虚拟网络”</strong>，然后在 <strong>“虚拟网络”</strong> 边栏选项卡的命令栏中，选择 <strong>“+ 添加”</strong> （或 <strong>“+ 创建”</strong>）。</p>
  </li>
  <li>
    <p>在 <strong>“创建虚拟网络”</strong> 边栏选项卡的 <strong>“基本信息”</strong> 选项卡上，指定以下设置（将其他设置保留为默认值）并选择 <strong>“下一步： IP 地址”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>订阅</td>
          <td>在本实验室中使用的 Azure 订阅的名称</td>
        </tr>
        <tr>
          <td>资源组</td>
          <td><strong>az30308c-labRG</strong></td>
        </tr>
        <tr>
          <td>名称</td>
          <td><strong>az30308c-test-vnet</strong></td>
        </tr>
        <tr>
          <td>区域</td>
          <td>本实验室初期向其部署虚拟机的 Azure 区域的名称</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 <strong>“创建虚拟网络”</strong> 边栏选项卡的 <strong>“IP 地址”</strong> 选项卡中，在 <strong>“IPv4 地址空间”</strong> 文本框键入 <strong>“10.8.0.0/16”</strong>，然后选择 <strong>“+ 添加子网”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“添加子网”</strong> 边栏选项卡中，指定以下设置（将其他设置保留为默认值）并选择 <strong>“添加”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>子网名称</td>
          <td><strong>subnet0</strong></td>
        </tr>
        <tr>
          <td>子网地址范围</td>
          <td><strong>10.8.0.0/24</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>返回到 <strong>“创建虚拟网络”</strong> 边栏选项卡中的 <strong>“IP 地址”</strong> 选项卡，选择 <strong>“查看 + 创建”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“创建虚拟网络”</strong> 边栏选项卡中的 <strong>“查看 + 创建”</strong> 选项卡中，选择 <strong>“创建”</strong>。</p>
  </li>
  <li>
    <p>在 Azure 门户中，搜索并选择 <strong>“存储帐户”</strong>，然后在 <strong>“存储帐户”</strong> 边栏选项卡的命令栏中，选择 <strong>“+ 添加”</strong> （或 <strong>“+ 创建”</strong>）。</p>
  </li>
  <li>
    <p>在 <strong>“创建存储帐户”</strong> 边栏选项卡的 <strong>“基本设置”</strong> 选项卡上，指定以下设置（其他设置则保留为默认值）：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>订阅</td>
          <td>在本实验室中使用的 Azure 订阅的名称</td>
        </tr>
        <tr>
          <td>资源组</td>
          <td><strong>az30308c-labRG</strong></td>
        </tr>
        <tr>
          <td>存储帐户名称</td>
          <td>由字母和数字组成、长度介于 3 到 24 之间的任何全局唯一名称</td>
        </tr>
        <tr>
          <td>位置</td>
          <td>本任务初期在其中创建虚拟网络的 Azure 区域的名称</td>
        </tr>
        <tr>
          <td>性能</td>
          <td><strong>标准</strong></td>
        </tr>
        <tr>
          <td>冗余</td>
          <td><strong>本地冗余存储 (LRS)</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 <strong>“创建存储帐户”</strong> 边栏选项卡的 <strong>“基本信息”</strong> 选项卡中，选择 <strong>“查看 + 创建”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“创建存储帐户”</strong> 边栏选项卡的 <strong>“查看 + 创建”</strong> 选项卡中，选择 <strong>“创建”</strong>。</p>
  </li>
</ol>

<h3 id="练习-2使用-azure-migrate-评估-hyper-v-迁移">练习 2：使用 Azure Migrate 评估 Hyper-V 迁移</h3>

<p>本次练习的主要任务如下：</p>

<ol>
  <li>
    <p>部署和配置 Azure Migrate 设备</p>
  </li>
  <li>
    <p>配置、运行和查看评估</p>
  </li>
</ol>

<h4 id="任务-1部署和配置-azure-migrate-设备">任务 1：部署和配置 Azure Migrate 设备</h4>

<ol>
  <li>
    <p>在 Azure 门户的 Microsoft Edge 窗口中，在与 <strong>“az30308a-hv-vm”</strong> 的远程桌面会话中，搜索并选择 <strong>“Azure Migrate”</strong>。</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>在“**Azure Migrate</td>
          <td>Windows、Linux 和 SQL Server<strong>”边栏选项卡中，在“</strong>Azure Migrate: 发现和评估**”磁贴。</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在“<strong>发现</strong>”边栏选项卡上，在“<strong>你的服务器是否已虚拟化?</strong>”下拉列表中，选择“<strong>是，使用 Hyper-V</strong>”。</p>
  </li>
  <li>
    <p>在“<strong>发现</strong>”边栏选项卡上的“<strong>命名你的设备</strong>”文本框中，键入 <strong>az30308a-vma1</strong> 并选择“<strong>生成密钥</strong>”按钮。</p>

    <blockquote>
      <p><strong>注意</strong>： 如果在生成 Azure Migrate 项目密钥时遇到与权限相关的错误，请在 Azure 门户中导航到 <strong>“订阅”</strong> 边栏选项卡，选择你的订阅，在订阅边栏选项卡上，选择 <strong>“访问控制(IAM)”</strong>，然后将 <strong>“所有者”</strong> 角色分配到你的 Azure AD 用户帐户。</p>
    </blockquote>
  </li>
  <li>
    <p>等待资源预配完成，在与 <strong>az30308a-hv-vm</strong> 的远程桌面会话中，启动记事本，然后将 <strong>“Azure Migrate 项目密钥”</strong> 复制到记事本中。</p>
  </li>
  <li>
    <p>在“<strong>发现</strong>”边栏选项卡上的“<strong>下载 Azure Migrate 设备</strong>”文本框中，选择“<strong>.VHD 文件</strong>”选项，选择“<strong>下载</strong>”，并在出现提示时将下载位置设置为 <strong>F:\VMs</strong> 文件夹。</p>

    <blockquote>
      <p><strong>备注</strong>： 等待下载完成。该操作需要约 5 分钟。</p>
    </blockquote>
  </li>
  <li>
    <p>下载完成后，将下载的 .ZIP 文件的内容提取到 <strong>“F:\VMs”</strong> 文件夹。</p>
  </li>
  <li>
    <p>在接入 <strong>az30308a-hv-vm</strong> 的远程桌面会话中，切换到 <strong>“Hyper-V 管理器”</strong> 控制台，选择 <strong>“az30308a-hv-vm”</strong> 节点，选择 <strong>“导入虚拟机”</strong>。这将开始执行<strong>导入虚拟机</strong>向导。</p>
  </li>
  <li>
    <p>在<strong>导入虚拟机</strong>向导的 <strong>“开始之前”</strong> 页面，选择 <strong>“下一步 &gt;”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“导入虚拟机”</strong> 向导的 <strong>“查找文件夹”</strong> 页面中，指定提取的 <strong>“虚拟机”</strong> 文件夹的位置，然后选择 <strong>“下一步 &gt;”</strong>：</p>
  </li>
  <li>
    <p>在 <strong>“导入虚拟机”</strong> 向导的 <strong>“选择虚拟机”</strong> 页面上，选择 <strong>“下一步 &gt;”</strong>：</p>
  </li>
  <li>
    <p>在 <strong>“导入虚拟机”</strong> 向导的 <strong>“选择导入类型”</strong> 页面上，选择 <strong>“注册现有虚拟机(使用现有的唯一 ID)”</strong>，然后选择 <strong>“下一步 &gt;”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“导入虚拟机”</strong> 向导的 <strong>“配置处理器”</strong> 页面中，将 <strong>“虚拟处理器数量”</strong> 设置为 <strong>“4”</strong>，然后选择 <strong>“下一步 &gt;”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 忽略指出虚拟处理器数量更改的任何错误消息。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“导入虚拟机”</strong> 向导的 <strong>“连接网络”</strong> 页面中，在 <strong>“连接”</strong> 下拉列表中选择 <strong>“NestedSwitch”</strong>，然后选择 <strong>“下一步 &gt;”</strong>。</p>
  </li>
  <li>
    <p>在<strong>导入虚拟机</strong>向导的 <strong>“摘要”</strong> 页面中，选择 <strong>“完成”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 等待导入完成。该操作需要约 10 分钟。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“Hyper-V 管理器”</strong> 控制台，选择新导入的虚拟机，然后选择 <strong>“重命名”</strong>，并将名称设置为 <strong>“az30308a-vma1”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Hyper-V 管理器”</strong> 控制台，选择新导入的虚拟机，然后选择 <strong>“启动”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Hyper-V 管理器”</strong> 控制台，验证虚拟机是否正在运行，然后选择 <strong>“连接”</strong>。</p>
  </li>
  <li>
    <p>在虚拟设备的“虚拟机连接”窗口中，在 <strong>“许可条款”</strong> 页面上，选择 <strong>“接受”</strong>。</p>
  </li>
  <li>
    <p>在虚拟设备的“虚拟机连接”窗口中，在 <strong>“自定义设置”</strong> 页面上，将内置“管理员帐户密码”设置为 <strong>“Pa55w.rd1234”</strong>，然后选择 <strong>“完成”</strong>。</p>
  </li>
  <li>
    <p>在虚拟设备的“虚拟机连接”窗口中，使用新设置的密码登录。</p>
  </li>
  <li>
    <p>在虚拟设备的“虚拟机连接”窗口中，启动 Windows PowerShell 并运行以下命令以标识其 IP 地址。</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock8" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock8" class="mt-0"><code class="language-powershell">(Get-NetIPAddress).IPAddress
</code></pre>
  </li>
  <li>
    <p>如有需要，在与 <strong>az30308a-hv-vm</strong> 的远程桌面会话中，下载 Microsoft Edge 并使用默认设置运行安装。</p>
  </li>
  <li>
    <p>在 Microsoft Edge 窗口中的与 <strong>“az30308a-hv-vm”</strong> 的远程桌面会话中，导航到 <a href="%60IPaddress%60_44368/">https://<code>IPaddress</code>:44368</a>，其中 <code>IPaddress</code> 占位符代表你在上一步中标识的 IP 地址。</p>

    <blockquote>
      <p><strong>注意</strong>： 忽略有关网站安全证书的警告。</p>
    </blockquote>
  </li>
  <li>
    <p>系统出现提示时，请使用以下凭据登录：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>用户名</td>
          <td><strong>管理员</strong></td>
        </tr>
        <tr>
          <td>密码</td>
          <td><strong>Pa55w.rd1234</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 Microsoft Edge 窗口中的 <strong>“设备配置管理器”</strong> 页面上，选择 <strong>“我同意”</strong> 按钮，等待先决条件验证成功。</p>
  </li>
  <li>
    <p>在 Microsoft Edge 窗口中，在 <strong>“设备配置管理器”</strong> 页面上的 <strong>“使用 Azure Migrate 注册”</strong> 部分的 <strong>“提供 Azure Migrate 项目密钥”</strong> 文本框中，粘贴你在本练习的前面部分复制到记事本中的密钥，选择 <strong>“登录”</strong>，接受所显示的默认代码并将其粘贴到剪贴板，选择 <strong>“复制代码并登录”</strong>，然后在浏览器页面的 <strong>“输入代码”</strong> 窗格中粘贴已复制到剪贴板的代码，选择 <strong>“下一步”</strong>，提供在本实验室中所用订阅中具有所有者角色的用户帐户的凭据来登录，然后关闭浏览器页面。</p>
  </li>
  <li>
    <p>在 Microsoft Edge 窗口中的 <strong>“设备配置管理器”</strong> 页面上，验证注册是否已成功，然后选择 <strong>“继续”</strong>。</p>
  </li>
  <li>
    <p>在 Microsoft Edge 窗口中，在 <strong>“设备配置管理器”</strong> 页面上的 <strong>“管理凭据和发现源”</strong> 部分，选择 <strong>“添加凭据”</strong>，在 <strong>“添加凭据”</strong> 窗格中指定以下设置，然后选择 <strong>“保存”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>友好名称</td>
          <td><strong>az30308acreds</strong></td>
        </tr>
        <tr>
          <td>用户名</td>
          <td><strong>Student</strong></td>
        </tr>
        <tr>
          <td>密码</td>
          <td><strong>Pa55w.rd1234</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 Microsoft Edge 窗口中，在 <strong>“设备配置管理器”</strong> 页面的 <strong>“提供 Hyper-V 主机/群集详细信息”</strong> 部分，选择 <strong>“添加发现源”</strong>，在 <strong>“添加发现源”</strong> 窗格中，选择 <strong>“添加单个项目”</strong> 选项，请确保 <strong>“发现源”</strong> 下拉列表设置为 <strong>“Hyper-V 主机/群集”</strong>，在 <strong>“易记名称”</strong> 下拉列表中，选择 <strong>“az30308acreds”</strong> 条目，在 <strong>“IP 地址/FQDN”</strong> 文本框中，键入 <strong>“10.0.2.1”</strong>，然后选择 <strong>“保存”</strong>。</p>
  </li>
  <li>
    <p>在 Microsoft Edge 窗口中，在 <strong>“设备配置管理器”</strong> 页面的 <strong>“提供 Hyper-V 主机/群集详细信息”</strong> 部分，选择 <strong>“开始发现”</strong>。</p>

    <blockquote>
      <p><strong>注意</strong>： 一般来说，每台主机大约需要 15 分钟才能将发现的服务器的元数据显示在 Azure 门户中。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2配置运行和查看评估">任务 2：配置、运行和查看评估</h4>

<ol>
  <li>
    <table>
      <tbody>
        <tr>
          <td>在与 <strong>“az30308a-hv-vm”</strong> 的远程桌面会话中，在显示 Azure 门户的 Microsoft Edge 窗口中，导航回 **“Azure Migrate</td>
          <td>Windows、Linux 和 SQL Server”** 边栏选项卡，选择 <strong>“刷新”</strong>，然后在 <strong>“Azure Migrate: 发现和评估”</strong> 磁贴中，打开 <strong>“评估”</strong> 下拉菜单并选择 <strong>“Azure VM”</strong>。</td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <p><strong>备注</strong>： 可能需要再次刷新页面。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“评估属性”</strong> 边栏选项卡中，选择 <strong>“编辑”</strong>，指定以下设置（将其他设置保留为默认值）并选择 <strong>“保存”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>目标位置</td>
          <td>用于本实验室的 Azure 区域的名称</td>
        </tr>
        <tr>
          <td>存储类型</td>
          <td><strong>自动</strong></td>
        </tr>
        <tr>
          <td>预留实例</td>
          <td><strong>无预留实例</strong></td>
        </tr>
        <tr>
          <td>大小调整标准</td>
          <td><strong>作为本地</strong></td>
        </tr>
        <tr>
          <td>VM 系列</td>
          <td><strong>Dsv3 系列</strong></td>
        </tr>
        <tr>
          <td>舒适因子</td>
          <td><strong>1</strong></td>
        </tr>
        <tr>
          <td>优惠</td>
          <td><strong>即用即付</strong></td>
        </tr>
        <tr>
          <td>货币</td>
          <td>美元 ($)</td>
        </tr>
        <tr>
          <td>折扣</td>
          <td><strong>0</strong></td>
        </tr>
        <tr>
          <td>VM 正常运行时间</td>
          <td>每月 <strong>31</strong> 天，每天 <strong>24</strong> 小时</td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <p><strong>备注</strong>： 考虑到实验室环境固有的时间有限，这种情况下唯一可行的选择是 <strong>“本地”</strong> 评估。</p>
    </blockquote>
  </li>
  <li>
    <p>返回到 <strong>“评估服务器”</strong> 边栏选项卡，选择 <strong>“下一步”</strong>，然后导航回 <strong>“选择要评估的计算机”</strong> 选项卡。</p>
  </li>
  <li>
    <p>将 <strong>“评估名称”</strong> 设置为 <strong>“az30308a-assessment”</strong>。</p>
  </li>
  <li>
    <p>确保已选中 <strong>“新建”</strong> 选项，将组名设置为 <strong>“az30308a-assessment-group”</strong>，在要添加到该组的计算机列表中，选择 <strong>“az30308a-vm1”</strong>。</p>
  </li>
  <li>
    <p>单击 <strong>“下一步”</strong>，再单击 <strong>“创建评估”</strong>。</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>导航回 **“Azure Migrate</td>
          <td>Windows、Linux 和 SQL Server”** 边栏选项卡，选择 <strong>“刷新”</strong>，在 <strong>“Azure Migrat: 服务器评估”</strong> 磁贴中，验证 <strong>“评估”</strong> 行是否包含 <strong>1</strong> 个条目，然后选择该条目。</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>在 **“Azure Migrate: 服务器评估</td>
          <td>评估”** 边栏选项卡上，选择新建的评估 <strong>az30308a-assessment</strong>。</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 <strong>“az30308a-assessment”</strong> 边栏选项卡上，查看指示 Azure 迁移就绪性以及每月计算和存储估算成本的信息。</p>

    <blockquote>
      <p><strong>备注</strong>： 在真实场景中，你应该考虑安装依赖项代理，以便在评估阶段提供有关服务器依赖项的更多见解。</p>
    </blockquote>
  </li>
</ol>

<h3 id="练习-3使用-azure-migrate-迁移-hyper-v-vm">练习 3：使用 Azure Migrate 迁移 Hyper-V VM</h3>

<p>本练习的主要任务如下：</p>

<ol>
  <li>
    <p>准备迁移 Hyper-V VM</p>
  </li>
  <li>
    <p>配置 Hyper-V VM 复制</p>
  </li>
  <li>
    <p>执行 Hyper-V VM 迁移</p>
  </li>
  <li>
    <p>删除实验室中部署的 Azure 资源</p>
  </li>
</ol>

<h4 id="任务-1准备迁移-hyper-v-vm">任务 1：准备迁移 Hyper-V VM</h4>

<ol>
  <li>
    <table>
      <tbody>
        <tr>
          <td>在与 <strong>“az30308a-hv-vm”</strong> 的远程桌面会话中，在显示 Azure 门户的 Microsoft Edge 窗口中，导航回 **“Azure Migrate</td>
          <td>Windows、Linux 和 SQL Server”** 边栏选项卡。</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>在 **“Azure Migrate</td>
          <td>Windows、Linux 和 SQL Server”** 边栏选项卡，在 <strong>“Azure Migrate: 服务器迁移”</strong> 磁贴中，选择 <strong>“发现”</strong> 链接。</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 <strong>“发现计算机”</strong> 边栏选项卡上，指定以下设置（将其他设置保留为默认值），然后选择 <strong>“创建资源”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>你的计算机是否虚拟化？</td>
          <td><strong>是的，使用 Hyper-V</strong></td>
        </tr>
        <tr>
          <td>目标区域</td>
          <td>在本实验室中使用的 Azure 区域的名称</td>
        </tr>
        <tr>
          <td>确认要迁移到的目标区域</td>
          <td>已选择</td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <p><strong>备注</strong>： 此步骤将自动触发 Azure Site Recovery 保管库的预配。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“发现计算机”</strong> 边栏选项卡上，在 <strong>“准备 Hyper-V 主机服务器” 1.</strong> 步骤中，选择第一个 <strong>“下载”</strong> 链接（而非“下载”按钮），以下载 Hyper-V 复制提供程序软件的安装程序。</p>
  </li>
  <li>
    <p>出现提示时，启动 <strong>“AzureSiteRecoveryProvider.exe”</strong>。此时将启动 <strong>“Azure Site Recovery 提供程序安装(Hyper-V 服务器)”</strong> 向导。</p>
  </li>
  <li>
    <p>在 <strong>“Microsoft 更新”</strong> 页面上，选择 <strong>“关”</strong>，然后选择 <strong>“下一步”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“提供程序安装”</strong> 页面上，选择 <strong>“安装”</strong>。</p>
  </li>
  <li>
    <p>切换到 Azure 门户，在 <strong>“发现计算机”</strong> 边栏选项卡上，选择本地 Hyper-V 主机准备程序步骤 1 中的 <strong>“下载”</strong> 按钮，以下载保管库注册密钥。出现提示时，将注册密钥保存到 <strong>“下载”</strong> 文件夹中。</p>
  </li>
  <li>
    <p>切换到 <strong>“提供程序安装”</strong> 页面，然后选择 <strong>“注册”</strong>。此时将启动 <strong>“Microsoft Azure Site Recovery 注册向导”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Microsoft Azure Site Recovery 注册向导”</strong> 的 <strong>“保管库设置”</strong> 页面， 选择 <strong>“浏览”</strong>，导航到 <strong>“下载”</strong> 文件夹，选择保管库凭据文件，然后选择 <strong>“打开”</strong>。</p>
  </li>
  <li>
    <p>回到 <strong>“Microsoft Azure Site Recovery 注册向导”</strong> 的 <strong>“保管库设置”</strong> 页面， 选择 <strong>“下一步”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Microsoft Azure Site Recovery 注册向导”</strong> 的 <strong>“代理设置”</strong> 页面 ，接受默认设置，然后选择 <strong>“下一步”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“Microsoft Azure Site Recovery 注册向导”</strong> 的 <strong>“注册”</strong> 页面， 选择 <strong>“完成”</strong>。</p>
  </li>
  <li>
    <p>注册过程完成后，在 <strong>“发现计算机”</strong> 边栏选项卡上，选择 <strong>“完成注册”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 可能需要刷新显示 <strong>“发现计算机”</strong> 边栏选项卡的浏览器页面，然后导航回该页面。</p>
    </blockquote>

    <blockquote>
      <p><strong>备注</strong>： 发现虚拟机的过程最多可能需要 15 分钟才能完成。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2配置-hyper-v-vm-复制">任务 2：配置 Hyper-V VM 复制</h4>

<ol>
  <li>
    <table>
      <tbody>
        <tr>
          <td>收到已完成注册的确认后，导航回 **“Azure Migrate”</td>
          <td>Windows、Linux 和 SQL Server”** 边栏选项卡，在 <strong>“Azure Migrate: 服务器迁移”</strong> 磁贴中，选择 <strong>“复制”</strong> 链接。</td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <table>
        <tbody>
          <tr>
            <td><strong>备注</strong>： 可能需要刷新显示 **“Azure Migrate”</td>
            <td>Windows、Linux 和 SQL Server”** 边栏选项卡的浏览器页面。</td>
          </tr>
        </tbody>
      </table>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“复制”</strong> 边栏选项卡的 <strong>“源设置”</strong> 页面，在 <strong>“你的计算机是否已虚拟化?”</strong> 下拉列表中，选择 <strong>“是，使用 Hyper-V”</strong>，然后选择 <strong>“下一步： 虚拟机”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“复制”</strong> 边栏选项卡的 <strong>“虚拟机”</strong> 页面中指定以下设置（将其他设置保留为默认值），并选择 <strong>“下一步：” 下一步: “目标设置”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>从 Azure Migrate 评估导入迁移设置</td>
          <td><strong>是，根据 Azure Migrate 评估应用迁移设置</strong></td>
        </tr>
        <tr>
          <td>选择组</td>
          <td><strong>az30308a-assessment-group</strong></td>
        </tr>
        <tr>
          <td>选择评估</td>
          <td><strong>az30308a-assessment</strong></td>
        </tr>
        <tr>
          <td>虚拟机</td>
          <td><strong>az30308a-vm1</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 <strong>“复制”</strong> 边栏选项卡的 <strong>“目标设置”</strong> 页面中指定以下设置（将其他设置保留为默认值），并选择 <strong>“下一步: 计算”</strong>：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>订阅</td>
          <td>在本实验室中使用的 Azure 订阅的名称</td>
        </tr>
        <tr>
          <td>资源组</td>
          <td><strong>az30308c-labRG</strong></td>
        </tr>
        <tr>
          <td>复制存储帐户</td>
          <td>之前在本实验室中创建的存储帐户的名称</td>
        </tr>
        <tr>
          <td>虚拟网络</td>
          <td><strong>az30308c-migration-vnet</strong></td>
        </tr>
        <tr>
          <td>子网</td>
          <td><strong>subnet0</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 <strong>“复制”</strong> 边栏选项卡的 <strong>“计算”</strong> 页面上，确保选中 <strong>“Azure VM 大小”</strong> 下拉列表中的 <strong>“Standard_D2s_v3”</strong>，在 <strong>“OS 类型”</strong> 下拉列表中，选择 <strong>“Windows”</strong>，然后选择 <strong>“下一步: 磁盘”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“复制”</strong> 边栏选项卡的 <strong>“磁盘”</strong> 页面上，接受默认设置并选择 <strong>“下一步: 查看 + 开始复制”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“复制”</strong> 边栏选项卡的 <strong>“查看 + 开始复制”</strong> 页面上，选择 <strong>“复制”</strong>。</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>若要监视复制状态，请导航回 **“Azure Migrate</td>
          <td>Windows、Linux 和 SQL Server”** 边栏选项卡，在 <strong>“Azure Migrate: 服务器迁移”</strong> 磁贴中，选择 <strong>“复制服务器”</strong> 条目，然后在 **“Azure Migrate: 服务器迁移</td>
          <td>复制计算机”** 上，检查复制计算机列表中的 <strong>“状态”</strong> 列。</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>等待状态更改为 <strong>“受保护”</strong>。该操作可能还需要 15 分钟。</li>
</ol>

<h4 id="任务-3执行-hyper-v-vm-迁移">任务 3：执行 Hyper-V VM 迁移</h4>

<ol>
  <li>
    <table>
      <tbody>
        <tr>
          <td>在 Azure 门户中的 **“Azure Migrate: 服务器迁移</td>
          <td>复制计算机”** 上，选择代表 <strong>“az30308a-vm1”</strong> 虚拟机的条目。</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 <strong>az30308a-vm1</strong> 复制计算机边栏选项卡上，选择 <strong>“测试迁移”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“测试迁移”</strong> 边栏选项卡的 <strong>“虚拟网络”</strong> 下拉列表中，选择 <strong>“az30308c-test-vnet”</strong>，然后选择 <strong>“测试迁移”</strong>。</p>

    <blockquote>
      <p><strong>备注</strong>： 等待测试迁移完成。该操作需要约 5 分钟。</p>
    </blockquote>
  </li>
  <li>
    <p>在 Azure 门户中，搜索并选择 <strong>“虚拟机”</strong>，在 <strong>“虚拟机”</strong> 边栏选项卡上，注意代表新预配虚拟机 <strong>az30308a-vm1-test</strong> 的条目。</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>在 Azure 门户中，导航回 **“Azure Migrate: 服务器迁移</td>
          <td>复制计算机”<strong>，选择 **“刷新”</strong>，然后验证 <strong>az30308a-vm1</strong> 虚拟机是否列出并具有 <strong>“清理测试故障转移挂起”</strong> 状态。</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>在 **“Azure Migrate: 服务器迁移</td>
          <td>复制计算机”** 边栏选项卡上，选择代表 <strong>az30308a-vm1</strong> 虚拟机的条目。</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>在 <strong>“az30308a-vm1 复制计算机”</strong> 边栏选项卡上，选择 <strong>“清理测试迁移”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“测试迁移清理”</strong> 边栏选项卡上，选中复选框 <strong>“测试完成。 删除测试虚拟机”</strong>，然后选择 <strong>“清理测试”</strong>。</p>
  </li>
  <li>
    <p>测试故障转移清理作业完成后，刷新显示 <strong>“az30308a-vm1 复制计算机”</strong> 边栏选项卡的浏览器页面，并注意工具栏中的 <strong>“迁移”</strong> 图标将自动变为可用。</p>
  </li>
  <li>
    <p>在 <strong>“az30308a-vm1 复制计算机”</strong> 边栏选项卡上，选择 <strong>“迁移”链接</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“迁移”</strong> 边栏选项卡上的 <strong>“在迁移之前关闭计算机以最大程度地减少数据丢失?”</strong> 下拉列表中，选择 <strong>“是”</strong>，然后选中 <strong>“az30308a-vm1”</strong> 条目旁边的复选框，然后选择 <strong>“迁移”</strong>。</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>若要监视迁移状态，请导航回 **“Azure Migrate”</td>
          <td>Windows、Linux 和 SQL Server”** 边栏选项卡，在 <strong>“Azure Migrate: 服务器迁移”</strong> 磁贴中，选择 <strong>“复制服务器”</strong> 条目，然后在 **“Azure Migrate: 服务器迁移</td>
          <td>复制计算机”** 上，检查复制计算机列表中的 <strong>“状态”</strong> 列。验证状态是否显示为 <strong>“计划内故障转移完成”</strong> 状态。</td>
        </tr>
      </tbody>
    </table>

    <blockquote>
      <table>
        <tbody>
          <tr>
            <td><strong>注意</strong>： 迁移应该是不可逆的操作。如果要查看已完成的信息，请导航回“Azure Migrate</td>
            <td>Windows、Linux 和 SQL Server”边栏选项卡，刷新页面，并验证“Azure Migrate: 服务器迁移”磁贴中已迁移服务器的值为 1。</td>
          </tr>
        </tbody>
      </table>
    </blockquote>
  </li>
</ol>

<h4 id="任务-4删除实验室中部署的-azure-资源">任务 4：删除实验室中部署的 Azure 资源</h4>

<ol>
  <li>
    <p>在与 <strong>“az30308a-hv-vm”</strong> 的远程桌面会话中，在显示 Azure 门户的浏览器窗口中，在“Cloud Shell”窗格中启动 PowerShell 会话。</p>
  </li>
  <li>
    <p>在“Cloud Shell”窗格中，运行以下命令以列出你在本练习中创建的资源组：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock9" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock9" class="mt-0"><code class="language-powershell">Get-AzResourceGroup -Name 'az30308*'
</code></pre>

    <blockquote>
      <p><strong>备注</strong>： 验证输出结果是否仅包含在本实验室中创建的资源组。在本任务中将删除这个组。</p>
    </blockquote>
  </li>
  <li>
    <p>在“Cloud Shell”窗格中运行以下命令，以删除在本实验室中创建的资源组</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock10" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock10" class="mt-0"><code class="language-powershell">Get-AzResourceGroup -Name 'az30308*' | Remove-AzResourceGroup -Force -AsJob
</code></pre>
  </li>
  <li>
    <p>关闭“Cloud Shell”窗格。</p>
  </li>
</ol>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-304ZH-Microsoft-Azure-Architect-Design" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-304ZH-Microsoft-Azure-Architect-Design
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D.js"></script>



</body></html>