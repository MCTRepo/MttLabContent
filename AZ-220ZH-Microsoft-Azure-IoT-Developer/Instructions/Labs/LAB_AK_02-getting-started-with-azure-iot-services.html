<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-220ZH-Microsoft-Azure-IoT-Developer
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D653337691cd169b6aa5719d4ea66f4e6a878a19c.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-220ZH-Microsoft-Azure-IoT-Developer
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-220ZH-Microsoft-Azure-IoT-Developer" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#练习-1了解全局唯一资源命名要求">练习 1：了解全局唯一资源命名要求</a></li><li class="nav-item"><a class="nav-link active" href="#练习-2使用-azure-门户创建-iot-中心">练习 2：使用 Azure 门户创建 IoT 中心</a></li><li class="nav-item"><a class="nav-link" href="#练习-3检查-iot-中心服务">练习 3：检查 IoT 中心服务</a></li><li class="nav-item"><a class="nav-link" href="#练习-4使用-azure-门户创建设备预配服务">练习 4：使用 Azure 门户创建设备预配服务</a></li><li class="nav-item"><a class="nav-link" href="#练习-5了解设备预配服务">练习 5：了解设备预配服务</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="azure-iot-服务入门">Azure IoT 服务入门</h1>

<h2 id="实验室场景">实验室场景</h2>

<p>你是为 Contoso（一家精制和分销美食奶酪的公司）工作的 Azure IoT 开发人员。</p>

<p>你的任务是探索 Azure 和 Azure IoT 服务，你将使用这些服务开发 Contoso 的 IoT 解决方案。你已熟悉 Azure 门户并为你的项目创建了资源组。现在，你需要开始研究 Azure IoT 服务。</p>

<h2 id="本实验室概览">本实验室概览</h2>

<p>在本实验室中，你将创建和研究 Azure IoT 中心和 IoT 中心设备预配服务。本实验室包括以下练习：</p>

<ul>
  <li>了解全局唯一资源命名要求</li>
  <li>使用 Azure 门户创建 IoT 中心</li>
  <li>检查 IoT 中心服务的功能</li>
  <li>创建设备预配服务并将其链接到 IoT 中心</li>
  <li>检查设备预配服务的功能</li>
</ul>

<h2 id="实验室说明">实验室说明</h2>

<h3 id="练习-1了解全局唯一资源命名要求">练习 1：了解全局唯一资源命名要求</h3>

<p>在本课程的实验室 2-20 中，你将创建用于开发 IoT 解决方案的 Azure 资源。为确保在各实验室中保持一致，并帮助你在使用完资源后清理它们，实验室说明将提供建议的资源名称。建议的资源名称将尽可能遵循此处建议的命名准则：<a href="https://docs.microsoft.com/zh-cn/azure/cloud-adoption-framework/ready/azure-best-practices/naming-and-tagging">建议的命名和标记约定</a>。但是，你将在本课程中创建的许多资源都公开了可在 Web 上使用的服务，这意味着它们必须具有全局唯一名称。为确保这些资源符合“全局唯一”要求，你将在必要时将唯一标识符添加到资源名称末尾。</p>

<p>在本练习中，你将创建唯一 ID 并查看一些示例，这些示例有助于说明如何在本课程的实验室 2-20 中使用唯一 ID。</p>

<h4 id="任务-1创建唯一-id">任务 1：创建唯一 ID</h4>

<ol>
  <li>
    <p>使用你的小写姓名首字母和当前日期，按以下模式构成你的唯一 ID：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="language-text"> YourInitialsYYMMDD
</code></pre>

    <p>唯一 ID 的第一部分将是你的小写姓名首字母。第二部分将是本年的最后两位数字、本月数字和本日数字。以下是一些示例：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="language-text"> gwb200123
 bho200504
 cah201216
 dm200911
</code></pre>

    <p>在实验室说明中，每当需要输入唯一 ID 时，你都将看到 <code>{your-id}</code> 被列为建议的资源名称的一部分。建议的资源名称的 <code>{your-id}</code> 部分是占位符。你将用唯一值替换整个占位符字符串（包括 <code>{}</code>）。</p>
  </li>
  <li>
    <p>现在请记下你的唯一 ID，并<strong>在整个课程期间使用同一个值</strong>。</p>

    <blockquote>
      <p><strong>备注：</strong> 请勿每天更改唯一 ID 的日期部分。请在本课程中一直使用相同的唯一 ID。</p>
    </blockquote>
  </li>
</ol>

<h4 id="任务-2查看如何以及何时应用唯一-id">任务 2：查看如何以及何时应用唯一 ID</h4>

<p>你在本课程的实验室中创建的许多资源将具有可公开寻址（尽管受保护）的终结点，因此必须是全局唯一的。需要全局唯一名称的资源的示例包括 IoT 中心、设备预配服务和 Azure 存储帐户。</p>

<p>如上所述，创建这些类型的资源时，会向你提供一个遵循建议准则的资源名称，并且会指示你添加唯一 ID 作为资源名称的一部分。为帮助阐明何时需要输入唯一 ID，建议的资源名称将包含唯一 ID 的占位符值。系统会指示你将该占位符值 <code>{your-id}</code> 替换为唯一 ID。</p>

<ol>
  <li>
    <p>查看以下资源命名示例：</p>

    <p>如果你的唯一 ID 为： <strong>cah191216</strong></p>

    <table>
      <thead>
        <tr>
          <th style="text-align: left">资源类型</th>
          <th style="text-align: left">名称模板</th>
          <th style="text-align: left">示例</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: left">IoT 中心</td>
          <td style="text-align: left">iot-az220-training-{your-id}</td>
          <td style="text-align: left">iot-az220-training-cah191216</td>
        </tr>
        <tr>
          <td style="text-align: left">设备预配服务</td>
          <td style="text-align: left">dps-az220-training-{your-id}</td>
          <td style="text-align: left">dps-az220-training-cah191216</td>
        </tr>
        <tr>
          <td style="text-align: left">Azure 存储帐户<br>（名称必须小写且不含短划线）</td>
          <td style="text-align: left">az220storage{your-id}</td>
          <td style="text-align: left">az220storagecah191216</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>查看以下在 Bash 脚本中应用唯一 ID 的示例：</p>

    <p>在本课程后面的一些实验室中，系统会指示你在 Bash 脚本中应用唯一 ID 值。为你提供的 Bash 脚本文件可能包含类似如下的代码：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="language-bash hljs"> <span class="hljs-comment"><span class="hljs-comment">#!/bin/bash</span></span>

 YourID=<span class="hljs-string"><span class="hljs-string">"{your-id}"</span></span>
 RGName=<span class="hljs-string"><span class="hljs-string">"rg-az220"</span></span>
 IoTHubName=<span class="hljs-string"><span class="hljs-string">"iot-az220-training-</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$YourID</span></span></span><span class="hljs-string">"</span></span>
</code></pre>

    <p>在上面的代码中，如果唯一 ID 的值为 <code>cah191216</code>，则包含 <code>YourID="{your-id}"</code> 的行应更新为 <code>YourID="cah191216"</code>。</p>

    <blockquote>
      <p><strong>备注：</strong> 注意不要更改最后一行代码中的 <code>$YourID</code> 值。如果不是 <code>{your-id}</code>，就不要替换它。</p>
    </blockquote>
  </li>
  <li>
    <p>查看以下在 C# 代码中应用唯一 ID 的示例：</p>

    <p>在本课程后面的一些实验室中，系统会指示你在 C# 源文件中应用唯一 ID 值。将为你提供的 C# 源代码可能包含类似以下内容的代码部分：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">c#</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="language-csharp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _yourId = <span class="hljs-string"><span class="hljs-string">"{your-id}"</span></span>;
 <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _rgName = <span class="hljs-string"><span class="hljs-string">"rg-az220"</span></span>;
 <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _iotHubName = <span class="hljs-string"><span class="hljs-string">$"iot-az220-training-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{_yourId}</span></span></span><span class="hljs-string">"</span></span>;
</code></pre>

    <p>在上面的代码中，如果唯一 ID 的值为 <code>cah191216</code>，则包含 <code>private string _yourId = "{your-id}";</code> 的行应更新为 <code>private string _yourId = "cah191216";</code></p>

    <blockquote>
      <p><strong>备注：</strong> 注意不要更改最后一行代码中的 <code>_yourId</code> 值。同样，如果不是 <code>{your-id}</code>，就不要替换它。</p>
    </blockquote>
  </li>
  <li>
    <p>请注意，并非所有资源名称都需要应用唯一 ID。</p>

    <p>你可能已经思考过，你在上一个实验室中创建的资源组不包含唯一 ID 值。</p>

    <p>某些资源（如资源组）在订阅中必须具有唯一的名称，但该名称不必是全局唯一的。因此，参加本课程的每名学生都可以使用该资源名称： <strong>rg-az220</strong>。并且，这仅适用于每名学生都使用其自己的订阅的情况，但实际情况就该如此。</p>
  </li>
  <li>
    <p>如果你的唯一 ID 实际上并不是唯一的，则请附加一个 <code>01</code> 或 <code>02</code>。</p>

    <p>当有两个或两个以上姓名首字母相同的人员在同一天开始上课时，可能会出现此情况。除非这个人坐在你旁边，否则你可能不知道这一点，直到在下一练习中创建 IoT 中心。Azure 会告诉你建议的资源名称（包含唯一 ID）是否是全局唯一的。在该情况下，系统会指示你更新唯一 ID，方式是追加一个 <code>##</code> 值。例如，如果唯一 ID 的值为 <code>cah191216</code>，则更新的唯一 ID 值将为：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="language-text"> cah20121600
 cah20121601
 cah20121602
 ...
 cah20121699
</code></pre>

    <p>如果无需更新唯一 ID，请尝试一直使用它。</p>
  </li>
</ol>

<h3 id="练习-2使用-azure-门户创建-iot-中心">练习 2：使用 Azure 门户创建 IoT 中心</h3>

<p>Azure IoT 中心是一项完全托管的服务，可在 IoT 设备和 Azure 之间实现可靠、安全的双向通信。Azure IoT 中心服务提供以下内容：</p>

<ul>
  <li>与数十亿个 IoT 设备建立双向通信</li>
  <li>有多种设备到云和云到设备通信选项，包括单向消息传递、文件传输和请求-答复方法。</li>
  <li>内置声明性消息路由到其他 Azure 服务。</li>
  <li>设备元数据和同步状态信息的可查询存储。</li>
  <li>使用每台设备的安全密钥或 X.509 证书来实现安全的通信和访问控制。</li>
  <li>广泛监视设备连接性和设备标识管理事件。</li>
  <li>适用于最受欢迎的语言和平台的 SDK 设备库。</li>
</ul>

<p>你可以使用多种方法来创建 IoT 中心。例如，可以使用 Azure 门户创建 IoT 中心资源，也可以编程方式创建 IoT 中心（和其他资源）。在本课程中，你将研究可用于创建和管理 Azure 资源的各种方法，包括 Azure CLI 和 Bash 脚本。</p>

<p>在本练习中，你将使用 Azure 门户创建和配置 IoT 中心。</p>

<h4 id="任务-1使用-azure-门户创建资源iot-中心">任务 1：使用 Azure 门户创建资源（IoT 中心）</h4>

<ol>
  <li>
    <p>使用你的 Azure 帐户凭据登录到 <a href="https://portal.azure.com">portal.azure.com</a>。</p>

    <p>如果有多个 Azure 帐户，请确保使用与本课程要使用的订阅绑定的帐户登录。  你可能会发现，使用 InPrivate/Incognito 浏览器会话最容易避免意外使用错误的帐户。</p>
  </li>
  <li>
    <p>请注意，已加载在上一个实验室中创建的 AZ-220 仪表板。</p>

    <p>在之后的课程中，将向仪表板添加资源。</p>
  </li>
  <li>
    <p>在 Azure 门户菜单上，单击 <strong>“+ 创建资源”</strong>。</p>

    <p>随即打开 <strong>“新建”</strong> 边栏选项卡，这是 Azure 市场的前端，该市场是可以在 Azure 中创建的所有资源的集合。市场包含来自 Microsoft 和社区的资源。</p>
  </li>
  <li>
    <p>在搜索文本框中，键入 <strong>“IoT 中心”</strong>，然后按 <strong>Enter</strong>。</p>

    <p>随即将打开 <strong>“市场”</strong> 边栏选项卡，显示与你的搜索条件匹配的可用服务。</p>

    <blockquote>
      <p><strong>备注：</strong> 由私人参与者提供的市场服务可能包括 Microsoft Azure Pass 或其他 Microsoft Azure 额度产品/服务未涵盖的费用。在本课程的实验室中，你将使用 Microsoft 提供的资源。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“市场”</strong> 边栏选项卡中，单击 <strong>“IoT 中心”</strong> 搜索结果。</p>

    <blockquote>
      <p><strong>备注：</strong>
<strong>“创建”</strong> 操作显示在 <strong>“IoT 中心”</strong> 搜索结果底部 - 这将直接导航至 IoT 中心创建视图。在日常使用中，你可能选择单击此项 - 为实现本教程的目的，请单击 <strong>“IoT 中心”</strong> 搜索结果的正文中的任意位置。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“IoT 中心”</strong> 边栏选项卡中，单击 <strong>“使用情况信息 + 支持”</strong>。</p>

    <p>请注意 <strong>“有用的链接”</strong> 下的资源链接列表。</p>

    <p>目前无需浏览这些链接，但需注意，这些链接都是可用的。例如，文档链接会将你导向至 IoT 中心资源和文档的根页面__。可使用此页面查看最新的 Azure IoT 中心文档并浏览本课程未涵盖的其他资源。在本课程中，你可以访问 docs.microsoft.com 站点，以获取有关特定主题的更多信息。</p>

    <p>如果你已打开其中一个链接，请立即将其关闭，并使用你的浏览器导航回“Azure 门户”选项卡。</p>
  </li>
</ol>

<h4 id="任务-2使用所需的属性设置创建-iot-中心">任务 2：使用所需的属性设置创建 IoT 中心</h4>

<ol>
  <li>
    <p>单击 <strong>“创建”</strong>，开始创建新的 IoT 中心。</p>

    <blockquote>
      <p><strong>提示：</strong> 将来，还可以使用另外两种方式来获得创建任何 Azure 资源类型的体验__：</p>

      <ol>
        <li>如果“收藏夹”中有该服务，你可以单击该服务以导航到实例列表，然后单击顶部的“+ 添加”按钮__。</li>
        <li>你可以在门户顶部的“搜索”__框中搜索服务名称来获取实例列表，然后单击顶部的“+ 添加”__按钮。</li>
      </ol>
    </blockquote>

    <p>以下步骤将引导你完成创建 IoT 中心所需的设置，并在你填充每个字段时逐一解释。</p>
  </li>
  <li>
    <p>在 <strong>“IoT 中心”</strong> 边栏选项卡的 <strong>“订阅”</strong> 下拉列表中，确保你打算在本课程中使用的 Azure 订阅已选中。</p>

    <p>所选的“基本信息”选项卡最初包含你需要填充的未初始化的资源，但其他选项卡上也有你需要熟悉的设置__。</p>
  </li>
  <li>
    <p>在 <strong>“资源组”</strong> 的右侧，打开下拉列表，然后单击 <strong>“rg-az220”</strong></p>

    <p>这是你在上一个实验室中创建的资源组。你需要将为本课程创建的资源分组在同一个资源组中。最佳做法是通过此方式对相关资源进行分组，这将帮助你在不再需要资源时对其进行清理。</p>
  </li>
  <li>
    <p>在 <strong>“区域”</strong> 的右侧，打开下拉列表并选择为资源组所选的相同区域。</p>

    <blockquote>
      <p><strong>备注：</strong> 即将进行的实验室之一将使用事件网格。为支持这个将来的实验室，你需要选择一个支持事件网格的区域。有关支持事件网格的当前区域列表，请参见以下链接：<a href="https://azure.microsoft.com/zh-cn/global-infrastructure/services/?products=event-grid&amp;regions=all">可用产品（按区域）</a></p>
    </blockquote>

    <p>正如之前所见，Azure 受到位于世界各地的众多数据中心支持。在 Azure 中创建内容时，你可以将其部署到这些数据中心位置中的其中一个位置。</p>

    <blockquote>
      <p><strong>备注：</strong>  选取一个区域来托管资源时，请记住，选取靠近最终用户的区域会减少加载/响应时间。在生产环境中，如果你与最终用户位于世界的两端，则不应选取距离你最近的区域。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“IoT 中心名称”</strong> 右侧，为你的 IoT 中心输入全局唯一名称，如下所示：</p>

    <p>要提供全局唯一名称，请输入 <strong>“iot-az220-training-{your-id}”</strong> （记住要将 <strong>{your-id}</strong> 替换为你在练习 1 中创建的唯一 ID）。</p>

    <p>例如： <strong>iot-az220-training-cah191216</strong></p>

    <p>IoT 中心的名称必须全局唯一，因为它是一种必须能够通过任何已启用 IP 的 IoT 设备进行访问的公开访问资源。</p>

    <p>为新的 IoT 中心指定唯一名称时，请考虑以下事项：</p>

    <ul>
      <li>
        <p>应用于 <strong>IoT 中心名称</strong>的值在整个 Azure 中必须唯一。这是正确的，因为分配给该名称的值将在 IoT 中心的连接字符串中使用。由于 Azure 让你可以将世界各地的设备连接到中心，因此必须使用连接字符串从 Internet 访问所有 Azure IoT 中心，因而连接字符串必须是唯一的。你将在本实验室的后面部分探索连接字符串。</p>
      </li>
      <li>
        <p>创建资源后，无法更改分配给 <strong>IoT 中心名称</strong>的值。如果确实需要更改名称，则需要使用所需名称创建一个新的 IoT 中心，从原始中心重新注册设备并将其注册到新中心，并删除旧的 IoT 中心。</p>
      </li>
      <li>
        <p><strong>“IoT 中心名称”</strong> 字段是必需字段。</p>
      </li>
    </ul>

    <blockquote>
      <p><strong>备注：</strong>  Azure 可确保你输入的名称是唯一的。如果输入的名称不是唯一的，Azure 将在名称字段下显示一条消息作为警告。如果看到警告消息，则应更新唯一 ID。尝试对唯一 ID 追加 <strong>“00”</strong>、 <strong>“01”</strong> 或 <strong>“02”</strong> 等，以实现全局唯一名称。</p>
    </blockquote>

    <blockquote>
      <p><strong>备注：</strong> 一些资源名称不能包含扩展字符（如短划线 (-) 或下划线 (_)），因此更新唯一 ID 时，请始终使用数字。</p>
    </blockquote>
  </li>
  <li>
    <p>在边栏选项卡顶部，单击 <strong>“管理”</strong>。</p>

    <p>请花费一点时间查看本实验室中显示的字段和其他信息。</p>
  </li>
  <li>
    <p>在 <strong>“定价和缩放层”</strong> 右侧，请确保已选中 <strong>“S1: 标准层”</strong>。</p>

    <p>Azure IoT 中心提供多个层级选项，具体取决于你需要的功能数以及每天通过解决方案发送的消息数。我们在本课程中使用的 S1 层允许每个单位每天传输共计 400,000 条消息，并提供此训练所需的所有服务__。实际上每个单位每天不需要传输 400,000 条消息，但是我们将使用标准层提供的功能，例如云到设备命令、设备管理和 IoT Edge__<em>__</em>。IoT 中心还提供一个免费层，用于测试和评估。该层具有与标准层相同的功能，但消息传递有限额。请务必注意，不能从免费层升级到基本层或标准层。免费层允许将 500 台设备连接到 IoT 中心，并且每天最多传输 8,000 条信息。每个 Azure 订阅都可以在免费层中创建一个 IoT 中心。</p>

    <blockquote>
      <p><strong>备注：</strong>  S1 - 标准层的费用为每月每个单位 25.00 美元__。你将指定 1 个单位。有关其他层级选项的详细信息，请参阅<a href="https://docs.microsoft.com/zh-cn/azure/iot-hub/iot-hub-scaling">为你的解决方案选择合适的 IoT 中心层</a>。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“S1 IoT 中心单位数”</strong> 右侧，确保选择了 <strong>“1”</strong>。</p>

    <p>如上所述，所选定价层会确定你的中心每天每个单位可以处理的消息数。要增加你的中心可处理的消息数而无需移至更高的定价层，你可以增加单位数。例如，如果你希望 IoT 中心支持多达 800,000 条消息流入量，则可以指定<em>两个</em> S1 层单位。在本课程中，你只需使用 1 个单位。</p>
  </li>
  <li>
    <p>在 <strong>Defender for IoT</strong> 右侧，确保选择了 <strong>“关闭”</strong>。</p>

    <p>Azure Defender for IoT 是一种统一的安全解决方案，用于识别 IoT/OT 设备、漏洞和威胁。它使你能够保护整个 IoT/OT 环境，无论你需要保护现有 IoT/OT 设备还是需要将安全性构建到新的 IoT 创新中。</p>

    <blockquote>
      <p><strong>提示</strong>：
 <strong>Azure Defender for IoT</strong> 之前被称为 <strong>Azure 安全中心</strong>，在 Azure 和此内容中的尚未更新此名称的位置，你可能仍会看到之前的名称。</p>
    </blockquote>

    <p>Azure Defender for IoT 默认处于启用状态，因为安全性对于 IoT 解决方案至关重要。你将在本课程的实验室 19 中探索 Azure Defender for IoT。现在禁用它，以确保实验室 19 的说明按预期工作。</p>

    <p>目前，可通过 Azure 门户在订阅级别启用 Azure Defender。Azure Defender 前 30 天免费。30 天后一旦使用，将按照<a href="https://azure.microsoft.com/zh-cn/pricing/details/azure-defender/">这里</a>的详细定价信息自动收费。</p>
  </li>
  <li>
    <p>展开 <strong>“高级设置”</strong>，然后确保 <strong>“设备到云的分区”</strong> 设置为 <strong>“4”</strong>。</p>

    <p>分区数将设备到云消息关联到这些消息的并行读取器的数目。大多数 IoT 中心仅需要四个分区，这是默认值。在本课程中，你将使用默认分区数创建 IoT 中心。</p>
  </li>
  <li>
    <p>在 <strong>“传输层安全性(TLS)”</strong> 部分，确保 <strong>“最低 TLS 版本”</strong> 设置为 <strong>“1.0”</strong>。</p>

    <p>IoT 中心使用传输层安全性 (TLS) 保护来自 IoT 设备和服务的连接。目前支持三个版本的 TLS 协议，即版本 1.0、1.1 和 1.2。</p>

    <blockquote>
      <p>[注意事项！]
创建 IoT 中心资源后，无法更改 <strong>“最低 TLS 版本”</strong> 属性。因此，必须事先正确测试并验证你的所有 IoT 设备和服务是否与 TLS 1.2 和建议的密码兼容。可通过以下内容了解有关 IoT 中心和 TLS 的详细信息：</p>
      <ul>
        <li><a href="https://docs.microsoft.com/azure/iot-hub/iot-hub-tls-support">IoT 中心的传输层安全性 (TLS) 支持</a></li>
      </ul>
    </blockquote>
  </li>
  <li>
    <p>在边栏选项卡顶部，单击 <strong>“查看 + 创建”</strong>。</p>

    <p>花费片刻时间查看你提供的设置。</p>
  </li>
  <li>
    <p>在边栏选项卡底部，单击 <strong>“创建”</strong>，完成 IoT 中心的创建。</p>

    <p>部署可能需要一分钟或更长时间。你可以打开“Azure 门户通知”窗格来监视进度。</p>
  </li>
  <li>
    <p>请注意，几分钟后你会收到一条通知，指出 IoT 中心已成功部署到 <strong>rg-az220</strong> 资源组。</p>
  </li>
  <li>
    <p>在 Azure 门户菜单中，单击 <strong>“仪表板”</strong>，然后单击 <strong>“刷新”</strong>。</p>

    <p>你会看到资源组磁贴列出新的 IoT 中心。</p>
  </li>
</ol>

<h3 id="练习-3检查-iot-中心服务">练习 3：检查 IoT 中心服务</h3>

<p>正如你已了解到的，IoT 中心是托管在云中的托管服务，充当中央消息中心，用于在 Azure IoT 服务与已连接的设备之间进行双向通信。</p>

<p>IoT 中心的功能可帮助你生成功能齐全的可缩放 IoT 解决方案，例如管理制造业中使用的工业设备，跟踪医疗保健中的宝贵资产以及监视办公楼使用情况和其他更多场景。IoT 中心监视通过跟踪设备创建、设备故障和设备连接等事件，帮助你对解决方案的运行状况进行维护。</p>

<p>在本练习中，你将了解 IoT 中心提供的部分功能。</p>

<h4 id="任务-1浏览-iot-中心概述信息">任务 1：浏览 IoT 中心概述信息</h4>

<ol>
  <li>
    <p>如有必要，使用 Azure 帐户凭据登录到 <a href="https://portal.azure.com">portal.azure.com</a>。</p>

    <p>如果有多个 Azure 帐户，请确保使用与本课程要使用的订阅绑定的帐户登录。</p>
  </li>
  <li>
    <p>验证是否正在显示 AZ-220 仪表板。</p>
  </li>
  <li>
    <p>在 <strong>rg-az220</strong> 资源组磁贴上，单击 <strong>“iot-az220-training-{your-id}”</strong></p>

    <p>首次打开“IoT 中心”边栏选项卡时，会显示 <strong>“概述”信息</strong>。可以看到此边栏选项卡的顶部区域提供了一些有关 IoT 中心服务的基本信息，例如数据中心位置和订阅。但此边栏选项卡也包含可提供如何使用中心和最近活动的相关信息的磁贴。在进一步探讨之前，我们先了解一下这些磁贴。</p>
  </li>
  <li>
    <p>请注意“IoT 中心”边栏选项卡左下角的 <strong>“IoT 中心使用情况”</strong> 磁贴。</p>

    <blockquote>
      <p><strong>备注：</strong> 磁贴位置基于浏览器窗口的宽度，因此布局可能与描述略有不同。</p>
    </blockquote>

    <p>此磁贴提供了与中心连接的内容和消息计数的快速概述。添加设备并开始发送消息时，此磁贴将提供出直观的“概览”信息。</p>
  </li>
  <li>
    <p>请注意 <strong>“IoT 中心使用情况”</strong> 磁贴右侧的 <strong>“使用的消息数”</strong> 磁贴和 <strong>“设备到云消息”</strong> 磁贴。</p>

    <p><strong>“设备到云消息”</strong> 磁贴提供了一段时间内来自设备的传入消息的快速概述。在下一模块中，你将注册设备并将消息发送到中心，因此你需要尽快开始查看这些磁贴上的信息。</p>

    <p><strong>“使用的消息数”</strong> 磁贴可帮助你跟踪使用的总消息数。</p>
  </li>
</ol>

<h4 id="任务-2使用左侧的菜单查看-iot-中心的功能">任务 2：使用左侧的菜单查看 IoT 中心的功能</h4>

<ol>
  <li>
    <p>在“IoT 中心”边栏选项卡中，花一点时间查看左侧的菜单选项。</p>

    <p>如你所料，这些菜单选项用于打开窗格，可通过这些窗格访问 IoT 中心的属性和功能。例如，可通过一些窗格访问已连接到中心的设备。</p>
  </li>
  <li>
    <p>在左侧菜单的 <strong>“资源管理器”</strong> 下，单击 <strong>“IoT 设备”</strong></p>

    <p>此窗格用于添加、修改和删除已注册到中心的设备。在本课程结束时，你将非常熟悉此窗格。</p>
  </li>
  <li>
    <p>在左侧菜单顶部附近，单击 <strong>“活动日志”</strong></p>

    <p>顾名思义，通过此窗格可以访问可用于查看活动和诊断问题的日志。还可以定义有助于执行日常任务的查询。非常方便。</p>
  </li>
  <li>
    <p>在左侧菜单的 <strong>“设置”</strong> 下，单击 <strong>“内置终结点”</strong></p>

    <p>IoT 中心公开了启用外部连接的“终结点”。实质上，终结点是连接到 IoT 中心或与 IoT 中心通信的构造。你会看到你的中心已定义了两个终结点：</p>

    <ul>
      <li><em>事件</em></li>
      <li><em>云到设备的消息传送</em></li>
    </ul>
  </li>
  <li>
    <p>在左侧菜单的 <strong>“消息传送”</strong> 下，单击 <strong>“消息路由”</strong></p>

    <p>使用 IoT 中心消息路由功能， 你可以将设备到云的传入消息路由到服务终结点，例如 Azure 存储容器、事件中心和服务总线队列。你还可以创建路由规则以执行基于查询的路由。</p>
  </li>
  <li>
    <p>在 <strong>“消息路由”</strong> 窗格顶部，单击 <strong>“自定义终结点”</strong>。</p>

    <p>自定义终结点（例如服务总线队列和存储）通常在 IoT 实现中使用。</p>
  </li>
  <li>
    <p>花一点时间查看 <strong>“设置”</strong> 下的菜单选项</p>

    <blockquote>
      <p><strong>备注：</strong> 本实验室练习仅用于介绍 IoT 中心服务并让你更加熟悉 UI，因此，如果你目前有点不知所措，请不要担心。随着本课程的继续进行，你将配置和管理 IoT 中心、设备和通信。</p>
    </blockquote>
  </li>
</ol>

<h3 id="练习-4使用-azure-门户创建设备预配服务">练习 4：使用 Azure 门户创建设备预配服务</h3>

<p>Azure IoT 中心设备预配服务是 IoT 中心的帮助程序服务，无需人工干预即可实现对适当 IoT 中心的零接触即时预配。设备预配服务提供以下内容：</p>

<ul>
  <li>零接触预配到单一 IoT 解决方案，无需在出厂（初始设置）时对 IoT 中心连接信息进行硬编码</li>
  <li>跨多个中心对设备进行负载均衡</li>
  <li>根据销售交易数据将设备连接到其所有者的 IoT 解决方案（多租户）</li>
  <li>根据用例将设备连接到特定的 IoT 解决方案（解决方案隔离）</li>
  <li>将设备连接到具有最低延迟的 IoT 中心（异地分片）</li>
  <li>根据设备中的更改重新进行预配</li>
  <li>滚动设备使用的密钥以连接到 IoT 中心（当不使用 X.509 证书进行连接时）</li>
</ul>

<p>你可以使用多种方法来创建 IoT 中心设备预配服务的实例。例如，你可以使用 Azure 门户，这是你将在任务中执行的操作。但是，你也可以使用 Azure CLI 或 Azure 资源管理器模板创建 DPS 实例。</p>

<h4 id="任务-1使用-azure-门户创建资源设备预配服务">任务 1：使用 Azure 门户创建资源（设备预配服务）</h4>

<ol>
  <li>
    <p>如有必要，使用 Azure 帐户凭据登录到 <a href="https://portal.azure.com">portal.azure.com</a>。</p>

    <p>如果有多个 Azure 帐户，请确保使用与本课程要使用的订阅绑定的帐户登录。</p>
  </li>
  <li>
    <p>在 Azure 门户菜单上，单击 <strong>“+ 创建资源”</strong>。</p>

    <p>如你所见， <strong>“新建”</strong> 边栏选项卡为你提供在 Azure 市场中搜索服务的功能。</p>
  </li>
  <li>
    <p>在“搜索”文本框中，键入 <strong>“设备预配服务”</strong>，然后按 Enter 键。</p>
  </li>
  <li>
    <p>在 <strong>“市场”</strong> 边栏选项卡中，单击 <strong>“IoT 中心设备预配服务”</strong> 搜索结果。</p>

    <blockquote>
      <p><strong>备注：</strong>
<strong>“创建”</strong> 操作显示在 <strong>“IoT 中心设备预配服务”</strong> 搜索结果底部 - 这将直接导航至 IoT 中心设备预配服务创建视图。在日常使用中，你可能选择单击此项 - 为实现本教程的目的，请单击 <strong>“IoT 中心设备预配服务”</strong> 搜索结果的正文中的任意位置。</p>
    </blockquote>
  </li>
  <li>
    <p>在 <strong>“IoT 中心设备预配服务”</strong> 边栏选项卡中，单击 <strong>“使用情况信息 + 支持”</strong>。</p>

    <p>请注意 <strong>“有用的链接”</strong> 下的资源链接列表。</p>

    <p>同样，现在无需研究此文档，知道它可用就可以了。“IoT 中心设备预配服务文档”页面是 DPS 的根页面。可以使用此页面浏览当前文档并找到可帮助你探索本课程范围之外的活动的教程和其他资源。在本课程中，你可以访问 docs.microsoft.com 站点，以获取有关特定主题的更多信息。</p>

    <p>如果你已打开其中一个链接，请立即将其关闭，并使用你的浏览器导航回“Azure 门户”选项卡。</p>
  </li>
</ol>

<h4 id="任务-2使用所需的属性设置创建设备预配服务">任务 2：使用所需的属性设置创建设备预配服务</h4>

<ol>
  <li>
    <p>单击 <strong>“创建”</strong>，开始创建新的 DPS 实例。</p>

    <p>接下来，你需要指定与中心和订阅有关的信息。以下步骤将引导你完成设置，并在你填充每个字段时逐一解释。</p>
  </li>
  <li>
    <p>在“<strong>订阅</strong>”下方，请确保已选择本课程所要使用的订阅。</p>
  </li>
  <li>
    <p>在“<strong>资源组</strong>”下，打开下拉列表，然后单击“<strong>rg-az220</strong>”</p>

    <p>你需要将为本课程创建的资源分组在同一个资源组中。最佳做法是通过此方式对相关资源进行分组，这将帮助你在不再需要资源时对其进行清理。</p>
  </li>
  <li>
    <p>在“<strong>名称</strong>”下，为你的 IoT 中心设备预配服务输入全局唯一名称，如下所示：</p>

    <p>要提供全局唯一名称，请输入“<strong>dps-az220-training-{your-id}</strong>”（记住要将 <strong>{your-id}</strong> 替换为你在练习 1 中创建的唯一 ID）。</p>

    <p>例如： <strong>dps-az220-training-cah191216</strong></p>
  </li>
  <li>
    <p>在“<strong>区域</strong>”下方，打开下拉列表并选择与为资源组选择的相同区域。</p>

    <blockquote>
      <p><strong>备注：</strong> 选取一个数据中心来托管资源时，请记住，选取靠近最终用户的数据中心会减少加载/响应时间。如果你与最终用户位于世界的两端，则不应选取离你最近的数据中心。</p>
    </blockquote>
  </li>
  <li>
    <p>在边栏选项卡底部，单击“<strong>查看 + 创建</strong>”。验证通过后，单击“<strong>创建</strong>”。</p>

    <p>部署可能需要一分钟或更长时间。你可以打开“Azure 门户通知”窗格来监视进度。</p>
  </li>
  <li>
    <p>请注意，几分钟后你会收到一条通知，指出 IoT 中心设备预配服务实例已成功部署到 <strong>rg-az220</strong> 资源组。</p>
  </li>
  <li>
    <p>在 Azure 门户菜单中，单击 <strong>“仪表板”</strong>，然后单击 <strong>“刷新”</strong>。</p>

    <p>你会看到“资源组”磁贴列出了新的 IoT 中心设备预配服务。</p>
  </li>
</ol>

<h4 id="任务-3链接-iot-中心和设备预配服务">任务 3：链接 IoT 中心和设备预配服务。</h4>

<ol>
  <li>
    <p>请注意，AZ-220 仪表板同时列出了 IoT 中心和 DPS 资源。</p>

    <p>你会看到同时列出了 IoT 中心和 DPS 资源 -（如果资源是最近创建的，可能需要单击 <strong>“刷新”</strong>）</p>
  </li>
  <li>
    <p>在 <strong>rg-az220</strong> 资源组磁贴上，单击 <strong>“dps-az220-training-{your-id}”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>“设备预配服务”</strong> 边栏选项卡的 <strong>“设置”</strong> 下，单击 <strong>“链接的 IoT 中心”</strong>。</p>
  </li>
  <li>
    <p>在边栏选项卡顶部，单击 <strong>“+ 添加”</strong>。</p>

    <p>将使用 <strong>“将链接添加到 IoT 中心”</strong> 边栏选项卡提供将设备预配服务实例链接到 IoT 中心所需的信息。</p>
  </li>
  <li>
    <p>在 <strong>“将链接添加到 IoT 中心”</strong> 边栏选项卡上，确保 <strong>“订阅”</strong> 下拉菜单显示的是将用于本课程的订阅。</p>

    <p>该订阅用于提供可用 IoT 中心的列表。</p>
  </li>
  <li>
    <p>打开 IoT 中心下拉菜单，然后单击 <strong>“iot-az220-training-{your-id}”</strong>。</p>

    <p>这是你在上一个练习中创建的 IoT 中心。</p>
  </li>
  <li>
    <p>在“访问策略”下拉列表中，单击 <strong>“iothubowner”</strong>。</p>

    <p><em>iothubowner</em> 凭据提供与指定的 IoT 中心建立链接所需的权限。</p>
  </li>
  <li>
    <p>若要完成配置，请单击 <strong>“保存”</strong>。</p>

    <p>现在你应看到“链接的 IoT 中心”窗格上列出了所选中心。可能需要单击 <strong>“刷新”</strong> 来显示已链接的 IoT 中心。</p>
  </li>
  <li>
    <p>在“Azure 门户中心”菜单上，单击 <strong>“仪表板”</strong>。</p>
  </li>
</ol>

<h3 id="练习-5了解设备预配服务">练习 5：了解设备预配服务</h3>

<p>IoT 中心设备预配服务是 IoT 中心的帮助程序服务，无需人为干预即可零接触实时预配至合适的 IoT 中心，使客户可以采用安全且可缩放的方式预配数百万台设备。</p>

<h4 id="任务-1浏览设备预配服务概述信息">任务 1：浏览设备预配服务概述信息</h4>

<ol>
  <li>
    <p>如有必要，使用 Azure 帐户凭据登录到 <a href="https://portal.azure.com">portal.azure.com</a>。</p>

    <p>如果有多个 Azure 帐户，请确保使用与本课程要使用的订阅绑定的帐户登录。</p>
  </li>
  <li>
    <p>验证是否正在显示 AZ-220 仪表板。</p>
  </li>
  <li>
    <p>在 <strong>rg-az220</strong> 资源组磁贴中，单击 <strong>“dps-az220-training-{your-id}”</strong></p>

    <p>首次打开设备预配服务实例时，它会显示概述信息。可以看到此边栏选项卡的顶部区域提供了一些有关 DPS 实例的基本信息，例如状态、数据中心位置和订阅。此边栏选项卡还提供了“快速链接”__部分，可访问：</p>

    <ul>
      <li><a href="https://docs.microsoft.com/zh-cn/azure/iot-dps/">Azure IoT 中心设备预配服务文档</a></li>
      <li><a href="https://docs.microsoft.com/zh-cn/azure/iot-dps/about-iot-dps">了解更多有关 IoT 中心设备预配服务的信息</a></li>
      <li><a href="https://docs.microsoft.com/zh-cn/azure/iot-dps/concepts-service">设备预配概念</a></li>
      <li><a href="https://azure.microsoft.com/zh-cn/pricing/details/iot-hub/">定价和缩放详细信息</a></li>
    </ul>

    <p>若时间允许，你可以返回并查看这些链接。</p>
  </li>
</ol>

<h4 id="任务-2使用导航菜单查看设备预配服务的功能">任务 2：使用导航菜单查看设备预配服务的功能</h4>

<ol>
  <li>
    <p>花一点时间查看左侧的菜单选项。</p>

    <p>如你所料，这些选项可打开窗格，通过这些窗格可访问 DPS 实例的活动日志、属性和功能。</p>
  </li>
  <li>
    <p>在左侧菜单顶部附近，单击 <strong>“活动日志”</strong></p>

    <p>顾名思义，通过此窗格可以访问可用于查看活动和诊断问题的日志。还可以定义有助于执行日常任务的查询。非常方便。</p>
  </li>
  <li>
    <p>在左侧菜单的 <strong>“设置”</strong> 下，单击 <strong>“快速入门”</strong>。</p>

    <p>此窗格列出了开始使用 IoT 中心设备预配服务的步骤、指向文档的链接以及用于配置 DPS 的其他边栏选项卡的快捷方式。</p>
  </li>
  <li>
    <p>在左侧菜单的 <strong>“设置”</strong> 下，单击 <strong>“共享访问策略”</strong>。</p>

    <p>此窗格提供访问策略的管理功能，并列出现有策略和关联权限。</p>
  </li>
  <li>
    <p>在左侧菜单的 <strong>“设置”</strong> 下，单击 <strong>“链接的 IoT 中心”</strong>。</p>

    <p>在此你可以看到之前链接的 IoT 中心。设备预配服务只能将设备预配到已链接到它的 IoT 中心。将 IoT 中心链接到设备预配服务实例可为 IoT 中心的设备注册表提供服务读取/写入权限；通过该链接，设备预配服务可以注册设备 ID 并在设备孪生中设置初始配置。链接的 IoT 中心可能位于任何 Azure 区域。可将其他订阅中的中心链接到预配服务。</p>
  </li>
  <li>
    <p>在左侧菜单的 <strong>“设置”</strong> 下，单击 <strong>“证书”</strong>。</p>

    <p>你可以在此管理 X.509 证书，该证书可通过 X.509 证书身份验证来保护 Azure IoT 中心。你将在之后的实验室中研究 X.509 证书。</p>
  </li>
  <li>
    <p>在左侧菜单 <strong>“设置”</strong> 下，单击 <strong>“管理注册”</strong>。</p>

    <p>你可以在此管理注册组和单个注册。</p>

    <p>注册组可用于共享所需初始配置的大量设备，或者全部转到同一租户的设备。注册组是一组共享特定证明机制的设备。注册组同时支持 X.509 和对称。X.509 注册组中的所有设备都提供已由同一根或中间证书颁发机构 (CA) 签名的 X.509 证书。对称密钥注册组中的每个设备都提供派生自组对称密钥的 SAS 令牌。注册组名称和证书名称必须是小写的字母数字，并可包含连字符。</p>

    <p>单个注册是用于可注册单一设备的条目。单个注册可使用 X.509 叶证书或 SAS 令牌（来自物理或虚拟 TPM）作为证明机制。单个注册中的注册 ID 是小写的字母数字，并且可包含连字符。单个注册可能会指定所需 IoT 中心设备 ID。</p>
  </li>
  <li>
    <p>花一点时间查看 <strong>“设置”</strong> 下的部分其他菜单选项</p>

    <blockquote>
      <p><strong>备注：</strong> 本实验室练习仅用于介绍 IoT 中心设备预配服务，让你更加熟悉 UI，因此，如果你目前感到有些茫然，请不要担心。之后的课程将更详细地介绍 DPS。</p>
    </blockquote>
  </li>
</ol>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-220ZH-Microsoft-Azure-IoT-Developer" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-220ZH-Microsoft-Azure-IoT-Developer
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D653337691cd169b6aa5719d4ea66f4e6a878a19c.js"></script>



</body></html>