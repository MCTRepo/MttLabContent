<!DOCTYPE html><html lang="en"><head>
        <title>
            AI-102ZH-Designing-and-Implementing-a-Microsoft-Azure-AI-Solution
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../">
                AI-102ZH-Designing-and-Implementing-a-Microsoft-Azure-AI-Solution
            </a>
            <a href="https://github.com/MicrosoftLearning/AI-102ZH-Designing-and-Implementing-a-Microsoft-Azure-AI-Solution" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#更新-bot-framework-emulator">更新 Bot Framework Emulator</a></li><li class="nav-item"><a class="nav-link" href="#克隆本课程的存储库">克隆本课程的存储库</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="使用-bot-framework-sdk-创建机器人">使用 Bot Framework SDK 创建机器人</h1>

<p><em>机器</em>人是一个软件代理，可参与人类用户的对话式对话。Microsoft Bot Framework 为构建可通过 Azure 机器人服务作为云服务交付的机器人提供了一个综合平台。</p>

<p>在本练习中，你将使用 Microsoft Bot Framework SDK 创建和部署机器人。</p>

<h2 id="准备工作">准备工作</h2>

<p>首先，为机器人开发准备环境。</p>

<h3 id="更新-bot-framework-emulator">更新 Bot Framework Emulator</h3>

<p>你将使用 Bot Framework SDK 来创建机器人，并使用 Bot Framework Emulator 对其进行测试。Bot Framework Emulator 会定期更新，因此请确保已安装最新版本。</p>

<blockquote>
  <p><strong>备注</strong>：更新可能包括更改用户界面，这可能会影响此练习中的说明。</p>
</blockquote>

<ol>
  <li>启动 <strong>Bot Framework Emulator</strong>，如果系统提示你安装更新，请为当前登录的用户完成该操作。如果系统没有自动发出提示，请使用 <strong>“帮助”</strong> 菜单上的 <strong>“检查更新”</strong> 选项来检查更新。</li>
  <li>安装任意可用更新后，关闭 Bot Framework Emulator，直到下次需要它时再打开。</li>
</ol>

<h3 id="克隆本课程的存储库">克隆本课程的存储库</h3>

<p>如果尚未将 <strong>AI-102-AIEngineer</strong> 代码存储库克隆到你要在此实验室中使用的环境，请按照以下步骤克隆它。否则，请在 Visual Studio Code 中打开克隆的文件夹。</p>

<ol>
  <li>启动 Visual Studio Code。</li>
  <li>打开面板 (Shift+Ctrl+P) 并运行 <strong>Git: Clone</strong> 命令，将 <code>https://github.com/MicrosoftLearning/AI-102ZH-Designing-and-Implementing-a-Microsoft-Azure-AI-Solution</code> 存储库克隆到本地文件夹（具体克隆到哪个文件夹无关紧要）。</li>
  <li>克隆存储库后，在 Visual Studio Code 中打开文件夹。</li>
  <li>
    <p>等待其他文件安装完毕，以支持存储库中的 C# 代码项目。</p>

    <blockquote>
      <p><strong>备注</strong>：如果系统提示你添加生成和调试所需的资产，请选择 <strong>“以后再说”</strong>。</p>
    </blockquote>
  </li>
</ol>

<h2 id="创建机器人">创建机器人</h2>

<p>你可以使用 Bot Framework SDK 基于模板创建机器人，然后自定义代码以满足你的特定要求。</p>

<blockquote>
  <p><strong>备注</strong>：在此练习中，可以选择使用 <strong>C#</strong> 或 <strong>Python</strong>。在下面的步骤中，请执行适用于你的语言首选项的操作。</p>
</blockquote>

<ol>
  <li>在 Visual Studio Code 的 <strong>“资源管理器”</strong> 窗格中，浏览到 <strong>13-bot-framework</strong> 文件夹，并根据你的语言首选项展开 <strong>C-Sharp</strong> 文件夹或 <strong>Python</strong> 文件夹。</li>
  <li>右键单击所选语言的文件夹，并打开集成终端。</li>
  <li>在终端中，运行以下命令以安装所需的机器人模板和包：</li>
</ol>

<p><strong>C#</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="language-C# hljs">dotnet <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> -i Microsoft.Bot.Framework.CSharp.EchoBot
dotnet <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> -i Microsoft.Bot.Framework.CSharp.CoreBot
dotnet <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> -i Microsoft.Bot.Framework.CSharp.EmptyBot
</code></pre>

<p><strong>Python</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="language-Python hljs">pip install botbuilder-core
pip install asyncio
pip install aiohttp
pip install cookiecutter==<span class="hljs-number"><span class="hljs-number">1.7</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>
</code></pre>

<ol>
  <li>安装模板和包后，运行以下命令以基于 <em>EchoBot</em> 模板创建机器人：</li>
</ol>

<p><strong>C#</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="language-C# hljs">dotnet <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> echobot -n TimeBot
</code></pre>

<p><strong>Python</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="language-Python hljs">cookiecutter https://github.com/microsoft/botbuilder-python/releases/download/Templates/echo.zip
</code></pre>

<p>如果使用的是 Python，则在 cookiecutter 提示时，输入以下详细信息：</p>
<ul>
  <li><strong>bot_name</strong>：TimeBot</li>
  <li><strong>bot_description</strong>：时间机器人</li>
</ul>

<ol>
  <li>
    <p>在终端窗格中，输入以下命令以将当前目录更改为 <strong>TimeBot</strong> 文件夹，其中列出了已为机器人生成的代码文件：</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="language-Code"> cd TimeBot
 dir
</code></pre>
  </li>
</ol>

<h2 id="在-bot-framework-emulator-中测试机器人">在 Bot Framework Emulator 中测试机器人</h2>

<p>你已经基于 <em>EchoBot</em> 模板创建了一个机器人。现在，可以在本地运行该机器人，并使用 Bot Framework Emulator（应将其安装在系统上）对其进行测试。</p>

<ol>
  <li>在终端窗格中，确保当前目录是包含机器人代码文件的 <strong>TimeBot</strong> 文件夹，然后输入以下命令以启动在本地运行的机器人。</li>
</ol>

<p><strong>C#</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="language-C# hljs">dotnet run
</code></pre>

<p><strong>Python</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="language-Python hljs">python app.py
</code></pre>

<p>机器人启动时，请注意将显示正在运行该机器人的终结点。该终结点类似于 <strong>http://localhost:3978</strong></p>

<ol>
  <li>
    <p>启动 Bot Framework Emulator，然后通过指定附加了 <strong>/api/messages</strong> 路径的终结点来打开机器人，如下所示：</p>

    <p><code>http://localhost:3978/api/messages</code></p>
  </li>
  <li>在 <strong>“实时聊天”</strong> 窗格中打开对话后，等待出现消息 <em>“欢迎使用！”</em>。</li>
  <li>输入 <em>“你好”</em> 等消息，并查看机器人的响应，该响应应回显你输入的消息。</li>
  <li>关闭 Bot Framework Emulator，并返回到 Visual Studio Code，然后在终端窗口中，按 <strong>Ctrl+C</strong> 停止机器人。</li>
</ol>

<h2 id="修改机器人代码">修改机器人代码</h2>

<p>你已经创建了一个机器人，该机器人将用户的输入回显给他们。这并不是特别有用，但可以用来说明对话式对话的基本流程。与机器人的对话包括一系列活动，其中文本、图形或用户界面卡用于交换信息。机器人以问候语开始对话，这是用户初始化与机器人的聊天会话时触发的对话更新活动的结果。然后，对话包含一系列进一步的活动，在对话中，用户和机器人进行多回合对话以发送消息。</p>

<ol>
  <li>在 Visual Studio Code 中，为机器人打开以下代码文件：
    <ul>
      <li><strong>C#</strong>：TimeBot/Bots/EchoBot.cs</li>
      <li><strong>Python</strong>：TimeBot/bot.py</li>
    </ul>

    <p>请注意，此文件中的代码包含活动处理程序函数，一个用于 <strong>“已添加成员”</strong> 对话更新活动（当某人加入聊天会话时），另一个用于 <em>“消息”</em> 活动（当收到消息时）。对话基于 <em>“回合”</em> 的概念，其中每个回合代表机器人在对话中接收、处理和响应活动的交互。<em>“回合上下文”</em> 用于跟踪有关当前回合中正在处理的活动的信息。</p>
  </li>
  <li>在代码文件的顶部，添加以下命名空间导入语句：</li>
</ol>

<p><strong>C#</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="language-C# hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System;
</code></pre>

<p><strong>Python</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock8" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock8" class="mt-0"><code class="language-Python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime
</code></pre>

<ol>
  <li>修改消息活动的活动处理程序函数以匹配以下代码：</li>
</ol>

<p><strong>C#</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock9" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock9" class="mt-0"><code class="language-C# hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> override async Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnMessageActivityAsync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ITurnContext&lt;IMessageActivity&gt; turnContext, CancellationToken cancellationToken)</span></span></span><span class="hljs-function">
</span></span>{
    <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> inputMessage = turnContext.Activity.Text;
    <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> responseMessage = <span class="hljs-string"><span class="hljs-string">"Ask me what the time is."</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputMessage.ToLower().StartsWith(<span class="hljs-string"><span class="hljs-string">"what"</span></span>) &amp;&amp; inputMessage.ToLower().Contains(<span class="hljs-string"><span class="hljs-string">"time"</span></span>))
    {
        var now = DateTime.Now;
        responseMessage = <span class="hljs-string"><span class="hljs-string">"The time is "</span></span> + now.Hour.ToString() + <span class="hljs-string"><span class="hljs-string">":"</span></span> + now.Minute.ToString(<span class="hljs-string"><span class="hljs-string">"D2"</span></span>);
    }
    await turnContext.SendActivityAsync(MessageFactory.Text(responseMessage, responseMessage), cancellationToken);
}
</code></pre>

<p><strong>Python</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock10" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock10" class="mt-0"><code class="language-Python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_message_activity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, turn_context: TurnContext)</span></span></span><span class="hljs-function">:</span></span>
    input_message = turn_context.activity.text
    response_message = <span class="hljs-string"><span class="hljs-string">'Ask me what the time is.'</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (input_message.lower().startswith(<span class="hljs-string"><span class="hljs-string">'what'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-string"><span class="hljs-string">'time'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> input_message.lower()):
        now = datetime.now()
        response_message = <span class="hljs-string"><span class="hljs-string">'The time is {}:{:02d}.'</span></span>.format(now.hour,now.minute)
    <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> turn_context.send_activity(response_message)
</code></pre>

<ol>
  <li>保存所做的更改，然后在终端窗格中，确保当前目录是包含机器人代码文件的 <strong>TimeBot</strong> 文件夹，然后输入以下命令以启动在本地运行的机器人。</li>
</ol>

<p><strong>C#</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock11" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock11" class="mt-0"><code class="language-C# hljs">dotnet run
</code></pre>

<p><strong>Python</strong></p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock12" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock12" class="mt-0"><code class="language-Python hljs">python app.py
</code></pre>

<p>同样，当机器人启动时，请注意将显示正在运行该机器人的终结点。</p>

<ol>
  <li>
    <p>启动 Bot Framework Emulator，然后通过指定附加了 <strong>/api/messages</strong> 路径的终结点来打开机器人，如下所示：</p>

    <p><code>http://localhost:3978/api/messages</code></p>
  </li>
  <li>在 <strong>“实时聊天”</strong> 窗格中打开对话后，等待出现消息 <em>“欢迎使用！”</em>。</li>
  <li>输入 <em>“你好”</em> 等消息，并查看机器人的响应，该响应应为 <em>“问我几点了”</em>。</li>
  <li>
    <p>输入 <em>“几点了？”</em> 并查看响应。</p>

    <p>机器人现在通过显示机器人运行的本地时间来响应查询“几点了？”。对于任何其他查询，机器人会提示用户询问它几点了。这是一个非常有限的机器人，可以通过与语言理解服务和其他自定义代码集成来进行改进，但是它可以作为一个工作示例，说明如何通过扩展从模板创建的机器人来使用 Bot Framework SDK 构建解决方案。</p>
  </li>
  <li>关闭 Bot Framework Emulator，并返回到 Visual Studio Code，然后在终端窗口中，按 <strong>Ctrl+C</strong> 停止机器人。</li>
</ol>

<h2 id="更多信息">更多信息</h2>

<p>要了解有关 Bot Framework 的详细信息，请参阅 <a href="https://docs.microsoft.com/azure/bot-service/index-bf-sdk">Bot Framework 文档</a>。</p>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AI-102ZH-Designing-and-Implementing-a-Microsoft-Azure-AI-Solution" target="_blank" class="ml-2">
                    MicrosoftLearning/AI-102ZH-Designing-and-Implementing-a-Microsoft-Azure-AI-Solution
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../assets/js/script_v%3D.js"></script>



</body></html>