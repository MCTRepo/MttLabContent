<!DOCTYPE html><html lang="en"><head>
        <title>
            PL-400_Microsoft-Power-Platform-Developer
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D964044cdd8d04bfc4633129f4b07c6ada955ec8f.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                PL-400_Microsoft-Power-Platform-Developer
            </a>
            <a href="https://github.com/MicrosoftLearning/PL-400_Microsoft-Power-Platform-Developer" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    </ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <blockquote>
  <p>[!NOTE]
Effective November 2020:</p>
  <ul>
    <li>Common Data Service has been renamed to Microsoft Dataverse. <a href="https://aka.ms/PAuAppBlog">Learn more</a></li>
    <li>Some terminology in Microsoft Dataverse has been updated. For example, <em>entity</em> is now <em>table</em> and <em>Column</em> is now <em>column</em>. <a href="https://go.microsoft.com/fwlink/?linkid=2147247">Learn more</a></li>
  </ul>

  <p>This content will be updated soon to reflect the latest terminology.</p>
</blockquote>

<h2 id="lab-04--client-scripting">Lab 04 – Client Scripting</h2>

<h1 id="scenario">Scenario</h1>

<p>A regional building department issues and tracks permits for new buildings and updates for remodeling of existing buildings. Throughout this course, you will build applications and automation to enable the regional building department to manage the permitting process. This will be an end-to-end solution which will help you understand the overall process flow.</p>

<p>In this lab, you will implement client-side logic that will use the web API to evaluate the permit type associated with the permit record and use the client scripting API to manipulate the form controls.</p>

<p>You will also customize the command bar to introduce a new lock permit button that will invoke a custom action to perform the lock permit logic. The server-side logic for the lock permit custom action will be implemented later in the course. Right now, you will just add the button and the logic to invoke the action.</p>

<h2 id="high-level-lab-steps">High-level lab steps</h2>

<p>As part of building the client-side logic, you will complete the following:</p>

<ul>
  <li>
    <p>Setup a folder to contain your client script</p>
  </li>
  <li>
    <p>Upload and register the client script on the form</p>
  </li>
  <li>
    <p>Build logic to use the web API to retrieve the permit type record associated with the permit</p>
  </li>
  <li>
    <p>Build logic based on the permit type settings to hide and show the inspections tab on the form</p>
  </li>
  <li>
    <p>Build logic to set Columns as required/not required based on the permit type settings</p>
  </li>
  <li>
    <p>Use a community tool, Ribbon Workbench, to modify the command bar</p>
  </li>
  <li>
    <p>Build logic to invoke the lock permit custom action when the command bar button is clicked</p>
  </li>
</ul>

<h2 id="things-to-consider-before-you-begin">Things to consider before you begin</h2>

<ul>
  <li>
    <p>Are there alternative designs that would be viable and not require code?</p>
  </li>
  <li>
    <p>Remember to continue working in your DEVELOPMENT environment. We will move everything to production soon.</p>
  </li>
</ul>

<p>‎</p>

<h1 id="exercise-1-prepare-and-load-resources">Exercise #1: Prepare and Load Resources</h1>

<p><strong>Objective:</strong> In this exercise, you will create, organize, and load your JavaScript web resources.</p>

<h2 id="task-1-use-visual-studio-code-to-create-resources">Task #1: Use Visual Studio Code to Create Resources</h2>

<p>In this task, you will set up a folder to contain the JavaScript web resource files in this course.</p>

<ol>
  <li>
    <p>If you do not already have Visual Studio Code, download it from here <a href="https://code.visualstudio.com/docs/?dv=win">Visual Studio Code</a> and install it.</p>
  </li>
  <li>
    <p>Start <strong>Visual Studio Code</strong>.</p>
  </li>
  <li>
    <p>Create resources</p>

    <ul>
      <li>Select Explorer from left menu or press Ctrl + Shift + E.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-01.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-01.png" alt="Select Explorer - screenshot"></a></p>

    <ul>
      <li>
        <p>Click <strong>Open Folder</strong>.</p>
      </li>
      <li>
        <p>Create a new folder and name it <strong>ContosoClientScripts</strong>. <br>
‎<strong>Note:</strong> This is the name and structure used for this lab, the platform does not require a specific structure or content organization. Many projects check these assets into a source control system to keep track of all the changes over the life of the client script.</p>
      </li>
      <li>
        <p>Select the new folder you just created and click <strong>Select Folder</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-02.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-02.png" alt="Select folder - screenshot"></a></p>
  </li>
  <li>
    <p>Create <strong>Form Scripts</strong> folder</p>

    <ul>
      <li>Hover over the folder and click <strong>New Folder</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-03.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-03.png" alt="New folder - screenshot"></a></p>

    <ul>
      <li>Name the new folder as <strong>FormScripts</strong> and click <strong>Enter</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-04.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-04.png" alt="Form scripts folder - screenshot"></a></p>
  </li>
  <li>
    <p>Create the <strong>Permit Form Functions</strong> file</p>

    <ul>
      <li>Right click on the <strong>FormScripts</strong> folder and select <strong>New File</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-05.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-05.png" alt="New file - screenshot"></a></p>

    <ul>
      <li>Name the new file as <strong>PermitFormFuntions.js</strong> and click <strong>Enter</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-06.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-06.png" alt="permit form functions JavaScript file - screenshot"></a></p>

    <ul>
      <li>
        <p>Add the below mentioned namespaces to the newly created <strong>PermitFormFunctions</strong> file.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="hljs cs">  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (ContosoPermit) == <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>)
  {<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ContosoPermit = {__namespace: <span class="hljs-literal"><span class="hljs-literal">true</span></span>};}
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (ContosoPermit.Scripts) == <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>)
  {ContosoPermit.Scripts = {__namespace: <span class="hljs-literal"><span class="hljs-literal">true</span></span>};}
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-07.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-07.png" alt="Namespaces - screenshot"></a></p>

    <ul>
      <li>
        <p>Add the function mentioned below after adding the namespaces.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="hljs bash">  ContosoPermit.Scripts.PermitForm = {
  __namespace: <span class="hljs-literal"><span class="hljs-literal">true</span></span>
  }
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-08.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-08.png" alt="Add function - screenshot"></a><br>
‎</p>
  </li>
</ol>

<h2 id="task-2-add-event-handlers">Task #2: Add Event Handlers</h2>

<p>In this task, you will create functions for the logic that you will be implementing. This will allow you to register the event handlers in the next tasks for calling these functions and performing few basic tests in the upcoming tasks.</p>

<ol>
  <li>
    <p>Add a function to OnLoad event</p>

    <ul>
      <li>
        <p>Add the function mentioned below to the <strong>PermitFormFuntions</strong> file inside the function created in Step 1(d).</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="hljs javascript">  handleOnLoad: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">executionContext</span></span></span><span class="hljs-function">) </span></span>{
  <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'on load - permit form'</span></span>);
  },
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-09.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-09.png" alt="handle on load event - screenshot"></a></p>
  </li>
  <li>
    <p>Add a function to OnChange permit type event</p>

    <ul>
      <li>
        <p>Add the function mentioned below to the <strong>PermitFormFuntions</strong> file inside the function created in Step 1(d). Once this is done, click <strong>File</strong> and <strong>Save All</strong>.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="hljs javascript">  handleOnChangePermitType: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">executionContext</span></span></span><span class="hljs-function">) </span></span>{

  <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'on change - permit type'</span></span>);

  },
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-10.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-10.png" alt="Handle on change permit type - screenshot"></a></p>
  </li>
</ol>

<h2 id="task-3-load-web-resources">Task #3: Load Web Resources</h2>

<p>In this task, you will upload the JavaScript files as web resources. Here, you will also edit the Permit Table main form and associate the new web resource with its form. Finally, you will register your functions to be called on specific form events.</p>

<ol>
  <li>
    <p>Open the Permit Management solution</p>

    <ul>
      <li>
        <p>Sign in to <a href="https://make.powerapps.com/">Power Apps maker portal</a>.</p>
      </li>
      <li>
        <p>Select your <strong>Dev</strong> environment.</p>
      </li>
      <li>
        <p>Select <strong>Solutions</strong>.</p>
      </li>
      <li>
        <p>Click to open the <strong>Permit Management</strong> solution.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-11.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-11.png" alt="Open solution - screenshot"></a></p>
  </li>
  <li>
    <p>Add web resource to the solution</p>

    <ul>
      <li>
        <p>Click <strong>+ New</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Other</strong> and select <strong>Web Resources</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-12.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-12.png" alt="Add web resource - screenshot"></a></p>

    <ul>
      <li>
        <p>Enter <strong>PermitFormScripts.js</strong> for <strong>Name</strong>.</p>
      </li>
      <li>
        <p>Enter <strong>Permit Form Scripts</strong> for <strong>Display Name</strong>.</p>
      </li>
      <li>
        <p>Select <strong>Script (Jscript)</strong> for <strong>Type</strong>.</p>
      </li>
      <li>
        <p>Select <strong>English</strong> for <strong>Language</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Browse</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-13.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-13.png" alt="New web resource form - screenshot"></a></p>

    <ul>
      <li>Select the <strong>PermitFormFunctions.js</strong> file and click <strong>Open</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-14.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-14.png" alt="Select file - screenshot"></a></p>

    <ul>
      <li>
        <p>Click <strong>Save</strong> and wait until the changes are saved.</p>
      </li>
      <li>
        <p>Click <strong>Publish</strong> and wait for the publishing to complete.</p>
      </li>
      <li>
        <p>Close the web resource editor Window.</p>
      </li>
      <li>
        <p>Click <strong>Done</strong>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Open the Permit main form.</p>

    <ul>
      <li>
        <p>Make sure you are still in the solution.</p>
      </li>
      <li>
        <p>Click to open the <strong>Permit</strong> Table.</p>
      </li>
      <li>
        <p>Select the <strong>Forms</strong> tab and click to open the <strong>Main</strong> form.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Switch to Classic. <br>
‎<strong>Note</strong>: Currently, you must switch to the classic solution explorer to complete the hookup of the client script to the form. In the future, this will be moved to make.powerapps.com and will not require switching to the classic tools.</p>

    <ul>
      <li>Click on the <strong>Switch to Classic</strong>. This will open the classic UI in a new browser window.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-15.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-15.png" alt="Switch to classic - screenshot"></a></p>
  </li>
  <li>
    <p>Add the script to the permit form</p>

    <ul>
      <li>Click <strong>Form Properties</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-16.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-16.png" alt="Form properties - screenshot"></a></p>

    <ul>
      <li>Click <strong>Add Library</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-17.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-17.png" alt="Add library - screenshot"></a></p>

    <ul>
      <li>Search for <strong>contoso</strong>, select <strong>PermitFormScripts</strong> entry with Display Name as <strong>PermitFormScripts</strong> and click <strong>Add</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-18.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-18.png" alt="Add script file - screenshot"></a></p>
  </li>
  <li>
    <p>Add OnLoad event handler.</p>

    <ul>
      <li>
        <p>Go to the <strong>Event Handlers</strong> section.</p>
      </li>
      <li>
        <p>Select <strong>Form</strong> from <strong>Control Dropdown</strong>.</p>
      </li>
      <li>
        <p>Select <strong>OnLoad</strong> from <strong>Event Dropdown</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Add</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-19.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-19.png" alt="Add event - screenshot"></a></p>

    <ul>
      <li>
        <p>Select <strong>Contoso_</strong><strong>PermitFormScripts.js</strong> in the dropdown for <strong>Library</strong>.</p>
      </li>
      <li>
        <p>Enter <strong>ContosoPermit.Scripts.PermitForm.handleOnLoad</strong> in the textbox for <strong>Function</strong>.</p>
      </li>
      <li>
        <p>Check the <strong>Pass Execution</strong> <strong>Context</strong> checkbox.</p>
      </li>
      <li>
        <p>Click <strong>OK</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-20.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-20.png" alt="Event details - screenshot"></a></p>
  </li>
  <li>
    <p>Add Permit Type OnChange event handler.</p>

    <ul>
      <li>
        <p>Go to the <strong>Event Handlers</strong> section.</p>
      </li>
      <li>
        <p>Select <strong>Permit Type</strong> from the dropdown for <strong>Control</strong>.</p>
      </li>
      <li>
        <p>Select <strong>OnChange</strong> from the dropdown for <strong>Event</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Add</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-21.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-21.png" alt="Add event - screenshot"></a></p>

    <ul>
      <li>
        <p>Select <strong>Contoso_</strong><strong>PermitFormScripts</strong><strong>.js</strong> for <strong>Library</strong>.</p>
      </li>
      <li>
        <p>Enter <strong>ContosoPermit.Scripts.PermitForm.handleOnChangePermitType</strong> in the textbox for <strong>Function</strong>.</p>
      </li>
      <li>
        <p>Check the <strong>Pass Execution</strong> <strong>Context</strong> checkbox.</p>
      </li>
      <li>
        <p>Click <strong>OK</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-22.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-22.png" alt="Event details - screenshot"></a></p>
  </li>
  <li>
    <p>Save and publish your changes</p>

    <ul>
      <li>
        <p>Click <strong>OK</strong> to close the <strong>Form Properties</strong> window.</p>
      </li>
      <li>
        <p>Click <strong>Save and Close</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-23.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-23.png" alt="Save and close - screenshot"></a></p>

    <ul>
      <li>Click on the <strong>&lt;- Back</strong> button.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-24.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-24.png" alt="Back to Table - screenshot"></a></p>

    <ul>
      <li>Go back to the solution by clicking on the solution name.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-25.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-25.png" alt="Back to the solution - screenshot"></a></p>

    <ul>
      <li>Click <strong>Publish All Customizations</strong> and wait for the publishing to complete.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-26.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-26.png" alt="Publish all customizations - screenshot"></a></p>
  </li>
</ol>

<p><strong>DO NOT</strong> navigate away from this page</p>

<h2 id="task-4-test-event-handlers">Task #4: Test Event Handlers</h2>

<p>In this task, you will be doing a test to ensure that you have correctly hooked up your functions to the permit form events.</p>

<ol>
  <li>
    <p>Start the Permit Management application</p>

    <ul>
      <li>
        <p>Select <strong>Apps</strong>.</p>
      </li>
      <li>
        <p>Click to start the <strong>Permit Management</strong> application and this will open the app in New Window.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-27.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-27.png" alt="Start application - screenshot"></a></p>
  </li>
  <li>
    <p>Open a Permit record</p>

    <ul>
      <li>
        <p>Select <strong>Permits</strong> from the Site Map.</p>
      </li>
      <li>
        <p>Click to open a permit record.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-28.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-28.png" alt="Open record - screenshot"></a></p>
  </li>
  <li>
    <p>Open Edge Dev Tools</p>

    <ul>
      <li>
        <p>Press <strong>F12</strong> or right click and select <strong>Inspect</strong>.</p>
      </li>
      <li>
        <p>Select the <strong>Console</strong> from top menu and clear console.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-29.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-29.png" alt="Clear console - screenshot"></a></p>
  </li>
  <li>
    <p>Refresh and confirm the OnLoad event handler function runs</p>

    <ul>
      <li>Go to the <strong>Permit</strong> record and click <strong>Refresh</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-30.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-30.png" alt="Refresh form - screenshot"></a></p>

    <ul>
      <li>Go to the <strong>Dev Tools</strong> and you should now be able to see the <strong>on load – permit form</strong> message.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-31.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-31.png" alt="On load event message - screenshot"></a></p>
  </li>
  <li>
    <p>Remove Permit Type and confirm the OnChange Permit Type event handler function runs</p>

    <ul>
      <li>Go to the <strong>Permit</strong> record and remove the <strong>Permit Type</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-32.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-32.png" alt="Remove permit type - screenshot"></a></p>

    <ul>
      <li>Go to the <strong>Dev Tools</strong> and you should now be able to see the <strong>on change – permit type</strong> message.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-33.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-33.png" alt="On change permit message - screenshot"></a></p>

    <ul>
      <li>Close the <strong>Dev Tools</strong>.</li>
    </ul>
  </li>
</ol>

<p>‎</p>

<h1 id="exercise-2-show-and-hide-tabs">Exercise #2: Show and Hide Tabs</h1>

<p><strong>Objective:</strong> In this exercise, you will create a script that will show and hide the inspections tab based on the permit type Table’s “required inspections” Column value.</p>

<h2 id="task-1-create-function">Task #1: Create Function</h2>

<ol>
  <li>
    <p>Create a function that will run when the Permit form loads and when the Permit Type value changes</p>

    <ul>
      <li>
        <p>Go back to <strong>Visual Studio Code</strong>.</p>
      </li>
      <li>
        <p>Add the function mentioned below to <strong>PermitFormFuntions</strong> inside the PermitForm function.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="hljs javascript">  _handlePermitTypeSettings: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">executionContext</span></span></span><span class="hljs-function">) </span></span>{

  },
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-34.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-34.png" alt="handle permit type settings function - screenshot"></a></p>
  </li>
  <li>
    <p>Get form context from the execution context</p>

    <ul>
      <li>
        <p>Add the script mentioned below inside _<strong>handlePermitTypeSettings</strong> function.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="hljs cs">  <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formContext = executionContext.getFormContext(); 
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>Get the Permit Type value from the form.</p>

    <ul>
      <li>
        <p>Add the script mentioned below inside the _<strong>handlePermitTypeSettings</strong> function. contoso_permittype is the logical name of the Permit Type Column. You can verify this in the Table metadata.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="hljs cs">  <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> permitType = formContext.getAttribute(<span class="hljs-string"><span class="hljs-string">"contoso_permittype"</span></span>).getValue();
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>Check if the Permit Type has value.</p>

    <ul>
      <li>
        <p>Add the script mentioned below inside the _<strong>handlePermitTypeSettings</strong> function.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="hljs coffeescript">  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (permitType == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) {

  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {
        
  }
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-35.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-35.png" alt="Handle permit type settings function - screenshot"></a></p>
  </li>
  <li>
    <p>Hide the Inspections tab and return if Permit type is null.</p>

    <ul>
      <li>
        <p>Add the script mentioned below inside the _<strong>handlePermitTypeSettings</strong> function. inspectionsTab is the name of the Inspections tab (This is configured while configuration of the Model Driven App in Lab1 Module 2).</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock8" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock8" class="mt-0"><code class="hljs cs">  formContext.ui.tabs.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">"inspectionsTab"</span></span>).setVisible(<span class="hljs-literal"><span class="hljs-literal">false</span></span>);
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-36.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-36.png" alt="Handle permit type settings function progress - screenshot"></a></p>
  </li>
</ol>

<h2 id="task-2-get-inspection-type-record">Task #2: Get Inspection Type Record</h2>

<p>In this task, you will use the web API to retrieve the permit type lookup record associated with the current permit record that is currently displayed in the form.</p>

<ol>
  <li>
    <p>Get the Permit Type ID</p>

    <ul>
      <li>
        <p>Add the script mentioned below in the else statement of the _<strong>handlePermitTypeSettings</strong> function.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock9" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock9" class="mt-0"><code class="hljs cs">  <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> permitTypeID = permitType[<span class="hljs-number"><span class="hljs-number">0</span></span>].id;
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>Retrieve the Permit Type record and show alert if there are errors</p>

    <ul>
      <li>
        <p>Add the script mentioned below in the else statement of the _<strong>handlePermitTypeSettings</strong> function. contoso_pertmittype is the logical name of the Permit Type Table.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock10" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock10" class="mt-0"><code class="hljs javascript">  Xrm.WebApi.retrieveRecord(<span class="hljs-string"><span class="hljs-string">"contoso_permittype"</span></span>, permitTypeID).then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) </span></span>{
  },

  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">'Error:'</span></span> + error.message) });
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-37.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-37.png" alt="Handle permit type settings function progress - screenshot"></a></p>
  </li>
  <li>
    <p>Check if “<strong>Require Inspections</strong>” Column value is true</p>

    <ul>
      <li>
        <p>Add the script mentioned below in the <strong>retrieveRecord</strong> function call. contoso_requireinspections is the logical name of the Require Inspections Column of the Permit Type Table.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock11" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock11" class="mt-0"><code class="hljs css">  <span class="hljs-selector-tag"><span class="hljs-selector-tag">if</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">result</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.contoso_requireinspections</span></span>) {

  } <span class="hljs-selector-tag"><span class="hljs-selector-tag">else</span></span> {

  }
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>Make the Inspections tab visible if Require Inspections is true</p>

    <ul>
      <li>
        <p>Add the script mentioned below in the if statement of the <strong>retrieveRecord</strong> call.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock12" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock12" class="mt-0"><code class="hljs css">  <span class="hljs-selector-tag"><span class="hljs-selector-tag">formContext</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ui</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.tabs</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.get</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">inspectionsTab</span></span>")<span class="hljs-selector-class"><span class="hljs-selector-class">.setVisible</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">true</span></span>);
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>Hide the Inspections tab if Require Inspections is not true</p>

    <ul>
      <li>
        <p>Add the script mentioned below in the else statement of the <strong>retrieveRecord</strong> call.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock13" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock13" class="mt-0"><code class="hljs css">  <span class="hljs-selector-tag"><span class="hljs-selector-tag">formContext</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ui</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.tabs</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.get</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">inspectionsTab</span></span>")<span class="hljs-selector-class"><span class="hljs-selector-class">.setVisible</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">false</span></span>);
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-38.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-38.png" alt="Handle permit type settings function progress - screenshot"></a></p>
  </li>
  <li>
    <p>Call the _handlePermitTypeSettings function from the handleOnLoad function.</p>

    <ul>
      <li>
        <p>Go to the <strong>handleOnLoad</strong> function and add the script mentioned below.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock14" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock14" class="mt-0"><code class="hljs css">  <span class="hljs-selector-tag"><span class="hljs-selector-tag">ContosoPermit</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Scripts</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.PermitForm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">._handlePermitTypeSettings</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">executionContext</span></span>);
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>Call the _handlePermitTypeSettings function from the handleOnChangePermitType function.</p>

    <ul>
      <li>
        <p>Go to the <strong>handleOnChangePertmitType</strong> function and add the script mentioned below.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock15" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock15" class="mt-0"><code class="hljs css">  <span class="hljs-selector-tag"><span class="hljs-selector-tag">ContosoPermit</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Scripts</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.PermitForm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">._handlePermitTypeSettings</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">executionContext</span></span>);
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-39.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-39.png" alt="handle on load and handle in change functions - screenshot"></a></p>
  </li>
</ol>

<p>Click File and <strong>Save All</strong>.</p>

<h2 id="task-3-load-updated-script">Task #3: Load Updated Script</h2>

<ol>
  <li>
    <p>Open the Permit Form Script web resource.</p>

    <ul>
      <li>
        <p>Navigate to <a href="https://make.powerapps.com/">Power Apps maker portal</a>.</p>
      </li>
      <li>
        <p>Select your <strong>Dev</strong> environment.</p>
      </li>
      <li>
        <p>Select <strong>Solutions</strong>.</p>
      </li>
      <li>
        <p>Click to open the <strong>Permit Management</strong> solution.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-40.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-40.png" alt="Open solution - screenshot"></a></p>

    <ul>
      <li>Locate and click to open the <strong>Permit Form Script</strong> web resource.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-41.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-41.png" alt="Open web resource - screenshot"></a></p>
  </li>
  <li>
    <p>Load the updated version of permitFormFuntion.jsPermitFormFuntion.js</p>

    <ul>
      <li>Click <strong>Choose file</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-42.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-42.png" alt="Choose file - screenshot"></a></p>

    <ul>
      <li>Select <strong>PermitFormFunctions.js</strong> and click <strong>Open</strong>.</li>
    </ul>
  </li>
  <li>
    <p>Save and Publish your changes</p>

    <ul>
      <li>
        <p>Click <strong>Save</strong> and wait until the changes are saved.</p>
      </li>
      <li>
        <p>Click <strong>Publish</strong> and wait for the publishing to complete.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-43.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-43.png" alt="Publish changes - screenshot"></a></p>
  </li>
</ol>

<p><strong>DO NOT</strong> close this window. You will need to come back to this window in the next exercise.</p>

<h2 id="task-4-test-your-changes">Task #4: Test Your Changes</h2>

<ol>
  <li>
    <p>Start the Permit Management application</p>

    <ul>
      <li>Select the browser tab or window for the Power Apps maker portal and click <strong>Done</strong> on the popup.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-44.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-44.png" alt="Done editing web resource - screenshot"></a></p>

    <ul>
      <li>
        <p>Select <strong>Apps</strong>.</p>
      </li>
      <li>
        <p>Click to open the <strong>Permit Management</strong> application.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Open Permit record.</p>

    <ul>
      <li>
        <p>Select Permits from the Site Map.</p>
      </li>
      <li>
        <p>Click to open a <strong>Permit</strong> record.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-45.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-45.png" alt="Open record - screenshot"></a></p>
  </li>
  <li>
    <p>Check if the <strong>Permit Type</strong> Column is empty and if it is, the <strong>Inspections</strong> tab is hidden. In this case, the Permit Type is null.</p>

    <p><a href="../L04/Static/mod-01-client-scripting-46.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-46.png" alt="Pert type Column null - screenshot"></a></p>
  </li>
  <li>
    <p>Select Permit Type.</p>

    <ul>
      <li>
        <p>Click on the <strong>Permit Type</strong> lookup.</p>
      </li>
      <li>
        <p>Select <strong>New Construction</strong>.</p>
      </li>
      <li>
        <p>Check if the <strong>Inspections</strong> tab is still hidden. If so, in this case, the Require Inspections Column value is false/No</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-47.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-47.png" alt="Pert type new construction with no inspection requirement - screenshot"></a></p>
  </li>
  <li>
    <p>Set <strong>Require Inspections</strong> Column value of the <strong>Permit Type</strong> to <strong>Yes</strong>.</p>

    <ul>
      <li>Click on the selected <strong>Permit Type</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-48.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-48.png" alt="Open permit type - screenshot"></a></p>

    <ul>
      <li>Set the <strong>Require Inspections</strong> to <strong>Yes</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-49.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-49.png" alt="Change inspection requirement - screenshot"></a></p>

    <ul>
      <li>
        <p>Click <strong>Save</strong> button on the bottom right of the screen.</p>
      </li>
      <li>
        <p>Click on the browser back button.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>You should now be able to see the Inspections tab.</p>

    <ul>
      <li>Select the <strong>Inspections</strong> tab.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-50.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-50.png" alt="Select inspection tab - screenshot"></a></p>

    <ul>
      <li>The user should now be able to view/add inspections to the sub-grid.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-51.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-51.png" alt="Inspections sub-grid - screenshot"></a></p>
  </li>
</ol>

<h1 id="exercise-3-toggle-required-property-on-the-columns">Exercise #3: Toggle *required property on the Columns</h1>

<p><strong>Objective:</strong> In this exercise, you will create a script that will make the “New Size” Column required when the “Require Size” Column value is set to Yes. If the “Require Size” Column value is set to No, remove the requirement and make it optional. You will also hide the “New Size” Column. This logic will be driven by a Column on the permit type record that was retrieved using web API in the previous exercise.</p>

<h2 id="task-1-create-function-1">Task #1: Create Function</h2>

<ol>
  <li>
    <p>Locate the _handlePermitTypeSettings function</p>

    <ul>
      <li>
        <p>Go back to <strong>Visual Studio Code</strong>.</p>
      </li>
      <li>
        <p>Locate the _<strong>handlePermitTypeSettings</strong> function.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>If permitType is null, remove the requirement and hide the “New Size” Column.</p>

    <ul>
      <li>
        <p>Add the script mentioned below in the <strong>if</strong> <strong>permitType == null</strong> statement. contoso_newsize is the logical name of the New Size Column.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock16" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock16" class="mt-0"><code class="hljs css">  <span class="hljs-selector-tag"><span class="hljs-selector-tag">formContext</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.getAttribute</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">contoso_newsize</span></span>")<span class="hljs-selector-class"><span class="hljs-selector-class">.setRequiredLevel</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">none</span></span>");

  <span class="hljs-selector-tag"><span class="hljs-selector-tag">formContext</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ui</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.controls</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.get</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">contoso_newsize</span></span>")<span class="hljs-selector-class"><span class="hljs-selector-class">.setVisible</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">false</span></span>);
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-52.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-52.png" alt="Remove requirement script - screenshot"></a></p>
  </li>
  <li>
    <p>Check if “Require Size” Column value of the Permit Type is set to Yes</p>

    <ul>
      <li>
        <p>Add the script mentioned below inside the retrieveRecord function.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock17" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock17" class="mt-0"><code class="hljs css">  <span class="hljs-selector-tag"><span class="hljs-selector-tag">if</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">result</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.contoso_requiresize</span></span>) {

  } <span class="hljs-selector-tag"><span class="hljs-selector-tag">else</span></span> {

  }
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-53.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-53.png" alt="Check requirement script - screenshot"></a></p>
  </li>
  <li>
    <p>If “Require Size” Column value of the Permit Type is set to Yes, make the “New Size” Column visible and as required.</p>

    <ul>
      <li>
        <p>Add the script mentioned below in the <strong>if</strong> <strong>result.contoso_requiresize</strong> statement. contoso_requiresize is the logical name of the Require Size Column.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock18" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock18" class="mt-0"><code class="hljs css">  <span class="hljs-selector-tag"><span class="hljs-selector-tag">formContext</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ui</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.controls</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.get</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">contoso_newsize</span></span>")<span class="hljs-selector-class"><span class="hljs-selector-class">.setVisible</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">true</span></span>);

  <span class="hljs-selector-tag"><span class="hljs-selector-tag">formContext</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.getAttribute</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">contoso_newsize</span></span>")<span class="hljs-selector-class"><span class="hljs-selector-class">.setRequiredLevel</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">required</span></span>");
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-54.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-54.png" alt="Show Column and make it required script - screenshot"></a></p>
  </li>
  <li>
    <p>If Require Size Column value of the Permit Type is not set to Yes, remove the “New Size” Column not required and hide it.</p>

    <ul>
      <li>
        <p>Add the script mentioned below inside the else statement.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock19" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock19" class="mt-0"><code class="hljs css">  <span class="hljs-selector-tag"><span class="hljs-selector-tag">formContext</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.getAttribute</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">contoso_newsize</span></span>")<span class="hljs-selector-class"><span class="hljs-selector-class">.setRequiredLevel</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">none</span></span>");

  <span class="hljs-selector-tag"><span class="hljs-selector-tag">formContext</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ui</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.controls</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.get</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">contoso_newsize</span></span>")<span class="hljs-selector-class"><span class="hljs-selector-class">.setVisible</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">false</span></span>);
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-55.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-55.png" alt="Remove requirement and hide Column script - screenshot"></a></p>
  </li>
  <li>
    <p>The _handlePermitTypeSettings function should now look like the image below.</p>

    <p><a href="../L04/Static/mod-01-client-scripting-56.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-56.png" alt="Completed handle permit type settings function - screenshot"></a></p>
  </li>
</ol>

<p>Click <strong>File</strong> and <strong>Save All</strong>.</p>

<h2 id="task-2-load-updated-script">Task #2: Load Updated Script</h2>

<ol>
  <li>
    <p>Open the Permit Form Script web resource.</p>

    <ul>
      <li>
        <p>Go back to the Permit Form Scripts web resource.</p>
      </li>
      <li>
        <p>Click <strong>Choose File</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-57.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-57.png" alt="Choose file - screenshot"></a></p>

    <ul>
      <li>Select the <strong>PermitFormFunctions.js</strong> you updated and click <strong>Open</strong>.</li>
    </ul>
  </li>
  <li>
    <p>Save and Publish your changes</p>

    <ul>
      <li>
        <p>Click <strong>Save</strong> and wait until the changes are saved.</p>
      </li>
      <li>
        <p>Click <strong>Publish All Customizations</strong> and wait for the publishing to complete.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-58.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-58.png" alt="Publish all customizations - screenshot"></a></p>
  </li>
</ol>

<p>Close the Web Resource editor.</p>

<h2 id="task-3-test-your-changes">Task #3: Test Your Changes</h2>

<ol>
  <li>
    <p>Start the Permit Management application</p>

    <ul>
      <li>
        <p>Log on to <a href="https://make.powerapps.com/">https://make.powerapps.com</a> and select your <strong>Dev</strong> environment.</p>
      </li>
      <li>
        <p>Select <strong>Apps</strong>.</p>
      </li>
      <li>
        <p>Click to open the <strong>Permit Management</strong> application.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Open Permit record.</p>

    <ul>
      <li>
        <p>Select Permits.</p>
      </li>
      <li>
        <p>Click to open a <strong>Permit</strong> record.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-59.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-59.png" alt="Open record - screenshot"></a></p>
  </li>
  <li>
    <p>Check if the <strong>New Size</strong> Column is hidden. If so, then it is because in this case, the “Require Size” Column of the Permit Type is set to NO.</p>

    <p><a href="../L04/Static/mod-01-client-scripting-60.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-60.png" alt="Hidden Column - screenshot"></a></p>
  </li>
  <li>
    <p>Set <strong>Require Size</strong> Column value of the <strong>Permit Type</strong> to <strong>Yes</strong>.</p>

    <ul>
      <li>Click on the selected <strong>Permit Type</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-61.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-61.png" alt="Open permit type - screenshot"></a></p>

    <ul>
      <li>Set the <strong>Require Size</strong> to <strong>Yes</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-62.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-62.png" alt="Change require size to yes - screenshot"></a></p>

    <ul>
      <li>
        <p>Click <strong>Save</strong> on the bottom right of the screen.</p>
      </li>
      <li>
        <p>Click on the browser back button.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Check if the “New Size” Column is visible and it is marked as required.</p>

    <ul>
      <li>You should now be able to see “<strong>New Size”</strong> Column on the form and this is marked as required.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-63.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-63.png" alt="Required Column- screenshot"></a></p>

    <ul>
      <li>Remove <strong>Permit Type</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-64.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-64.png" alt="Remove permit type - screenshot"></a></p>

    <ul>
      <li>Check if both the <strong>Inspections</strong> tab and <strong>New Size</strong> Column are now hidden. They should be removed as soon as the “Permit Type” is removed.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-65.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-65.png" alt="Removed tab and size Column - screenshot"></a></p>
  </li>
</ol>

<h1 id="exercise-4-command-button-function">Exercise #4: Command Button Function</h1>

<p><strong>Objective:</strong> In this exercise, you will download and install the Ribbon Workbench tool to edit the command bar. Through this, you will also create action, create function that will lock permits, add a button to the permit Table and call the lock permit function when the button is clicked.</p>

<h2 id="task-1-download-and-install-ribbon-workbench">Task #1: Download and Install Ribbon Workbench</h2>

<p>Ribbon Workbench is a community tool that makes it easier to edit the command bar on a form. Alternatively, you can do this without the tool, by directly editing the RibbonDiffXml.</p>

<ol>
  <li>
    <p>Get Ribbon Workbench download link</p>

    <ul>
      <li>
        <p>Log on to <a href="http://www.develop1.net/public/Download Ribbon Workbench 2013.aspx">http://www.develop1.net/public/Download%20Ribbon%20Workbench%202013.aspx</a></p>
      </li>
      <li>
        <p>Click <strong>Download</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-66.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-66.png" alt="Download - screenshot"></a></p>

    <ul>
      <li>
        <p>Provide a name and an email and the download link will be sent to that email.</p>
      </li>
      <li>
        <p>Select <strong>Dynamics 365/Power Apps</strong> for <strong>Version</strong> available and click <strong>Send Download Link</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-67.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-67.png" alt="Send download link - screenshot"></a></p>

    <ul>
      <li>Wait to receive the download link in an email to the provided email address.</li>
    </ul>
  </li>
  <li>
    <p>Download Ribbon Workbench</p>

    <ul>
      <li>
        <p>After you receive the email, click on the download button.</p>
      </li>
      <li>
        <p>Save the downloaded solution on your machine.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Install Ribbon Workbench solution.</p>

    <ul>
      <li>
        <p>Sign in to <a href="https://make.powerapps.com/">Power Apps maker portal</a> and select your <strong>Dev</strong> environment.</p>
      </li>
      <li>
        <p>Select <strong>Solutions</strong> and click <strong>Import</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-68.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-68.png" alt="Import solution - screenshot"></a></p>

    <ul>
      <li>
        <p>Click <strong>Choose File</strong>.</p>
      </li>
      <li>
        <p>Select the <strong>RibbonWorkbench</strong> solution you just downloaded and click <strong>Open</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-69.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-69.png" alt="Select solution - screenshot"></a></p>

    <ul>
      <li>
        <p>Click <strong>Next</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Next</strong> again.</p>
      </li>
      <li>
        <p>Click <strong>Import</strong> and wait for the import to complete.</p>
      </li>
      <li>
        <p>Click <strong>Close</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-70.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-70.png" alt="Close solution import wizard - screenshot"></a></p>
  </li>
  <li>
    <p>Confirm the Ribbon Workbench was installed</p>

    <ul>
      <li>Select <strong>Apps</strong> and click to open the <strong>Permit Management</strong> application.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-71.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-71.png" alt="Open application - screenshot"></a></p>

    <ul>
      <li>Click <strong>Settings</strong> and select <strong>Advanced Settings</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-72.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-72.png" alt="Advanced setting - screenshot"></a></p>

    <ul>
      <li>
        <table>
          <tbody>
            <tr>
              <td>Click **Settings</td>
              <td>Solutions**.</td>
            </tr>
          </tbody>
        </table>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-73.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-73.png" alt="Open solutions - screenshot"></a></p>

    <ul>
      <li>You should see the Ribbon Workbench button on the top.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-74.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-74.png" alt="Ribbon workbench - screenshot"></a></p>
  </li>
  <li>
    <p>Close the <strong>Advanced Settings</strong> browser tab or window.</p>
  </li>
  <li>
    <p>Close the Permit Management application.</p>
  </li>
</ol>

<h2 id="task-2-create-action-process">Task #2: Create Action Process</h2>

<p>In this task, you will create a custom action that will be called to lock the permit. You will not be implementing the business logic in this lab to lock the permit. It will be completed later in the class when you build the plug-in that registers on the custom actions you will define here.</p>

<ol>
  <li>
    <p>Open the Permit Management Solution.</p>

    <ul>
      <li>
        <p>Navigate to <a href="https://make.powerapps.com/">Power Apps makes portal</a> and make sure you have the <strong>Dev</strong> environment selected.</p>
      </li>
      <li>
        <p>Select <strong>Solutions</strong> and click to open the <strong>Permit Management</strong> solution.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Switch to Classic</p>

    <ul>
      <li>Click on the <strong>….</strong> button and select <strong>Switch to Classic</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-75.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-75.png" alt="Switch to classic - screenshot"></a></p>
  </li>
  <li>
    <p>Create new process</p>

    <ul>
      <li>Select <strong>Processes</strong> and click <strong>New</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-76.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-76.png" alt="Create new process - screenshot"></a></p>

    <ul>
      <li>Enter <strong>Lock Permit</strong> for <strong>Name</strong>, select <strong>Action</strong> from the dropdown for <strong>Category</strong>, select <strong>Permit</strong> from the dropdown for <strong>Table</strong>, select <strong>New Blank Process</strong> for <strong>Type</strong>, and click <strong>OK</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-77.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-77.png" alt="New process form - screenshot"></a></p>
  </li>
  <li>
    <p>Add process arguments</p>

    <ul>
      <li>Go to the <strong>Process Arguments</strong> section and click <strong>Add</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-78.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-78.png" alt="Add process argument - screenshot"></a></p>

    <ul>
      <li>Enter <strong>Reason</strong> for <strong>Name</strong>, select <strong>Type as String</strong>, and select <strong>Input</strong> for <strong>Direction</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-79.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-79.png" alt="Add string input argument - screenshot"></a></p>

    <ul>
      <li>
        <p>Click <strong>Add</strong> again.</p>
      </li>
      <li>
        <p>Enter <strong>CanceledInspectionsCount</strong> for <strong>Name</strong>, select <strong>Type</strong> as <strong>Integer</strong>, and select <strong>Output</strong> for <strong>Direction</strong>.</p>
      </li>
      <li>
        <p>You should now have one input and one output arguments.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-80.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-80.png" alt="Process arguments - screenshot"></a></p>
  </li>
  <li>
    <p>Save and activate action</p>

    <ul>
      <li>
        <p>Click <strong>Save</strong> and wait until the changes are saved.</p>
      </li>
      <li>
        <p>Click <strong>Activate</strong>. This will open a pop-up for confirmation. Click <strong>Activate.</strong></p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-81.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-81.png" alt="Activate process - screenshot"></a></p>

    <ul>
      <li>
        <p>Confirm the activation and wait for the action to be activated. You should now be able to see the Deactivate option in the Top menu.</p>
      </li>
      <li>
        <p>Click <strong>Close</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-82.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-82.png" alt="Close process editor - screenshot"></a></p>

    <ul>
      <li>Close the solution explorer.</li>
    </ul>
  </li>
</ol>

<h2 id="task-3-create-the-function">Task #3: Create the Function</h2>

<p>In this task, you will create the logic to invoke a custom action using the web API.</p>

<ol>
  <li>
    <p>Start Visual Studio Code and open the resources you create in exercise one</p>

    <ul>
      <li>
        <p>Start <strong>Visual Studio Code</strong>.</p>
      </li>
      <li>
        <p>Click <strong>File</strong> and select <strong>Open Folder</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-83.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-83.png" alt="Open folder - screenshot"></a></p>

    <ul>
      <li>Select the <strong>ContosoClientScrpts</strong> folder you created in exercise one and click <strong>Select Folder</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-84.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-84.png" alt="Select folder - screenshot"></a></p>
  </li>
  <li>
    <p>Add a function that will build the request</p>

    <ul>
      <li>Open the <strong>PermitFormFunctions.js</strong> file.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-85.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-85.png" alt="Permit dorm function file - screenshot"></a></p>

    <ul>
      <li>
        <p>Add the function below after the _handlePermitTypeSettings function.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock20" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock20" class="mt-0"><code class="hljs javascript">  _lockPermitRequest : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">permitID, reason</span></span></span><span class="hljs-function">) </span></span>{

  },
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-86.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-86.png" alt="Add lock permit request function - screenshot"></a></p>
  </li>
  <li>
    <p>Build entity and set reason.</p>

    <ul>
      <li>
        <p>Add the script mentioned below inside the <strong>_lockPermitRequest</strong> function.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock21" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock21" class="mt-0"><code class="hljs objectivec">  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entity = { entityType: <span class="hljs-string"><span class="hljs-string">"contoso_permit"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>: permitID };

  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Reason = reason;
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>Build and return the request</p>

    <ul>
      <li>
        <p>Add the script mentioned below in the <strong>_lockPermiRequest</strong> function.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock22" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock22" class="mt-0"><code class="hljs coffeescript">  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getMetadata = function () {
      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {
          boundParameter: <span class="hljs-string"><span class="hljs-string">"entity"</span></span>, parameterTypes: {
              <span class="hljs-string"><span class="hljs-string">"entity"</span></span>: {
                  typeName: <span class="hljs-string"><span class="hljs-string">"mscrm.contoso_permit"</span></span>,
                  structuralProperty: <span class="hljs-number"><span class="hljs-number">5</span></span>
              },
              <span class="hljs-string"><span class="hljs-string">"Reason"</span></span>: {
                  <span class="hljs-string"><span class="hljs-string">"typeName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Edm.String"</span></span>,
                  <span class="hljs-string"><span class="hljs-string">"structuralProperty"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> // Primitive Type
              }
          },
          operationType: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> an action. Use <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> functions <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-string"><span class="hljs-string">'2'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> CRUD
          operationName: <span class="hljs-string"><span class="hljs-string">"contoso_LockPermit"</span></span>,
      };
  };
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-87.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-87.png" alt="Add lock permit request function progress- screenshot"></a></p>
  </li>
  <li>
    <p>Add the function that will be called from the action button.</p>

    <ul>
      <li>
        <p>Add the function mentioned below after the <strong>_lockPermitRequest</strong> function.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock23" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock23" class="mt-0"><code class="hljs javascript">  lockPermit: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">primaryControl</span></span></span><span class="hljs-function">) </span></span>{

  },
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-88.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-88.png" alt="Lock permit function - screenshot"></a></p>
  </li>
  <li>
    <p>Get Permit ID and call <strong>_lockPermitRequest</strong></p>

    <ul>
      <li>
        <p>Get the id by adding the script mentioned below inside the <strong>lockPermit</strong> function.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock24" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock24" class="mt-0"><code class="hljs nginx">  <span class="hljs-attribute"><span class="hljs-attribute">formContext</span></span> = primaryControl;
  <span class="hljs-attribute"><span class="hljs-attribute">var</span></span> PermitID = formContext.data.entity.getId().replace(<span class="hljs-string"><span class="hljs-string">'{'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>).replace(<span class="hljs-string"><span class="hljs-string">'}'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>);
</code></pre>
      </li>
      <li>
        <p>Call <strong>_lockPermitRequest</strong>. We are hardcoding the reason “Admin Lock”</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock25" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock25" class="mt-0"><code class="hljs cs">  <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lockPermitRequest = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContosoPermit.Scripts.PermitForm._lockPermitRequest(PermitID, <span class="hljs-string"><span class="hljs-string">"Admin Lock"</span></span>);
</code></pre>
      </li>
    </ul>
  </li>
  <li>
    <p>Execute the request.</p>

    <ul>
      <li>
        <p>Add the script mentioned below inside the lockPermit function.</p>

        <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock26" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock26" class="mt-0"><code class="hljs javascript">  <span class="hljs-comment"><span class="hljs-comment">// Use the request object to execute the function</span></span>
      Xrm.WebApi.online.execute(lockPermitRequest).then(
          <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) </span></span>{
              <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.ok) {
                  <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Status: %s %s"</span></span>, result.status, result.statusText);
                  <span class="hljs-comment"><span class="hljs-comment">// perform other operations as required;</span></span>
                  formContext.ui.setFormNotification(<span class="hljs-string"><span class="hljs-string">"Status "</span></span> + result.status, <span class="hljs-string"><span class="hljs-string">"INFORMATION"</span></span>);
              }
          },
          <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{
              <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(error.message);
              <span class="hljs-comment"><span class="hljs-comment">// handle error conditions</span></span>
          }
      );
</code></pre>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-89.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-89.png" alt="Lock permit function screenshot"></a></p>

    <ul>
      <li>Click <strong>File</strong> and <strong>Save All</strong>.</li>
    </ul>
  </li>
  <li>
    <p>Load the update resource and publish.</p>

    <ul>
      <li>
        <p>Log on to <a href="https://make.powerapps.com/">Power Apps maker portal</a> and make sure you have the <strong>Dev</strong> environment selected.</p>
      </li>
      <li>
        <p>Select <strong>Solutions</strong> and click to open the <strong>Permit Management</strong> solution.</p>
      </li>
      <li>
        <p>Click to open the <strong>Permit Form Scripts</strong> web resource. This will open a new browser window.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-90.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-90.png" alt="Open web resource -screenshot"></a></p>

    <ul>
      <li>
        <p>Click <strong>Choose File</strong>.</p>
      </li>
      <li>
        <p>Select the <strong>PermitFormFunctions.js</strong> you updated and click <strong>Open</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Save</strong> and wait until the changes are saved.</p>
      </li>
      <li>
        <p>Click <strong>Publish All Customizations</strong> and wait for the publishing to complete.</p>
      </li>
      <li>
        <p>Close the web resource editor and return to the solutions window.</p>
      </li>
      <li>
        <p>Click <strong>Done</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-91.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-91.png" alt="Done editing - screenshot "></a></p>
  </li>
</ol>

<h2 id="task-4-add-button-to-ribbon">Task #4: Add Button to Ribbon</h2>

<ol>
  <li>
    <p>Open Ribbon Workbench</p>

    <ul>
      <li>
        <p>Sign in to <a href="https://make.powerapps.com/">Power Apps maker portal</a> and make sure you have the <strong>Dev</strong> environment selected.</p>
      </li>
      <li>
        <p>Select <strong>Apps</strong> and click to open the <strong>Permit Management</strong> application.</p>
      </li>
      <li>
        <p>Click <strong>Settings</strong> and select <strong>Advanced Settings</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-92.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-92.png" alt="Advanced settings - screenshot"></a></p>

    <ul>
      <li>
        <table>
          <tbody>
            <tr>
              <td>Click **Settings</td>
              <td>Solutions**.</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>Click on the Ribbon Workbench button.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-93.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-93.png" alt="Open ribbon workbench - screenshot"></a></p>
  </li>
  <li>
    <p>Load the Permit Management solution</p>

    <ul>
      <li>
        <p>Select the <strong>Permit Management</strong> solution in the pop-up opened for selecting the Load Solution.</p>
      </li>
      <li>
        <p>Click <strong>OK</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-94.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-94.png" alt="Select permit management solution - screenshot"></a></p>

    <ul>
      <li>Wait for the solution to be downloaded.</li>
    </ul>
  </li>
  <li>
    <p>Add command to permit Table</p>

    <ul>
      <li>
        <p>Select <strong>contoso_permit</strong> from the dropdown for Table.</p>
      </li>
      <li>
        <p>Click <strong>Add Command</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-95.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-95.png" alt="Add command - screenshot"></a></p>
  </li>
  <li>
    <p>Add action to command</p>

    <ul>
      <li>Select the command you just created.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-96.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-96.png" alt="Select command - screenshot"></a></p>

    <ul>
      <li>Click <strong>Add Action.</strong></li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-97.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-97.png" alt="Add action - screenshot"></a></p>

    <ul>
      <li>Select <strong>JavaScript</strong> <strong>Action</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-98.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-98.png" alt="JavaScript action - screenshot"></a></p>

    <ul>
      <li>Search for <strong>contoso</strong> and select <strong>contoso_PermitFormScripts.js</strong></li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-99.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-99.png" alt="Select library - screenshot"></a></p>

    <ul>
      <li>Enter <strong>ContosoPermit.Scripts.PermitForm.lockPermit</strong> in the textbox for <strong>Function Name</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-100.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-100.png" alt="Function name - screenshot"></a></p>
  </li>
  <li>
    <p>Add primary control parameter</p>

    <ul>
      <li>Click <strong>Add Parameter</strong> and select <strong>CRM Parameter</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-101.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-101.png" alt="Add CRM parameter - screenshot"></a></p>

    <ul>
      <li>Select <strong>PrimaryControl</strong> for <strong>Value</strong>.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-102.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-102.png" alt="Select primary control as parameter value - screenshot"></a></p>
  </li>
  <li>
    <p>Add a button select command</p>

    <ul>
      <li>Drag a <strong>Button</strong> from the <strong>Toolbox</strong> and drop it between <strong>Deactivate</strong> and <strong>Delete</strong>. Make sure you are adding it on the Mscrm.Form.contoso_permit.MainTab section.</li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-103.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-103.png" alt="Add button - screenshot"></a></p>

    <ul>
      <li>
        <p>Select the button you just added to ribbon.</p>
      </li>
      <li>
        <p>Go to the <strong>Properties</strong> section and select the command you created for <strong>Command</strong>.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-104.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-104.png" alt="Select command - screenshot"></a></p>

    <ul>
      <li>
        <p>Change the <strong>Label</strong> value to <strong>Lock Permit</strong>.</p>
      </li>
      <li>
        <p>Provide <strong>Alt</strong> text, <strong>Tool Tip Title</strong>, and <strong>Tool Tip Description.</strong></p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-105.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-105.png" alt="Button properties - screenshot"></a></p>
  </li>
  <li>
    <p>Publish your changes.</p>

    <p><a href="../L04/Static/mod-01-client-scripting-106.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-106.png" alt="Publish - screenshot"></a></p>
  </li>
</ol>

<p>Click <strong>OK</strong> and wait for the publishing to complete. This might take a few minutes to complete.</p>

<h2 id="task-5-test-command-button">Task #5: Test Command Button</h2>

<ol>
  <li>
    <p>Start the Permit Management application.</p>

    <ul>
      <li>
        <p>Log on to <a href="https://make.powerapps.com/">Power Apps maker portal</a> and make sure you have your <strong>Dev</strong> environment selected.</p>
      </li>
      <li>
        <p>Select <strong>Apps</strong> and click to open the <strong>Permit Management</strong> application.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Open a permit record</p>

    <ul>
      <li>
        <p>Select Permits.</p>
      </li>
      <li>
        <p>Click to open a permit.</p>
      </li>
      <li>
        <p>You should be able to see the button you just added.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-107.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-107.png" alt="Lock permit button - screenshot"></a></p>
  </li>
  <li>
    <p>Test the Command</p>

    <ul>
      <li>
        <p>Click on the <strong>Lock Permit</strong> button.</p>
      </li>
      <li>
        <p>The script should trigger the action and you should be able to see the Status 200 notification.</p>
      </li>
    </ul>

    <p><a href="../L04/Static/mod-01-client-scripting-108.png" target="_blank"><img src="../L04/Static/mod-01-client-scripting-108.png" alt="Status notification - screenshot"></a></p>
  </li>
</ol>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/PL-400_Microsoft-Power-Platform-Developer" target="_blank" class="ml-2">
                    MicrosoftLearning/PL-400_Microsoft-Power-Platform-Developer
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D964044cdd8d04bfc4633129f4b07c6ada955ec8f.js"></script>



</body></html>