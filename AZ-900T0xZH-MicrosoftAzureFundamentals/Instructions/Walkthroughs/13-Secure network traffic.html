<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-900T0xZH-MicrosoftAzureFundamentals
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-900T0xZH-MicrosoftAzureFundamentals
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-900T0xZH-MicrosoftAzureFundamentals" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    </ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="13---保护网络流量10-分钟">13 - 保护网络流量（10 分钟）</h1>

<p>在此演练中，我们将配置一个网络安全组。</p>

<h1 id="任务-1创建虚拟机">任务 1：创建虚拟机</h1>

<p>在此任务中，我们将创建 Windows Server 2019 Datacenter 虚拟机。</p>

<ol>
  <li>
    <p>登录到 <a href="https://portal.azure.com">Azure 门户</a>。</p>
  </li>
  <li>
    <p>从“<strong>所有服务</strong>”边栏选项卡，搜索并选择“<strong>虚拟机</strong>”，然后单击“<strong>+ 添加</strong>”、“<strong>+ 创建</strong>”、“<strong>+ 新建</strong>”虚拟机。</p>
  </li>
  <li>
    <p>在 <strong>“基本”</strong> 选项卡上，填写以下信息（保留其他所有设置的默认值）：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>订阅</td>
          <td><strong>使用提供的默认值</strong></td>
        </tr>
        <tr>
          <td>资源组</td>
          <td><strong>创建新的资源组</strong></td>
        </tr>
        <tr>
          <td>虚拟机名称</td>
          <td><strong>SimpleWinVM</strong></td>
        </tr>
        <tr>
          <td>区域</td>
          <td><strong>（美国）美国东部</strong></td>
        </tr>
        <tr>
          <td>映像</td>
          <td><strong>Windows Server 2019 Datacenter Gen 2</strong></td>
        </tr>
        <tr>
          <td>大小</td>
          <td><strong>标准 D2s v3</strong></td>
        </tr>
        <tr>
          <td>管理员帐户用户名</td>
          <td><strong>azureuser</strong></td>
        </tr>
        <tr>
          <td>管理员帐户密码</td>
          <td><strong>Pa$$w0rd1234</strong></td>
        </tr>
        <tr>
          <td>入站端口规则</td>
          <td><strong>无</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>切换到 <strong>“联网”</strong> 选项卡，然后配置以下设置：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>NIC 网络安全组</td>
          <td><strong>无</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>切换到 <strong>“管理”</strong> 选项卡，然后在其 <strong>“监视”</strong> 部分中选择以下设置：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>启动诊断</td>
          <td><strong>禁用</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>保留其余默认值，然后单击页面底部的 <strong>“查看 + 创建”</strong> 按钮。</p>
  </li>
  <li>
    <p>验证通过后，单击 <strong>“创建”</strong> 按钮。部署虚拟机大约需要五分钟时间。</p>
  </li>
  <li>
    <p>监视部署。创建资源组和虚拟机可能需要几分钟时间。</p>
  </li>
  <li>
    <p>在部署边栏选项卡或从“通知”区域，单击 <strong>“前往资源”</strong>。</p>
  </li>
  <li>
    <p>在 <strong>SimpleWinVM</strong> 虚拟机边栏选项卡上，单击 <strong>“联网”</strong>，查看 <strong>“入站端口规则”</strong> 选项卡，并注意没有与虚拟机的网络接口或网络接口所连接的子网关联的网络安全组。</p>

    <p><strong>备注</strong>：识别网络接口的名称。在下一个任务中需要使用它。</p>
  </li>
</ol>

<h1 id="任务-2创建网络安全组">任务 2：创建网络安全组</h1>

<p>在本任务中，我们将创建一个网络安全组并将其与网络接口关联。</p>

<ol>
  <li>
    <p>从“<strong>所有服务</strong>”边栏选项卡，搜索并选择“<strong>网络安全组</strong>”，然后单击 <strong>“+ 添加”、“+ 创建”、“+ 新建”</strong></p>
  </li>
  <li>
    <p>在 <strong>“创建网络安全组”</strong> 边栏选项卡的 <strong>“基本”</strong> 选项卡中，指定以下设置：</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>订阅</td>
          <td><strong>使用默认订阅</strong></td>
        </tr>
        <tr>
          <td>资源组</td>
          <td><strong>请从下拉列表中选择默认值</strong></td>
        </tr>
        <tr>
          <td>名称</td>
          <td><strong>myNSGSecure</strong></td>
        </tr>
        <tr>
          <td>区域</td>
          <td><strong>（美国）美国东部</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>单击 <strong>“查看 + 创建”</strong>，然后在验证后单击 <strong>“创建”</strong>。</p>
  </li>
  <li>
    <p>创建 NSG 后，单击 <strong>“前往资源”</strong>。</p>
  </li>
  <li>
    <p>在“<strong>设置</strong>”下，单击“<strong>网络接口</strong>”，然后单击“<strong>关联</strong>”。</p>
  </li>
  <li>
    <p>选择你在上一个任务中识别的网络接口。</p>
  </li>
</ol>

<h1 id="任务-3配置入站安全端口规则以允许-rdp">任务 3：配置入站安全端口规则以允许 RDP</h1>

<p>在此任务中，我们将通过配置入站安全端口规则来允许虚拟机的 RDP 流量。</p>

<ol>
  <li>
    <p>在 Azure 门户中，导航到 <strong>SimpleWinVM</strong> 虚拟机的边栏选项卡。</p>
  </li>
  <li>
    <p>在 <strong>“概述”</strong> 窗格中，单击 <strong>“连接”</strong>。</p>
  </li>
  <li>
    <p>选择“RDP”并下载运行 RDP 的文件，尝试连接到虚拟机。默认情况下，网络安全组不允许 RDP。关闭错误窗口。</p>

    <p><a href="../images/1201.png" target="_blank"><img src="../images/1201.png" alt="显示“虚拟机连接失败”错误消息的屏幕截图。"></a></p>
  </li>
  <li>
    <p>在虚拟机边栏选项卡上，向下滚动到“<strong>设置</strong>”部分，单击“<strong>网络</strong>”，然后注意到“<strong>myNSGSecure (附加到网络接口: myVMNic)</strong>”网络安全组的入站规则拒绝除虚拟网络和负载均衡器探测中的流量外的所有入站流量。</p>
  </li>
  <li>
    <p>在 <strong>“入站端口规则”</strong> 选项卡中，单击 <strong>“添加入站端口规则”</strong>。完成后，单击 <strong>“添加”</strong>。</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>源</td>
          <td><strong>任何</strong></td>
        </tr>
        <tr>
          <td>源端口范围</td>
          <td><strong>*</strong></td>
        </tr>
        <tr>
          <td>目标</td>
          <td><strong>任何</strong></td>
        </tr>
        <tr>
          <td>目标端口范围</td>
          <td><strong>3389</strong></td>
        </tr>
        <tr>
          <td>协议</td>
          <td><strong>TCP</strong></td>
        </tr>
        <tr>
          <td>操作</td>
          <td><strong>允许</strong></td>
        </tr>
        <tr>
          <td>优先级</td>
          <td><strong>300</strong></td>
        </tr>
        <tr>
          <td>名称</td>
          <td><strong>AllowRDP</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>选择“<strong>添加</strong>”并等待预配规则，然后返回到“<strong>连接</strong>”再次尝试通过 RDP 连接到虚拟机。这次应该会成功。记住用户是“<strong>azureuser</strong>”，密码是“<strong>Pa$$w0rd1234</strong>”。</p>
  </li>
</ol>

<h1 id="任务-4配置出站安全端口规则以拒绝-internet-访问">任务 4：配置出站安全端口规则以拒绝 Internet 访问</h1>

<p>在此任务中，我们将创建会拒绝 Internet 访问的 NSG 出站端口规则，然后对其进行测试以确保该规则正常工作。</p>

<ol>
  <li>
    <p>在你的虚拟机 RDP 会话中继续。</p>
  </li>
  <li>
    <p>计算机启动后，打开 <strong>Internet Explorer</strong> 浏览器。</p>
  </li>
  <li>
    <p>验证是否可以访问 <strong>https://www.bing.com</strong> 然后关闭 Internet Explorer。你将需要通过 IE 增强安全性弹出窗口进行工作。</p>

    <p><strong>备注</strong>：现在，我们将配置一个规则以拒绝出站 Internet 访问。</p>
  </li>
  <li>
    <p>回到 Azure 门户中，导航回 <strong>SimpleWinVM</strong> 虚拟机的边栏选项卡。</p>
  </li>
  <li>
    <p>在 <strong>“设置”</strong> 下，单击 <strong>“联网”</strong>，然后单击 <strong>“出站端口规则”</strong>。</p>
  </li>
  <li>
    <p>注意有一条规则为 <strong>“AllowInternetOutbound”</strong>。这是默认规则，无法删除。</p>
  </li>
  <li>
    <p>单击 <strong>“myNSGSecure（附加到网络接口：myVMNic）”</strong> 网络安全组右侧的 <strong>“添加出站端口规则”</strong>，然后配置具有更高优先级的新出站安全规则，该规则将拒绝 Internet 流量。完成后，单击 <strong>“添加”</strong>。</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>源</td>
          <td><strong>任何</strong></td>
        </tr>
        <tr>
          <td>源端口范围</td>
          <td><strong>*</strong></td>
        </tr>
        <tr>
          <td>目标</td>
          <td><strong>服务标记</strong></td>
        </tr>
        <tr>
          <td>目标服务标记</td>
          <td><strong>Internet</strong></td>
        </tr>
        <tr>
          <td>目标端口范围</td>
          <td><strong>*</strong></td>
        </tr>
        <tr>
          <td>协议</td>
          <td><strong>TCP</strong></td>
        </tr>
        <tr>
          <td>操作</td>
          <td><strong>拒绝</strong></td>
        </tr>
        <tr>
          <td>优先级</td>
          <td><strong>4000</strong></td>
        </tr>
        <tr>
          <td>名称</td>
          <td><strong>DenyInternet</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>单击“<strong>添加</strong>”。返回到你 RDP 的 VM。</p>
  </li>
  <li>
    <p>浏览到 <strong>https://www.microsoft.com</strong> 。该页面应该不会显示。你可能需要通过其他 IE 增强安全性弹出窗口进行工作。</p>
  </li>
</ol>

<p><strong>备注</strong>：为避免产生额外费用，你可以根据需要删除此资源组。搜索资源组，单击你的资源组，然后单击“<strong>删除资源组</strong>”。验证资源组的名称，然后单击“<strong>删除</strong>”。关注“<strong>通知</strong>”，了解删除操作的进度。</p>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-900T0xZH-MicrosoftAzureFundamentals" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-900T0xZH-MicrosoftAzureFundamentals
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D.js"></script>



</body></html>