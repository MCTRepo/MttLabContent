<!DOCTYPE html><html lang="en"><head>
        <title>
            AZ-900T0xZH-MicrosoftAzureFundamentals
        </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="../../assets/css/style_v%3D.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="../../">
                AZ-900T0xZH-MicrosoftAzureFundamentals
            </a>
            <a href="https://github.com/MicrosoftLearning/AZ-900T0xZH-MicrosoftAzureFundamentals" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
    </nav>
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    </ul>
                </nav>         
            </aside>
            <hr class>
            <article class="col-sm-10 mb-5">
                <h1 id="17---创建-azure-策略10-分钟">17 - 创建 Azure 策略（10 分钟）</h1>

<p>在本演练中，我们将创建一个 Azure 策略，以将 Azure 资源的部署限制到特定位置。</p>

<h1 id="任务-1创建策略分配">任务 1：创建策略分配</h1>

<p>在此任务中，我们将配置“允许的位置”策略并将其分配给我们的订阅。</p>

<ol>
  <li>
    <p>登录到 <a href="https://portal.azure.com">Azure 门户</a>。</p>
  </li>
  <li>
    <p>在“<strong>所有服务</strong>”边栏选项卡中，搜索并选择“<strong>策略</strong>”，在“<strong>创作</strong>”部分，单击“<strong>定义</strong>”。  花一点时间查看内置策略定义列表。例如，在“<strong>类别</strong>”下拉列表中，仅选择“<strong>计算</strong>”。注意，利用“<strong>允许的虚拟机大小 SKU</strong>”定义，可以指定组织可部署的一组虚拟机 SKU。</p>
  </li>
  <li>
    <p>返回到 <strong>“策略”</strong> 页面，在 <strong>“创作”</strong> 部分下单击 <strong>“分配”</strong>。分配是将策略分配到特定范围。例如，可以将定义分配给订阅范围。</p>
  </li>
  <li>
    <p>单击 <strong>“策略 - 分配”</strong> 页面顶部的 <strong>“分配策略”</strong>。</p>
  </li>
  <li>
    <p>在“<strong>分配策略</strong>”页上，保留默认选项。</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>范围</td>
          <td>使用默认订阅</td>
        </tr>
        <tr>
          <td>策略定义</td>
          <td>单击省略号，然后搜索“<strong>允许的位置</strong>”，然后<strong>选择</strong></td>
        </tr>
        <tr>
          <td>分配名称</td>
          <td><strong>允许的位置</strong></td>
        </tr>
      </tbody>
    </table>

    <p><a href="../images/1402.png" target="_blank"><img src="../images/1402.png" alt="此屏幕截图显示了“范围”窗格，其中已填写字段值，并突出显示“选择”按钮。 "></a></p>
  </li>
  <li>
    <p>在“<strong>参数</strong>”选项卡中，选择 <strong>“日本西部</strong>”。单击“<strong>查看 + 创建</strong>”，然后再单击“<strong>创建</strong>”。</p>

    <p><strong>备注</strong>：范围确定策略分配将应用到的资源或资源组。在本例中，我们可以将此策略分配给特定的资源组，但我们选择在订阅级别分配该策略。请注意，可以根据范围配置排除资源。排除是可选的。</p>

    <p><strong>备注</strong>：这一 <strong>“允许的位置”</strong> 策略定义将指定所有资源必须部署到的位置。如果选择其他位置，将不允许部署。有关详细信息，请参阅 <a href="https://docs.microsoft.com/zh-cn/azure/governance/policy/samples/index">Azure 策略示例</a>页面。</p>

    <p><a href="../images/1403.png" target="_blank"><img src="../images/1403.png" alt="此屏幕截图显示了“可用定义”窗格，其中突出显示了各个字段，并且选中了“审核未使用托管磁盘的 VM”选项。"></a></p>
  </li>
  <li>
    <p><strong>“允许的位置”</strong> 策略分配现已列在 <strong>“策略 - 分配”</strong> 窗格中，该策略已设置好，可在我们指定的范围级别（订阅级别）强制执行该策略。</p>
  </li>
</ol>

<h1 id="任务-2测试允许的位置策略">任务 2：测试“允许的位置”策略</h1>

<p>在此任务中，我们将测试“允许的位置”策略。</p>

<ol>
  <li>
    <p>在 Azure 门户的“<strong>所有服务</strong>”边栏选项卡中，搜索并选择“<strong>存储帐户</strong>”，然后单击“<strong>+ 创建</strong>”。</p>
  </li>
  <li>
    <p>配置存储帐户（将存储帐户名称中的 <strong>“xxxx”</strong> 替换为字母和数字，使该名称在全局范围内唯一）。其他设置均保留默认值。</p>

    <table>
      <thead>
        <tr>
          <th>设置</th>
          <th>值</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>订阅</td>
          <td><strong>使用支持的默认值</strong></td>
        </tr>
        <tr>
          <td>资源组</td>
          <td><strong>myRGPolicy</strong> （新建）</td>
        </tr>
        <tr>
          <td>存储帐户名称</td>
          <td><strong>storageaccountxxxx</strong></td>
        </tr>
        <tr>
          <td>位置</td>
          <td><strong>（美国）美国东部</strong></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>单击 <strong>“查看 + 创建”</strong>，然后单击 <strong>“创建”</strong>。</p>
  </li>
  <li>
    <p>你将收到说明策略不允许资源的“<strong>部署失败</strong>”错误，其中包含“<strong>允许的位置</strong>”策略名称。</p>
  </li>
</ol>

<h1 id="任务-3删除策略分配">任务 3：删除策略分配</h1>

<p>在此任务中，我们将删除“允许的位置”策略分配并进行测试。</p>

<p>我们将删除策略分配，确保在以后需要做的任何工作中不会受阻。</p>

<ol>
  <li>
    <p>在 <strong>“所有服务”</strong> 边栏选项卡中，搜索并选择 <strong>“策略”</strong>，然后单击 <strong>“允许的位置”</strong> 策略。</p>

    <p><strong>备注</strong>： 在 <strong>“策略”</strong> 边栏选项卡上，你可以查看已分配的各种策略的合规性状态。</p>

    <p><strong>备注</strong>： “允许的位置”策略可能会显示不合规资源。如果出现这种情况，就表示这些资源先于策略分配创建。</p>
  </li>
  <li>
    <p>单击“允许的位置”。将打开“<strong>允许的位置策略合规性</strong>”窗口。</p>
  </li>
  <li>
    <p>在顶部菜单中单击“<strong>删除分配</strong>”。单击“<strong>是</strong>”，确认删除策略分配</p>

    <p><a href="../images/1407.png" target="_blank"><img src="../images/1407.png" alt="“删除分配”菜单项的屏幕截图。"></a></p>
  </li>
  <li>
    <p>尝试创建另一个存储帐户，确保该策略不再有效。</p>

    <p><strong>备注</strong>： <strong>“允许的位置”</strong> 策略适用于以下常见场景：</p>
    <ul>
      <li><em>成本跟踪</em>： 你可以在不同的区域位置使用不同的订阅。此策略将确保所有资源都部署到目标区域以帮助进行成本跟踪。</li>
      <li><em>数据驻留和安全合规性</em>：你还可能具有数据驻留要求，按客户或特定的工作负载创建订阅，并定义所有资源必须部署在特定数据中心中，以确保满足数据和安全合规性要求。</li>
    </ul>
  </li>
</ol>

<p>恭喜！你已创建一个 Azure 策略，用于将 Azure 资源的部署限制在特定数据中心。</p>

<p><strong>备注</strong>：为避免产生额外费用，你可以根据需要删除此资源组。搜索资源组，单击你的资源组，然后单击“<strong>删除资源组</strong>”。验证资源组的名称，然后单击“<strong>删除</strong>”。关注“<strong>通知</strong>”，了解删除操作的进度。</p>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/AZ-900T0xZH-MicrosoftAzureFundamentals" target="_blank" class="ml-2">
                    MicrosoftLearning/AZ-900T0xZH-MicrosoftAzureFundamentals
                </a>
            </span>
        </nav>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="../../assets/js/script_v%3D.js"></script>



</body></html>